/*!
 * Copyright 2011-2012 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 */
/*!
 * Description : Array and textureless GLSL 2D/3D/4D simplex 
 *               noise functions.
 *      Author : Ian McEwan, Ashima Arts.
 *  Maintainer : ijm
 *     Lastmod : 20110822 (ijm)
 *     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
 *               Distributed under the MIT License. See LICENSE file.
 *               https://github.com/ashima/webgl-noise
 */
/*!
 * Cellular noise ("Worley noise") in 2D in GLSL.
 * Copyright (c) Stefan Gustavson 2011-04-19. All rights reserved.
 * This code is released under the conditions of the MIT license.
 * See LICENSE file for details.
 */
/*!\n\
 * Description : Array and textureless GLSL 2D/3D/4D simplex \n\
 *               noise functions.\n\
 *      Author : Ian McEwan, Ashima Arts.\n\
 *  Maintainer : ijm\n\
 *     Lastmod : 20110822 (ijm)\n\
 *     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n\
 *               Distributed under the MIT License. See LICENSE file.\n\
 *               https://github.com/ashima/webgl-noise\n\
 */
/*!\n\
 * Cellular noise (\"Worley noise\") in 2D in GLSL.\n\
 * Copyright (c) Stefan Gustavson 2011-04-19. All rights reserved.\n\
 * This code is released under the conditions of the MIT license.\n\
 * See LICENSE file for details.\n\
 */
/*!
 * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 
 * * Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * * Neither the name of the project nor the names of its contributors may be
 *   used to endorse or promote products derived from this software without
 *   specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Modifications made by Analytical Graphics, Inc.
 */
/*!\n\
 * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n\
 * All rights reserved.\n\
 * \n\
 * Redistribution and use in source and binary forms, with or without\n\
 * modification, are permitted provided that the following conditions\n\
 * are met:\n\
 * \n\
 * * Redistributions of source code must retain the above copyright notice,\n\
 *   this list of conditions and the following disclaimer.\n\
 * * Redistributions in binary form must reproduce the above copyright notice,\n\
 *   this list of conditions and the following disclaimer in the documentation\n\
 *   and/or other materials provided with the distribution.\n\
 * * Neither the name of the project nor the names of its contributors may be\n\
 *   used to endorse or promote products derived from this software without\n\
 *   specific prior written permission.\n\
 * \n\
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n\
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n\
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n\
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n\
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n\
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n\
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n\
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n\
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n\
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\
 *\n\
 * Modifications made by Analytical Graphics, Inc.\n\
 */
/*!
 * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 
 * * Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * * Neither the name of the project nor the names of its contributors may be
 *   used to endorse or promote products derived from this software without
 *   specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Modifications made by Analytical Graphics, Inc.
 */
/*!\n\
 * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n\
 * All rights reserved.\n\
 * \n\
 * Redistribution and use in source and binary forms, with or without\n\
 * modification, are permitted provided that the following conditions\n\
 * are met:\n\
 * \n\
 * * Redistributions of source code must retain the above copyright notice,\n\
 *   this list of conditions and the following disclaimer.\n\
 * * Redistributions in binary form must reproduce the above copyright notice,\n\
 *   this list of conditions and the following disclaimer in the documentation\n\
 *   and/or other materials provided with the distribution.\n\
 * * Neither the name of the project nor the names of its contributors may be\n\
 *   used to endorse or promote products derived from this software without\n\
 *   specific prior written permission.\n\
 * \n\
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n\
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n\
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n\
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n\
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n\
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n\
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n\
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n\
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n\
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\
 *\n\
 * Modifications made by Analytical Graphics, Inc.\n\
 */
/*!
  This library rewrites the Canvas2D "measureText" function
  so that it returns a more complete metrics object.
  This library is licensed under the MIT (Expat) license,
  the text for which is included below.

   -----------------------------------------------------------------------------

  CHANGELOG:

    2012-01-21 - Whitespace handling added by Joe Turner
                 (https://github.com/oampo)

   -----------------------------------------------------------------------------

  Copyright (C) 2011 by Mike "Pomax" Kamermans

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
  THE SOFTWARE.
*/
/** @license MIT License (c) copyright B Cavalier & J Hann */
/*!
   Portions Copyright (c) 2006-2009 Microsoft Corporation.  All rights reserved.

   http://msdn.microsoft.com/en-us/library/bb259689.aspx
   http://msdn.microsoft.com/en-us/cc300389.aspx#O

   MICROSOFT LIMITED PUBLIC LICENSE

   This license governs use of code marked as 'sample' or 'example' available on
   this web site without a license agreement, as provided under the section above
   titled 'NOTICE SPECIFIC TO SOFTWARE AVAILABLE ON THIS WEB SITE.' If you use
   such code (the 'software'), you accept this license. If you do not accept the
   license, do not use the software.

   1. Definitions

   The terms 'reproduce,' 'reproduction,' 'derivative works,' and 'distribution'
   have the same meaning here as under U.S. copyright law.

   A 'contribution' is the original software, or any additions or changes to the software.

   A 'contributor' is any person that distributes its contribution under this license.

   'Licensed patents' are a contributor's patent claims that read directly on its contribution.

   2. Grant of Rights

   (A) Copyright Grant - Subject to the terms of this license, including the license
   conditions and limitations in section 3, each contributor grants you a non-exclusive,
   worldwide, royalty-free copyright license to reproduce its contribution, prepare
   derivative works of its contribution, and distribute its contribution or any
   derivative works that you create.

   (B) Patent Grant - Subject to the terms of this license, including the license
   conditions and limitations in section 3, each contributor grants you a
   non-exclusive, worldwide, royalty-free license under its licensed patents to
   make, have made, use, sell, offer for sale, import, and/or otherwise dispose
   of its contribution in the software or derivative works of the contribution
   in the software.

   3. Conditions and Limitations

   (A) No Trademark License- This license does not grant you rights to use any
   contributors' name, logo, or trademarks.

   (B) If you bring a patent claim against any contributor over patents that
   you claim are infringed by the software, your patent license from such
   contributor to the software ends automatically.

   (C) If you distribute any portion of the software, you must retain all
   copyright, patent, trademark, and attribution notices that are present in
   the software.

   (D) If you distribute any portion of the software in source code form, you
   may do so only under this license by including a complete copy of this license
   with your distribution. If you distribute any portion of the software in
   compiled or object code form, you may only do so under a license that
   complies with this license.

   (E) The software is licensed 'as-is.' You bear the risk of using it. The
   contributors give no express warranties, guarantees or conditions. You may
   have additional consumer rights under your local laws which this license
   cannot change. To the extent permitted under your local laws, the contributors
   exclude the implied warranties of merchantability, fitness for a particular
   purpose and non-infringement.

   (F) Platform Limitation - The licenses granted in sections 2(A) and 2(B)
   extend only to the software or derivative works that you create that run
   on a Microsoft Windows operating system product.
 */
(function(){var a,b,c;(function(d){function j(a,b){if(a&&a.charAt(0)==="."&&b){b=b.split("/"),b=b.slice(0,b.length-1),a=b.concat(a.split("/"));var c,d;for(c=0;d=a[c];c++)if(d===".")a.splice(c,1),c-=1;else if(d===".."){if(c===1&&(a[2]===".."||a[0]===".."))break;c>0&&(a.splice(c-1,2),c-=2)}a=a.join("/")}return a}function k(a,b){return function(){return i.apply(d,g.call(arguments,0).concat([a,b]))}}function l(a){return function(b){return j(b,a)}}function m(a){return function(b){e[a]=b}}function n(a){if(f.hasOwnProperty(a)){var b=f[a];delete f[a],h.apply(d,b)}return e[a]}function o(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=j(a.slice(0,e),b),a=a.slice(e+1),d=n(c),d&&d.normalize?a=d.normalize(a,l(b)):a=j(a,b)):a=j(a,b),{f:c?c+"!"+a:a,n:a,p:d}}var e={},f={},g=[].slice,h,i;if(typeof c=="function")return;h=function(a,b,c,g){var h=[],i,j,l,p,q,r;g||(g=a);if(typeof c=="function"){!b.length&&c.length&&(b=["require","exports","module"]);for(p=0;p<b.length;p++){r=o(b[p],g),l=r.f;if(l==="require")h[p]=k(a);else if(l==="exports")h[p]=e[a]={},i=!0;else if(l==="module")j=h[p]={id:a,uri:"",exports:e[a]};else if(e.hasOwnProperty(l)||f.hasOwnProperty(l))h[p]=n(l);else{if(!r.p)throw a+" missing "+l;r.p.load(r.n,k(g,!0),m(l),{}),h[p]=e[l]}}q=c.apply(e[a],h),a&&(j&&j.exports!==d?e[a]=j.exports:i||(e[a]=q))}else a&&(e[a]=c)},a=i=function(a,b,c,e){return typeof a=="string"?n(o(a,b).f):(a.splice||(b.splice?(a=b,b=arguments[2]):a=[]),e?h(d,a,b,c):setTimeout(function(){h(d,a,b,c)},15),i)},i.config=function(){return i},b||(b=i),c=function(a,b,d){b.splice||(d=b,b=[]),c.unordered?f[a]=[a,b,d]:h(a,b,d)},c.amd={jQuery:!0}})(),c("../ThirdParty/almond-0.0.3/almond.js",function(){}),c("Core/DefaultProxy",[],function(){var a=function(a){this.proxy=a};return a.prototype.getURL=function(a){return this.proxy+"?"+encodeURIComponent(a)},a}),c("Core/DeveloperError",[],function(){var a=function(a){this.name="DeveloperError",this.message=a,this.error=new Error};return a.prototype.toString=function(){var a=this.name+": "+this.message;return typeof this.error!="undefined"&&(typeof this.error.stack!="undefined"?a+="\n"+this.error.stack.toString():a+="\n"+this.error.toString()),a},a}),c("Core/Enumeration",[],function(){var a=function(a,b,c){this.value=a,this.name=b;if(typeof c!="undefined")for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d])};return a.prototype.valueOf=function(){return this.value},a.prototype.toString=function(){return this.name},a}),c("Core/ClockRange",["./Enumeration"],function(a){var b={UNBOUNDED:new a(0,"UNBOUNDED"),CLAMPED:new a(1,"CLAMPED"),LOOP:new a(1,"LOOP")};return b}),c("Core/ClockStep",["./Enumeration"],function(a){var b={TICK_DEPENDENT:new a(0,"TICK_DEPENDENT"),SYSTEM_CLOCK_DEPENDENT:new a(1,"SYSTEM_CLOCK_DEPENDENT")};return b}),c("Core/ComponentDatatype",["./Enumeration"],function(a){if(typeof Int8Array=="undefined")return{};var b={};return b.BYTE=new a(5120,"BYTE"),b.BYTE.sizeInBytes=Int8Array.BYTES_PER_ELEMENT,b.BYTE.toTypedArray=function(a){return new Int8Array(a)},b.BYTE.createArrayBufferView=function(a,b){return new Int8Array(a,b)},b.UNSIGNED_BYTE=new a(5121,"UNSIGNED_BYTE"),b.UNSIGNED_BYTE.sizeInBytes=Uint8Array.BYTES_PER_ELEMENT,b.UNSIGNED_BYTE.toTypedArray=function(a){return new Uint8Array(a)},b.UNSIGNED_BYTE.createArrayBufferView=function(a,b){return new Uint8Array(a,b)},b.SHORT=new a(5122,"SHORT"),b.SHORT.sizeInBytes=Int16Array.BYTES_PER_ELEMENT,b.SHORT.toTypedArray=function(a){return new Int16Array(a)},b.SHORT.createArrayBufferView=function(a,b){return new Int16Array(a,b)},b.UNSIGNED_SHORT=new a(5123,"UNSIGNED_SHORT"),b.UNSIGNED_SHORT.sizeInBytes=Uint16Array.BYTES_PER_ELEMENT,b.UNSIGNED_SHORT.toTypedArray=function(a){return new Uint16Array(a)},b.UNSIGNED_SHORT.createArrayBufferView=function(a,b){return new Uint16Array(a,b)},b.FLOAT=new a(5126,"FLOAT"),b.FLOAT.sizeInBytes=Float32Array.BYTES_PER_ELEMENT,b.FLOAT.toTypedArray=function(a){return new Float32Array(a)},b.FLOAT.createArrayBufferView=function(a,b){return new Float32Array(a,b)},b.validate=function(a){return a===b.BYTE||a===b.UNSIGNED_BYTE||a===b.SHORT||a===b.UNSIGNED_SHORT||a===b.FLOAT},b}),c("Core/Event",["./DeveloperError"],function(a){var b=function(){this._listeners=[],this._scopes=[]};return b.prototype.getNumberOfListeners=function(){return this._listeners.length},b.prototype.addEventListener=function(b,c){if(typeof b!="function")throw new a("listener is required and must be a function.");var d=this._listeners,e=d.indexOf(b);if(e!==-1)throw new a("listener is already subscribed.");d.push(b),this._scopes.push(c)},b.prototype.removeEventListener=function(b){if(typeof b!="function")throw new a("listener is required and must be a function.");var c=this._listeners,d=c.indexOf(b);if(d===-1)throw new a("listener is not subscribed.");c.splice(d,1),this._scopes.splice(d,1)},b.prototype.raiseEvent=function(){var a=this._listeners,b=this._scopes;for(var c=a.length-1;c>-1;c--)a[c].apply(b[c],arguments)},b}),c("Core/EventModifier",["./Enumeration"],function(a){var b={SHIFT:new a(0,"SHIFT"),CTRL:new a(1,"CTRL"),ALT:new a(2,"ALT")};return b}),c("Core/FAR",[],function(){var a=5906376272e3;return a}),c("Core/Fullscreen",["./DeveloperError"],function(a){var b,c={requestFullscreen:undefined,exitFullscreen:undefined,fullscreenEnabled:undefined,fullscreenElement:undefined,fullscreenchange:undefined,fullscreenerror:undefined},d={};return d.supportsFullscreen=function(){if(typeof b!="undefined")return b;b=!1;var a=document.body;if(typeof a.requestFullscreen=="function")return c.requestFullscreen="requestFullscreen",c.exitFullscreen="exitFullscreen",c.fullscreenEnabled="fullscreenEnabled",c.fullscreenElement="fullscreenElement",c.fullscreenchange="fullscreenchange",c.fullscreenerror="fullscreenerror",b=!0,b;var d=["webkit","moz","o","ms","khtml"],e;for(var f=0,g=d.length;f<g;++f){var h=d[f];e=h+"RequestFullscreen",typeof a[e]=="function"?(c.requestFullscreen=e,b=!0):(e=h+"RequestFullScreen",typeof a[e]=="function"&&(c.requestFullscreen=e,b=!0)),e=h+"ExitFullscreen",typeof document[e]=="function"?c.exitFullscreen=e:(e=h+"CancelFullScreen",typeof document[e]=="function"&&(c.exitFullscreen=e)),e=h+"FullscreenEnabled",typeof document[e]!="undefined"?c.fullscreenEnabled=e:(e=h+"FullScreenEnabled",typeof document[e]!="undefined"&&(c.fullscreenEnabled=e)),e=h+"FullscreenElement",typeof document[e]!="undefined"?c.fullscreenElement=e:(e=h+"FullScreenElement",typeof document[e]!="undefined"&&(c.fullscreenElement=e)),e=h+"fullscreenchange",typeof document["on"+e]!="undefined"&&(c.fullscreenchange=e),e=h+"fullscreenerror",typeof document["on"+e]!="undefined"&&(c.fullscreenerror=e)}return b},d.requestFullscreen=function(a){if(!d.supportsFullscreen())return;a[c.requestFullscreen]()},d.exitFullscreen=function(){if(!d.supportsFullscreen())return;document[c.exitFullscreen]()},d.isFullscreenEnabled=function(){return d.supportsFullscreen()?document[c.fullscreenEnabled]:undefined},d.getFullscreenElement=function(){return d.supportsFullscreen()?document[c.fullscreenElement]:undefined},d.isFullscreen=function(){return d.supportsFullscreen()?d.getFullscreenElement()!==null:undefined},d.getFullscreenChangeEventName=function(){return d.supportsFullscreen()?c.fullscreenchange:undefined},d.getFullscreenErrorEventName=function(){return d.supportsFullscreen()?c.fullscreenerror:undefined},d}),c("Core/FeatureDetection",["./Fullscreen"],function(a){function c(a){return a.split(".").map(function(a){return parseInt(a,10)})}function f(){if(typeof d=="undefined"){var a=/ Chrome\/([\.0-9]+)/.exec(navigator.userAgent);if(!a)return d=!1;d=!0,e=c(a[1])}return d}function g(){return f()&&e}function j(){if(typeof h=="undefined"){if(f()||!/ Safari\/[\.0-9]+/.test(navigator.userAgent))return h=!1;var a=/ Version\/([\.0-9]+)/.exec(navigator.userAgent);if(!a)return h=!1;h=!0,i=c(a[1])}return h}function k(){return j()&&i}function n(){if(typeof l=="undefined"){var a=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(navigator.userAgent);if(!a)return l=!1;l=!0,m=c(a[1]),m.isNightly=!!a[2]}return l}function o(){return n()&&m}var b={},d,e,h,i,l,m,p;return b.supportsCrossOriginImagery=function(){return typeof p=="undefined"&&(j()&&o()[0]<536?p=!1:p="withCredentials"in new XMLHttpRequest),p},b.supportsFullscreen=function(){return a.supportsFullscreen()},b}),c("Core/IndexDatatype",["./Enumeration"],function(a){var b={UNSIGNED_BYTE:new a(5121,"UNSIGNED_BYTE"),UNSIGNED_SHORT:new a(5123,"UNSIGNED_SHORT")};return b}),c("Core/Intersect",["./Enumeration"],function(a){var b={OUTSIDE:new a(-1,"OUTSIDE"),INTERSECTING:new a(0,"INTERSECTING"),INSIDE:new a(1,"INSIDE")};return b}),c("Core/LagrangePolynomialApproximation",[],function(){var a={type:"Lagrange"};return a.getRequiredDataPoints=function(a){return Math.max(a+1,2)},a.interpolateOrderZero=function(a,b,c,d){var e,f,g=b.length,h=new Array(d);for(e=0;e<d;e++)h[e]=0;for(e=0;e<g;e++){var i=1;for(f=0;f<g;f++)if(f!==e){var j=b[e]-b[f];i*=(a-b[f])/j}for(f=0;f<d;f++)h[f]+=i*c[e*d+f]}return h},a}),c("Core/LeapSecond",["./DeveloperError"],function(a){var b=function(b,c){if(typeof b=="undefined")throw new a("date is required.");if(c===null||isNaN(c))throw new a("offset is required and must be a number.");this.julianDate=b,this.offset=c};return b.setLeapSeconds=function(c){if(!Array.isArray(c))throw new a("leapSeconds is required and must be an array.");b._leapSeconds=c,b._leapSeconds.sort(b.compareLeapSecondDate)},b.getLeapSeconds=function(a){return b._leapSeconds},b.prototype.equals=function(a){return this.julianDate.equals(a.julianDate)&&this.offset===a.offset},b.compareLeapSecondDate=function(a,b){var c=a.julianDate.getJulianDayNumber(),d=b.julianDate.getJulianDayNumber();if(c!==d)return c<d?-1:1;var e=a.julianDate.getSecondsOfDay(),f=b.julianDate.getSecondsOfDay();return e!==f?e<f?-1:1:0},b._leapSeconds=[],b}),c("Core/LinearApproximation",["./DeveloperError"],function(a){var b={type:"Linear"};return b.getRequiredDataPoints=function(b){if(b!==1)throw new a("Linear interpolation can only generate a first degree polynomial.");return 2},b.interpolateOrderZero=function(b,c,d,e){if(c.length!==2)throw new a("The xTable provided to the linear interpolator must have exactly two elements.");if(e<=0)throw new a("There must be at least 1 dependent variable for each independent variable.");var f=new Array(e),g=c[0],h=c[1],i,j,k;for(i=0;i<e;i++)j=d[i],k=d[i+e],f[i]=((k-j)*b+h*j-g*k)/(h-g);return f},b}),c("Core/MouseEventType",["./Enumeration"],function(a){var b={LEFT_DOWN:new a(0,"LEFT_DOWN"),LEFT_UP:new a(1,"LEFT_UP"),LEFT_CLICK:new a(2,"LEFT_CLICK"),LEFT_DOUBLE_CLICK:new a(3,"LEFT_DOUBLE_CLICK"),RIGHT_DOWN:new a(5,"RIGHT_DOWN"),RIGHT_UP:new a(6,"RIGHT_UP"),RIGHT_CLICK:new a(7,"RIGHT_CLICK"),RIGHT_DOUBLE_CLICK:new a(8,"RIGHT_DOUBLE_CLICK"),MIDDLE_DOWN:new a(10,"MIDDLE_DOWN"),MIDDLE_UP:new a(11,"MIDDLE_UP"),MIDDLE_CLICK:new a(12,"MIDDLE_CLICK"),MIDDLE_DOUBLE_CLICK:new a(13,"MIDDLE_DOUBLE_CLICK"),MOVE:new a(15,"MOVE"),WHEEL:new a(16,"WHEEL")};return b}),c("Core/PrimitiveType",["./Enumeration"],function(a){var b={POINTS:new a(0,"POINTS"),LINES:new a(1,"LINES"),LINE_LOOP:new a(2,"LINE_LOOP"),LINE_STRIP:new a(3,"LINE_STRIP"),TRIANGLES:new a(4,"TRIANGLES"),TRIANGLE_STRIP:new a(5,"TRIANGLE_STRIP"),TRIANGLE_FAN:new a(6,"TRIANGLE_FAN"),validate:function(a){return a===b.POINTS||a===b.LINES||a===b.LINE_LOOP||a===b.LINE_STRIP||a===b.TRIANGLES||a===b.TRIANGLE_STRIP||a===b.TRIANGLE_FAN}};return b}),c("Core/Queue",[],function(){var a=function(){this._array=[],this._offset=0,this.length=0};return a.prototype.enqueue=function(a){this._array.push(a),this.length++},a.prototype.dequeue=function(){if(this.length===0)return undefined;var a=this._array,b=this._offset,c=a[b];return a[b]=undefined,b++,b>10&&b*2>a.length&&(this._array=a.slice(b),b=0),this._offset=b,this.length--,c},a.prototype.contains=function(a){return this._array.indexOf(a)!==-1},a.prototype.clear=function(){this._array.length=this._offset=this.length=0},a.prototype.sort=function(a){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(a)},a}),c("Core/RuntimeError",[],function(){var a=function(a){this.name="RuntimeError",this.message=a,this.error=new Error};return a.prototype.toString=function(){var a=this.name+": "+this.message;return typeof this.error!="undefined"&&(typeof this.error.stack!="undefined"?a+="\n"+this.error.stack.toString():a+="\n"+this.error.toString()),a},a}),c("Core/Spherical",[],function(){var a=function(a,b,c){this.clock=typeof a=="undefined"?0:a,this.cone=typeof b=="undefined"?0:b,this.magnitude=typeof c=="undefined"?1:c};return a.fromCartesian3=function(b,c){typeof c=="undefined"&&(c=new a);var d=b.x,e=b.y,f=b.z,g=d*d+e*e;return c.clock=Math.atan2(e,d),c.cone=Math.atan2(Math.sqrt(g),f),c.magnitude=Math.sqrt(g+f*f),c},a.clone=function(b,c){return typeof c=="undefined"&&(c=new a),c.clock=b.clock,c.cone=b.cone,c.magnitude=b.magnitude,c},a.normalize=function(b,c){return typeof c=="undefined"&&(c=new a),c.clock=b.clock,c.cone=b.cone,c.magnitude=1,c},a.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a.clock===b.clock&&a.cone===b.cone&&a.magnitude===b.magnitude},a.equalsEpsilon=function(a,b,c){return c=typeof c=="undefined"?0:c,a===b||typeof a!="undefined"&&typeof b!="undefined"&&Math.abs(a.clock-b.clock)<=c&&Math.abs(a.cone-b.cone)<=c&&Math.abs(a.magnitude-b.magnitude)<=c},a.toString=function(a){return"("+a.clock+", "+a.cone+", "+a.magnitude+")"},a.prototype.clone=function(b){return a.clone(this,b)},a.prototype.normalize=function(b){return a.normalize(this,b)},a.prototype.equals=function(b){return a.equals(this,b)},a.prototype.equalsEpsilon=function(b,c){return a.equalsEpsilon(this,b,c)},a.prototype.toString=function(){return a.toString(this)},a}),c("Core/TimeConstants",[],function(){var a={SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5};return a}),c("Core/TimeStandard",[],function(){var a={UTC:0,TAI:1};return a}),c("Core/Tipsify",["./DeveloperError"],function(a){var b={};return b.calculateACMR=function(b){b=b||{};var c=b.indices,d=b.maximumIndex,e=b.cacheSize||24;if(!c)throw new a("indices is required.");var f=c.length;if(f<3||f%3!==0)throw new a("indices length must be a multiple of three.");if(d<=0)throw new a("maximumIndex must be greater than zero.");if(e<3)throw new a("cacheSize must be greater than two.");if(!d){d=0;var g=0,h=c[g];while(g<f)h>d&&(d=h),++g,h=c[g]}var i=[];for(var j=0;j<d+1;j++)i[j]=0;var k=e+1;for(var l=0;l<f;++l)k-i[c[l]]>e&&(i[c[l]]=k,++k);return(k-e+1)/(f/3)},b.tipsify=function(b){function g(a,b,c,d){while(b.length>=1){var e=b[b.length-1];b.splice(b.length-1,1);if(a[e].numLiveTriangles>0)return e}while(f<d){if(a[f].numLiveTriangles>0)return++f,f-1;++f}return-1}function h(a,b,c,d,e,f,h){var i=-1,j,k=-1,l=0;while(l<c.length){var m=c[l];if(d[m].numLiveTriangles){j=0,e-d[m].timeStamp+2*d[m].numLiveTriangles<=b&&(j=e-d[m].timeStamp);if(j>k||k===-1)k=j,i=m}++l}return i===-1?g(d,f,a,h):i}b=b||{};var c=b.indices,d=b.maximumIndex,e=b.cacheSize||24,f;if(!c)throw new a("indices is required.");var i=c.length;if(i<3||i%3!==0)throw new a("indices length must be a multiple of three.");if(d<=0)throw new a("maximumIndex must be greater than zero.");if(e<3)throw new a("cacheSize must be greater than two.");var j=0,k=0,l=c[k],m=i;if(d)j=d+1;else{while(k<m)l>j&&(j=l),++k,l=c[k];if(j===-1)return 0;++j}var n=[];for(var o=0;o<j;o++)n[o]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};k=0;var p=0;while(k<m)n[c[k]].vertexTriangles.push(p),++n[c[k]].numLiveTriangles,n[c[k+1]].vertexTriangles.push(p),++n[c[k+1]].numLiveTriangles,n[c[k+2]].vertexTriangles.push(p),++n[c[k+2]].numLiveTriangles,++p,k+=3;var q=0,r=e+1;f=1;var s=[],t=[],u,v,w=0,x=[],y=i/3,z=[];for(o=0;o<y;o++)z[o]=!1;var A,B;while(q!==-1){s=[],v=n[q],B=v.vertexTriangles.length;for(var C=0;C<B;++C){p=v.vertexTriangles[C];if(!z[p]){z[p]=!0,k=p+p+p;for(var D=0;D<3;++D)A=c[k],s.push(A),t.push(A),x[w]=A,++w,u=n[A],--u.numLiveTriangles,r-u.timeStamp>e&&(u.timeStamp=r,++r),++k}}q=h(c,e,s,n,r,t,j)}return x},b}),c("Core/TridiagonalSystemSolver",["./DeveloperError"],function(a){var b={};return b.solve=function(b,c,d,e){if(!!b&&b instanceof Array){if(!!c&&c instanceof Array){if(!!d&&d instanceof Array){if(!!e&&e instanceof Array){if(c.length!==e.length)throw new a("diagonal and right must have the same lengths.");if(b.length!==d.length)throw new a("lower and upper must have the same lengths.");if(b.length!==c.length-1)throw new a("lower and upper must be one less than the length of diagonal.");var f=[],g=[],h=[];f.length=d.length,g.length=h.length=e.length,f[0]=d[0]/c[0],g[0]=e[0].multiplyByScalar(1/c[0]);var i,j=1;for(;j<f.length;++j)i=1/(c[j]-f[j-1]*b[j-1]),f[j]=d[j]*i,g[j]=e[j].subtract(g[j-1].multiplyByScalar(b[j-1])),g[j]=g[j].multiplyByScalar(i);i=1/(c[j]-f[j-1]*b[j-1]),g[j]=e[j].subtract(g[j-1].multiplyByScalar(b[j-1])),g[j]=g[j].multiplyByScalar(i),h[h.length-1]=g[g.length-1];for(j=h.length-2;j>=0;--j)h[j]=g[j].subtract(h[j+1].multiplyByScalar(f[j]));return h}throw new a("The array right is required.")}throw new a("The array upper is required.")}throw new a("The array diagonal is required.")}throw new a("The array lower is required.")},b}),c("Core/Visibility",["./Enumeration"],function(a){var b={NONE:new a(-1,"NONE"),PARTIAL:new a(0,"PARTIAL"),FULL:new a(1,"FULL")};return b}),c("Core/WindingOrder",["./Enumeration"],function(a){var b={CLOCKWISE:new a(2304,"CLOCKWISE"),COUNTER_CLOCKWISE:new a(2305,"COUNTER_CLOCKWISE"),validate:function(a){return a===b.CLOCKWISE||a===b.COUNTER_CLOCKWISE}};return b}),c("Core/binarySearch",["./DeveloperError"],function(a){var b=function(b,c,d){if(!b)throw new a("array is required.");if(!c)throw new a("itemToFind is required.");if(!d)throw new a("comparator is required.");var e=0,f=b.length-1,g,h;while(e<=f){g=~~((e+f)/2),h=d(b[g],c);if(h<0){e=g+1;continue}if(h>0){f=g-1;continue}return g}return~(f+1)};return b}),c("Core/AnimationController",["./binarySearch","./DeveloperError"],function(a,b){var c=function(a){this.clock=a,this._animating=!0;if(typeof a!="object")throw new b("Clock parameter required to construct AnimationController.")},d=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400];return c.prototype.isAnimating=function(){return this._animating},c.prototype.reset=function(){this.clock.currentTime=this.clock.startTime,this._animating=!1},c.prototype.update=function(){return this._animating?this.clock.tick():this.clock.currentTime},c.prototype.pause=function(){this._animating=!1},c.prototype.play=function(){this._animating=!0;var a=this.clock;a.multiplier<0&&(a.multiplier=-a.multiplier),this.clock.tick(0)},c.prototype.playReverse=function(){this._animating=!0;var a=this.clock;a.multiplier>0&&(a.multiplier=-a.multiplier),this.clock.tick(0)},c.prototype.slower=function(){var b=this.clock,c=b.multiplier>0?b.multiplier:-b.multiplier,e=a(d,c,function(a,b){return a-b});e<0&&(e=~e),e--,e===-1?b.multiplier*=.5:b.multiplier>=0?b.multiplier=d[e]:b.multiplier=-d[e]},c.prototype.faster=function(){var b=this.clock,c=b.multiplier>0?b.multiplier:-b.multiplier,e=a(d,c,function(a,b){return a-b});e<0?e=~e:e++,e===d.length?b.multiplier*=2:b.multiplier>=0?b.multiplier=d[e]:b.multiplier=-d[e]},c}),c("Core/clone",[],function(){function a(b){if(b===null||typeof b!="object")return b;var c=new b.constructor;for(var d in b)b.hasOwnProperty(d)&&(c[d]=a(b[d]));return c}return a}),c("Core/createGuid",[],function(){var a=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a==="x"?b:b&3|8;return c.toString(16)})};return a}),c("Core/defaultValue",[],function(){var a=function(a,b){return typeof a!="undefined"?a:b};return a}),c("Core/Interval",["./defaultValue"],function(a){var b=function(b,c){this.start=a(b,0),this.stop=a(c,0)};return b}),c("Core/Math",["./defaultValue","./DeveloperError"],function(a,b){var c={};c.EPSILON1=.1,c.EPSILON2=.01,c.EPSILON3=.001,c.EPSILON4=1e-4,c.EPSILON5=1e-5,c.EPSILON6=1e-6,c.EPSILON7=1e-7,c.EPSILON8=1e-8,c.EPSILON9=1e-9,c.EPSILON10=1e-10,c.EPSILON11=1e-11,c.EPSILON12=1e-12,c.EPSILON13=1e-13,c.EPSILON14=1e-14,c.EPSILON15=1e-15,c.EPSILON16=1e-16,c.EPSILON17=1e-17,c.EPSILON18=1e-18,c.EPSILON19=1e-19,c.EPSILON20=1e-20,c.GRAVITATIONALPARAMETER=3986004418e5,c.sign=function(a){return a>0?1:a<0?-1:0},c.sinh=function(a){var b=Math.pow(Math.E,a),c=Math.pow(Math.E,-1*a);return(b-c)*.5},c.cosh=function(a){var b=Math.pow(Math.E,a),c=Math.pow(Math.E,-1*a);return(b+c)*.5},c.lerp=function(a,b,c){return(1-c)*a+c*b},c.PI=Math.PI,c.ONE_OVER_PI=1/Math.PI,c.PI_OVER_TWO=Math.PI*.5,c.PI_OVER_THREE=Math.PI/3,c.PI_OVER_FOUR=Math.PI/4,c.PI_OVER_SIX=Math.PI/6,c.THREE_PI_OVER_TWO=3*Math.PI*.5,c.TWO_PI=2*Math.PI,c.ONE_OVER_TWO_PI=1/(2*Math.PI),c.RADIANS_PER_DEGREE=Math.PI/180,c.DEGREES_PER_RADIAN=180/Math.PI,c.toRadians=function(a){return a*c.RADIANS_PER_DEGREE},c.toDegrees=function(a){return a*c.DEGREES_PER_RADIAN},c.convertLongitudeRange=function(a){var b=c.TWO_PI,d=a-Math.floor(a/b)*b;return d<-Math.PI?d+=b:d>=Math.PI&&(d-=b),d},c.negativePiToPi=function(a){var b=c.EPSILON10,d=c.PI,e=c.TWO_PI;while(a<-(d+b))a+=e;a<-d&&(a=-d);while(a>d+b)a-=e;return a>d&&(a=d),a},c.equalsEpsilon=function(a,b,c){return c=c||0,Math.abs(a-b)<=c};var d=[1];return c.factorial=function(a){if(typeof a!="number"||a<0)throw new b("A number greater than or equal to 0 is required.");var c=d.length;if(a>=c){var e=d[c-1];for(var f=c;f<=a;f++)d.push(e*f)}return d[a]},c.incrementWrap=function(c,d,e){e=a(e,0);if(d<=e)throw new b("Maximum value must be greater than minimum value.");return++c,c>d&&(c=e),c},c.isPowerOfTwo=function(a){if(typeof a!="number"||a<0)throw new b("A number greater than or equal to 0 is required.");var c=a|0;return c!==0&&(c&c-1)===0},c.clamp=function(a,b,c){return a<b?b:a>c?c:a},c}),c("Core/HermitePolynomialApproximation",["./Math"],function(a){function c(a,b,d,e,f,g){var h=0,i,j,k;if(e>0){for(j=0;j<f;j++){i=!1;for(k=0;k<g.length&&!i;k++)j===g[k]&&(i=!0);i||(g.push(j),h+=c(a,b,d,e-1,f,g),g.splice(g.length-1,1))}return h}h=1;for(j=0;j<f;j++){i=!1;for(k=0;k<g.length&&!i;k++)j===g[k]&&(i=!0);i||(h*=a-d[b[j]])}return h}var b=a.factorial,d={type:"Hermite"};return d.getRequiredDataPoints=function(a){return Math.max(a+1,2)},d.interpolateOrderZero=function(a,d,e,f){var g=d.length,h,i,j,k,l,m,n=new Array(f),o=new Array(f);for(h=0;h<f;h++){n[h]=0;var p=new Array(g);o[h]=p;for(i=0;i<g;i++)p[i]=[]}var q=g,r=new Array(q);for(h=0;h<q;h++)r[h]=h;var s=g-1;for(k=0;k<f;k++){for(i=0;i<q;i++)m=r[i]*f+k,o[k][0].push(e[m]);for(h=1;h<q;h++){var t=!1;for(i=0;i<q-h;i++){var u=d[r[i]],v=d[r[i+h]],w;v-u<=0?(m=r[i]*f+f*h+k,w=e[m],o[k][h].push(w/b(h))):(w=o[k][h-1][i+1]-o[k][h-1][i],o[k][h].push(w/(v-u))),t=t||w!==0}t||(s=h-1)}}for(j=0,l=0;j<=l;j++)for(h=j;h<=s;h++){var x=c(a,r,d,j,h,[]);for(k=0;k<f;k++){var y=o[k][h][0];n[k+j*f]+=y*x}}return n},d}),c("Core/QuadraticRealPolynomial",["./DeveloperError","./Math"],function(a,b){function d(a,c,d){var e=a+c;return b.sign(a)!==b.sign(c)&&Math.abs(e/Math.max(Math.abs(a),Math.abs(c)))<d?0:e}var c={};return c.discriminant=function(b,c,d){if(typeof b!="number")throw new a("a is a required number.");if(typeof c!="number")throw new a("b is a required number.");if(typeof d!="number")throw new a("c is a required number.");var e=c*c-4*b*d;return e},c.realRoots=function(c,e,f){if(typeof c!="number")throw new a("a is a required number.");if(typeof e!="number")throw new a("b is a required number.");if(typeof f!="number")throw new a("c is a required number.");var g;if(c===0)return e===0?[]:[-f/e];if(e===0){if(f===0)return[0,0];var h=Math.abs(f),i=Math.abs(c);if(h<i&&h/i<b.EPSILON14)return[0,0];if(h>i&&i/h<b.EPSILON14)return[];g=-f/c;if(g<0)return[];var j=Math.sqrt(g);return[-j,j]}if(f===0)return g=-e/c,g<0?[g,0]:[0,g];var k=e*e,l=4*c*f,m=d(k,-l,b.EPSILON14);if(m<0)return[];var n=-0.5*d(e,b.sign(e)*Math.sqrt(m),b.EPSILON14);return e>0?[n/c,f/n]:[f/n,n/c]},c}),c("Core/CubicRealPolynomial",["./DeveloperError","./Math","./QuadraticRealPolynomial"],function(a,b,c){function e(a,b,c,d){var e=a,f=b/3,g=c/3,h=d,i=e*g,j=f*h,k=f*f,l=g*g,m=e*g-k,n=e*h-f*g,o=f*h-l,p=4*m*o-n*n,q,r;if(p<0){var s,t,u;k*j>=i*l?(s=e,t=m,u=-2*f*m+e*n):(s=h,t=o,u=-h*n+2*g*o);var v=u<0?-1:1,w=-v*Math.abs(s)*Math.sqrt(-p);r=-u+w;var x=r/2,y=x<0?-Math.pow(-x,1/3):Math.pow(x,1/3),z=r===w?-y:-t/y;return q=t<=0?y+z:-u/(y*y+z*z+t),k*j>=i*l?[(q-f)/e]:[-h/(q+g)]}var A=m,B=-2*f*m+e*n,C=o,D=-h*n+2*g*o,E=Math.sqrt(p),F=Math.sqrt(3)/2,G=Math.abs(Math.atan2(e*E,-B)/3);q=2*Math.sqrt(-A);var H=Math.cos(G);r=q*H;var I=q*(-H/2-F*Math.sin(G)),J=r+I>2*f?r-f:I-f,K=e,L=J/K;G=Math.abs(Math.atan2(h*E,-D)/3),q=2*Math.sqrt(-C),H=Math.cos(G),r=q*H,I=q*(-H/2-F*Math.sin(G));var M=-h,N=r+I<2*g?r+g:I+g,O=M/N,P=K*N,Q=-J*N-K*M,R=J*M,S=(g*Q-f*R)/(-f*Q+g*P);if(L<=S)return L<=O?S<=O?[L,S,O]:[L,O,S]:[O,L,S];return L<=O?[S,L,O]:S<=O?[S,O,L]:[O,S,L]}var d={};return d.discriminant=function(b,c,d,e){if(typeof b!="number")throw new a("a is a required number.");if(typeof c!="number")throw new a("b is a required number.");if(typeof d!="number")throw new a("c is a required number.");if(typeof e!="number")throw new a("d is a required number.");var f=b*b,g=c*c,h=d*d,i=e*e,j=18*b*c*d*e+g*h-27*f*i-4*(b*h*d+g*c*e);return j},d.realRoots=function(b,d,f,g){if(typeof b!="number")throw new a("a is a required number.");if(typeof d!="number")throw new a("b is a required number.");if(typeof f!="number")throw new a("c is a required number.");if(typeof g!="number")throw new a("d is a required number.");var h,i;if(b===0)return c.realRoots(d,f,g);if(d===0){if(f===0){if(g===0)return[0,0,0];i=-g/b;var j=i<0?-Math.pow(-i,1/3):Math.pow(i,1/3);return[j,j,j]}return g===0?(h=c.realRoots(b,0,f),h.Length===0?[0]:[h[0],0,h[1]]):e(b,0,f,g)}if(f===0)return g===0?(i=-d/b,i<0?[i,0,0]:[0,0,i]):e(b,d,0,g);if(g===0)return h=c.realRoots(b,d,f),h.length===0?[0]:h[1]<=0?[h[0],h[1],0]:h[0]>=0?[0,h[0],h[1]]:[h[0],0,h[1]];return e(b,d,f,g)},d}),c("Core/QuarticRealPolynomial",["./DeveloperError","./Math","./CubicRealPolynomial","./QuadraticRealPolynomial"],function(a,b,c,d){function f(a,e,f,g){var h=a*a,i=e-3*h/8,j=f-e*a/2+h*a/8,k=g-f*a/4+e*h/16-3*h*h/256,l=c.realRoots(1,2*i,i*i-4*k,-j*j);if(l.length>0){var m=-a/4,n=l[l.length-1];if(Math.abs(n)<b.EPSILON14){var o=d.realRoots(1,i,k);if(o.length===2){var p=o[0],q=o[1],r;if(p>=0&&q>=0){var s=Math.sqrt(p),t=Math.sqrt(q);return[m-t,m-s,m+s,m+t]}if(p>=0&&q<0)return r=Math.sqrt(p),[m-r,m+r];if(p<0&&q>=0)return r=Math.sqrt(q),[m-r,m+r]}return[]}if(n>0){var u=Math.sqrt(n),v=(i+n-j/u)/2,w=(i+n+j/u)/2,x=d.realRoots(1,u,v),y=d.realRoots(1,-u,w);if(x.length!==0){x[0]+=m,x[1]+=m;if(y.length!==0)return y[0]+=m,y[1]+=m,x[1]<=y[0]?[x[0],x[1],y[0],y[1]]:y[1]<=x[0]?[y[0],y[1],x[0],x[1]]:x[0]>=y[0]&&x[1]<=y[1]?[y[0],x[0],x[1],y[1]]:y[0]>=x[0]&&y[1]<=x[1]?[x[0],y[0],y[1],x[1]]:x[0]>y[0]&&x[0]<y[1]?[y[0],x[0],y[1],x[1]]:[x[0],y[0],x[1],y[1]];return x}return y.length!==0?(y[0]+=m,y[1]+=m,y):[]}}return[]}function g(a,e,f,g){var h=f*f,i=e*e,j=a*a,k=-2*e,l=f*a+i-4*g,m=j*g-f*e*a+h,n=c.realRoots(1,k,l,m);if(n.length>0){var o=n[0],p=e-o,q=p*p,r=a/2,s=p/2,t=q-4*g,u=q+4*Math.abs(g),v=j-4*o,w=j+4*Math.abs(o),x,y;if(o<0||t*w<v*u){var z=Math.sqrt(v);x=z/2,y=z===0?0:(a*s-f)/z}else{var A=Math.sqrt(t);x=A===0?0:(a*s-f)/A,y=A/2}var B,C;r===0&&x===0?(B=0,C=0):b.sign(r)===b.sign(x)?(B=r+x,C=o/B):(C=r-x,B=o/C);var D,E;s===0&&y===0?(D=0,E=0):b.sign(s)===b.sign(y)?(D=s+y,E=g/D):(E=s-y,D=g/E);var F=d.realRoots(1,B,D),G=d.realRoots(1,C,E);if(F.length!==0)return G.length!==0?F[1]<=G[0]?[F[0],F[1],G[0],G[1]]:G[1]<=F[0]?[G[0],G[1],F[0],F[1]]:F[0]>=G[0]&&F[1]<=G[1]?[G[0],F[0],F[1],G[1]]:G[0]>=F[0]&&G[1]<=F[1]?[F[0],G[0],G[1],F[1]]:F[0]>G[0]&&F[0]<G[1]?[G[0],F[0],G[1],F[1]]:[F[0],G[0],F[1],G[1]]:F;if(G.length!==0)return G}return[]}var e={};return e.discriminant=function(b,c,d,e,f){if(typeof b!="number")throw new a("a is a required number.");if(typeof c!="number")throw new a("b is a required number.");if(typeof d!="number")throw new a("c is a required number.");if(typeof e!="number")throw new a("d is a required number.");if(typeof f!="number")throw new a("e is a required number.");var g=b*b,h=g*b,i=c*c,j=i*c,k=d*d,l=k*d,m=e*e,n=m*e,o=f*f,p=o*f,q=i*k*m-4*j*n-4*b*l*m+18*b*c*d*n-27*g*m*m+256*h*p+f*(18*j*d*e-4*i*l+16*b*k*k-80*b*c*k*e-6*b*i*m+144*g*d*m)+o*(144*b*i*d-27*i*i-128*g*k-192*g*c*e);return q},e.realRoots=function(d,e,h,i,j){if(typeof d!="number")throw new a("a is a required number.");if(typeof e!="number")throw new a("b is a required number.");if(typeof h!="number")throw new a("c is a required number.");if(typeof i!="number")throw new a("d is a required number.");if(typeof j!="number")throw new a("e is a required number.");if(Math.abs(d)<b.EPSILON15)return c.realRoots(e,h,i,j);var k=e/d,l=h/d,m=i/d,n=j/d,o=k<0?1:0;o+=l<0?o+1:o,o+=m<0?o+1:o,o+=n<0?o+1:o;switch(o){case 0:return f(k,l,m,n);case 1:return g(k,l,m,n);case 2:return g(k,l,m,n);case 3:return f(k,l,m,n);case 4:return f(k,l,m,n);case 5:return g(k,l,m,n);case 6:return f(k,l,m,n);case 7:return f(k,l,m,n);case 8:return g(k,l,m,n);case 9:return f(k,l,m,n);case 10:return f(k,l,m,n);case 11:return g(k,l,m,n);case 12:return f(k,l,m,n);case 13:return f(k,l,m,n);case 14:return f(k,l,m,n);case 15:return f(k,l,m,n);default:return undefined}},e}),c("Core/combine",["./DeveloperError","./defaultValue"],function(a,b){var c=function(a,c,e){c=b(c,!0),e=b(e,!0);var f={};for(var g=0;g<a.length;g++)d(f,a[g],c,e);return f},d=function(b,c,e,f){for(var g in c)if(c.hasOwnProperty(g))if(b.hasOwnProperty(g)&&typeof b[g]!="undefined"){if(!f)throw new a("Duplicate member: "+g);e&&typeof b[g]=="object"&&typeof c[g]=="object"&&d(b[g],c[g],e,f)}else b[g]=c[g]};return c}),c("Core/destroyObject",["./defaultValue","./DeveloperError"],function(a,b){function c(){return!0}var d=function(d,e){function f(){throw new b(e)}e=a(e,"This object was destroyed, i.e., destroy() was called.");for(var g in d)typeof d[g]=="function"?d[g]=f:delete d[g];return d.isDestroyed=c,undefined};return d}),c("Core/freezeObject",[],function(){var a=Object.freeze;return typeof a=="undefined"&&(a=function(a){return a}),a}),c("Core/Cartesian2",["./defaultValue","./DeveloperError","./freezeObject"],function(a,b,c){var d=function(b,c){this.x=a(b,0),this.y=a(c,0)};d.clone=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");return typeof c=="undefined"?new d(a.x,a.y):(c.x=a.x,c.y=a.y,c)},d.fromCartesian3=d.clone,d.fromCartesian4=d.clone,d.getMaximumComponent=function(a){if(typeof a=="undefined")throw new b("cartesian is required");return Math.max(a.x,a.y)},d.getMinimumComponent=function(a){if(typeof a=="undefined")throw new b("cartesian is required");return Math.min(a.x,a.y)},d.magnitudeSquared=function(a){if(typeof a=="undefined")throw new b("cartesian is required");return a.x*a.x+a.y*a.y},d.magnitude=function(a){return Math.sqrt(d.magnitudeSquared(a))},d.normalize=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");var e=d.magnitude(a);return typeof c=="undefined"?new d(a.x/e,a.y/e):(c.x=a.x/e,c.y=a.y/e,c)},d.dot=function(a,c){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return a.x*c.x+a.y*c.y},d.multiplyComponents=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return typeof e=="undefined"?new d(a.x*c.x,a.y*c.y):(e.x=a.x*c.x,e.y=a.y*c.y,e)},d.add=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return typeof e=="undefined"?new d(a.x+c.x,a.y+c.y):(e.x=a.x+c.x,e.y=a.y+c.y,e)},d.subtract=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return typeof e=="undefined"?new d(a.x-c.x,a.y-c.y):(e.x=a.x-c.x,e.y=a.y-c.y,e)},d.multiplyByScalar=function(a,c,e){if(typeof a=="undefined")throw new b("cartesian is required");if(typeof c!="number")throw new b("scalar is required and must be a number.");return typeof e=="undefined"?new d(a.x*c,a.y*c):(e.x=a.x*c,e.y=a.y*c,e)},d.divideByScalar=function(a,c,e){if(typeof a=="undefined")throw new b("cartesian is required");if(typeof c!="number")throw new b("scalar is required and must be a number.");return typeof e=="undefined"?new d(a.x/c,a.y/c):(e.x=a.x/c,e.y=a.y/c,e)},d.negate=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");return typeof c=="undefined"?new d(-a.x,-a.y):(c.x=-a.x,c.y=-a.y,c)},d.abs=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");return typeof c=="undefined"?new d(Math.abs(a.x),Math.abs(a.y)):(c.x=Math.abs(a.x),c.y=Math.abs(a.y),c)};var e=new d;d.lerp=function(a,c,f,g){if(typeof a=="undefined")throw new b("start is required.");if(typeof c=="undefined")throw new b("end is required.");if(typeof f!="number")throw new b("t is required and must be a number.");return d.multiplyByScalar(c,f,e),g=d.multiplyByScalar(a,1-f,g),d.add(e,g,g)};var f=new d,g=new d;d.angleBetween=function(a,c){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return d.normalize(a,f),d.normalize(c,g),Math.acos(d.dot(f,g))};var h=new d;return d.mostOrthogonalAxis=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required.");var e=d.normalize(a,h);return d.abs(e,e),e.x<=e.y?c=d.clone(d.UNIT_X,c):c=d.clone(d.UNIT_Y,c),c},d.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a.x===b.x&&a.y===b.y},d.equalsEpsilon=function(a,c,d){if(typeof d!="number")throw new b("epsilon is required and must be a number.");return a===c||typeof a!="undefined"&&typeof c!="undefined"&&Math.abs(a.x-c.x)<=d&&Math.abs(a.y-c.y)<=d},d.ZERO=c(new d(0,0)),d.UNIT_X=c(new d(1,0)),d.UNIT_Y=c(new d(0,1)),d.prototype.getMaximumComponent=function(){return d.getMaximumComponent(this)},d.prototype.getMinimumComponent=function(){return d.getMinimumComponent(this)},d.prototype.clone=function(a){return d.clone(this,a)},d.prototype.magnitudeSquared=function(){return d.magnitudeSquared(this)},d.prototype.magnitude=function(){return d.magnitude(this)},d.prototype.normalize=function(a){return d.normalize(this,a)},d.prototype.dot=function(a){return d.dot(this,a)},d.prototype.multiplyComponents=function(a,b){return d.multiplyComponents(this,a,b)},d.prototype.add=function(a,b){return d.add(this,a,b)},d.prototype.subtract=function(a,b){return d.subtract(this,a,b)},d.prototype.multiplyByScalar=function(a,b){return d.multiplyByScalar(this,a,b)},d.prototype.divideByScalar=function(a,b){return d.divideByScalar(this,a,b)},d.prototype.negate=function(a){return d.negate(this,a)},d.prototype.abs=function(a){return d.abs(this,a)},d.prototype.lerp=function(a,b,c){return d.lerp(this,a,b,c)},d.prototype.angleBetween=function(a){return d.angleBetween(this,a)},d.prototype.mostOrthogonalAxis=function(a){return d.mostOrthogonalAxis(this,a)},d.prototype.equals=function(a){return d.equals(this,a)},d.prototype.equalsEpsilon=function(a,b){return d.equalsEpsilon(this,a,b)},d.prototype.toString=function(){return"("+this.x+", "+this.y+")"},d}),c("Core/PlaneTessellator",["./DeveloperError","./Cartesian2","./PrimitiveType"],function(a,b,c){var d={compute:function(d){d=d||{};var e=d.resolution||new b(2,2),f=d.onInterpolation;if(e.x<=1||e.y<=1)throw new a("Resolution must be greater than one in both the x and y directions.");var g,h;if(f)for(h=0;h<e.y;++h){var i=h/(e.y-1);for(g=0;g<e.x;++g){var j=g/(e.x-1);f(new b(j,i))}}var k=[];for(h=0;h<e.y-1;++h){var l=h*e.x,m=(h+1)*e.x;for(g=0;g<e.x-1;++g)k.push(l+g,l+g+1,m+g+1),k.push(l+g,m+g+1,m+g)}return{attributes:{},indexLists:[{primitiveType:c.TRIANGLES,values:k}]}}};return d}),c("Core/Cartesian3",["./defaultValue","./DeveloperError","./freezeObject"],function(a,b,c){var d=function(b,c,d){this.x=a(b,0),this.y=a(c,0),this.z=a(d,0)};d.fromSpherical=function(c,e){if(typeof c=="undefined")throw new b("spherical is required");typeof e=="undefined"&&(e=new d);var f=c.clock,g=c.cone,h=a(c.magnitude,1),i=h*Math.sin(g);return e.x=i*Math.cos(f),e.y=i*Math.sin(f),e.z=h*Math.cos(g),e},d.clone=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");return typeof c=="undefined"?new d(a.x,a.y,a.z):(c.x=a.x,c.y=a.y,c.z=a.z,c)},d.fromCartesian4=d.clone,d.getMaximumComponent=function(a){if(typeof a=="undefined")throw new b("cartesian is required");return Math.max(a.x,a.y,a.z)},d.getMinimumComponent=function(a){if(typeof a=="undefined")throw new b("cartesian is required");return Math.min(a.x,a.y,a.z)},d.magnitudeSquared=function(a){if(typeof a=="undefined")throw new b("cartesian is required");return a.x*a.x+a.y*a.y+a.z*a.z},d.magnitude=function(a){return Math.sqrt(d.magnitudeSquared(a))},d.normalize=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");var e=d.magnitude(a);return typeof c=="undefined"?new d(a.x/e,a.y/e,a.z/e):(c.x=a.x/e,c.y=a.y/e,c.z=a.z/e,c)},d.dot=function(a,c){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return a.x*c.x+a.y*c.y+a.z*c.z},d.multiplyComponents=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return typeof e=="undefined"?new d(a.x*c.x,a.y*c.y,a.z*c.z):(e.x=a.x*c.x,e.y=a.y*c.y,e.z=a.z*c.z,e)},d.add=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return typeof e=="undefined"?new d(a.x+c.x,a.y+c.y,a.z+c.z):(e.x=a.x+c.x,e.y=a.y+c.y,e.z=a.z+c.z,e)},d.subtract=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return typeof e=="undefined"?new d(a.x-c.x,a.y-c.y,a.z-c.z):(e.x=a.x-c.x,e.y=a.y-c.y,e.z=a.z-c.z,e)},d.multiplyByScalar=function(a,c,e){if(typeof a=="undefined")throw new b("cartesian is required");if(typeof c!="number")throw new b("scalar is required and must be a number.");return typeof e=="undefined"?new d(a.x*c,a.y*c,a.z*c):(e.x=a.x*c,e.y=a.y*c,e.z=a.z*c,e)},d.divideByScalar=function(a,c,e){if(typeof a=="undefined")throw new b("cartesian is required");if(typeof c!="number")throw new b("scalar is required and must be a number.");return typeof e=="undefined"?new d(a.x/c,a.y/c,a.z/c):(e.x=a.x/c,e.y=a.y/c,e.z=a.z/c,e)},d.negate=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");return typeof c=="undefined"?new d(-a.x,-a.y,-a.z):(c.x=-a.x,c.y=-a.y,c.z=-a.z,c)},d.abs=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");return typeof c=="undefined"?new d(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z)):(c.x=Math.abs(a.x),c.y=Math.abs(a.y),c.z=Math.abs(a.z),c)};var e=new d;d.lerp=function(a,c,f,g){if(typeof a=="undefined")throw new b("start is required.");if(typeof c=="undefined")throw new b("end is required.");if(typeof f!="number")throw new b("t is required and must be a number.");return d.multiplyByScalar(c,f,e),g=d.multiplyByScalar(a,1-f,g),d.add(e,g,g)};var f=new d,g=new d;d.angleBetween=function(a,c){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");d.normalize(a,f),d.normalize(c,g);var e=d.dot(f,g),h=d.cross(f,g,f).magnitude();return Math.atan2(h,e)};var h=new d;return d.mostOrthogonalAxis=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required.");var e=d.normalize(a,h);return d.abs(e,e),e.x<=e.y?e.x<=e.z?c=d.clone(d.UNIT_X,c):c=d.clone(d.UNIT_Z,c):e.y<=e.z?c=d.clone(d.UNIT_Y,c):c=d.clone(d.UNIT_Z,c),c},d.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a.x===b.x&&a.y===b.y&&a.z===b.z},d.equalsEpsilon=function(a,c,d){if(typeof d!="number")throw new b("epsilon is required and must be a number.");return a===c||typeof a!="undefined"&&typeof c!="undefined"&&Math.abs(a.x-c.x)<=d&&Math.abs(a.y-c.y)<=d&&Math.abs(a.z-c.z)<=d},d.cross=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");var f=a.x,g=a.y,h=a.z,i=c.x,j=c.y,k=c.z,l=g*k-h*j,m=h*i-f*k,n=f*j-g*i;return typeof e=="undefined"?new d(l,m,n):(e.x=l,e.y=m,e.z=n,e)},d.ZERO=c(new d(0,0,0)),d.UNIT_X=c(new d(1,0,0)),d.UNIT_Y=c(new d(0,1,0)),d.UNIT_Z=c(new d(0,0,1)),d.prototype.getMaximumComponent=function(){return d.getMaximumComponent(this)},d.prototype.getMinimumComponent=function(){return d.getMinimumComponent(this)},d.prototype.clone=function(a){return d.clone(this,a)},d.prototype.magnitudeSquared=function(){return d.magnitudeSquared(this)},d.prototype.magnitude=function(){return d.magnitude(this)},d.prototype.normalize=function(a){return d.normalize(this,a)},d.prototype.dot=function(a){return d.dot(this,a)},d.prototype.multiplyComponents=function(a,b){return d.multiplyComponents(this,a,b)},d.prototype.add=function(a,b){return d.add(this,a,b)},d.prototype.subtract=function(a,b){return d.subtract(this,a,b)},d.prototype.multiplyByScalar=function(a,b){return d.multiplyByScalar(this,a,b)},d.prototype.divideByScalar=function(a,b){return d.divideByScalar(this,a,b)},d.prototype.negate=function(a){return d.negate(this,a)},d.prototype.abs=function(a){return d.abs(this,a)},d.prototype.lerp=function(a,b,c){return d.lerp(this,a,b,c)},d.prototype.angleBetween=function(a){return d.angleBetween(this,a)},d.prototype.mostOrthogonalAxis=function(a){return d.mostOrthogonalAxis(this,a)},d.prototype.equals=function(a){return d.equals(this,a)},d.prototype.equalsEpsilon=function(a,b){return d.equalsEpsilon(this,a,b)},d.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},d.prototype.cross=function(a,b){return d.cross(this,a,b)},d}),c("Core/AxisAlignedBoundingBox",["./defaultValue","./DeveloperError","./Cartesian3","./Intersect"],function(a,b,c,d){var e=function(b,d,e){this.minimum=c.clone(a(b,c.ZERO)),this.maximum=c.clone(a(d,c.ZERO)),typeof e=="undefined"?(e=c.add(this.minimum,this.maximum),c.multiplyByScalar(e,.5,e)):e=c.clone(e),this.center=e};e.fromPoints=function(a,b){typeof b=="undefined"&&(b=new e);if(typeof a=="undefined"||a.length===0)return b.minimum=c.clone(c.ZERO,b.minimum),b.maximum=c.clone(c.ZERO,b.maximum),b.center=c.clone(c.ZERO,b.center),b;var d=a[0].x,f=a[0].y,g=a[0].z,h=a[0].x,i=a[0].y,j=a[0].z,k=a.length;for(var l=1;l<k;l++){var m=a[l],n=m.x,o=m.y,p=m.z;d=Math.min(n,d),h=Math.max(n,h),f=Math.min(o,f),i=Math.max(o,i),g=Math.min(p,g),j=Math.max(p,j)}var q=b.minimum;q.x=d,q.y=f,q.z=g;var r=b.maximum;r.x=h,r.y=i,r.z=j;var s=c.add(q,r,b.center);return c.multiplyByScalar(s,.5,s),b},e.clone=function(a,d){if(typeof a=="undefined")throw new b("box is required");return typeof d=="undefined"?new e(a.minimum,a.maximum):(d.minimum=c.clone(a.minimum,d.minimum),d.maximum=c.clone(a.maximum,d.maximum),d.center=c.clone(a.center,d.center),d)},e.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&c.equals(a.center,b.center)&&c.equals(a.minimum,b.minimum)&&c.equals(a.maximum,b.maximum)};var f=new c;return e.intersect=function(a,e){if(typeof a=="undefined")throw new b("box is required.");if(typeof e=="undefined")throw new b("plane is required.");f=c.subtract(a.maximum,a.minimum,f);var g=c.multiplyByScalar(f,.5,f),h=g.x*Math.abs(e.x)+g.y*Math.abs(e.y)+g.z*Math.abs(e.z),i=c.dot(a.center,e)+e.w;return i-h>0?d.INSIDE:i+h<0?d.OUTSIDE:d.INTERSECTING},e.prototype.clone=function(a){return e.clone(this,a)},e.prototype.intersect=function(a){return e.intersect(this,a)},e.prototype.equals=function(a){return e.equals(this,a)},e}),c("Core/BoxTessellator",["./DeveloperError","./Cartesian3","./ComponentDatatype","./PrimitiveType"],function(a,b,c,d){var e={compute:function(e){e=e||{};var f,g;if(e.minimumCorner&&e.maximumCorner)f=e.minimumCorner,g=e.maximumCorner;else{var h=e.dimensions||new b(1,1,1);if(h.x<0||h.y<0||h.z<0)throw new a("All dimensions components must be greater than or equal to zero.");var i=h.multiplyByScalar(.5);f=i.negate(),g=i}var j={};return j.attributes={},j.indexLists=[],j.attributes.position={componentDatatype:c.FLOAT,componentsPerAttribute:3,values:[f.x,f.y,f.z,g.x,f.y,f.z,g.x,g.y,f.z,f.x,g.y,f.z,f.x,f.y,g.z,g.x,f.y,g.z,g.x,g.y,g.z,f.x,g.y,g.z]},j.indexLists.push({primitiveType:d.TRIANGLES,values:[4,5,6,4,6,7,1,0,3,1,3,2,1,6,5,1,2,6,2,3,7,2,7,6,3,0,4,3,4,7,0,1,5,0,5,4]}),j}};return e}),c("Core/CubeMapEllipsoidTessellator",["./DeveloperError","./Cartesian3","./ComponentDatatype","./PrimitiveType"],function(a,b,c,d){var e={};return e.compute=function(e,f,g){function j(a,b){var c=[];c[0]=a,c[2+(f-1)-1]=b;var d=h[a],e=h[b].subtract(h[a]);for(var g=1;g<f;++g){var i=g/f;c[g]=h.length,h.push(d.add(e.multiplyByScalar(i)))}return c}function k(a,b,c,d){var e=h[b[0]],g=h[b[b.length-1]].subtract(e),j=h[d[0]].subtract(e),k=[],l=[],m=b,n=l;for(var o=1;o<=f;++o){if(o!==f){o!==1&&(k=l.slice(0),m=k),l[0]=a[o],l[f]=c[o];var p=o/f,q=j.multiplyByScalar(p);for(var r=1;r<f;++r){var s=r/f,t=g.multiplyByScalar(s);l[r]=h.length,h.push(e.add(t).add(q))}}else o!==1&&(m=l),n=d;for(var u=0;u<f;++u)i.push(m[u]),i.push(m[u+1]),i.push(n[u+1]),i.push(m[u]),i.push(n[u+1]),i.push(n[u])}}if(f<=0)throw new a("numberOfPartitions must be greater than zero.");g=g||"position";var h=[],i=[];h.push(new b(-1,0,-1)),h.push(new b(0,-1,-1)),h.push(new b(1,0,-1)),h.push(new b(0,1,-1)),h.push(new b(-1,0,1)),h.push(new b(0,-1,1)),h.push(new b(1,0,1)),h.push(new b(0,1,1));var l=j(0,1),m=j(1,2),n=j(2,3),o=j(3,0),p=j(4,5),q=j(5,6),r=j(6,7),s=j(7,4),t=j(0,4),u=j(1,5),v=j(2,6),w=j(3,7);k(t,l,u,p),k(u,m,v,q),k(v,n,w,r),k(w,o,t,s),k(s.slice(0).reverse(),p,q,r.slice(0).reverse()),k(m,l.slice(0).reverse(),o.slice(0).reverse(),n);var x=e.getRadii(),y=h.length,z=0,A=new Array(y*3);for(var B=0;B<y;++B){var C=h[B];b.normalize(C,C),b.multiplyComponents(C,x,C),A[z++]=C.x,A[z++]=C.y,A[z++]=C.z}var D={};return D.attributes={},D.indexLists=[],D.attributes[g]={componentDatatype:c.FLOAT,componentsPerAttribute:3,values:A},D.indexLists.push({primitiveType:d.TRIANGLES,values:i}),D},e}),c("Core/EncodedCartesian3",["./Cartesian3","./DeveloperError"],function(a,b){function d(a,b){var c;a>=0?(c=Math.floor(a/65536)*65536,b.high=c,b.low=a-c):(c=Math.floor(-a/65536)*65536,b.high=-c,b.low=a+c)}var c=function(){this.high=a.ZERO.clone(),this.low=a.ZERO.clone()},e=function(){this.high=0,this.low=0};c.fromCartesian=function(a,f){if(typeof a=="undefined")throw new b("cartesian is required");typeof f=="undefined"&&(f=new c);var g=f.high,h=f.low;return d(a.x,e),g.x=e.high,h.x=e.low,d(a.y,e),g.y=e.high,h.y=e.low,d(a.z,e),g.z=e.high,h.z=e.low,f};var f=new c;return c.writeElements=function(a,d,e){if(typeof a=="undefined")throw new b("cartesian is required");if(typeof d=="undefined")throw new b("cartesianArray is required");if(typeof e!="number"||e<0)throw new b("index must be a number greater than or equal to 0.");c.fromCartesian(a,f);var g=f.high,h=f.low;d[e]=g.x,d[e+1]=g.y,d[e+2]=g.z,d[e+3]=h.x,d[e+4]=h.y,d[e+5]=h.z},c}),c("Core/Ray",["./DeveloperError","./defaultValue","./Cartesian3"],function(a,b,c){var d=function(a,d){d=c.clone(b(d,c.ZERO)),d.equals(c.ZERO)||c.normalize(d,d),this.origin=c.clone(b(a,c.ZERO)),this.direction=d};return d.prototype.getPoint=function(b,d){if(typeof b!="number")throw new a("t is a required number");return d=c.multiplyByScalar(this.direction,b,d),c.add(this.origin,d,d)},d}),c("Core/Cartesian4",["./defaultValue","./DeveloperError","./freezeObject"],function(a,b,c){var d=function(b,c,d,e){this.x=a(b,0),this.y=a(c,0),this.z=a(d,0),this.w=a(e,0)};d.clone=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");return typeof c=="undefined"?new d(a.x,a.y,a.z,a.w):(c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c)},d.getMaximumComponent=function(a){if(typeof a=="undefined")throw new b("cartesian is required");return Math.max(a.x,a.y,a.z,a.w)},d.getMinimumComponent=function(a){if(typeof a=="undefined")throw new b("cartesian is required");return Math.min(a.x,a.y,a.z,a.w)},d.magnitudeSquared=function(a){if(typeof a=="undefined")throw new b("cartesian is required");return a.x*a.x+a.y*a.y+a.z*a.z+a.w*a.w},d.magnitude=function(a){return Math.sqrt(d.magnitudeSquared(a))},d.normalize=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");var e=d.magnitude(a);return typeof c=="undefined"?new d(a.x/e,a.y/e,a.z/e,a.w/e):(c.x=a.x/e,c.y=a.y/e,c.z=a.z/e,c.w=a.w/e,c)},d.dot=function(a,c){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return a.x*c.x+a.y*c.y+a.z*c.z+a.w*c.w},d.multiplyComponents=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return typeof e=="undefined"?new d(a.x*c.x,a.y*c.y,a.z*c.z,a.w*c.w):(e.x=a.x*c.x,e.y=a.y*c.y,e.z=a.z*c.z,e.w=a.w*c.w,e)},d.add=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return typeof e=="undefined"?new d(a.x+c.x,a.y+c.y,a.z+c.z,a.w+c.w):(e.x=a.x+c.x,e.y=a.y+c.y,e.z=a.z+c.z,e.w=a.w+c.w,e)},d.subtract=function(a,c,e){if(typeof a=="undefined")throw new b("left is required");if(typeof c=="undefined")throw new b("right is required");return typeof e=="undefined"?new d(a.x-c.x,a.y-c.y,a.z-c.z,a.w-c.w):(e.x=a.x-c.x,e.y=a.y-c.y,e.z=a.z-c.z,e.w=a.w-c.w,e)},d.multiplyByScalar=function(a,c,e){if(typeof a=="undefined")throw new b("cartesian is required");if(typeof c!="number")throw new b("scalar is required and must be a number.");return typeof e=="undefined"?new d(a.x*c,a.y*c,a.z*c,a.w*c):(e.x=a.x*c,e.y=a.y*c,e.z=a.z*c,e.w=a.w*c,e)},d.divideByScalar=function(a,c,e){if(typeof a=="undefined")throw new b("cartesian is required");if(typeof c!="number")throw new b("scalar is required and must be a number.");return typeof e=="undefined"?new d(a.x/c,a.y/c,a.z/c,a.w/c):(e.x=a.x/c,e.y=a.y/c,e.z=a.z/c,e.w=a.w/c,e)},d.negate=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");return typeof c=="undefined"?new d(-a.x,-a.y,-a.z,-a.w):(c.x=-a.x,c.y=-a.y,c.z=-a.z,c.w=-a.w,c)},d.abs=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required");return typeof c=="undefined"?new d(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z),Math.abs(a.w)):(c.x=Math.abs(a.x),c.y=Math.abs(a.y),c.z=Math.abs(a.z),c.w=Math.abs(a.w),c)};var e=new d;d.lerp=function(a,c,f,g){if(typeof a=="undefined")throw new b("start is required.");if(typeof c=="undefined")throw new b("end is required.");if(typeof f!="number")throw new b("t is required and must be a number.");return d.multiplyByScalar(c,f,e),g=d.multiplyByScalar(a,1-f,g),d.add(e,g,g)};var f=new d;return d.mostOrthogonalAxis=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required.");var e=d.normalize(a,f);return d.abs(e,e),e.x<=e.y?e.x<=e.z?e.x<=e.w?c=d.clone(d.UNIT_X,c):c=d.clone(d.UNIT_W,c):e.z<=e.w?c=d.clone(d.UNIT_Z,c):c=d.clone(d.UNIT_W,c):e.y<=e.z?e.y<=e.w?c=d.clone(d.UNIT_Y,c):c=d.clone(d.UNIT_W,c):e.z<=e.w?c=d.clone(d.UNIT_Z,c):c=d.clone(d.UNIT_W,c),c},d.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a.x===b.x&&a.y===b.y&&a.z===b.z&&a.w===b.w},d.equalsEpsilon=function(a,c,d){if(typeof d!="number")throw new b("epsilon is required and must be a number.");return a===c||typeof a!="undefined"&&typeof c!="undefined"&&Math.abs(a.x-c.x)<=d&&Math.abs(a.y-c.y)<=d&&Math.abs(a.z-c.z)<=d&&Math.abs(a.w-c.w)<=d},d.ZERO=c(new d(0,0,0,0)),d.UNIT_X=c(new d(1,0,0,0)),d.UNIT_Y=c(new d(0,1,0,0)),d.UNIT_Z=c(new d(0,0,1,0)),d.UNIT_W=c(new d(0,0,0,1)),d.prototype.getMaximumComponent=function(){return d.getMaximumComponent(this)},d.prototype.getMinimumComponent=function(){return d.getMinimumComponent(this)},d.prototype.clone=function(a){return d.clone(this,a)},d.prototype.magnitudeSquared=function(){return d.magnitudeSquared(this)},d.prototype.magnitude=function(){return d.magnitude(this)},d.prototype.normalize=function(a){return d.normalize(this,a)},d.prototype.dot=function(a){return d.dot(this,a)},d.prototype.multiplyComponents=function(a,b){return d.multiplyComponents(this,a,b)},d.prototype.add=function(a,b){return d.add(this,a,b)},d.prototype.subtract=function(a,b){return d.subtract(this,a,b)},d.prototype.multiplyByScalar=function(a,b){return d.multiplyByScalar(this,a,b)},d.prototype.divideByScalar=function(a,b){return d.divideByScalar(this,a,b)},d.prototype.negate=function(a){return d.negate(this,a)},d.prototype.abs=function(a){return d.abs(this,a)},d.prototype.lerp=function(a,b,c){return d.lerp(this,a,b,c)},d.prototype.mostOrthogonalAxis=function(a){return d.mostOrthogonalAxis(this,a)},d.prototype.equals=function(a){return d.equals(this,a)},d.prototype.equalsEpsilon=function(a,b){return d.equalsEpsilon(this,a,b)},d.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},d}),c("Core/Cartographic",["./defaultValue","./DeveloperError","./freezeObject","./Math"],function(a,b,c,d){var e=function(b,c,d){this.longitude=a(b,0),this.latitude=a(c,0),this.height=a(d,0)};return e.fromDegrees=function(b,c,f,g){return b=d.toRadians(a(b,0)),c=d.toRadians(a(c,0)),f=a(f,0),typeof g=="undefined"?new e(b,c,f):(g.longitude=b,g.latitude=c,g.height=f,g)},e.clone=function(a,c){if(typeof a=="undefined")throw new b("cartographic is required");return typeof c=="undefined"?new e(a.longitude,a.latitude,a.height):(c.longitude=a.longitude,c.latitude=a.latitude,c.height=a.height,c)},e.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a.longitude===b.longitude&&a.latitude===b.latitude&&a.height===b.height},e.equalsEpsilon=function(a,c,d){if(typeof d!="number")throw new b("epsilon is required and must be a number.");return a===c||typeof a!="undefined"&&typeof c!="undefined"&&Math.abs(a.longitude-c.longitude)<=d&&Math.abs(a.latitude-c.latitude)<=d&&Math.abs(a.height-c.height)<=d},e.toString=function(a){if(typeof a=="undefined")throw new b("cartographic is required");return"("+a.longitude+", "+a.latitude+", "+a.height+")"},e.ZERO=c(new e(0,0,0)),e.prototype.clone=function(a){return e.clone(this,a)},e.prototype.equals=function(a){return e.equals(this,a)},e.prototype.equalsEpsilon=function(a,b){return e.equalsEpsilon(this,a,b)},e.prototype.toString=function(){return e.toString(this)},e}),c("Core/PolylinePipeline",["./Cartographic","./Cartesian3"],function(a,b){var c={wrapLongitude:function(c,d){var e=[];if(d&&d.length>0){var f=d.length,g=[{cartesian:b.clone(d[0]),cartographic:c.cartesianToCartographic(d[0]),index:0}],h=g[0].cartographic;for(var i=1;i<f;++i){var j=c.cartesianToCartographic(d[i]);if(Math.abs(h.longitude-j.longitude)>Math.PI){var k=h.longitude<0?-Math.PI:Math.PI,l=j.longitude+2*k,m=(k-h.longitude)/(l-h.longitude),n=h.latitude+(j.latitude-h.latitude)*m,o=h.height+(j.height-h.height)*m;g.push({cartesian:c.cartographicToCartesian(new a(k,n,o)),cartographic:new a(k,n,o),index:i}),e.push(g),g=[],g.push({cartesian:c.cartographicToCartesian(new a(-k,n,o)),cartographic:new a(-k,n,o),index:i})}g.push({cartesian:b.clone(d[i]),cartographic:c.cartesianToCartographic(d[i]),index:i}),h=j.clone()}g.length>1&&e.push(g)}return e}};return c}),c("Core/Color",["./defaultValue","./freezeObject"],function(a,b){var c=function(b,c,d,e){this.red=a(b,1),this.green=a(c,1),this.blue=a(d,1),this.alpha=a(e,1)};return c.fromBytes=function(b,d,e,f){return b=a(b,255),d=a(d,255),e=a(e,255),f=a(f,255),new c(b/255,d/255,e/255,f/255)},c.byteToFloat=function(a){return a/255},c.floatToByte=function(a){return a===1?255:a*256|0},c.clone=function(a,b){return typeof b=="undefined"?new c(a.red,a.green,a.blue,a.alpha):(b.red=a.red,b.green=a.green,b.blue=a.blue,b.alpha=a.alpha,b)},c.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a.red===b.red&&a.green===b.green&&a.blue===b.blue&&a.alpha===b.alpha},c.prototype.clone=function(a){return c.clone(this,a)},c.prototype.equals=function(a){return c.equals(this,a)},c.prototype.equalsEpsilon=function(a,b){return this===a||typeof a!="undefined"&&Math.abs(this.red-a.red)<=b&&Math.abs(this.green-a.green)<=b&&Math.abs(this.blue-a.blue)<=b&&Math.abs(this.alpha-a.alpha)<=b},c.prototype.toString=function(){return"("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},c.prototype.toCSSColor=function(){var a=c.floatToByte(this.red),b=c.floatToByte(this.green),d=c.floatToByte(this.blue);return"rgba("+a+","+b+","+d+","+this.alpha+")"},c.WHITE=b(new c(1,1,1,1)),c.BLACK=b(new c(0,0,0,1)),c.RED=b(new c(1,0,0,1)),c.GREEN=b(new c(0,1,0,1)),c.BLUE=b(new c(0,0,1,1)),c.YELLOW=b(new c(1,1,0,1)),c.MAGENTA=b(new c(1,0,1,1)),c.CYAN=b(new c(0,1,1,1)),c}),c("Core/Ellipsoid",["./freezeObject","./defaultValue","./DeveloperError","./Math","./Cartesian3","./Cartographic"],function(a,b,c,d,e,f){var g=function(a,d,f){a=b(a,0),d=b(d,0),f=b(f,0);if(a<0||d<0||f<0)throw new c("All radii components must be greater than or equal to zero.");this._radii=new e(a,d,f),this._radiiSquared=new e(a*a,d*d,f*f),this._radiiToTheFourth=new e(a*a*a*a,d*d*d*d,f*f*f*f),this._oneOverRadii=new e(a===0?0:1/a,d===0?0:1/d,f===0?0:1/f),this._oneOverRadiiSquared=new e(a===0?0:1/(a*a),d===0?0:1/(d*d),f===0?0:1/(f*f)),this._minimumRadius=Math.min(a,d,f),this._maximumRadius=Math.max(a,d,f)};g.fromCartesian3=function(a){return typeof a=="undefined"?new g:new g(a.x,a.y,a.z)},g.WGS84=a(new g(6378137,6378137,6356752.314245179)),g.UNIT_SPHERE=a(new g(1,1,1)),g.prototype.getRadii=function(){return this._radii},g.prototype.getRadiiSquared=function(){return this._radiiSquared},g.prototype.getRadiiToTheFourth=function(){return this._radiiToTheFourth},g.prototype.getOneOverRadii=function(){return this._oneOverRadii},g.prototype.getOneOverRadiiSquared=function(){return this._oneOverRadiiSquared},g.prototype.getMinimumRadius=function(){return this._minimumRadius},g.prototype.getMaximumRadius=function(){return this._maximumRadius},g.prototype.geocentricSurfaceNormal=e.normalize,g.prototype.geodeticSurfaceNormalCartographic=function(a,b){if(typeof a=="undefined")throw new c("cartographic is required.");var d=a.longitude,f=a.latitude,g=Math.cos(f),h=g*Math.cos(d),i=g*Math.sin(d),j=Math.sin(f);return typeof b=="undefined"&&(b=new e),b.x=h,b.y=i,b.z=j,e.normalize(b,b)},g.prototype.geodeticSurfaceNormal=function(a,b){return b=e.multiplyComponents(a,this._oneOverRadiiSquared,b),e.normalize(b,b)};var h=new e,i=new e;g.prototype.cartographicToCartesian=function(a,b){var c=h,d=i;this.geodeticSurfaceNormalCartographic(a,c),e.multiplyComponents(this._radiiSquared,c,d);var f=Math.sqrt(e.dot(c,d));return e.divideByScalar(d,f,d),e.multiplyByScalar(c,a.height,c),e.add(d,c,b)},g.prototype.cartographicArrayToCartesianArray=function(a,b){if(typeof a=="undefined")throw new c("cartographics is required.");var d=a.length;typeof b=="undefined"?b=new Array(d):b.length=d;for(var e=0;e<d;e++)b[e]=this.cartographicToCartesian(a[e],b[e]);return b};var j=new e,k=new e,l=new e;return g.prototype.cartesianToCartographic=function(a,b){var c=this.scaleToGeodeticSurface(a,k),g=this.geodeticSurfaceNormal(c,j),h=e.subtract(a,c,l),i=Math.atan2(g.y,g.x),m=Math.asin(g.z),n=d.sign(e.dot(h,a))*e.magnitude(h);return typeof b=="undefined"?new f(i,m,n):(b.longitude=i,b.latitude=m,b.height=n,b)},g.prototype.cartesianArrayToCartographicArray=function(a,b){if(typeof a=="undefined")throw new c("cartesians is required.");var d=a.length;typeof b=="undefined"?b=new Array(d):b.length=d;for(var e=0;e<d;++e)b[e]=this.cartesianToCartographic(a[e],b[e]);return b},g.prototype.scaleToGeodeticSurface=function(a,b){if(typeof a=="undefined")throw new c("cartesian is required.");var f=a.x,g=a.y,h=a.z,i=this._oneOverRadiiSquared,j=i.x,k=i.y,l=i.z,m=this._radiiSquared,n=m.x,o=m.y,p=m.z,q=this._radiiToTheFourth,r=q.x,s=q.y,t=q.z,u=1/Math.sqrt(f*f*j+g*g*k+h*h*l),v=u*f*j,w=u*g*k,x=u*h*l,y=Math.sqrt(v*v+w*w+x*x),z=(1-u)*(e.magnitude(a)/y),A=f*f,B=g*g,C=h*h,D=0,E=0,F=0,G=0,H=1;do{z-=G/H,D=1+z*j,E=1+z*k,F=1+z*l;var I=D*D,J=E*E,K=F*F,L=D*I,M=E*J,N=F*K;G=A/(n*I)+B/(o*J)+C/(p*K)-1,H=-2*(A/(r*L)+B/(s*M)+C/(t*N))}while(Math.abs(G)>d.EPSILON10);return v=f/D,w=g/E,x=h/F,typeof b=="undefined"?new e(v,w,x):(b.x=v,b.y=w,b.z=x,b)},g.prototype.scaleToGeocentricSurface=function(a,b){if(typeof a=="undefined")throw new c("cartesian is required.");var d=a.x,f=a.y,g=a.z,h=this._oneOverRadiiSquared,i=1/Math.sqrt(d*d*h.x+f*f*h.y+g*g*h.z);return e.multiplyByScalar(a,i,b)},g.prototype.transformPositionToScaledSpace=function(a,b){return e.multiplyComponents(a,this._oneOverRadii,b)},g.prototype.equals=function(a){return this===a||typeof a!="undefined"&&e.equals(this._radii,a._radii)},g.prototype.toString=function(){return this._radii.toString()},g}),c("Core/GeographicProjection",["./defaultValue","./Cartesian3","./Cartographic","./Ellipsoid"],function(a,b,c,d){var e=function(b){this._ellipsoid=a(b,d.WGS84),this._semimajorAxis=this._ellipsoid.getMaximumRadius(),this._oneOverSemimajorAxis=1/this._semimajorAxis};return e.prototype.getEllipsoid=function(){return this._ellipsoid},e.prototype.project=function(a,c){var d=this._semimajorAxis,e=a.longitude*d,f=a.latitude*d,g=a.height;return typeof c=="undefined"?new b(e,f,g):(c.x=e,c.y=f,c.z=g,c)},e.prototype.unproject=function(a,b){var d=this._oneOverSemimajorAxis,e=a.x*d,f=a.y*d,g=a.z;return typeof b=="undefined"?new c(e,f,g):(b.longitude=e,b.latitude=f,b.height=g,b)},e}),c("Core/BoundingRectangle",["./defaultValue","./DeveloperError","./Cartographic","./GeographicProjection","./Intersect"],function(a,b,c,d,e){var f=function(b,c,d,e){this.x=a(b,0),this.y=a(c,0),this.width=a(d,0),this.height=a(e,0)};f.fromPoints=function(a,b){typeof b=="undefined"&&(b=new f);if(typeof a=="undefined"||a.length===0)return b.x=0,b.y=0,b.width=0,b.height=0,b;var c=a.length,d=a[0].x,e=a[0].y,g=a[0].x,h=a[0].y;for(var i=1;i<c;i++){var j=a[i],k=j.x,l=j.y;d=Math.min(k,d),g=Math.max(k,g),e=Math.min(l,e),h=Math.max(l,h)}return b.x=d,b.y=e,b.width=g-d,b.height=h-e,b};var g=new d,h=new c,i=new c;return f.fromExtent=function(a,b,c){typeof c=="undefined"&&(c=new f);if(typeof a=="undefined")return c.x=0,c.y=0,c.width=0,c.height=0,c;b=typeof b!="undefined"?b:g;var d=b.project(a.getSouthwest(h)),e=b.project(a.getNortheast(i));return e.subtract(d,e),c.x=d.x,c.y=d.y,c.width=e.x,c.height=e.y,c},f.clone=function(a,c){if(typeof a=="undefined")throw new b("rectangle is required");return typeof c=="undefined"?new f(a.x,a.y,a.width,a.height):(c.x=a.x,c.y=a.y,c.width=a.width,c.height=a.height,c)},f.union=function(a,c,d){if(typeof a=="undefined")throw new b("left is required.");if(typeof c=="undefined")throw new b("right is required.");typeof d=="undefined"&&(d=new f);var e=Math.min(a.x,c.x),g=Math.min(a.y,c.y),h=Math.max(a.x+a.width,c.x+c.width),i=Math.max(a.y+a.height,c.y+c.height);return d.x=e,d.y=g,d.width=h-e,d.height=i-g,d},f.expand=function(a,c,d){if(typeof a=="undefined")throw new b("rectangle is required.");if(typeof c=="undefined")throw new b("point is required.");d=f.clone(a,d);var e=c.x-d.x,g=c.y-d.y;return e>d.width?d.width=e:e<0&&(d.width-=e,d.x=c.x),g>d.height?d.height=g:g<0&&(d.height-=g,d.y=c.y),d},f.intersect=function(a,c){if(typeof a=="undefined")throw new b("left is required.");if(typeof c=="undefined")throw new b("right is required.");var d=a.x,f=a.y,g=c.x,h=c.y;return d>g+c.width||d+a.width<g||f+a.height<h||f>h+c.height?e.OUTSIDE:e.INTERSECTING},f.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height},f.prototype.clone=function(a){return f.clone(this,a)},f.prototype.union=function(a,b){return f.union(this,a,b)},f.prototype.expand=function(a,b){return f.expand(this,a,b)},f.prototype.intersect=function(a){return f.intersect(this,a)},f.prototype.equals=function(a){return f.equals(this,a)},f}),c("Core/MeshFilters",["./DeveloperError","./Cartesian3","./GeographicProjection","./ComponentDatatype","./PrimitiveType","./Tipsify"],function(a,b,c,d,e,f){var g={};return g.toWireframeInPlace=function(a){function b(a,b,c,d){a.push(b),a.push(c),a.push(c),a.push(d),a.push(d),a.push(b)}function c(a){var c=[],d=a.length;for(var e=0;e<d;e+=3)b(c,a[e],a[e+1],a[e+2]);return c}function d(a){var c=[],d=a.length;if(d>=3){b(c,a[0],a[1],a[2]);for(var e=3;e<d;++e)b(c,a[e-1],a[e],a[e-2])}return c}function f(a){var c=[];if(a.length>0){var d=a[0],e=a.length-1;for(var f=1;f<e;++f)b(c,d,a[f],a[f+1])}return c}if(a){var g=a.indexLists;if(g){var h=g.length;for(var i=0;i<h;++i){var j=g[i];switch(j.primitiveType){case e.TRIANGLES:j.primitiveType=e.LINES,j.values=c(j.values);break;case e.TRIANGLE_STRIP:j.primitiveType=e.LINES,j.values=d(j.values);break;case e.TRIANGLE_FAN:j.primitiveType=e.LINES,j.values=f(j.values)}}}}return a},g.createAttributeIndices=function(a){var b={};if(a){var c=a.attributes,d=0;for(var e in c)c.hasOwnProperty(e)&&(b[e]=d++)}return b},g.mapAttributeIndices=function(a,b){var c={};if(a&&b)for(var d in b)b.hasOwnProperty(d)&&(c[b[d]]=a[d]);return c},g._computeNumberOfAttributes=function(b){var c=-1;for(var d in b.attributes)if(b.attributes.hasOwnProperty(d)&&b.attributes[d].values){var e=b.attributes[d],f=e.values.length/e.componentsPerAttribute;if(c!==f&&c!==-1)throw new a("All mesh attribute lists must have the same number of attributes.");c=f}return c},g.reorderForPreVertexCache=function(b){if(b){var c=g._computeNumberOfAttributes(b),d=[];for(var e=0;e<c;e++)d[e]=-1;var f=b.indexLists;if(f){var h=f.length;for(var i=0;i<h;++i){var j=f[i].values,k=j.length,l=[],m=0,n=0,o=0,p;while(m<k){p=d[j[m]];if(p!==-1)l[n]=p;else{p=j[m];if(p>=c)throw new a("Input indices contains a value greater than or equal to the number of vertices");d[p]=o,l[n]=o,++o}++m,++n}f[i].values=l}}var q=b.attributes;if(q)for(var r in q)if(q.hasOwnProperty(r)&&q[r].values){var s=q[r].values,t=0,u=q[r].componentsPerAttribute,v=[];while(t<c){var w=d[t];for(e=0;e<u;e++)v[u*w+e]=s[u*t+e];++t}q[r].values=v}}return b},g.reorderForPostVertexCache=function(a,b){if(a){var c=a.indexLists;if(c){var d=c.length;for(var e=0;e<d;e++){var g=c[e].values,h=g.length,i=0;for(var j=0;j<h;j++)g[j]>i&&(i=g[j]);c[e].values=f.tipsify({indices:g,maximumIndex:i,cacheSize:b})}}}return a},g._verifyTrianglesPrimitiveType=function(b){var c=b.length;for(var d=0;d<c;++d)if(b[d].primitiveType!==e.TRIANGLES)throw new a("indexLists must have PrimitiveType equal to PrimitiveType.TRIANGLES.")},g._copyAttributesDescriptions=function(a){var b={};for(var c in a)if(a.hasOwnProperty(c)&&a[c].values){var d=a[c];b[c]={componentDatatype:d.componentDatatype,componentsPerAttribute:d.componentsPerAttribute,values:[]}}return b},g._copyVertex=function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)&&b[d].values){var e=b[d];for(var f=0;f<e.componentsPerAttribute;++f)a[d].values.push(e.values[c*e.componentsPerAttribute+f])}},g.fitToUnsignedShortIndices=function(a){function b(a,b,c){return{attributes:a,indexLists:[{primitiveType:b,values:c}]}}var c=[];if(a){g._verifyTrianglesPrimitiveType(a.indexLists);var d=g._computeNumberOfAttributes(a),e=65536,f=a.indexLists;if(f&&d>e){var h=f.length;for(var i=0;i<h;++i){var j=[],k=[],l=0,m=g._copyAttributesDescriptions(a.attributes),n=f[i].values,o=n.length;for(var p=0;p<o;p+=3){var q=n[p],r=n[p+1],s=n[p+2],t=j[q];typeof t=="undefined"&&(t=l++,j[q]=t,g._copyVertex(m,a.attributes,q));var u=j[r];typeof u=="undefined"&&(u=l++,j[r]=u,g._copyVertex(m,a.attributes,r));var v=j[s];typeof v=="undefined"&&(v=l++,j[s]=v,g._copyVertex(m,a.attributes,s)),k.push(t),k.push(u),k.push(v),l+3>e&&(c.push(b(m,f[i].primitiveType,k)),j=[],k=[],l=0,m=g._copyAttributesDescriptions(a.attributes))}k.length!==0&&c.push(b(m,f[i].primitiveType,k))}}else c.push(a)}return c},g.projectTo2D=function(a,e){if(a&&a.attributes&&a.attributes.position){e=e||new c;var f=e.getEllipsoid(),g=a.attributes.position.values,h=[];for(var i=0;i<g.length;i+=3){var j=f.cartesianToCartographic(new b(g[i],g[i+1],g[i+2])),k=e.project(j);h.push(k.x,k.y)}a.attributes.position3D=a.attributes.position,a.attributes.position2D={componentDatatype:d.FLOAT,componentsPerAttribute:2,values:h},delete a.attributes.position}return a},g}),c("Core/WebMercatorProjection",["./defaultValue","./Cartesian3","./Cartographic","./Math","./Ellipsoid"],function(a,b,c,d,e){var f=function(b){this._ellipsoid=a(b,e.WGS84),this._semimajorAxis=this._ellipsoid.getMaximumRadius(),this._oneOverSemimajorAxis=1/this._semimajorAxis};return f.mercatorAngleToGeodeticLatitude=function(a){return d.PI_OVER_TWO-2*Math.atan(Math.exp(-a))},f.geodeticLatitudeToMercatorAngle=function(a){a>f.MaximumLatitude?a=f.MaximumLatitude:a<-f.MaximumLatitude&&(a=-f.MaximumLatitude);var b=Math.sin(a);return.5*Math.log((1+b)/(1-b))},f.MaximumLatitude=f.mercatorAngleToGeodeticLatitude(Math.PI),f.prototype.getEllipsoid=function(){return this._ellipsoid},f.prototype.project=function(a,c){var d=this._semimajorAxis,e=a.longitude*d,g=f.geodeticLatitudeToMercatorAngle(a.latitude)*d,h=a.height;return typeof c=="undefined"?new b(e,g,h):(c.x=e,c.y=g,c.z=h,c)},f.prototype.unproject=function(a,b){var d=this._oneOverSemimajorAxis,e=a.x*d,g=f.mercatorAngleToGeodeticLatitude(a.y*d),h=a.z;return typeof b=="undefined"?new c(e,g,h):(b.longitude=e,b.latitude=g,b.height=h,b)},f}),c("Core/Extent",["./freezeObject","./defaultValue","./Ellipsoid","./Cartographic","./DeveloperError","./Math"],function(a,b,c,d,e,f){var g=function(a,c,d,e){this.west=b(a,0),this.south=b(c,0),this.east=b(d,0),this.north=b(e,0)};g.prototype.clone=function(a){return typeof a=="undefined"?new g(this.west,this.south,this.east,this.north):(a.west=this.west,a.south=this.south,a.east=this.east,a.north=this.north,a)},g.prototype.equals=function(a){return typeof a!="undefined"&&this.west===a.west&&this.south===a.south&&this.east===a.east&&this.north===a.north},g.prototype.equalsEpsilon=function(a,b){if(typeof b!="number")throw new e("epsilon is required and must be a number.");return typeof a!="undefined"&&Math.abs(this.west-a.west)<=b&&Math.abs(this.south-a.south)<=b&&Math.abs(this.east-a.east)<=b&&Math.abs(this.north-a.north)<=b},g.prototype.validate=function(){var a=this.north;if(typeof a!="number")throw new e("north is required to be a number.");if(a<-f.PI_OVER_TWO||a>f.PI_OVER_TWO)throw new e("north must be in the interval [-Pi/2, Pi/2].");var b=this.south;if(typeof b!="number")throw new e("south is required to be a number.");if(b<-f.PI_OVER_TWO||b>f.PI_OVER_TWO)throw new e("south must be in the interval [-Pi/2, Pi/2].");var c=this.west;if(typeof c!="number")throw new e("west is required to be a number.");if(c<-Math.PI||c>Math.PI)throw new e("west must be in the interval [-Pi, Pi].");var d=this.east;if(typeof d!="number")throw new e("east is required to be a number.");if(d<-Math.PI||d>Math.PI)throw new e("east must be in the interval [-Pi, Pi].")},g.prototype.getSouthwest=function(a){return typeof a=="undefined"?new d(this.west,this.south):(a.longitude=this.west,a.latitude=this.south,a.height=0,a)},g.prototype.getNorthwest=function(a){return typeof a=="undefined"?new d(this.west,this.north):(a.longitude=this.west,a.latitude=this.north,a.height=0,a)},g.prototype.getNortheast=function(a){return typeof a=="undefined"?new d(this.east,this.north):(a.longitude=this.east,a.latitude=this.north,a.height=0,a)},g.prototype.getSoutheast=function(a){return typeof a=="undefined"?new d(this.east,this.south):(a.longitude=this.east,a.latitude=this.south,a.height=0,a)},g.prototype.getCenter=function(a){return typeof a=="undefined"?new d((this.west+this.east)*.5,(this.south+this.north)*.5):(a.longitude=(this.west+this.east)*.5,a.latitude=(this.south+this.north)*.5,a.height=0,a)},g.prototype.intersectWith=function(a,b){if(typeof a=="undefined")throw new e("otherExtent is required.");var c=Math.max(this.west,a.west),d=Math.max(this.south,a.south),f=Math.min(this.east,a.east),h=Math.min(this.north,a.north);return typeof b=="undefined"?new g(c,d,f,h):(b.west=c,b.south=d,b.east=f,b.north=h,b)},g.prototype.contains=function(a){if(typeof a=="undefined")throw new e("cartographic is required.");return a.longitude>=this.west&&a.longitude<=this.east&&a.latitude>=this.south&&a.latitude<=this.north},g.prototype.isEmpty=function(){return this.west===this.east&&this.south===this.north};var h=new d;return g.prototype.subsample=function(a,d){a=b(a,c.WGS84),typeof d=="undefined"&&(d=[]);var e=0,g=this.north,i=this.south,j=this.east,k=this.west,l=h;l.longitude=k,l.latitude=g,d[e]=a.cartographicToCartesian(l,d[e]),e++,l.longitude=j,d[e]=a.cartographicToCartesian(l,d[e]),e++,l.latitude=i,d[e]=a.cartographicToCartesian(l,d[e]),e++,l.longitude=k,d[e]=a.cartographicToCartesian(l,d[e]),e++,g<0?l.latitude=g:i>0?l.latitude=i:l.latitude=0;for(var m=1;m<8;++m){var n=-Math.PI+m*f.PI_OVER_TWO;k<n&&n<j&&(l.longitude=n,d[e]=a.cartographicToCartesian(l,d[e]),e++)}return l.latitude===0&&(l.longitude=k,d[e]=a.cartographicToCartesian(l,d[e]),e++,l.longitude=j,d[e]=a.cartographicToCartesian(l,d[e]),e++),d.length=e,d},g.MAX_VALUE=a(new g(-Math.PI,-f.PI_OVER_TWO,Math.PI,f.PI_OVER_TWO)),g}),c("Core/ExtentTessellator",["./defaultValue","./DeveloperError","./Math","./Ellipsoid","./Extent","./Cartesian3","./ComponentDatatype","./PrimitiveType"],function(a,b,c,d,e,f,g,h){var i={};return i.computeVertices=function(b){b=a(b,{});var c=b.extent,d=b.surfaceHeight,e=b.width,f=b.height,g=(c.east-c.west)/(e-1),h=(c.north-c.south)/(f-1),i=b.generateTextureCoordinates,j=b.interleaveTextureCoordinates,k=b.relativeToCenter,l=b.vertices,m=b.textureCoordinates,n=b.indices,o=b.radiiSquared,p=o.x,q=o.y,r=o.z,s=Math.cos,t=Math.sin,u=Math.sqrt,v=1/(c.east-c.west),w=1/(c.north-c.south),x=0,y=0;for(var z=0;z<f;++z){var A=c.north-h*z,B=s(A),C=t(A),D=r*C,E=(A-c.south)*w,F=E;for(var G=0;G<e;++G){var H=c.west+g*G,I=B*s(H),J=B*t(H),K=p*I,L=q*J,M=u(K*I+L*J+D*C),N=K/M,O=L/M,P=D/M;l[x++]=N+I*d-k.x,l[x++]=O+J*d-k.y,l[x++]=P+C*d-k.z;if(i){var Q=(H-c.west)*v,R=Q;j?(l[x++]=R,l[x++]=F):(m[y++]=R,m[y++]=F)}}}if(typeof n!="undefined"){var S=0,T=0;for(var U=0;U<f-1;++U){for(var V=0;V<e-1;++V){var W=S,X=W+e,Y=X+1,Z=W+1;n[T++]=W,n[T++]=X,n[T++]=Z,n[T++]=Z,n[T++]=X,n[T++]=Y,++S}++S}}},i.compute=function(b){b=a(b,{});var c=b.extent;c.validate();var e=a(b.ellipsoid,d.WGS84);b.radiiSquared=e.getRadiiSquared(),b.relativeToCenter=a(b.relativeToCenter,f.ZERO);var j=a(b.granularity,.1);b.surfaceHeight=a(b.surfaceHeight,0),b.width=Math.ceil((c.east-c.west)/j)+1,b.height=Math.ceil((c.north-c.south)/j)+1;var k=[],l=[],m=[];b.generateTextureCoordinates=a(b.generateTextureCoordinates,!1),b.interleaveTextureCoordinates=!1,b.vertices=k,b.textureCoordinates=m,b.indices=l,i.computeVertices(b);var n={attributes:{},indexLists:[{primitiveType:h.TRIANGLES,values:l}]},o=a(b.positionName,"position");n.attributes[o]={componentDatatype:g.FLOAT,componentsPerAttribute:3,values:k};if(b.generateTextureCoordinates){var p=a(b.textureCoordinatesName,"textureCoordinates");n.attributes[p]={componentDatatype:g.FLOAT,componentsPerAttribute:2,values:m}}return n},i.computeBuffers=function(b){b=a(b,{});var c=b.extent;c.validate();var e=a(b.ellipsoid,d.WGS84);b.radiiSquared=e.getRadiiSquared(),b.relativeToCenter=a(b.relativeToCenter,f.ZERO);var g=a(b.granularity,.1);b.surfaceHeight=a(b.surfaceHeight,0),b.width=Math.ceil((c.east-c.west)/g)+1,b.height=Math.ceil((c.north-c.south)/g)+1;var h=[],j=[],k=[];b.generateTextureCoordinates=a(b.generateTextureCoordinates,!1),b.interleaveTextureCoordinates=a(b.interleaveTextureCoordinates,!1),b.vertices=h,b.textureCoordinates=k,b.indices=j,i.computeVertices(b);var l={indices:j};return b.interleaveTextureCoordinates?l.vertices=h:(l.positions=h,b.generateTextureCoordinates&&(l.textureCoordinates=k)),l},i}),c("Core/Matrix2",["./Cartesian2","./defaultValue","./DeveloperError","./freezeObject"],function(a,b,c,d){var e=function(a,c,d,e){this[0]=b(a,0),this[1]=b(d,0),this[2]=b(c,0),this[3]=b(e,0)};return e.clone=function(a,b){if(typeof a=="undefined")throw new c("values is required");return typeof b=="undefined"?new e(a[0],a[2],a[1],a[3]):(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b)},e.fromColumnMajorArray=e.clone,e.fromRowMajorArray=function(a,b){if(typeof a=="undefined")throw new c("values is required.");return typeof b=="undefined"?new e(a[0],a[1],a[2],a[3]):(b[0]=a[0],b[1]=a[2],b[2]=a[1],b[3]=a[3],b)},e.toArray=function(a,b){if(typeof a=="undefined")throw new c("matrix is required");return typeof b=="undefined"?[a[0],a[1],a[2],a[3]]:(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b)},e.getElementIndex=function(a,b){if(typeof b!="number"||b<0||b>1)throw new c("row is required and must be 0 or 1.");if(typeof a!="number"||a<0||a>1)throw new c("column is required and must be 0 or 1.");return a*2+b},e.getColumn=function(b,d,e){if(typeof b=="undefined")throw new c("matrix is required.");if(typeof d!="number"||d<0||d>1)throw new c("index is required and must be 0 or 1.");var f=d*2,g=b[f],h=b[f+1];return typeof e=="undefined"?new a(g,h):(e.x=g,e.y=h,e)},e.setColumn=function(a,b,d,f){if(typeof a=="undefined")throw new c("matrix is required");if(typeof d=="undefined")throw new c("cartesian is required");if(typeof b!="number"||b<0||b>1)throw new c("index is required and must be 0 or 1.");f=e.clone(a,f);var g=b*2;return f[g]=d.x,f[g+1]=d.y,f},e.getRow=function(b,d,e){if(typeof b=="undefined")throw new c("matrix is required.");if(typeof d!="number"||d<0||d>1)throw new c("index is required and must be 0 or 1.");var f=b[d],g=b[d+2];return typeof e=="undefined"?new a(f,g):(e.x=f,e.y=g,e)},e.setRow=function(a,b,d,f){if(typeof a=="undefined")throw new c("matrix is required");if(typeof d=="undefined")throw new c("cartesian is required");if(typeof b!="number"||b<0||b>1)throw new c("index is required and must be 0 or 1.");return f=e.clone(a,f),f[b]=d.x,f[b+2]=d.y,f},e.multiply=function(a,b,d){if(typeof a=="undefined")throw new c("left is required");if(typeof b=="undefined")throw new c("right is required");var f=a[0]*b[0]+a[2]*b[1],g=a[0]*b[2]+a[2]*b[3],h=a[1]*b[0]+a[3]*b[1],i=a[1]*b[2]+a[3]*b[3];return typeof d=="undefined"?new e(f,g,h,i):(d[0]=f,d[1]=h,d[2]=g,d[3]=i,d)},e.multiplyByVector=function(b,d,e){if(typeof b=="undefined")throw new c("matrix is required");if(typeof d=="undefined")throw new c("cartesian is required");var f=b[0]*d.x+b[2]*d.y,g=b[1]*d.x+b[3]*d.y;return typeof e=="undefined"?new a(f,g):(e.x=f,e.y=g,e)},e.multiplyByScalar=function(a,b,d){if(typeof a=="undefined")throw new c("matrix is required");if(typeof b!="number")throw new c("scalar is required and must be a number");return typeof d=="undefined"?new e(a[0]*b,a[2]*b,a[1]*b,a[3]*b):(d[0]=a[0]*b,d[1]=a[1]*b,d[2]=a[2]*b,d[3]=a[3]*b,d)},e.negate=function(a,b){if(typeof a=="undefined")throw new c("matrix is required");return typeof b=="undefined"?new e(-a[0],-a[2],-a[1],-a[3]):(b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=-a[3],b)},e.transpose=function(a,b){if(typeof a=="undefined")throw new c("matrix is required");var d=a[0],f=a[2],g=a[1],h=a[3];return typeof b=="undefined"?new e(d,g,f,h):(b[0]=d,b[1]=f,b[2]=g,b[3]=h,b)},e.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},e.equalsEpsilon=function(a,b,d){if(typeof d!="number")throw new c("epsilon is required and must be a number");return a===b||typeof a!="undefined"&&typeof b!="undefined"&&Math.abs(a[0]-b[0])<=d&&Math.abs(a[1]-b[1])<=d&&Math.abs(a[2]-b[2])<=d&&Math.abs(a[3]-b[3])<=d},e.IDENTITY=d(new e(1,0,0,1)),e.COLUMN0ROW0=0,e.COLUMN0ROW1=1,e.COLUMN1ROW0=2,e.COLUMN1ROW1=3,e.prototype.clone=function(a){return e.clone(this,a)},e.prototype.toArray=function(a){return e.toArray(this,a)},e.prototype.getColumn=function(a,b){return e.getColumn(this,a,b)},e.prototype.setColumn=function(a,b,c){return e.setColumn(this,a,b,c)},e.prototype.getRow=function(a,b){return e.getRow(this,a,b)},e.prototype.setRow=function(a,b,c){return e.setRow(this,a,b,c)},e.prototype.multiply=function(a,b){return e.multiply(this,a,b)},e.prototype.multiplyByVector=function(a,b){return e.multiplyByVector(this,a,b)},e.prototype.multiplyByScalar=function(a,b){return e.multiplyByScalar(this,a,b)},e.prototype.negate=function(a){return e.negate(this,a)},e.prototype.transpose=function(a){return e.transpose(this,a)},e.prototype.equals=function(a){return e.equals(this,a)},e.prototype.equalsEpsilon=function(a,b){return e.equalsEpsilon(this,a,b)},e.prototype.toString=function(){return"("+this[0]+", "+this[2]+")\n"+"("+this[1]+", "+this[3]+")"},e}),c("Core/Matrix3",["./Cartesian3","./defaultValue","./DeveloperError","./freezeObject"],function(a,b,c,d){var e=function(a,c,d,e,f,g,h,i,j){this[0]=b(a,0),this[1]=b(e,0),this[2]=b(h,0),this[3]=b(c,0),this[4]=b(f,0),this[5]=b(i,0),this[6]=b(d,0),this[7]=b(g,0),this[8]=b(j,0)};return e.clone=function(a,b){if(typeof a=="undefined")throw new c("values is required");return typeof b=="undefined"?new e(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]):(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b)},e.fromColumnMajorArray=e.clone,e.fromRowMajorArray=function(a,b){if(typeof a=="undefined")throw new c("values is required.");return typeof b=="undefined"?new e(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]):(b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8],b)},e.fromQuaternion=function(a,b){if(typeof a=="undefined")throw new c("quaternion is required");var d=a.x*a.x,f=a.x*a.y,g=a.x*a.z,h=a.x*a.w,i=a.y*a.y,j=a.y*a.z,k=a.y*a.w,l=a.z*a.z,m=a.z*a.w,n=a.w*a.w,o=d-i-l+n,p=2*(f+m),q=2*(g-k),r=2*(f-m),s=-d+i-l+n,t=2*(j+h),u=2*(g+k),v=2*(j-h),w=-d-i+l+n;return typeof b=="undefined"?new e(o,p,q,r,s,t,u,v,w):(b[0]=o,b[1]=r,b[2]=u,b[3]=p,b[4]=s,b[5]=v,b[6]=q,b[7]=t,b[8]=w,b)},e.fromScale=function(a,b){if(typeof a=="undefined")throw new c("scale is required.");return typeof b=="undefined"?new e(a.x,0,0,0,a.y,0,0,0,a.z):(b[0]=a.x,b[1]=0,b[2]=0,b[3]=0,b[4]=a.y,b[5]=0,b[6]=0,b[7]=0,b[8]=a.z,b)},e.toArray=function(a,b){if(typeof a=="undefined")throw new c("matrix is required");return typeof b=="undefined"?[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]:(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b)},e.getElementIndex=function(a,b){if(typeof b!="number"||b<0||b>2)throw new c("row is required and must be 0, 1, or 2.");if(typeof a!="number"||a<0||a>2)throw new c("column is required and must be 0, 1, or 2.");return a*3+b},e.getColumn=function(b,d,e){if(typeof b=="undefined")throw new c("matrix is required.");if(typeof d!="number"||d<0||d>2)throw new c("index is required and must be 0, 1, or 2.");var f=d*3,g=b[f],h=b[f+1],i=b[f+2];return typeof e=="undefined"?new a(g,h,i):(e.x=g,e.y=h,e.z=i,e)},e.setColumn=function(a,b,d,f){if(typeof a=="undefined")throw new c("matrix is required");if(typeof d=="undefined")throw new c("cartesian is required");if(typeof b!="number"||b<0||b>2)throw new c("index is required and must be 0, 1, or 2.");f=e.clone(a,f);var g=b*3;return f[g]=d.x,f[g+1]=d.y,f[g+2]=d.z,f},e.getRow=function(b,d,e){if(typeof b=="undefined")throw new c("matrix is required.");if(typeof d!="number"||d<0||d>2)throw new c("index is required and must be 0, 1, or 2.");var f=b[d],g=b[d+3],h=b[d+6];return typeof e=="undefined"?new a(f,g,h):(e.x=f,e.y=g,e.z=h,e)},e.setRow=function(a,b,d,f){if(typeof a=="undefined")throw new c("matrix is required");if(typeof d=="undefined")throw new c("cartesian is required");if(typeof b!="number"||b<0||b>2)throw new c("index is required and must be 0, 1, or 2.");return f=e.clone(a,f),f[b]=d.x,f[b+3]=d.y,f[b+6]=d.z,f},e.multiply=function(a,b,d){if(typeof a=="undefined")throw new c("left is required");if(typeof b=="undefined")throw new c("right is required");var f=a[0]*b[0]+a[3]*b[1]+a[6]*b[2],g=a[1]*b[0]+a[4]*b[1]+a[7]*b[2],h=a[2]*b[0]+a[5]*b[1]+a[8]*b[2],i=a[0]*b[3]+a[3]*b[4]+a[6]*b[5],j=a[1]*b[3]+a[4]*b[4]+a[7]*b[5],k=a[2]*b[3]+a[5]*b[4]+a[8]*b[5],l=a[0]*b[6]+a[3]*b[7]+a[6]*b[8],m=a[1]*b[6]+a[4]*b[7]+a[7]*b[8],n=a[2]*b[6]+a[5]*b[7]+a[8]*b[8];return typeof d=="undefined"?new e(f,i,l,g,j,m,h,k,n):(d[0]=f,d[1]=g,d[2]=h,d[3]=i,d[4]=j,d[5]=k,d[6]=l,d[7]=m,d[8]=n,d)},e.multiplyByVector=function(b,d,e){if(typeof b=="undefined")throw new c("matrix is required");if(typeof d=="undefined")throw new c("cartesian is required");var f=d.x,g=d.y,h=d.z,i=b[0]*f+b[3]*g+b[6]*h,j=b[1]*f+b[4]*g+b[7]*h,k=b[2]*f+b[5]*g+b[8]*h;return typeof e=="undefined"?new a(i,j,k):(e.x=i,e.y=j,e.z=k,e)},e.multiplyByScalar=function(a,b,d){if(typeof a=="undefined")throw new c("matrix is required");if(typeof b!="number")throw new c("scalar is required and must be a number");return typeof d=="undefined"?new e(a[0]*b,a[3]*b,a[6]*b,a[1]*b,a[4]*b,a[7]*b,a[2]*b,a[5]*b,a[8]*b):(d[0]=a[0]*b,d[1]=a[1]*b,d[2]=a[2]*b,d[3]=a[3]*b,d[4]=a[4]*b,d[5]=a[5]*b,d[6]=a[6]*b,d[7]=a[7]*b,d[8]=a[8]*b,d)},e.negate=function(a,b){if(typeof a=="undefined")throw new c("matrix is required");return typeof b=="undefined"?new e(-a[0],-a[3],-a[6],-a[1],-a[4],-a[7],-a[2],-a[5],-a[8]):(b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=-a[3],b[4]=-a[4],b[5]=-a[5],b[6]=-a[6],b[7]=-a[7],b[8]=-a[8],b)},e.transpose=function(a,b){if(typeof a=="undefined")throw new c("matrix is required");var d=a[0],f=a[3],g=a[6],h=a[1],i=a[4],j=a[7],k=a[2],l=a[5],m=a[8];return typeof b=="undefined"?new e(d,h,k,f,i,l,g,j,m):(b[0]=d,b[1]=f,b[2]=g,b[3]=h,b[4]=i,b[5]=j,b[6]=k,b[7]=l,b[8]=m,b)},e.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]},e.equalsEpsilon=function(a,b,d){if(typeof d!="number")throw new c("epsilon is required and must be a number");return a===b||typeof a!="undefined"&&typeof b!="undefined"&&Math.abs(a[0]-b[0])<=d&&Math.abs(a[1]-b[1])<=d&&Math.abs(a[2]-b[2])<=d&&Math.abs(a[3]-b[3])<=d&&Math.abs(a[4]-b[4])<=d&&Math.abs(a[5]-b[5])<=d&&Math.abs(a[6]-b[6])<=d&&Math.abs(a[7]-b[7])<=d&&Math.abs(a[8]-b[8])<=d},e.IDENTITY=d(new e(1,0,0,0,1,0,0,0,1)),e.COLUMN0ROW0=0,e.COLUMN0ROW1=1,e.COLUMN0ROW2=2,e.COLUMN1ROW0=3,e.COLUMN1ROW1=4,e.COLUMN1ROW2=5,e.COLUMN2ROW0=6,e.COLUMN2ROW1=7,e.COLUMN2ROW2=8,e.prototype.clone=function(a){return e.clone(this,a)},e.prototype.toArray=function(a){return e.toArray(this,a)},e.prototype.getColumn=function(a,b){return e.getColumn(this,a,b)},e.prototype.setColumn=function(a,b,c){return e.setColumn(this,a,b,c)},e.prototype.getRow=function(a,b){return e.getRow(this,a,b)},e.prototype.setRow=function(a,b,c){return e.setRow(this,a,b,c)},e.prototype.multiply=function(a,b){return e.multiply(this,a,b)},e.prototype.multiplyByVector=function(a,b){return e.multiplyByVector(this,a,b)},e.prototype.multiplyByScalar=function(a,b){return e.multiplyByScalar(this,a,b)},e.prototype.negate=function(a){return e.negate(this,a)},e.prototype.transpose=function(a){return e.transpose(this,a)},e.prototype.equals=function(a){return e.equals(this,a)},e.prototype.equalsEpsilon=function(a,b){return e.equalsEpsilon(this,a,b)},e.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n"+"("+this[1]+", "+this[4]+", "+this[7]+")\n"+"("+this[2]+", "+this[5]+", "+this[8]+")"},e}),c("Core/IntersectionTests",["./DeveloperError","./Math","./Cartesian3","./Cartographic","./Matrix3","./QuadraticRealPolynomial","./QuarticRealPolynomial"],function(a,b,c,d,e,f,g){function i(a,c,d){var e=a+c;return b.sign(a)!==b.sign(c)&&Math.abs(e/Math.max(Math.abs(a),Math.abs(c)))<d?0:e}function j(a,d,h,j,k){var l=j*j,m=k*k,n=(a[e.COLUMN1ROW1]-a[e.COLUMN2ROW2])*m,o=k*(j*i(a[e.COLUMN1ROW0],a[e.COLUMN0ROW1],b.EPSILON15)+d.y),p=a[e.COLUMN0ROW0]*l+a[e.COLUMN2ROW2]*m+j*d.x+h,q=m*i(a[e.COLUMN2ROW1],a[e.COLUMN1ROW2],b.EPSILON15),r=k*(j*i(a[e.COLUMN2ROW0],a[e.COLUMN0ROW2])+d.z),s,t=[];if(r===0&&q===0){s=f.realRoots(n,o,p);if(s.length===0)return t;var u=s[0],v=Math.sqrt(Math.max(1-u*u,0));t.push(new c(j,k*u,k*-v)),t.push(new c(j,k*u,k*v));if(s.length===2){var w=s[1],x=Math.sqrt(Math.max(1-w*w,0));t.push(new c(j,k*w,k*-x)),t.push(new c(j,k*w,k*x))}return t}var y=r*r,z=q*q,A=n*n,B=r*q,C=A+z,D=2*(o*n+B),E=2*p*n+o*o-z+y,F=2*(p*o-B),G=p*p-y;if(C===0&&D===0&&E===0&&F===0)return t;s=g.realRoots(C,D,E,F,G);var H=s.length;if(H===0)return t;for(var I=0;I<H;++I){var J=s[I],K=J*J,L=Math.max(1-K,0),M=Math.sqrt(L),N;b.sign(n)===b.sign(p)?N=i(n*K+p,o*J,b.EPSILON12):b.sign(p)===b.sign(o*J)?N=i(n*K,o*J+p,b.EPSILON12):N=i(n*K+o*J,p,b.EPSILON12);var O=i(q*J,r,b.EPSILON15),P=N*O;P<0?t.push(new c(j,k*J,k*M)):P>0?t.push(new c(j,k*J,k*-M)):M!==0?(t.push(new c(j,k*J,k*-M)),t.push(new c(j,k*J,k*M)),++I):t.push(new c(j,k*J,k*M))}return t}var h={};return h.rayPlane=function(d,e,f,g){if(typeof d=="undefined")throw new a("ray is required.");if(typeof e=="undefined")throw new a("planeNormal is required.");if(typeof f=="undefined")throw new a("planeD is required.");var h=d.origin,i=d.direction,j=c.dot(e,i);if(Math.abs(j)<b.EPSILON15)return undefined;var k=(-f-c.dot(e,h))/j;return k<0?undefined:(g=i.multiplyByScalar(k,g),c.add(h,g))},h.rayEllipsoid=function(b,c){if(typeof b=="undefined")throw new a("ray is required.");if(typeof c=="undefined")throw new a("ellipsoid is required.");var d=c.getOneOverRadii(),e=d.multiplyComponents(b.origin),f=d.multiplyComponents(b.direction),g=e.magnitudeSquared(),h=e.dot(f),i,j,k,l,m;if(g>1){if(h>=0)return undefined;var n=h*h;i=g-1,j=f.magnitudeSquared(),k=j*i;if(n<k)return undefined;if(n>k){l=h*h-k,m=-h+Math.sqrt(l);var o=m/j,p=i/m;return o<p?{start:o,stop:p}:{start:p,stop:o}}var q=Math.sqrt(i/j);return{start:q,stop:q}}return g<1?(i=g-1,j=f.magnitudeSquared(),k=j*i,h<0?(l=h*h-k,m=h-Math.sqrt(l),{start:0,stop:i/m}):h>0?(l=h*h-k,m=h+Math.sqrt(l),{start:0,stop:m/j}):(m=Math.sqrt(-k),{start:0,stop:m/j})):h<0?(j=f.magnitudeSquared(),{start:0,stop:-h/j}):undefined},h.grazingAltitudeLocation=function(f,g){if(typeof f=="undefined")throw new a("ray is required.");if(typeof g=="undefined")throw new a("ellipsoid is required.");var h=f.origin,i=f.direction,k=g.geodeticSurfaceNormal(h);if(c.dot(i,k)>=0)return h;var l=typeof this.rayEllipsoid(f,g)!="undefined",m=g.transformPositionToScaledSpace(i),n=m.normalize(),o=m.mostOrthogonalAxis(),p=o.cross(n).normalize(),q=n.cross(p).normalize(),r=new e(n.x,p.x,q.x,n.y,p.y,q.y,n.z,p.z,q.z),s=r.transpose(),t=e.fromScale(g.getRadii()),u=e.fromScale(g.getOneOverRadii()),v=new e(0,i.z,-i.y,-i.z,0,i.x,i.y,-i.x,0),w=s.multiply(u).multiply(v),x=w.multiply(t).multiply(r),y=w.multiplyByVector(h),z=j(x,y.negate(),0,0,1),A,B,C=z.length;if(C>0){var D=c.ZERO,E=Number.NEGATIVE_INFINITY;for(var F=0;F<C;++F){A=t.multiplyByVector(r.multiplyByVector(z[F]));var G=A.subtract(h).normalize(),H=G.dot(i);H>E&&(E=H,D=A)}var I=g.cartesianToCartographic(D);return E=b.clamp(E,0,1),B=D.subtract(h).magnitude()*Math.sqrt(1-E*E),B=l?-B:B,g.cartographicToCartesian(new d(I.longitude,I.latitude,B))}return undefined},h}),c("Core/Matrix4",["./Cartesian3","./Cartesian4","./defaultValue","./DeveloperError","./freezeObject","./Math","./Matrix3","./RuntimeError"],function(a,b,c,d,e,f,g,h){var i=function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q){this[0]=c(a,0),this[1]=c(f,0),this[2]=c(j,0),this[3]=c(n,0),this[4]=c(b,0),this[5]=c(g,0),this[6]=c(k,0),this[7]=c(o,0),this[8]=c(d,0),this[9]=c(h,0),this[10]=c(l,0),this[11]=c(p,0),this[12]=c(e,0),this[13]=c(i,0),this[14]=c(m,0),this[15]=c(q,0)};i.clone=function(a,b){if(typeof a=="undefined")throw new d("values is required");return typeof b=="undefined"?new i(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b)},i.fromColumnMajorArray=i.clone,i.fromRowMajorArray=function(a,b){if(typeof a=="undefined")throw new d("values is required.");return typeof b=="undefined"?new i(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]):(b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15],b)},i.fromRotationTranslation=function(a,b,c){if(typeof a=="undefined")throw new d("rotation is required.");if(typeof b=="undefined")throw new d("translation is required.");return typeof c=="undefined"?new i(a[0],a[3],a[6],b.x,a[1],a[4],a[7],b.y,a[2],a[5],a[8],b.z,0,0,0,1):(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=0,c[4]=a[3],c[5]=a[4],c[6]=a[5],c[7]=0,c[8]=a[6],c[9]=a[7],c[10]=a[8],c[11]=0,c[12]=b.x,c[13]=b.y,c[14]=b.z,c[15]=1,c)},i.fromTranslation=function(a,b){return i.fromRotationTranslation(g.IDENTITY,a,b)},i.fromScale=function(a,b){if(typeof a=="undefined")throw new d("scale is required.");return typeof b=="undefined"?new i(a.x,0,0,0,0,a.y,0,0,0,0,a.z,0,0,0,0,1):(b[0]=a.x,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=a.y,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=a.z,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b)};var j=new a,k=new a,l=new a;i.fromCamera=function(b,c){if(typeof b=="undefined")throw new d("camera is required.");var e=b.eye,f=b.target,g=b.up;if(typeof e=="undefined")throw new d("camera.eye is required.");if(typeof f=="undefined")throw new d("camera.target is required.");if(typeof g=="undefined")throw new d("camera.up is required.");a.subtract(f,e,j).normalize(j),a.cross(j,g,k).normalize(k),a.cross(k,j,l).normalize(l);var h=k.x,m=k.y,n=k.z,o=j.x,p=j.y,q=j.z,r=l.x,s=l.y,t=l.z,u=e.x,v=e.y,w=e.z,x=h*-u+m*-v+n*-w,y=r*-u+s*-v+t*-w,z=o*u+p*v+q*w;return typeof c=="undefined"?new i(h,m,n,x,r,s,t,y,-o,-p,-q,z,0,0,0,1):(c[0]=h,c[1]=r,c[2]=-o,c[3]=0,c[4]=m,c[5]=s,c[6]=-p,c[7]=0,c[8]=n,c[9]=t,c[10]=-q,c[11]=0,c[12]=x,c[13]=y,c[14]=z,c[15]=1,c)},i.computePerspectiveFieldOfView=function(a,b,c,e,f){if(a<=0||a>Math.PI)throw new d("fovY must be in [0, PI).");if(b<=0)throw new d("aspectRatio must be greater than zero.");if(c<=0)throw new d("near must be greater than zero.");if(e<=0)throw new d("far must be greater than zero.");var g=Math.tan(a*.5),h=1/g,j=h/b,k=(e+c)/(c-e),l=2*e*c/(c-e);return typeof f=="undefined"?new i(j,0,0,0,0,h,0,0,0,0,k,l,0,0,-1,0):(f[0]=j,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=h,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=k,f[11]=-1,f[12]=0,f[13]=0,f[14]=l,f[15]=0,f)},i.computeOrthographicOffCenter=function(a,b,c,e,f,g,h){if(typeof a=="undefined")throw new d("left is required.");if(typeof b=="undefined")throw new d("right is required.");if(typeof c=="undefined")throw new d("bottom is required.");if(typeof e=="undefined")throw new d("top is required.");if(typeof f=="undefined")throw new d("near is required.");if(typeof g=="undefined")throw new d("far is required.");var j=1/(b-a),k=1/(e-c),l=1/(g-f),m=-(b+a)*j,n=-(e+c)*k,o=-(g+f)*l;return j*=2,k*=2,l*=-2,typeof h=="undefined"?new i(j,0,0,m,0,k,0,n,0,0,l,o,0,0,0,1):(h[0]=j,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=k,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=l,h[11]=0,h[12]=m,h[13]=n,h[14]=o,h[15]=1,h)},i.computePerspectiveOffCenter=function(a,b,c,e,f,g,h){if(typeof a=="undefined")throw new d("left is required.");if(typeof b=="undefined")throw new d("right is required.");if(typeof c=="undefined")throw new d("bottom is required.");if(typeof e=="undefined")throw new d("top is required.");if(typeof f=="undefined")throw new d("near is required.");if(typeof g=="undefined")throw new d("far is required.");var j=2*f/(b-a),k=2*f/(e-c),l=(b+a)/(b-a),m=(e+c)/(e-c),n=-(g+f)/(g-f),o=-1,p=-2*g*f/(g-f);return typeof h=="undefined"?new i(j,0,l,0,0,k,m,0,0,0,n,p,0,0,o,0):(h[0]=j,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=k,h[6]=0,h[7]=0,h[8]=l,h[9]=m,h[10]=n,h[11]=o,h[12]=0,h[13]=0,h[14]=p,h[15]=0,h)},i.computeInfinitePerspectiveOffCenter=function(a,b,c,e,f,g){if(typeof a=="undefined")throw new d("left is required.");if(typeof b=="undefined")throw new d("right is required.");if(typeof c=="undefined")throw new d("bottom is required.");if(typeof e=="undefined")throw new d("top is required.");if(typeof f=="undefined")throw new d("near is required.");var h=2*f/(b-a),j=2*f/(e-c),k=(b+a)/(b-a),l=(e+c)/(e-c),m=-1,n=-1,o=-2*f;return typeof g=="undefined"?new i(h,0,k,0,0,j,l,0,0,0,m,o,0,0,n,0):(g[0]=h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=j,g[6]=0,g[7]=0,g[8]=k,g[9]=l,g[10]=m,g[11]=n,g[12]=0,g[13]=0,g[14]=o,g[15]=0,g)};var m={};i.computeViewportTransformation=function(a,b,d,e){a=c(a,m);var f=c(a.x,0),g=c(a.y,0),h=c(a.width,0),j=c(a.height,0);b=c(b,0),d=c(d,1);var k=h*.5,l=j*.5,n=(d-b)*.5,o=k,p=l,q=n,r=f+k,s=g+l,t=b+n,u=1;return typeof e=="undefined"?new i(o,0,0,r,0,p,0,s,0,0,q,t,0,0,0,u):(e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=q,e[11]=0,e[12]=r,e[13]=s,e[14]=t,e[15]=u,e)},i.toArray=function(a,b){if(typeof a=="undefined")throw new d("matrix is required");return typeof b=="undefined"?[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]:(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b)},i.getElementIndex=function(a,b){if(typeof b!="number"||b<0||b>3)throw new d("row is required and must be 0, 1, 2, or 3.");if(typeof a!="number"||a<0||a>3)throw new d("column is required and must be 0, 1, 2, or 3.");return a*4+b},i.getColumn=function(a,c,e){if(typeof a=="undefined")throw new d("matrix is required.");if(typeof c!="number"||c<0||c>3)throw new d("index is required and must be 0, 1, 2, or 3.");var f=c*4,g=a[f],h=a[f+1],i=a[f+2],j=a[f+3];return typeof e=="undefined"?new b(g,h,i,j):(e.x=g,e.y=h,e.z=i,e.w=j,e)},i.setColumn=function(a,b,c,e){if(typeof a=="undefined")throw new d("matrix is required");if(typeof c=="undefined")throw new d("cartesian is required");if(typeof b!="number"||b<0||b>3)throw new d("index is required and must be 0, 1, 2, or 3.");e=i.clone(a,e);var f=b*4;return e[f]=c.x,e[f+1]=c.y,e[f+2]=c.z,e[f+3]=c.w,e},i.getRow=function(a,c,e){if(typeof a=="undefined")throw new d("matrix is required.");if(typeof c!="number"||c<0||c>3)throw new d("index is required and must be 0, 1, 2, or 3.");var f=a[c],g=a[c+4],h=a[c+8],i=a[c+12];return typeof e=="undefined"?new b(f,g,h,i):(e.x=f,e.y=g,e.z=h,e.w=i,e)},i.setRow=function(a,b,c,e){if(typeof a=="undefined")throw new d("matrix is required");if(typeof c=="undefined")throw new d("cartesian is required");if(typeof b!="number"||b<0||b>3)throw new d("index is required and must be 0, 1, 2, or 3.");return e=i.clone(a,e),e[b]=c.x,e[b+4]=c.y,e[b+8]=c.z,e[b+12]=c.w,e},i.multiply=function(a,b,c){if(typeof a=="undefined")throw new d("left is required");if(typeof b=="undefined")throw new d("right is required");var e=a[0],f=a[1],g=a[2],h=a[3],j=a[4],k=a[5],l=a[6],m=a[7],n=a[8],o=a[9],p=a[10],q=a[11],r=a[12],s=a[13],t=a[14],u=a[15],v=b[0],w=b[1],x=b[2],y=b[3],z=b[4],A=b[5],B=b[6],C=b[7],D=b[8],E=b[9],F=b[10],G=b[11],H=b[12],I=b[13],J=b[14],K=b[15],L=e*v+j*w+n*x+r*y,M=f*v+k*w+o*x+s*y,N=g*v+l*w+p*x+t*y,O=h*v+m*w+q*x+u*y,P=e*z+j*A+n*B+r*C,Q=f*z+k*A+o*B+s*C,R=g*z+l*A+p*B+t*C,S=h*z+m*A+q*B+u*C,T=e*D+j*E+n*F+r*G,U=f*D+k*E+o*F+s*G,V=g*D+l*E+p*F+t*G,W=h*D+m*E+q*F+u*G,X=e*H+j*I+n*J+r*K,Y=f*H+k*I+o*J+s*K,Z=g*H+l*I+p*J+t*K,$=h*H+m*I+q*J+u*K;return typeof c=="undefined"?new i(L,P,T,X,M,Q,U,Y,N,R,V,Z,O,S,W,$):(c[0]=L,c[1]=M,c[2]=N,c[3]=O,c[4]=P,c[5]=Q,c[6]=R,c[7]=S,c[8]=T,c[9]=U,c[10]=V,c[11]=W,c[12]=X,c[13]=Y,c[14]=Z,c[15]=$,c)},i.multiplyByTranslation=function(a,b,c){if(typeof a=="undefined")throw new d("matrix is required");if(typeof b=="undefined")throw new d("translation is required");var e=b.x,f=b.y,g=b.z,h=e*a[0]+f*a[4]+g*a[8]+a[12],j=e*a[1]+f*a[5]+g*a[9]+a[13],k=e*a[2]+f*a[6]+g*a[10]+a[14];return typeof c=="undefined"?new i(a[0],a[4],a[8],h,a[1],a[5],a[9],j,a[2],a[6],a[10],k,a[3],a[7],a[11],a[15]):(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=h,c[13]=j,c[14]=k,c[15]=a[15],c)},i.multiplyByVector=function(a,c,e){if(typeof a=="undefined")throw new d("matrix is required");if(typeof c=="undefined")throw new d("cartesian is required");var f=c.x,g=c.y,h=c.z,i=c.w,j=a[0]*f+a[4]*g+a[8]*h+a[12]*i,k=a[1]*f+a[5]*g+a[9]*h+a[13]*i,l=a[2]*f+a[6]*g+a[10]*h+a[14]*i,m=a[3]*f+a[7]*g+a[11]*h+a[15]*i;return typeof e=="undefined"?new b(j,k,l,m):(e.x=j,e.y=k,e.z=l,e.w=m,e)};var n=new b(0,0,0,1);return i.multiplyByPoint=function(a,b,c){if(typeof b=="undefined")throw new d("cartesian is required");return n.x=b.x,n.y=b.y,n.z=b.z,i.multiplyByVector(a,n,c)},i.multiplyByScalar=function(a,b,c){if(typeof a=="undefined")throw new d("matrix is required");if(typeof b!="number")throw new d("scalar is required and must be a number");return typeof c=="undefined"?new i(a[0]*b,a[4]*b,a[8]*b,a[12]*b,a[1]*b,a[5]*b,a[9]*b,a[13]*b,a[2]*b,a[6]*b,a[10]*b,a[14]*b,a[3]*b,a[7]*b,a[11]*b,a[15]*b):(c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c[3]=a[3]*b,c[4]=a[4]*b,c[5]=a[5]*b,c[6]=a[6]*b,c[7]=a[7]*b,c[8]=a[8]*b,c[9]=a[9]*b,c[10]=a[10]*b,c[11]=a[11]*b,c[12]=a[12]*b,c[13]=a[13]*b,c[14]=a[14]*b,c[15]=a[15]*b,c)},i.negate=function(a,b){if(typeof a=="undefined")throw new d("matrix is required");return typeof b=="undefined"?new i(-a[0],-a[4],-a[8],-a[12],-a[1],-a[5],-a[9],-a[13],-a[2],-a[6],-a[10],-a[14],-a[3],-a[7],-a[11],-a[15]):(b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=-a[3],b[4]=-a[4],b[5]=-a[5],b[6]=-a[6],b[7]=-a[7],b[8]=-a[8],b[9]=-a[9],b[10]=-a[10],b[11]=-a[11],b[12]=-a[12],b[13]=-a[13],b[14]=-a[14],b[15]=-a[15],b)},i.transpose=function(a,b){if(typeof a=="undefined")throw new d("matrix is required");if(typeof b=="undefined")return new i(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]);var c=a[1],e=a[2],f=a[3],g=a[6],h=a[7],j=a[11];return b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=c,b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=e,b[9]=g,b[10]=a[10],b[11]=a[14],b[12]=f,b[13]=h,b[14]=j,b[15]=a[15],b},i.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]},i.equalsEpsilon=function(a,b,c){if(typeof c!="number")throw new d("epsilon is required and must be a number");return a===b||typeof a!="undefined"&&typeof b!="undefined"&&Math.abs(a[0]-b[0])<=c&&Math.abs(a[1]-b[1])<=c&&Math.abs(a[2]-b[2])<=c&&Math.abs(a[3]-b[3])<=c&&Math.abs(a[4]-b[4])<=c&&Math.abs(a[5]-b[5])<=c&&Math.abs(a[6]-b[6])<=c&&Math.abs(a[7]-b[7])<=c&&Math.abs(a[8]-b[8])<=c&&Math.abs(a[9]-b[9])<=c&&Math.abs(a[10]-b[10])<=c&&Math.abs(a[11]-b[11])<=c&&Math.abs(a[12]-b[12])<=c&&Math.abs(a[13]-b[13])<=c&&Math.abs(a[14]-b[14])<=c&&Math.abs(a[15]-b[15])<=c},i.getTranslation=function(b,c){if(typeof b=="undefined")throw new d("matrix is required");return typeof c=="undefined"?new a(b[12],b[13],b[14]):(c.x=b[12],c.y=b[13],c.z=b[14],c)},i.getRotation=function(a,b){if(typeof a=="undefined")throw new d("matrix is required");return typeof b=="undefined"?new g(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]):(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[4],b[4]=a[5],b[5]=a[6],b[6]=a[8],b[7]=a[9],b[8]=a[10],b)},i.inverse=function(a,b){if(typeof a=="undefined")throw new d("matrix is required");var c=a[0],e=a[4],g=a[8],j=a[12],k=a[1],l=a[5],m=a[9],n=a[13],o=a[2],p=a[6],q=a[10],r=a[14],s=a[3],t=a[7],u=a[11],v=a[15],w=q*v,x=r*u,y=p*v,z=r*t,A=p*u,B=q*t,C=o*v,D=r*s,E=o*u,F=q*s,G=o*t,H=p*s,I=w*l+z*m+A*n-(x*l+y*m+B*n),J=x*k+C*m+F*n-(w*k+D*m+E*n),K=y*k+D*l+G*n-(z*k+C*l+H*n),L=B*k+E*l+H*m-(A*k+F*l+G*m),M=x*e+y*g+B*j-(w*e+z*g+A*j),N=w*c+D*g+E*j-(x*c+C*g+F*j),O=z*c+C*e+H*j-(y*c+D*e+G*j),P=A*c+F*e+G*g-(B*c+E*e+H*g);w=g*n,x=j*m,y=e*n,z=j*l,A=e*m,B=g*l,C=c*n,D=j*k,E=c*m,F=g*k,G=c*l,H=e*k;var Q=w*t+z*u+A*v-(x*t+y*u+B*v),R=x*s+C*u+F*v-(w*s+D*u+E*v),S=y*s+D*t+G*v-(z*s+C*t+H*v),T=B*s+E*t+H*u-(A*s+F*t+G*u),U=y*q+B*r+x*p-(A*r+w*p+z*q),V=E*r+w*o+D*q-(C*q+F*r+x*o),W=C*p+H*r+z*o-(G*r+y*o+D*p),X=G*q+A*o+F*p-(E*p+H*q+B*o),Y=c*I+e*J+g*K+j*L;if(Math.abs(Y)<f.EPSILON20)throw new h("matrix is not invertible because its determinate is zero.");return Y=1/Y,typeof b=="undefined"?new i(I*Y,M*Y,Q*Y,U*Y,J*Y,N*Y,R*Y,V*Y,K*Y,O*Y,S*Y,W*Y,L*Y,P*Y,T*Y,X*Y):(b[0]=I*Y,b[1]=J*Y,b[2]=K*Y,b[3]=L*Y,b[4]=M*Y,b[5]=N*Y,b[6]=O*Y,b[7]=P*Y,b[8]=Q*Y,b[9]=R*Y,b[10]=S*Y,b[11]=T*Y,b[12]=U*Y,b[13]=V*Y,b[14]=W*Y,b[15]=X*Y,b)},i.inverseTransformation=function(a,b){if(typeof a=="undefined")throw new d("matrix is required");var c=a[0],e=a[1],f=a[2],g=a[4],h=a[5],j=a[6],k=a[8],l=a[9],m=a[10],n=a[12],o=a[13],p=a[14],q=-c*n-e*o-f*p,r=-g*n-h*o-j*p,s=-k*n-l*o-m*p;return typeof b=="undefined"?new i(c,e,f,q,g,h,j,r,k,l,m,s,0,0,0,1):(b[0]=c,b[1]=g,b[2]=k,b[3]=0,b[4]=e,b[5]=h,b[6]=l,b[7]=0,b[8]=f,b[9]=j,b[10]=m,b[11]=0,b[12]=q,b[13]=r,b[14]=s,b[15]=1,b)},i.IDENTITY=e(new i(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),i.COLUMN0ROW0=0,i.COLUMN0ROW1=1,i.COLUMN0ROW2=2,i.COLUMN0ROW3=3,i.COLUMN1ROW0=4,i.COLUMN1ROW1=5,i.COLUMN1ROW2=6,i.COLUMN1ROW3=7,i.COLUMN2ROW0=8,i.COLUMN2ROW1=9,i.COLUMN2ROW2=10,i.COLUMN2ROW3=11,i.COLUMN3ROW0=12,i.COLUMN3ROW1=13,i.COLUMN3ROW2=14,i.COLUMN3ROW3=15,i.prototype.clone=function(a){return i.clone(this,a)},i.prototype.toArray=function(a){return i.toArray(this,a)},i.prototype.getColumn=function(a,b){return i.getColumn(this,a,b)},i.prototype.setColumn=function(a,b,c){return i.setColumn(this,a,b,c)},i.prototype.getRow=function(a,b){return i.getRow(this,a,b)},i.prototype.setRow=function(a,b,c){return i.setRow(this,a,b,c)},i.prototype.multiply=function(a,b){return i.multiply(this,a,b)},i.prototype.multiplyByTranslation=function(a,b){return i.multiplyByTranslation(this,a,b)},i.prototype.multiplyByVector=function(a,b){return i.multiplyByVector(this,a,b)},i.prototype.multiplyByPoint=function(a,b){return i.multiplyByPoint(this,a,b)},i.prototype.multiplyByScalar=function(a,b){return i.multiplyByScalar(this,a,b)},i.prototype.negate=function(a){return i.negate(this,a)},i.prototype.transpose=function(a){return i.transpose(this,a)},i.prototype.equals=function(a){return i.equals(this,a)},i.prototype.equalsEpsilon=function(a,b){return i.equalsEpsilon(this,a,b)},i.prototype.toString=function(){return"("+this[0]+", "+this[4]+", "+this[8]+", "+this[12]+")\n"+"("+this[1]+", "+this[5]+", "+this[9]+", "+this[13]+")\n"+"("+this[2]+", "+this[6]+", "+this[10]+", "+this[14]+")\n"+"("+this[3]+", "+this[7]+", "+this[11]+", "+this[15]+")"},i.prototype.getTranslation=function(a){return i.getTranslation(this,a)},i.prototype.getRotation=function(a){return i.getRotation(this,a)},i.prototype.inverse=function(a){return i.inverse(this,a)},i.prototype.inverseTransformation=function(a){return i.inverseTransformation(this,a)},i}),c("Core/BoundingSphere",["./defaultValue","./DeveloperError","./Cartesian2","./Cartesian3","./Cartesian4","./Cartographic","./Ellipsoid","./GeographicProjection","./Extent","./Intersect","./Interval","./Matrix4"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=function(b,c){this.center=typeof b!="undefined"?d.clone(b):d.ZERO.clone(),this.radius=a(c,0)},n=new d,o=new d,p=new d,q=new d,r=new d,s=new d,t=new d,u=new d,v=new d,w=new d,x=new d;m.fromPoints=function(a,b){typeof b=="undefined"&&(b=new m);if(typeof a=="undefined"||a.length===0)return b.center=d.ZERO.clone(b.center),b.radius=0,b;var c=d.clone(a[0],t),e=d.clone(c,n),f=d.clone(c,o),g=d.clone(c,p),h=d.clone(c,q),i=d.clone(c,r),j=d.clone(c,s),k=a.length;for(var l=1;l<k;l++){d.clone(a[l],c);var y=c.x,z=c.y,A=c.z;y<e.x&&d.clone(c,e),y>h.x&&d.clone(c,h),z<f.y&&d.clone(c,f),z>i.y&&d.clone(c,i),A<g.z&&d.clone(c,g),A>j.z&&d.clone(c,j)}var B=d.magnitudeSquared(d.subtract(h,e,u)),C=d.magnitudeSquared(d.subtract(i,f,u)),D=d.magnitudeSquared(d.subtract(j,g,u)),E=e,F=h,G=B;C>G&&(G=C,E=f,F=i),D>G&&(G=D,E=g,F=j);var H=v;H.x=(E.x+F.x)*.5,H.y=(E.y+F.y)*.5,H.z=(E.z+F.z)*.5;var I=d.magnitudeSquared(d.subtract(F,H,u)),J=Math.sqrt(I),K=w;K.x=e.x,K.y=f.y,K.z=g.z;var L=x;L.x=h.x,L.y=i.y,L.z=j.z;var M=d.multiplyByScalar(d.add(K,L,u),.5),N=0;for(l=0;l<k;l++){d.clone(a[l],c);var O=d.magnitude(d.subtract(c,M,u));O>N&&(N=O);var P=d.magnitudeSquared(d.subtract(c,H,u));if(P>I){var Q=Math.sqrt(P);J=(J+Q)*.5,I=J*J;var R=Q-J;H.x=(J*H.x+R*c.x)/Q,H.y=(J*H.y+R*c.y)/Q,H.z=(J*H.z+R*c.z)/Q}}return J<N?(d.clone(H,b.center),b.radius=J):(d.clone(M,b.center),b.radius=N),b};var y=new h,z=new f,A=new f;m.fromExtent2D=function(a,b,c){typeof c=="undefined"&&(c=new m);if(typeof a=="undefined")return c.center=d.ZERO.clone(c.center),c.radius=0,c;b=typeof b!="undefined"?b:y;var e=b.project(a.getSouthwest(z)),f=b.project(a.getNortheast(A)),g=f.x-e.x,h=f.y-e.y;c.radius=Math.sqrt(g*g+h*h)*.5;var i=c.center;return i.x=e.x+g*.5,i.y=e.y+h*.5,i.z=0,c};var B=[];m.fromExtent3D=function(b,c,d){c=a(c,g.WGS84);var e=typeof b!="undefined"?b.subsample(c,B):undefined;return m.fromPoints(e,d)},m.fromVertices=function(a,c,e,f){typeof f=="undefined"&&(f=new m);if(typeof a=="undefined"||a.length===0)return f.center=d.ZERO.clone(f.center),f.radius=0,f;typeof c=="undefined"&&(c=d.ZERO),typeof e=="undefined"&&(e=3);if(e<3)throw new b("stride must be 3 or greater.");var g=t;g.x=a[0]+c.x,g.y=a[1]+c.y,g.z=a[2]+c.z;var h=d.clone(g,n),i=d.clone(g,o),j=d.clone(g,p),k=d.clone(g,q),l=d.clone(g,r),y=d.clone(g,s),z=a.length;for(var A=0;A<z;A+=e){var B=a[A]+c.x,C=a[A+1]+c.y,D=a[A+2]+c.z;g.x=B,g.y=C,g.z=D,B<h.x&&d.clone(g,h),B>k.x&&d.clone(g,k),C<i.y&&d.clone(g,i),C>l.y&&d.clone(g,l),D<j.z&&d.clone(g,j),D>y.z&&d.clone(g,y)}var E=d.magnitudeSquared(d.subtract(k,h,u)),F=d.magnitudeSquared(d.subtract(l,i,u)),G=d.magnitudeSquared(d.subtract(y,j,u)),H=h,I=k,J=E;F>J&&(J=F,H=i,I=l),G>J&&(J=G,H=j,I=y);var K=v;K.x=(H.x+I.x)*.5,K.y=(H.y+I.y)*.5,K.z=(H.z+I.z)*.5;var L=d.magnitudeSquared(d.subtract(I,K,u)),M=Math.sqrt(L),N=w;N.x=h.x,N.y=i.y,N.z=j.z;var O=x;O.x=k.x,O.y=l.y,O.z=y.z;var P=d.multiplyByScalar(d.add(N,O,u),.5),Q=0;for(A=0;A<z;A+=e){g.x=a[A]+c.x,g.y=a[A+1]+c.y,g.z=a[A+2]+c.z;var R=d.magnitude(d.subtract(g,P,u));R>Q&&(Q=R);var S=d.magnitudeSquared(d.subtract(g,K,u));if(S>L){var T=Math.sqrt(S);M=(M+T)*.5,L=M*M;var U=T-M;K.x=(M*K.x+U*g.x)/T,K.y=(M*K.y+U*g.y)/T,K.z=(M*K.z+U*g.z)/T}}return M<Q?(d.clone(K,f.center),f.radius=M):(d.clone(P,f.center),f.radius=Q),f},m.clone=function(a,c){if(typeof a=="undefined")throw new b("sphere is required");return typeof c=="undefined"?new m(a.center,a.radius):(c.center=d.clone(a.center,c.center),c.radius=a.radius,c)};var C=new d,D=new d;m.union=function(a,c,e){if(typeof a=="undefined")throw new b("left is required.");if(typeof c=="undefined")throw new b("right is required.");typeof e=="undefined"&&(e=new m);var f=a.center,g=c.center;d.add(f,g,D);var h=d.multiplyByScalar(D,.5,D),i=d.subtract(f,h,C).magnitude()+a.radius,j=d.subtract(g,h,C).magnitude()+c.radius;return e.radius=Math.max(i,j),d.clone(h,e.center),e};var E=new d;m.expand=function(a,c,e){if(typeof a=="undefined")throw new b("sphere is required.");if(typeof c=="undefined")throw new b("point is required.");e=m.clone(a,e);var f=d.subtract(c,e.center,E).magnitude();return f>e.radius&&(e.radius=f),e},m.intersect=function(a,c){if(typeof a=="undefined")throw new b("sphere is required.");if(typeof c=="undefined")throw new b("plane is required.");var e=a.center,f=a.radius,g=d.dot(c,e)+c.w;return g<-f?j.OUTSIDE:g<f?j.INTERSECTING:j.INSIDE};var F=e.UNIT_W.clone();m.transform=function(a,c,e){if(typeof a=="undefined")throw new b("sphere is required.");if(typeof c=="undefined")throw new b("transform is required.");return typeof e=="undefined"&&(e=new m),l.multiplyByPoint(c,a.center,F),d.clone(F,e.center),e.radius=a.radius,e};var G=new d;return m.getPlaneDistances=function(a,c,e,f){if(typeof a=="undefined")throw new b("sphere is required.");if(typeof c=="undefined")throw new b("position is required.");if(typeof e=="undefined")throw new b("direction is required.");typeof f=="undefined"&&(f=new k);var g=d.subtract(a.center,c,G),h=d.multiplyByScalar(e,e.dot(g),G),i=h.magnitude();return f.start=i-a.radius,f.stop=i+a.radius,f},m.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&d.equals(a.center,b.center)&&a.radius===b.radius},m.prototype.clone=function(a){return m.clone(this,a)},m.prototype.union=function(a,b){return m.union(this,a,b)},m.prototype.expand=function(a,b){return m.expand(this,a,b)},m.prototype.intersect=function(a){return m.intersect(this,a)},m.prototype.transform=function(a,b){return m.transform(this,a,b)},m.prototype.getPlaneDistances=function(a,b,c){return m.getPlaneDistances(this,a,b,c)},m.prototype.equals=function(a){return m.equals(this,a)},m}),c("Core/EllipsoidalOccluder",["./defaultValue","./DeveloperError","./Math","./Cartesian3","./Visibility","./Ellipsoid","./BoundingSphere"],function(a,b,c,d,e,f,g){var h=function(a,c){if(typeof a=="undefined")throw new b("ellipsoid is required.");this._ellipsoid=a,this._cameraPosition=new d(0,0,0),this._cameraPositionInScaledSpace=new d(0,0,0),this._distanceToLimbInScaledSpaceSquared=0,typeof c!="undefined"&&this.setCameraPosition(c)};h.prototype.getEllipsoid=function(){return this._ellipsoid},h.prototype.setCameraPosition=function(a){var b=this._ellipsoid,c=b.transformPositionToScaledSpace(a,this._cameraPositionInScaledSpace),e=d.magnitude(c),f=e*e-1;d.clone(a,this._cameraPosition),this._cameraPositionInScaledSpace=c,this._distanceToLimbInScaledSpaceSquared=f},h.prototype.getCameraPosition=function(){return this._cameraPosition};var i=new d(0,0,0);return h.prototype.isPointVisible=function(a){var b=this._ellipsoid,c=b.transformPositionToScaledSpace(a,i);return this.isScaledSpacePointVisible(c)},h.prototype.isScaledSpacePointVisible=function(a){var b=this._cameraPositionInScaledSpace,c=this._distanceToLimbInScaledSpaceSquared,e=d.subtract(a,b,i),f=-e.dot(b);return f<c||f*f/e.magnitudeSquared()<c},h}),c("Core/Occluder",["./defaultValue","./DeveloperError","./Math","./Cartesian3","./Visibility","./Ellipsoid","./BoundingSphere"],function(a,b,c,d,e,f,g){var h=function(a,c){if(!a)throw new b("occluderBoundingSphere is required.");if(!c)throw new b("camera position is required.");this._occluderPosition=a.center.clone(),this._occluderRadius=a.radius,this._horizonDistance=0,this._horizonPlaneNormal=undefined,this._horizonPlanePosition=undefined,this._cameraPosition=undefined,this.setCameraPosition(c)};h.prototype.getPosition=function(){return this._occluderPosition},h.prototype.getRadius=function(){return this._occluderRadius},h.prototype.setCameraPosition=function(a){a=d.clone(a);var b=this._occluderPosition.subtract(a),c=b.magnitudeSquared(),e=this._occluderRadius*this._occluderRadius,f,g,h;if(c>e){f=Math.sqrt(c-e),c=1/Math.sqrt(c),g=b.multiplyByScalar(c);var i=f*f*c;h=a.add(g.multiplyByScalar(i))}else f=Number.MAX_VALUE;this._horizonDistance=f,this._horizonPlaneNormal=g,this._horizonPlanePosition=h,this._cameraPosition=a};var i=new d(0,0,0);h.prototype.isPointVisible=function(a){if(this._horizonDistance!==Number.MAX_VALUE){var b=d.subtract(a,this._occluderPosition,i),c=this._occluderRadius;c=b.magnitudeSquared()-c*c;if(c>0)return c=Math.sqrt(c)+this._horizonDistance,b=d.subtract(a,this._cameraPosition,b),c*c>b.magnitudeSquared()}return!1},h.prototype.isBoundingSphereVisible=function(a){var b=a.center.clone(),c=a.radius;if(this._horizonDistance!==Number.MAX_VALUE){var e=d.subtract(b,this._occluderPosition,i),f=this._occluderRadius-c;f=e.magnitudeSquared()-f*f;if(c<this._occluderRadius)return f>0?(f=Math.sqrt(f)+this._horizonDistance,e=d.subtract(b,this._cameraPosition,e),f*f+c*c>e.magnitudeSquared()):!1;if(f>0){e=b.subtract(this._cameraPosition);var g=e.magnitudeSquared(),h=this._occluderRadius*this._occluderRadius,j=c*c;return(this._horizonDistance*this._horizonDistance+h)*j>g*h?!0:(f=Math.sqrt(f)+this._horizonDistance,f*f+j>g)}return!0}return!1},h.prototype.getVisibility=function(a){var b=a.center.clone(),c=a.radius;if(c>this._occluderRadius)return e.FULL;if(this._horizonDistance!==Number.MAX_VALUE){var d=b.subtract(this._occluderPosition),f=this._occluderRadius-c,g=d.magnitudeSquared();f=g-f*f;if(f>0){f=Math.sqrt(f)+this._horizonDistance,d=b.subtract(this._cameraPosition);var h=d.magnitudeSquared();return f*f+c*c<h?e.NONE:(f=this._occluderRadius+c,f=g-f*f,f>0?(f=Math.sqrt(f)+this._horizonDistance,h<f*f+c*c?e.FULL:e.PARTIAL):(d=b.subtract(this._horizonPlanePosition),d.dot(this._horizonPlaneNormal)>-c?e.PARTIAL:e.FULL))}}return e.NONE},h.getOccludeePoint=function(a,c,e){if(!a)throw new b("occluderBoundingSphere is required.");if(!e)throw new b("positions is required.");if(e.length===0)throw new b("positions must contain at least one element");var f=d.clone(c),g=a.center.clone(),i=a.radius,j=e.length;if(g.equals(c))throw new b("occludeePosition must be different than occluderBoundingSphere.center");var k=f.subtract(g).normalize(),l=-k.dot(g),m=h._anyRotationVector(g,k,l),n=h._horizonToPlaneNormalDotProduct(a,k,l,m,e[0]);if(!n)return undefined;var o;for(var p=1;p<j;++p){o=h._horizonToPlaneNormalDotProduct(a,k,l,m,e[p]);if(!o)return undefined;o<n&&(n=o)}if(n<.0017453283658983088)return undefined;var q=i/n;return g.add(k.multiplyByScalar(q))};var j=[];return h.computeOccludeePointFromExtent=function(c,e){if(typeof c=="undefined")throw new b("extent is required.");e=a(e,f.WGS84);var i=c.subsample(e,j),k=g.fromPoints(i),l=d.ZERO;return l.equals(k.center)?undefined:h.getOccludeePoint(new g(l,e.getMinimumRadius()),k.center,i)},h._anyRotationVector=function(a,b,c){var e=b.clone().abs(),f=e.x>e.y?0:1;if(f===0&&e.z>e.x||f===1&&e.z>e.y)f=2;var g=new d;f===0?(e.x=a.x,e.y=a.y+1,e.z=a.z+1,g=d.UNIT_X):f===1?(e.x=a.x+1,e.y=a.y,e.z=a.z+1,g=d.UNIT_Y):(e.x=a.x+1,e.y=a.y+1,e.z=a.z,g=d.UNIT_Z);var h=(b.dot(e)+c)/-b.dot(g);return e.add(g.multiplyByScalar(h)).subtract(a).normalize()},h._rotationVector=function(a,b,d,e,f){var g=e.subtract(a);g=g.normalize();if(b.dot(g)<.9999999847691291){var h=b.cross(g),i=h.magnitude();if(i>c.EPSILON13)return h.normalize()}return f},h._horizonToPlaneNormalDotProduct=function(a,b,c,e,f){var g=d.clone(f),h=a.center.clone(),i=a.radius,j=h.subtract(g),k=j.magnitudeSquared(),l=i*i;if(k<l)return!1;var m=k-l,n=Math.sqrt(m),o=Math.sqrt(k),p=1/o,q=n*p,r=q*n;j=j.normalize();var s=g.add(j.multiplyByScalar(r)),t=Math.sqrt(m-r*r),u=this._rotationVector(h,b,c,g,e),v=new d(u.x*u.x*j.x+(u.x*u.y-u.z)*j.y+(u.x*u.z+u.y)*j.z,(u.x*u.y+u.z)*j.x+u.y*u.y*j.y+(u.y*u.z-u.x)*j.z,(u.x*u.z-u.y)*j.x+(u.y*u.z+u.x)*j.y+u.z*u.z*j.z);v=v.normalize();var w=v.multiplyByScalar(t);u=s.add(w).subtract(h).normalize();var x=b.dot(u);u=s.subtract(w).subtract(h).normalize();var y=b.dot(u);return x<y?x:y},h}),c("Core/HermiteSpline",["./DeveloperError","./Matrix4","./Cartesian4","./TridiagonalSystemSolver"],function(a,b,c,d){var e=function(b){if(!b||!(b instanceof Array)||b.length<3)throw new a("controlPoints is required. It must be an array with at least a length of 3.");this._points=b,this._lastTimeIndex=0,!this._points[0].tangent||!this._points[this._points.length-1].tangent?this._generateNatural():this._points[0].tangent&&!this._points[1].tangent&&this._points[this._points.length-1].tangent&&!this._points[this._points.length-2].tangent&&this._generateClamped()};return e.hermiteCoefficientMatrix=new b(2,-3,0,1,-2,3,0,0,1,-2,1,0,1,-1,0,0),e.prototype._findIndex=function(a){var b=this._lastTimeIndex||0;if(a>=this._points[b].time){if(b+1<this._points.length&&a<this._points[b+1].time)return b;if(b+2<this._points.length&&a<this._points[b+2].time)return this._lastTimeIndex=b+1,this._lastTimeIndex}else if(b-1>=0&&a>=this._points[b-1].time)return this._lastTimeIndex=b-1,this._lastTimeIndex;for(b=0;b<this._points.length-1;++b)if(a>=this._points[b].time&&a<this._points[b+1].time)break;return b===this._points.length-1&&(b=this._points.length-2),this._lastTimeIndex=b,this._lastTimeIndex},e.prototype._generateClamped=function(){var a=[],b=[],c=[],e=[];a.length=c.length=this._points.length-1,b.length=e.length=this._points.length;var f;a[0]=b[0]=1,c[0]=0,e[0]=this._points[0].tangent;for(f=1;f<a.length-1;++f)a[f]=c[f]=1,b[f]=4,e[f]=this._points[f+1].point.subtract(this._points[f-1].point).multiplyByScalar(3);a[f]=0,c[f]=1,b[f]=4,e[f]=this._points[f+1].point.subtract(this._points[f-1].point).multiplyByScalar(3),b[f+1]=1,e[f+1]=this._points[f+1].tangent;var g=d.solve(a,b,c,e);for(f=0;f<this._points.length;++f)this._points[f].tangent=g[f]},e.prototype._generateNatural=function(){var a=[],b=[],c=[],e=[];a.length=c.length=this._points.length-1,b.length=e.length=this._points.length;var f;a[0]=c[0]=1,b[0]=2,e[0]=this._points[1].point.subtract(this._points[0].point).multiplyByScalar(3);for(f=1;f<a.length;++f)a[f]=c[f]=1,b[f]=4,e[f]=this._points[f+1].point.subtract(this._points[f-1].point).multiplyByScalar(3);b[f]=2,e[f]=this._points[f].point.subtract(this._points[f-1].point).multiplyByScalar(3);var g=d.solve(a,b,c,e);for(f=0;f<this._points.length;++f)this._points[f].tangent=g[f]},e.prototype.getControlPoints=function(){return this._points},e.prototype.evaluate=function(b){if(typeof b=="undefined")throw new a("time is required.");if(b<this._points[0].time||b>this._points[this._points.length-1].time)throw new a("time is out of range.");var d=this._findIndex(b),f=(b-this._points[d].time)/(this._points[d+1].time-this._points[d].time),g=new c(0,f*f,f);g.x=g.y*f;var h=e.hermiteCoefficientMatrix.multiplyByPoint(g),i=this._points[d].point.multiplyByScalar(h.x),j=this._points[d+1].point.multiplyByScalar(h.y),k=this._points[d].tangent.multiplyByScalar(h.z),l=this._points[d+1].tangent.multiplyByScalar(h.w);return i.add(j.add(k.add(l)))},e}),c("Core/CatmullRomSpline",["./DeveloperError","./Matrix4","./Cartesian3","./Cartesian4","./HermiteSpline"],function(a,b,c,d,e){var f=function(b,d,e){if(!b||!(b instanceof Array)||b.length<3)throw new a("controlPoints is required and must be an array of objects with point and time properties, with a length of at least 3.");this._points=b,this._lastTimeIndex=0;if(d)this._ti=c.clone(d);else{var f=c.clone(b[0].point),g=c.clone(b[1].point),h=c.clone(b[2].point);this._ti=g.multiplyByScalar(2).subtract(h).subtract(f).multiplyByScalar(.5)}if(d)this._to=c.clone(e);else{var i=b.length-1,j=c.clone(b[i].point),k=c.clone(b[i-1].point),l=c.clone(b[i-2].point);this._to=j.subtract(k.multiplyByScalar(2)).add(l).multiplyByScalar(.5)}};return f.catmullRomCoefficientMatrix=new b(-0.5,1,-0.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-0.5,0,0),f.prototype.getControlPoints=function(){return this._points},f.prototype.getStartTangent=function(){return this._ti},f.prototype.getEndTangent=function(){return this._to},f.prototype._findIndex=function(a){var b=this._lastTimeIndex||0;if(a>=this._points[b].time){if(b+1<this._points.length&&a<this._points[b+1].time)return b;if(b+2<this._points.length&&a<this._points[b+2].time)return this._lastTimeIndex=b+1,this._lastTimeIndex}else if(b-1>=0&&a>=this._points[b-1].time)return this._lastTimeIndex=b-1,this._lastTimeIndex;for(b=0;b<this._points.length-1;++b)if(a>=this._points[b].time&&a<this._points[b+1].time)break;return b===this._points.length-1&&(b=this._points.length-2),this._lastTimeIndex=b,this._lastTimeIndex},f.prototype.evaluate=function(b){if(typeof b=="undefined")throw new a("time is required.");if(b<this._points[0].time||b>this._points[this._points.length-1].time)throw new a("time is out of range.");var d=this._findIndex(b),g=(b-this._points[d].time)/(this._points[d+1].time-this._points[d].time),h=new c(0,g*g,g);h.x=h.y*g;var i,j,k,l,m;return d===0?(i=this._points[0].point,j=this._points[1].point,k=this._ti,l=this._points[2].point.subtract(i).multiplyByScalar(.5),m=e.hermiteCoefficientMatrix.multiplyByPoint(h)):d===this._points.length-2?(i=this._points[d].point,j=this._points[d+1].point,k=j.subtract(this._points[d-1].point).multiplyByScalar(.5),l=this._to,m=e.hermiteCoefficientMatrix.multiplyByPoint(h)):(i=this._points[d-1].point,j=this._points[d].point,k=this._points[d+1].point,l=this._points[d+2].point,m=f.catmullRomCoefficientMatrix.multiplyByPoint(h)),i=i.multiplyByScalar(m.x),j=j.multiplyByScalar(m.y),k=k.multiplyByScalar(m.z),l=l.multiplyByScalar(m.w),i.add(j.add(k.add(l)))},f}),c("Core/Transforms",["./defaultValue","./DeveloperError","./Math","./Matrix3","./Matrix4","./Cartesian2","./Cartesian3","./Cartesian4","./TimeConstants","./Ellipsoid"],function(a,b,c,d,e,f,g,h,i,j){var k=24110.54841,l=8640184.812866,m=.093104,n=-0.0000062,o=1.1772758384668e-19,p=72921158553e-15,q=c.TWO_PI/86400,r=new g,s=new g,t=new g,u=new g,v=new g,w=new g,x=new h,y={eastNorthUpToFixedFrame:function(d,f,h){if(typeof d=="undefined")throw new b("origin is required.");if(c.equalsEpsilon(d.x,0,c.EPSILON14)&&c.equalsEpsilon(d.y,0,c.EPSILON14)){var i=c.sign(d.z);return typeof h=="undefined"?new e(0,-i,0,d.x,1,0,0,d.y,0,0,i,d.z,0,0,0,1):(h[0]=0,h[1]=1,h[2]=0,h[3]=0,h[4]=-i,h[5]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=i,h[11]=0,h[12]=d.x,h[13]=d.y,h[14]=d.z,h[15]=1,h)}var k=r,l=s,m=t;return f=a(f,j.WGS84),f.geodeticSurfaceNormal(d,k),l.x=-d.y,l.y=d.x,l.z=0,g.normalize(l,l),k.cross(l,m),typeof h=="undefined"?new e(l.x,m.x,k.x,d.x,l.y,m.y,k.y,d.y,l.z,m.z,k.z,d.z,0,0,0,1):(h[0]=l.x,h[1]=l.y,h[2]=l.z,h[3]=0,h[4]=m.x,h[5]=m.y,h[6]=m.z,h[7]=0,h[8]=k.x,h[9]=k.y,h[10]=k.z,h[11]=0,h[12]=d.x,h[13]=d.y,h[14]=d.z,h[15]=1,h)},northEastDownToFixedFrame:function(d,f,h){if(typeof d=="undefined")throw new b("origin is required.");if(c.equalsEpsilon(d.x,0,c.EPSILON14)&&c.equalsEpsilon(d.y,0,c.EPSILON14)){var i=c.sign(d.z);return typeof h=="undefined"?new e(-i,0,0,d.x,0,1,0,d.y,0,0,-i,d.z,0,0,0,1):(h[0]=-i,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=-i,h[11]=0,h[12]=d.x,h[13]=d.y,h[14]=d.z,h[15]=1,h)}var k=u,l=v,m=w;return f=a(f,j.WGS84),f.geodeticSurfaceNormal(d,k),l.x=-d.y,l.y=d.x,l.z=0,g.normalize(l,l),k.cross(l,m),typeof h=="undefined"?new e(m.x,l.x,-k.x,d.x,m.y,l.y,-k.y,d.y,m.z,l.z,-k.z,d.z,0,0,0,1):(h[0]=m.x,h[1]=m.y,h[2]=m.z,h[3]=0,h[4]=l.x,h[5]=l.y,h[6]=l.z,h[7]=0,h[8]=-k.x,h[9]=-k.y,h[10]=-k.z,h[11]=0,h[12]=d.x,h[13]=d.y,h[14]=d.z,h[15]=1,h)},computeTemeToPseudoFixedMatrix:function(a,e){if(typeof a=="undefined")throw new b("date is required.");var f=a.addSeconds(-a.getTaiMinusUtc()),g=f.getJulianDayNumber(),h=f.getSecondsOfDay(),j,r=g-2451545;h>=43200?j=(r+.5)/i.DAYS_PER_JULIAN_CENTURY:j=(r-.5)/i.DAYS_PER_JULIAN_CENTURY;var s=k+j*(l+j*(m+j*n)),t=s*q%c.TWO_PI,u=p+o*(g-2451545.5),v=(h+i.SECONDS_PER_DAY*.5)%i.SECONDS_PER_DAY,w=t+u*v,x=Math.cos(w),y=Math.sin(w);return typeof e=="undefined"?new d(x,y,0,-y,x,0,0,0,1):(e[0]=x,e[1]=-y,e[2]=0,e[3]=y,e[4]=x,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e)},pointToWindowCoordinates:function(a,c,d,g){if(typeof a=="undefined")throw new b("modelViewProjectionMatrix is required.");if(typeof c=="undefined")throw new b("viewportTransformation is required.");if(typeof d=="undefined")throw new b("point is required.");var i=x;return e.multiplyByPoint(a,d,i),h.multiplyByScalar(i,1/i.w,i),e.multiplyByVector(c,i,i),f.fromCartesian4(i,g)}};return y}),c("Core/EllipsoidTangentPlane",["./defaultValue","./DeveloperError","./Transforms","./AxisAlignedBoundingBox","./IntersectionTests","./Cartesian2","./Cartesian3","./Ellipsoid","./Ray"],function(a,b,c,d,e,f,g,h,i){var j=function(d,e){if(typeof d=="undefined")throw new b("origin is required.");e=a(e,h.WGS84),d=e.scaleToGeodeticSurface(d);var f=c.eastNorthUpToFixedFrame(d,e);this._ellipsoid=e,this._origin=g.clone(d),this._xAxis=g.fromCartesian4(f.getColumn(0)),this._yAxis=g.fromCartesian4(f.getColumn(1)),this._normal=g.fromCartesian4(f.getColumn(2)),this._distance=-g.dot(d,d)},k=new d;j.fromPoints=function(a,c){if(typeof a=="undefined")throw new b("cartesians is required.");var e=d.fromPoints(a,k);return new j(e.center,c)},j.prototype.getEllipsoid=function(){return this._ellipsoid},j.prototype.getOrigin=function(){return this._origin};var l=new i,m=new g;j.prototype.projectPointOntoPlane=function(a,c){if(typeof a=="undefined")throw new b("cartesian is required.");var d=l;d.origin=a,g.normalize(a,d.direction);var h=e.rayPlane(d,this._normal,this._distance,m);if(typeof h!="undefined"){var i=h.subtract(this._origin,h),j=this._xAxis.dot(i),k=this._yAxis.dot(i);return typeof c=="undefined"?new f(j,k):(c.x=j,c.y=k,c)}return undefined},j.prototype.projectPointsOntoPlane=function(a,c){if(typeof a=="undefined")throw new b("cartesians is required.");typeof c=="undefined"&&(c=[]);var d=0,e=a.length;for(var f=0;f<e;f++){var g=this.projectPointOntoPlane(a[f],c[d]);typeof g!="undefined"&&(c[d]=g,d++)}return c.length=d,c};var n=new g;return j.prototype.projectPointsOntoEllipsoid=function(a,c){if(typeof a=="undefined")throw new b("cartesians is required.");var d=a.length;typeof c=="undefined"?c=new Array(d):c.length=d;var e=this._ellipsoid,f=this._origin,h=this._xAxis,i=this._yAxis,j=n;for(var k=0;k<d;++k){var l=a[k];h.multiplyByScalar(l.x,j);var m=c[k]=g.add(f,j,c[k]);i.multiplyByScalar(l.y,j),g.add(m,j,m),e.scaleToGeocentricSurface(m,m)}return c},j}),c("Core/Quaternion",["./Cartesian3","./defaultValue","./DeveloperError","./freezeObject","./Math","./Matrix3"],function(a,b,c,d,e,f){var g=function(a,c,d,e){this.x=b(a,0),this.y=b(c,0),this.z=b(d,0),this.w=b(e,0)},h;g.fromAxisAngle=function(b,d,e){if(typeof b=="undefined")throw new c("axis is required.");if(typeof d!="number")throw new c("angle is required and must be a number.");var f=d/2,i=Math.sin(f);h=a.normalize(b,h);var j=h.x*i,k=h.y*i,l=h.z*i,m=Math.cos(f);return typeof e=="undefined"?new g(j,k,l,m):(e.x=j,e.y=k,e.z=l,e.w=m,e)};var i=[1,2,0],j=new Array(3);g.fromRotationMatrix=function(a,b){if(typeof a=="undefined")throw new c("matrix is required.");var d,e,h,k,l,m=a[f.COLUMN0ROW0],n=a[f.COLUMN1ROW1],o=a[f.COLUMN2ROW2],p=m+n+o;if(p>0)d=Math.sqrt(p+1),l=.5*d,d=.5/d,e=(a[f.COLUMN2ROW1]-a[f.COLUMN1ROW2])*d,h=(a[f.COLUMN0ROW2]-a[f.COLUMN2ROW0])*d,k=(a[f.COLUMN1ROW0]-a[f.COLUMN0ROW1])*d;else{var q=i,r=0;n>m&&(r=1),o>m&&o>n&&(r=2);var s=q[r],t=q[s];d=Math.sqrt(a[f.getElementIndex(r,r)]-a[f.getElementIndex(s,s)]-a[f.getElementIndex(t,t)]+1);var u=j;u[r]=.5*d,d=.5/d,l=(a[f.getElementIndex(t,s)]-a[f.getElementIndex(s,t)])*d,u[s]=(a[f.getElementIndex(s,r)]+a[f.getElementIndex(r,s)])*d,u[t]=(a[f.getElementIndex(t,r)]+a[f.getElementIndex(r,t)])*d,e=u[0],h=u[1],k=u[2]}return typeof b=="undefined"?new g(e,h,k,l):(b.x=e,b.y=h,b.z=k,b.w=l,b)},g.clone=function(a,b){if(typeof a=="undefined")throw new c("quaternion is required");return typeof b=="undefined"?new g(a.x,a.y,a.z,a.w):(b.x=a.x,b.y=a.y,b.z=a.z,b.w=a.w,b)},g.conjugate=function(a,b){if(typeof a=="undefined")throw new c("quaternion is required");return typeof b=="undefined"?new g(-a.x,-a.y,-a.z,a.w):(b.x=-a.x,b.y=-a.y,b.z=-a.z,b.w=a.w,b)},g.magnitudeSquared=function(a){if(typeof a=="undefined")throw new c("quaternion is required");return a.x*a.x+a.y*a.y+a.z*a.z+a.w*a.w},g.magnitude=function(a){if(typeof a=="undefined")throw new c("quaternion is required");return Math.sqrt(g.magnitudeSquared(a))},g.normalize=function(a,b){var c=1/g.magnitude(a),d=a.x*c,e=a.y*c,f=a.z*c,h=a.w*c;return typeof b=="undefined"?new g(d,e,f,h):(b.x=d,b.y=e,b.z=f,b.w=h,b)},g.inverse=function(a,b){var c=g.magnitudeSquared(a);return b=g.conjugate(a,b),g.multiplyByScalar(b,1/c,b)},g.add=function(a,b,d){if(typeof a=="undefined")throw new c("left is required");if(typeof b=="undefined")throw new c("right is required");return typeof d=="undefined"?new g(a.x+b.x,a.y+b.y,a.z+b.z,a.w+b.w):(d.x=a.x+b.x,d.y=a.y+b.y,d.z=a.z+b.z,d.w=a.w+b.w,d)},g.subtract=function(a,b,d){if(typeof a=="undefined")throw new c("left is required");if(typeof b=="undefined")throw new c("right is required");return typeof d=="undefined"?new g(a.x-b.x,a.y-b.y,a.z-b.z,a.w-b.w):(d.x=a.x-b.x,d.y=a.y-b.y,d.z=a.z-b.z,d.w=a.w-b.w,d)},g.negate=function(a,b){if(typeof a=="undefined")throw new c("quaternion is required");return typeof b=="undefined"?new g(-a.x,-a.y,-a.z,-a.w):(b.x=-a.x,b.y=-a.y,b.z=-a.z,b.w=-a.w,b)},g.dot=function(a,b){if(typeof a=="undefined")throw new c("left is required");if(typeof b=="undefined")throw new c("right is required");return a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w},g.multiply=function(a,b,d){if(typeof a=="undefined")throw new c("left is required");if(typeof b=="undefined")throw new c("right is required");var e=a.x,f=a.y,h=a.z,i=a.w,j=b.x,k=b.y,l=b.z,m=b.w,n=i*j+e*m+f*l-h*k,o=i*k-e*l+f*m+h*j,p=i*l+e*k-f*j+h*m,q=i*m-e*j-f*k-h*l;return typeof d=="undefined"?new g(n,o,p,q):(d.x=n,d.y=o,d.z=p,d.w=q,d)},g.multiplyByScalar=function(a,b,d){if(typeof a=="undefined")throw new c("quaternion is required");if(typeof b!="number")throw new c("scalar is required and must be a number.");return typeof d=="undefined"?new g(a.x*b,a.y*b,a.z*b,a.w*b):(d.x=a.x*b,d.y=a.y*b,d.z=a.z*b,d.w=a.w*b,d)},g.divideByScalar=function(a,b,d){if(typeof a=="undefined")throw new c("quaternion is required");if(typeof b!="number")throw new c("scalar is required and must be a number.");return typeof d=="undefined"?new g(a.x/b,a.y/b,a.z/b,a.w/b):(d.x=a.x/b,d.y=a.y/b,d.z=a.z/b,d.w=a.w/b,d)},g.getAxis=function(b,d){if(typeof b=="undefined")throw new c("quaternion is required");var f=b.w;if(Math.abs(f-1)<e.EPSILON6)return typeof d=="undefined"?new a(0,0,0):(d.x=d.y=d.z=0,d);var g=1/Math.sqrt(1-f*f);return typeof d=="undefined"?new a(b.x*g,b.y*g,b.z*g):(d.x=b.x*g,d.y=b.y*g,d.z=b.z*g,d)},g.getAngle=function(a){if(typeof a=="undefined")throw new c("quaternion is required");return Math.abs(a.w-1)<e.EPSILON6?0:2*Math.acos(a.w)};var k;g.lerp=function(a,b,d,e){if(typeof a=="undefined")throw new c("start is required.");if(typeof b=="undefined")throw new c("end is required.");if(typeof d!="number")throw new c("t is required and must be a number.");return k=g.multiplyByScalar(b,d,k),e=g.multiplyByScalar(a,1-d,e),g.add(k,e,e)};var l,m,n;return g.slerp=function(a,b,d,f){if(typeof a=="undefined")throw new c("start is required.");if(typeof b=="undefined")throw new c("end is required.");if(typeof d!="number")throw new c("t is required and must be a number.");var h=g.dot(a,b),i=b;h<0&&(h=-h,i=l=g.negate(b,l));if(1-h<e.EPSILON6)return g.lerp(a,i,d);var j=Math.acos(h);return m=g.multiplyByScalar(a,Math.sin((1-d)*j),m),n=g.multiplyByScalar(i,Math.sin(d*j),n),f=g.add(m,n,f),g.multiplyByScalar(f,1/Math.sin(j),f)},g.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&a.x===b.x&&a.y===b.y&&a.z===b.z&&a.w===b.w},g.equalsEpsilon=function(a,b,d){if(typeof d!="number")throw new c("epsilon is required and must be a number.");return a===b||typeof a!="undefined"&&typeof b!="undefined"&&Math.abs(a.x-b.x)<=d&&Math.abs(a.y-b.y)<=d&&Math.abs(a.z-b.z)<=d&&Math.abs(a.w-b.w)<=d},g.ZERO=d(new g(0,0,0,0)),g.IDENTITY=d(new g(0,0,0,1)),g.prototype.clone=function(a){return g.clone(this,a)},g.prototype.conjugate=function(a){return g.conjugate(this,a)},g.prototype.magnitudeSquared=function(){return g.magnitudeSquared(this)},g.prototype.magnitude=function(){return g.magnitude(this)},g.prototype.normalize=function(a){return g.normalize(this,a)},g.prototype.inverse=function(a){return g.inverse(this,a)},g.prototype.add=function(a,b){return g.add(this,a,b)},g.prototype.subtract=function(a,b){return g.subtract(this,a,b)},g.prototype.negate=function(a){return g.negate(this,a)},g.prototype.dot=function(a){return g.dot(this,a)},g.prototype.multiply=function(a,b){return g.multiply(this,a,b)},g.prototype.multiplyByScalar=function(a,b){return g.multiplyByScalar(this,a,b)},g.prototype.divideByScalar=function(a,b){return g.divideByScalar(this,a,b)},g.prototype.getAxis=function(a){return g.getAxis(this,a)},g.prototype.getAngle=function(){return g.getAngle(this)},g.prototype.lerp=function(a,b,c){return g.lerp(this,a,b,c)},g.prototype.slerp=function(a,b,c){return g.slerp(this,a,b,c)},g.prototype.equals=function(a){return g.equals(this,a)},g.prototype.equalsEpsilon=function(a,b){return g.equalsEpsilon(this,a,b)},g.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},g}),c("Core/OrientationInterpolator",["./DeveloperError","./Quaternion"],function(a,b){var c=function(b){if(!b||!(b instanceof Array)||b.length<2)throw new a("controlPoints is required. It must be an array with at least a length of 3.");this._points=b,this._lastTimeIndex=0};return c.prototype.getControlPoints=function(){return this._points},c.prototype._findIndex=function(a){var b=this._lastTimeIndex||0;if(a>=this._points[b].time){if(b+1<this._points.length&&a<this._points[b+1].time)return b;if(b+2<this._points.length&&a<this._points[b+2].time)return this._lastTimeIndex=b+1,this._lastTimeIndex}else if(b-1>=0&&a>=this._points[b-1].time)return this._lastTimeIndex=b-1,this._lastTimeIndex;for(b=0;b<this._points.length-1;++b)if(a>=this._points[b].time&&a<this._points[b+1].time)break;return b===this._points.length-1&&(b=this._points.length-2),this._lastTimeIndex=b,this._lastTimeIndex},c.prototype.evaluate=function(b){if(typeof b=="undefined")throw new a("time is required.");if(b<this._points[0].time||b>this._points[this._points.length-1].time)throw new a("time is out of range.");var c=this._findIndex(b),d=(b-this._points[c].time)/(this._points[c+1].time-this._points[c].time);return this._points[c].orientation.slerp(this._points[c+1].orientation,d)},c}),c("Core/Shapes",["./DeveloperError","./Math","./Cartesian2","./Cartesian3","./Quaternion","./Matrix3"],function(a,b,c,d,e,f){function g(a,b,c,d,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u,v,w,x,y,z,A,B;for(var C=0;C<t;C++,o+=q,++s){v=q>0?n[o]+p:p-n[o],x=v+m,y=-Math.cos(x),A=k.multiplyByScalar(y),y=Math.sin(x),B=l.multiplyByScalar(y),A=A.add(B),y=Math.cos(v),y*=y,z=Math.sin(v),z*=z,w=g/Math.sqrt(d*y+c*z),u=w/b,y=Math.sin(u/2);var D=(new e(A.x*y,A.y*y,A.z*y,Math.cos(u/2))).normalize(),E=f.fromQuaternion(D),F=E.multiplyByVector(j),G=F.normalize();F=G.multiplyByScalar(i),r[s]=F}}var h={computeCircleBoundary:function(c,d,e,f){if(!c||!d||!e)throw new a("ellipsoid, center, and radius are required.");if(e<=0)throw new a("radius must be greater than zero.");f=f||b.toRadians(1);if(f<=0)throw new a("granularity must be greater than zero.");return this.computeEllipseBoundary(c,d,e,e,0,f)},computeEllipseBoundary:function(c,e,f,h,i,j){if(!c||!e||!f||!h)throw new a("ellipsoid, center, semiMajorAxis, and semiMinorAxis are required.");if(f<=0||h<=0)throw new a("Semi-major and semi-minor axes must be greater than zero.");i=i||0,j=j||b.toRadians(1);if(j<=0)throw new a("granularity must be greater than zero.");if(f<h){var k=f;f=h,h=k}var l=2.31,m=f*f,n=h*h,o=f*h,p=1-n/m,q=Math.sqrt(p),r=d.clone(e),s=r.magnitude(),t=new d(0,0,1),u=1/s,v=r.multiplyByScalar(u),w=t.cross(r).normalize(),x=v.cross(w),y=1+Math.ceil(b.PI_OVER_TWO/j),z=l/(y-1),A=[],B=0,C=0;for(var D=0;D<y;D++,C+=z,++B){A[B]=C-q*Math.sin(C);if(A[B]>=b.PI_OVER_TWO){A[B]=b.PI_OVER_TWO,y=D+1;break}}var E=[];return g(c,r.magnitude(),m,n,o,q,s,v,w,x,i,A,0,0,1,E,0,y-1),g(c,r.magnitude(),m,n,o,q,s,v,w,x,i,A,y-1,Math.PI,-1,E,y-1,y-1),g(c,r.magnitude(),m,n,o,q,s,v,w,x,i,A,0,Math.PI,1,E,2*y-2,y-1),g(c,r.magnitude(),m,n,o,q,s,v,w,x,i,A,y-1,b.TWO_PI,-1,E,3*y-3,y),E.push(E[0].clone()),E}};return h}),c("Core/getImagePixels",[],function(){var a={},b=function(b,c,d){typeof c=="undefined"&&(c=b.width),typeof d=="undefined"&&(d=b.height);var e=a[c];typeof e=="undefined"&&(e={},a[c]=e);var f=e[d];if(typeof f=="undefined"){var g=document.createElement("canvas");g.width=c,g.height=d,f=g.getContext("2d"),f.globalCompositeOperation="copy",e[d]=f}return f.drawImage(b,0,0,c,d),f.getImageData(0,0,c,d).data};return b}),c("Core/isLeapYear",["./DeveloperError"],function(a){function b(b){if(b===null||isNaN(b))throw new a("year is required and must be a number.");return b%4===0&&b%100!==0||b%400===0}return b}),c("Core/JulianDate",["./DeveloperError","./binarySearch","./TimeConstants","./LeapSecond","./TimeStandard","./isLeapYear"],function(a,b,c,d,e,f){function i(a){var c=new d(a,0),e=d.getLeapSeconds(),f=b(e,c,d.compareLeapSecondDate);f<0&&(f=~f),f>=e.length&&(f=e.length-1);var g=e[f].offset;if(f>0){var h=a.getSecondsDifference(e[f].julianDate);h>g&&(f--,g=e[f].offset)}a.addSeconds(g,a)}function j(a,c){var e=new d(a,0),f=d.getLeapSeconds(),g=b(f,e,d.compareLeapSecondDate);g<0&&(g=~g);if(g===0)return a.addSeconds(-f[0].offset,c);if(g>=f.length)return a.addSeconds(-f[g-1].offset,c);var h=a.getSecondsDifference(f[g].julianDate);return h===0?a.addSeconds(-f[g].offset,c):h<=1?undefined:a.addSeconds(-f[--g].offset,c)}function k(a,b,d){var f=b/c.SECONDS_PER_DAY|0;return a+=f,b-=c.SECONDS_PER_DAY*f,b<0&&(a--,b+=c.SECONDS_PER_DAY),typeof d=="undefined"?new x(a,b,e.TAI):(d._julianDayNumber=a,d._secondsOfDay=b,d)}function l(a,b,d,e,f,g,h){var i=(b-14)/12|0,j=a+4800+i,k=(1461*j/4|0)+(367*(b-2-12*i)/12|0)-(3*((j+100)/100)/4|0)+d-32075;e-=12,e<0&&(e+=24);var l=g+(e*c.SECONDS_PER_HOUR+f*c.SECONDS_PER_MINUTE+h*c.SECONDS_PER_MILLISECOND);return l>=43200&&(k-=1),[k,l]}function m(a){return l(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())}var g=[31,28,31,30,31,30,31,31,30,31,30,31],h=29,n=/^(\d{4})$/,o=/^(\d{4})-(\d{2})$/,p=/^(\d{4})-?(\d{3})$/,q=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,r=/^(\d{4})-?(\d{2})-?(\d{2})$/,s=/([Z+\-])?(\d{2})?:?(\d{2})?$/,t=/^(\d{2})(\.\d+)?/.source+s.source,u=/^(\d{2}):?(\d{2})(\.\d+)?/.source+s.source,v=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+s.source,w="Valid ISO 8601 date string required.",x=function(b,d,f){this._julianDayNumber=undefined,this._secondsOfDay=undefined;var g,h;if(typeof b!="undefined"||typeof d!="undefined"||typeof f!="undefined"){if(typeof f=="undefined")f=e.UTC;else if(f!==e.UTC&&f!==e.TAI)throw new a("timeStandard is not a known TimeStandard.");if(b===null||isNaN(b))throw new a("julianDayNumber is required.");if(d===null||isNaN(d))throw new a("julianSecondsOfDay is required.");g=b|0,h=d+(b-g)*c.SECONDS_PER_DAY}else{var j=new Date,l=m(j);g=l[0],h=l[1],f=e.UTC}k(g,h,this),f===e.UTC&&i(this)};x.clone=function(b,c){if(typeof b=="undefined")throw new a("date is required.");return typeof c=="undefined"?new x(b._julianDayNumber,b._secondsOfDay,e.TAI):(c._julianDayNumber=b._julianDayNumber,c._secondsOfDay=b._secondsOfDay,c)},x.fromDate=function(b,c){if(typeof b=="undefined"||b===null||isNaN(b.getTime()))throw new a("date must be a valid JavaScript Date.");var d=m(b);return new x(d[0],d[1],c)},x.fromIso8601=function(b){if(typeof b!="string")throw new a(w);b=b.replace(",",".");var c=b.split("T"),d,i=1,j=1,k=0,m=0,s=0,y=0,z=c[0],A=c[1],B,C;if(typeof z=="undefined")throw new a(w);var D;c=z.match(r);if(c!==null){D=z.split("-").length-1;if(D>0&&D!==2)throw new a(w);d=+c[1],i=+c[2],j=+c[3]}else{c=z.match(o);if(c!==null)d=+c[1],i=+c[2];else{c=z.match(n);if(c!==null)d=+c[1];else{var E;c=z.match(p);if(c!==null){d=+c[1],E=+c[2],C=f(d);if(E<1||C&&E>366||!C&&E>365)throw new a(w)}else{c=z.match(q);if(c===null)throw new a(w);d=+c[1];var F=+c[2],G=+c[3]||0;D=z.split("-").length-1;if(D>0&&(typeof c[3]=="undefined"&&D!==1||typeof c[3]!="undefined"&&D!==2))throw new a(w);var H=new Date(Date.UTC(d,0,4));E=F*7+G-H.getUTCDay()-3}B=new Date(Date.UTC(d,0,1)),B.setUTCDate(E),i=B.getUTCMonth()+1,j=B.getUTCDate()}}}C=f(d);if(i<1||i>12||j<1||(i!==2||!C)&&j>g[i-1]||C&&i===2&&j>h)throw new a(w);var I;if(typeof A!="undefined"){c=A.match(v);if(c!==null){D=A.split(":").length-1;if(D>0&&D!==2)throw new a(w);k=+c[1],m=+c[2],s=+c[3],y=+(c[4]||0)*1e3,I=5}else{c=A.match(u);if(c!==null){D=A.split(":").length-1;if(D>0&&D!==1)throw new a(w);k=+c[1],m=+c[2],s=+(c[3]||0)*60,I=4}else{c=A.match(t);if(c===null)throw new a(w);k=+c[1],m=+(c[2]||0)*60,I=3}}if(m>=60||s>=61||k>24||k===24&&(m>0||s>0||y>0))throw new a(w);var J=c[I],K=+c[I+1],L=+(c[I+2]||0);switch(J){case"+":k-=K,m-=L;break;case"-":k+=K,m+=L;break;case"Z":break;default:m+=(new Date(Date.UTC(d,i-1,j,k,m))).getTimezoneOffset()}}else m+=(new Date(Date.UTC(d,i-1,j))).getTimezoneOffset();var M=s===60;M&&s--;while(m>=60)m-=60,k++;while(k>=24)k-=24,j++;B=C&&i===2?h:g[i-1];while(j>B)j-=B,i++,i>12&&(i-=12,d++),B=C&&i===2?h:g[i-1];while(m<0)m+=60,k--;while(k<0)k+=24,j--;while(j<1)B=C&&i===2?h:g[i-1],j+=B,i--,i<1&&(i+=12,d--);var N=l(d,i,j,k,m,s,y),O=new x(N[0],N[1],e.UTC);return M&&O.addSeconds(1,O),O},x.fromTotalDays=function(b,c){if(b===null||isNaN(b))throw new a("totalDays is required.");return new x(b,0,c)},x.compare=function(a,b){var c=a._julianDayNumber-b._julianDayNumber;return c!==0?c:a._secondsOfDay-b._secondsOfDay},x.prototype.clone=function(a){return x.clone(this,a)},x.prototype.getTotalDays=function(){return this._julianDayNumber+this._secondsOfDay/c.SECONDS_PER_DAY},x.prototype.getJulianDayNumber=function(){return this._julianDayNumber},x.prototype.getJulianTimeFraction=function(){return this._secondsOfDay/c.SECONDS_PER_DAY},x.prototype.getSecondsOfDay=function(){return this._secondsOfDay};var y=new x(0,0,e.TAI);return x.prototype.toDate=function(){var a=j(this,y);typeof a=="undefined"&&(this.addSeconds(1,y),a=j(y,y));var b=a._julianDayNumber,d=a._secondsOfDay;d>=43200&&(b+=1);var e=b+68569|0,f=4*e/146097|0;e=e-((146097*f+3)/4|0)|0;var g=4e3*(e+1)/1461001|0;e=e-(1461*g/4|0)+31|0;var h=80*e/2447|0,i=e-(2447*h/80|0)|0;e=h/11|0;var k=h+2-12*e|0,l=100*(f-49)+g+e|0;k--;var m=d/c.SECONDS_PER_HOUR|0,n=d-m*c.SECONDS_PER_HOUR,o=n/c.SECONDS_PER_MINUTE|0;n-=o*c.SECONDS_PER_MINUTE;var p=n|0,q=(n-p)/c.SECONDS_PER_MILLISECOND|0;return m+=12,m>23&&(m-=24),new Date(Date.UTC(l,k,i,m,o,p,q))},x.prototype.getSecondsDifference=function(a){var b=this,d=a,e=(d.getJulianDayNumber()-b.getJulianDayNumber())*c.SECONDS_PER_DAY;return e+(d.getSecondsOfDay()-b.getSecondsOfDay())},x.prototype.getMinutesDifference=function(a){return this.getSecondsDifference(a)/c.SECONDS_PER_MINUTE},x.prototype.getTaiMinusUtc=function(){var a=new d(this,0),c=d.getLeapSeconds(),e=b(c,a,d.compareLeapSecondDate);return e<0&&(e=~e,--e,e<0&&(e=0)),c[e].offset},x.prototype.addSeconds=function(b,c){if(b===null||isNaN(b))throw new a("seconds is required and must be a number.");return k(this._julianDayNumber,this._secondsOfDay+b,c)},x.prototype.addMinutes=function(b){if(b===null||isNaN(b))throw new a("duration is required and must be a number.");var d=this._secondsOfDay+b*c.SECONDS_PER_MINUTE;return new x(this._julianDayNumber,d,e.TAI)},x.prototype.addHours=function(b){if(b===null||isNaN(b))throw new a("duration is required and must be a number.");var d=this._secondsOfDay+b*c.SECONDS_PER_HOUR;return new x(this._julianDayNumber,d,e.TAI)},x.prototype.addDays=function(b){if(b===null||isNaN(b))throw new a("duration is required and must be a number.");var c=this._julianDayNumber+b;return new x(c,this._secondsOfDay,e.TAI)},x.prototype.lessThan=function(a){return x.compare(this,a)<0},x.prototype.lessThanOrEquals=function(a){return x.compare(this,a)<=0},x.prototype.greaterThan=function(a){return x.compare(this,a)>0},x.prototype.greaterThanOrEquals=function(a){return x.compare(this,a)>=0},x.prototype.equals=function(a){return x.compare(this,a)===0},x.prototype.equalsEpsilon=function(b,c){if(c===null||isNaN(c))throw new a("epsilon is required and must be number.");return Math.abs(this.getSecondsDifference(b))<=c},d._leapSeconds.length===0&&(d._leapSeconds=[new d(new x(2441317,43210,e.TAI),10),new d(new x(2441499,43211,e.TAI),11),new d(new x(2441683,43212,e.TAI),12),new d(new x(2442048,43213,e.TAI),13),new d(new x(2442413,43214,e.TAI),14),new d(new x(2442778,43215,e.TAI),15),new d(new x(2443144,43216,e.TAI),16),new d(new x(2443509,43217,e.TAI),17),new d(new x(2443874,43218,e.TAI),18),new d(new x(2444239,43219,e.TAI),19),new d(new x(2444786,43220,e.TAI),20),new d(new x(2445151,43221,e.TAI),21),new d(new x(2445516,43222,e.TAI),22),new d(new x(2446247,43223,e.TAI),23),new d(new x(2447161,43224,e.TAI),24),new d(new x(2447892,43225,e.TAI),25),new d(new x(2448257,43226,e.TAI),26),new d(new x(2448804,43227,e.TAI),27),new d(new x(2449169,43228,e.TAI),28),new d(new x(2449534,43229,e.TAI),29),new d(new x(2450083,43230,e.TAI),30),new d(new x(2450630,43231,e.TAI),31),new d(new x(2451179,43232,e.TAI),32),new d(new x(2453736,43233,e.TAI),33),new d(new x(2454832,43234,e.TAI),34),new d(new x(2456109,43235,e.TAI),35)]),x}),c("Core/Clock",["./DeveloperError","./JulianDate","./ClockStep","./ClockRange"],function(a,b,c,d){var e=function(e){var f=e;typeof f=="undefined"&&(f={});var g=f.startTime,h=typeof g=="undefined",i=f.stopTime,j=typeof i=="undefined",k=f.currentTime,l=typeof k=="undefined";h&&j&&l?(k=new b,g=k.clone(),i=k.addDays(1)):h&&j?(g=k.clone(),i=k.addDays(1)):h&&l?(g=i.addDays(-1),k=g.clone()):l&&j?(k=g.clone(),i=g.addDays(1)):l?k=g.clone():j?i=k.addDays(1):h&&(g=k.clone());if(g.greaterThan(i))throw new a("startTime must come before stopTime.");var m=f.multiplier;typeof m=="undefined"&&(m=1);var n=f.clockStep;typeof n=="undefined"&&(n=c.SYSTEM_CLOCK_DEPENDENT);var o=f.clockRange;typeof o=="undefined"&&(o=d.UNBOUNDED),this.startTime=g,this.stopTime=i,this.currentTime=k,this.multiplier=m,this.clockStep=n,this.clockRange=o,this._lastCpuTime=(new Date).getTime()};return e.prototype.tick=function(a){return this._tick(a,this.multiplier)},e.prototype.reverseTick=function(){return this._tick(undefined,-this.multiplier)},e.prototype._tick=function(a,b){var e=this.startTime,f=this.stopTime,g=this.currentTime,h=(new Date).getTime();if(typeof a=="undefined")if(this.clockStep===c.TICK_DEPENDENT)g=g.addSeconds(b);else{var i=h-this._lastCpuTime;g=g.addSeconds(b*(i/1e3))}else g=g.addSeconds(a);if(this.clockRange===d.CLAMPED)g.lessThan(e)?g=e:g.greaterThan(f)&&(g=f);else if(this.clockRange===d.LOOP){while(g.lessThan(e))g=f.addSeconds(e.getSecondsDifference(g));while(g.greaterThan(f))g=e.addSeconds(f.getSecondsDifference(g))}return this.currentTime=g,this._lastCpuTime=h,g},e}),c("Core/EventHandler",["./DeveloperError","./destroyObject","./Cartesian2","./JulianDate","./MouseEventType","./EventModifier"],function(a,b,c,d,e,f){var g=function(a){this._mouseEvents={};for(var b in e)e.hasOwnProperty(b)&&(this._mouseEvents[b]=0);this._modifiedMouseEvents={};for(var c in f)if(f.hasOwnProperty(c)){this._modifiedMouseEvents[c]={};for(b in e)e.hasOwnProperty(b)&&(this._modifiedMouseEvents[c][b]=0)}this._leftMouseButtonDown=!1,this._middleMouseButtonDown=!1,this._rightMouseButtonDown=!1,this._seenAnyTouchEvents=!1,this._lastMouseX=0,this._lastMouseY=0,this._totalPixels=0,this._clickPixelTolerance=5,this._element=a||document,this._register()};return g.prototype._getPosition=function(a){if(this._element===document)return{x:a.clientX,y:a.clientY};var b=this._element.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}},g.prototype.setMouseAction=function(b,c,d){if(!b)throw new a("action is required.");if(!c)throw new a("type is required.");var e;d&&d.name?e=this._modifiedMouseEvents[d.name]:e=this._mouseEvents,c&&c.name&&e&&(e[c.name]=b)},g.prototype.getMouseAction=function(b,c){if(!b)throw new a("type is required.");var d;return c&&c.name?d=this._modifiedMouseEvents[c.name]:d=this._mouseEvents,b&&b.name&&d?d[b.name]:undefined},g.prototype.removeMouseAction=function(b,c){if(!b)throw new a("type is required.");var d;c&&c.name?d=this._modifiedMouseEvents[c.name]:d=this._mouseEvents,b&&b.name&&d&&d[b.name]&&delete d[b.name]},g.prototype._getModifier=function(a){return a.shiftKey?f.SHIFT:a.ctrlKey?f.CTRL:a.altKey?f.ALT:undefined},g.prototype._handleMouseDown=function(a){var b=this._getPosition(a);this._lastMouseX=b.x,this._lastMouseY=b.y,this._totalPixels=0;if(this._seenAnyTouchEvents)return;var d=this._getModifier(a),f;a.button===0?(this._leftMouseButtonDown=!0,f=this.getMouseAction(e.LEFT_DOWN,d)):a.button===1?(this._middleMouseButtonDown=!0,f=this.getMouseAction(e.MIDDLE_DOWN,d)):a.button===2&&(this._rightMouseButtonDown=!0,f=this.getMouseAction(e.RIGHT_DOWN,d)),f&&f({position:new c(b.x,b.y)}),a.preventDefault()},g.prototype._handleMouseUp=function(a){var b=this._getModifier(a),d,f;if(this._seenAnyTouchEvents)return;a.button===0?(this._leftMouseButtonDown=!1,d=this.getMouseAction(e.LEFT_UP,b),f=this.getMouseAction(e.LEFT_CLICK,b)):a.button===1?(this._middleMouseButtonDown=!1,d=this.getMouseAction(e.MIDDLE_UP,b),f=this.getMouseAction(e.MIDDLE_CLICK,b)):a.button===2&&(this._rightMouseButtonDown=!1,d=this.getMouseAction(e.RIGHT_UP,b),f=this.getMouseAction(e.RIGHT_CLICK,b));var g=this._getPosition(a),h=this._lastMouseX-g.x,i=this._lastMouseY-g.y;this._totalPixels+=Math.sqrt(h*h+i*i),d&&d({position:new c(g.x,g.y)}),f&&this._totalPixels<this._clickPixelTolerance&&f({position:new c(g.x,g.y)})},g.prototype._handleMouseMove=function(a){var b=this._getPosition(a);if(this._seenAnyTouchEvents)return;var d=this._lastMouseX-b.x,f=this._lastMouseY-b.y;this._totalPixels+=Math.sqrt(d*d+f*f);var g={startPosition:new c(this._lastMouseX,this._lastMouseY),endPosition:new c(b.x,b.y),motion:new c(0,0)},h=this._getModifier(a),i=this.getMouseAction(e.MOVE,h);i&&i(g),this._lastMouseX=g.endPosition.x,this._lastMouseY=g.endPosition.y,(this._leftMouseButtonDown||this._middleMouseButtonDown||this._rightMouseButtonDown)&&a.preventDefault()},g.prototype._handleTouchStart=function(a){var b,d=a.touches.length;this._seenAnyTouchEvents=!0;if(d===1){b=this._getPosition(a.touches[0]),this._lastMouseX=b.x,this._lastMouseY=b.y,this._totalPixels=0;var f=this._getModifier(a),g;this._leftMouseButtonDown=!0,g=this.getMouseAction(e.LEFT_DOWN,f),g&&g({position:new c(b.x,b.y)}),a.preventDefault()}else this._leftMouseButtonDown&&this._handleTouchEnd(a)},g.prototype._handleTouchEnd=function(a){var b=a.touches.length,d=a.targetTouches.length,f=this._getModifier(a),g,h;this._leftMouseButtonDown&&(this._leftMouseButtonDown=!1,g=this.getMouseAction(e.LEFT_UP,f),h=this.getMouseAction(e.LEFT_CLICK,f));if(d>0){var i=this._getPosition(a.targetTouches[0]),j=this._lastMouseX-i.x,k=this._lastMouseY-i.y;this._totalPixels+=Math.sqrt(j*j+k*k),g&&g({position:new c(i.x,i.y)}),h&&this._totalPixels<this._clickPixelTolerance&&h({position:new c(i.x,i.y)})}b===1&&this._handleTouchStart(a)},g.prototype._handleTouchMove=function(a){if(this._leftMouseButtonDown&&a.touches.length===1){var b=this._getPosition(a.touches[0]),d=this._lastMouseX-b.x,f=this._lastMouseY-b.y;this._totalPixels+=Math.sqrt(d*d+f*f);var g={startPosition:new c(this._lastMouseX,this._lastMouseY),endPosition:new c(b.x,b.y),motion:new c(0,0)},h=this._getModifier(a),i=this.getMouseAction(e.MOVE,h);i&&i(g),this._lastMouseX=g.endPosition.x,this._lastMouseY=g.endPosition.y,(this._leftMouseButtonDown||this._middleMouseButtonDown||this._rightMouseButtonDown)&&a.preventDefault()}},g.prototype._handleMouseWheel=function(a){var b=a.detail?a.detail*-120:a.wheelDelta,c=this._getModifier(a),d=e.WHEEL,f=this.getMouseAction(d,c);f&&(a.preventDefault(),f(b))},g.prototype._handleMouseDblClick=function(a){var b=this._getModifier(a),d,f=this._getPosition(a);a.button===0?d=this.getMouseAction(e.LEFT_DOUBLE_CLICK,b):a.button===1?d=this.getMouseAction(e.MIDDLE_DOUBLE_CLICK,b):a.button===2&&(d=this.getMouseAction(e.RIGHT_DOUBLE_CLICK,b)),d&&d({position:new c(f.x,f.y)})},g.prototype._register=function(){var a=this,b=!0;this._callbacks=[],typeof this._element.disableRootEvents!="undefined"&&(b=!1),this._callbacks.push({name:"mousedown",onDoc:!1,action:function(b){a._handleMouseDown(b)}}),this._callbacks.push({name:"mouseup",onDoc:b,action:function(b){a._handleMouseUp(b)}}),this._callbacks.push({name:"mousemove",onDoc:b,action:function(b){a._handleMouseMove(b)}}),this._callbacks.push({name:"dblclick",onDoc:!1,action:function(b){a._handleMouseDblClick(b)}}),this._callbacks.push({name:"touchstart",onDoc:!1,action:function(b){a._handleTouchStart(b)}}),this._callbacks.push({name:"touchend",onDoc:b,action:function(b){a._handleTouchEnd(b)}}),this._callbacks.push({name:"touchmove",onDoc:b,action:function(b){a._handleTouchMove(b)}}),this._callbacks.push({name:"mousewheel",onDoc:!1,action:function(b){a._handleMouseWheel(b)}}),this._callbacks.push({name:"DOMMouseScroll",onDoc:!1,action:function(b){a._handleMouseWheel(b)}});for(var c=0;c<this._callbacks.length;c++){var d=this._callbacks[c];d.onDoc?document.addEventListener(d.name,d.action,!1):this._element.addEventListener(d.name,d.action,!1)}},g.prototype._unregister=function(){for(var a=0;a<this._callbacks.length;a++){var b=this._callbacks[a];b.onDoc?document.removeEventListener(b.name,b.action,!1):this._element.removeEventListener(b.name,b.action,!1)}},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return this._unregister(),b(this)},g}),c("Core/TimeInterval",["./DeveloperError","./freezeObject","./JulianDate","./TimeStandard"],function(a,b,c,d){var e=function(b,d,e,f,g){if(typeof b=="undefined")throw new a("start must be specified.");if(typeof d=="undefined")throw new a("stop must be specified.");typeof e=="undefined"&&(e=!0),typeof f=="undefined"&&(f=!0);var h=c.compare(d,b);this.start=b,this.stop=d,this.data=g,this.isStartIncluded=e,this.isStopIncluded=f,this.isEmpty=h<0||h===0&&(!e||!f)};return e.fromIso8601=function(a,b,d,f){var g=a.split("/"),h=c.fromIso8601(g[0]),i=c.fromIso8601(g[1]);return new e(h,i,b,d,f)},e.equals=function(a,b){return a===b||typeof a!="undefined"&&typeof b!="undefined"&&(a.isEmpty&&b.isEmpty||a.isStartIncluded===b.isStartIncluded&&a.isStopIncluded===b.isStopIncluded&&a.start.equals(b.start)&&a.stop.equals(b.stop))},e.equalsEpsilon=function(b,c,d){if(typeof d!="number")throw new a("epsilon is required and must be a number.");return b===c||typeof b!="undefined"&&typeof c!="undefined"&&(b.isEmpty&&c.isEmpty||b.isStartIncluded===c.isStartIncluded&&b.isStopIncluded===c.isStopIncluded&&b.start.equalsEpsilon(c.start,d)&&b.stop.equalsEpsilon(c.stop,d))},e.prototype.clone=function(){return new e(this.start,this.stop,this.isStartIncluded,this.isStopIncluded,this.data)},e.EMPTY=b(new e(new c(0,0,d.TAI),new c(0,0,d.TAI),!1,!1)),e.prototype.intersect=function(a,b){if(typeof a=="undefined")return e.EMPTY;var c=a.start,d=a.stop,f=a.isStartIncluded,g=a.isStopIncluded,h=this.start,i=this.stop,j=this.isStartIncluded,k=this.isStopIncluded,l,m,n;return c.greaterThanOrEquals(h)&&i.greaterThanOrEquals(c)?(m=!c.equals(h)&&f||j&&f,n=k&&g,l=typeof b!="undefined"?b(this.data,a.data):this.data,i.greaterThanOrEquals(d)?(n=n||!d.equals(i)&&g,new e(c,d,m,n,l)):(n=n||k,new e(c,i,m,n,l))):c.lessThanOrEquals(h)&&h.lessThanOrEquals(d)?(m=c.equals(h)===!1&&j||j&&f,n=k&&g,l=typeof b!="undefined"?b(this.data,a.data):this.data,i.greaterThanOrEquals(d)?(n=n||d.equals(i)===!1&&g,new e(h,d,m,n,l)):(n=n||k,new e(h,i,m,n,l))):e.EMPTY},e.prototype.contains=function(a){if(this.isEmpty)return!1;var b=c.compare(this.start,a);if(b===0)return this.isStartIncluded;var d=c.compare(a,this.stop);return d===0?this.isStopIncluded:b<0&&d<0},e.prototype.equals=function(a){return e.equals(this,a)},e.prototype.equalsEpsilon=function(a,b){return e.equalsEpsilon(this,a,b)},e}),c("Core/Iso8601",["./freezeObject","./JulianDate","./TimeInterval"],function(a,b,c){var d=a(b.fromIso8601("0000-01-01T00:00:00Z")),e=a(b.fromIso8601("9999-12-31T24:00:00Z")),f=a(new c(d,e,!0,!0)),g={MINIMUM_VALUE:d,MAXIMUM_VALUE:e,MAXIMUM_INTERVAL:f};return g}),c("Core/TimeIntervalCollection",["./DeveloperError","./binarySearch","./TimeInterval","./JulianDate"],function(a,b,c,d){function e(a,b){return d.compare(a.start,b.start)}var f=function(){this._intervals=[]};return f.prototype.get=function(b){if(isNaN(b))throw new a("index must be a number.");return this._intervals[b]},f.prototype.getStart=function(){var a=this._intervals;return a.length===0?undefined:a[0].start},f.prototype.getStop=function(){var a=this._intervals,b=a.length;return b===0?undefined:a[b-1].stop},f.prototype.getLength=function(){return this._intervals.length},f.prototype.clear=function(){this._intervals=[]},f.prototype.isEmpty=function(){return this._intervals.length===0},f.prototype.findIntervalContainingDate=function(a){var b=this.indexOf(a);return b>=0?this._intervals[b]:undefined},f.prototype.contains=function(a){return this.indexOf(a)>=0},f.prototype.indexOf=function(d){if(typeof d=="undefined")throw new a("date required");var f=this._intervals,g=b(f,new c(d,d,!0,!0),e);return g>=0?f[g].isStartIncluded?g:g>0&&f[g-1].stop.equals(d)&&f[g-1].isStopIncluded?g-1:~g:(g=~g,g>0&&g-1<f.length&&f[g-1].contains(d)?g-1:~g)},f.prototype.findInterval=function(a,b,c,d){var e=this._intervals,f;for(var g=0,h=e.length;g<h;g++){f=e[g];if((typeof a=="undefined"||f.start.equals(a))&&(typeof b=="undefined"||f.stop.equals(b))&&(typeof c=="undefined"||f.isStartIncluded===c)&&(typeof d=="undefined"||f.isStopIncluded===d))return e[g]}return undefined},f.prototype.addInterval=function(f,g){if(typeof f=="undefined")throw new a("interval is required");if(!f.isEmpty){var h,i,j=this._intervals;if(j.length===0||f.start.greaterThan(j[j.length-1].stop)){j.push(f);return}i=b(j,f,e),i<0?i=~i:i>0&&f.isStartIncluded&&j[i-1].isStartIncluded&&j[i-1].start.equals(f.start)?--i:i<j.length&&!f.isStartIncluded&&j[i].isStartIncluded&&j[i].start.equals(f.start)&&++i;if(i>0){h=d.compare(j[i-1].stop,f.start);if(h>0||h===0&&(j[i-1].isStopIncluded||f.isStartIncluded))(typeof g!="undefined"?g(j[i-1].data,f.data):j[i-1].data===f.data)?(f.stop.greaterThan(j[i-1].stop)?f=new c(j[i-1].start,f.stop,j[i-1].isStartIncluded,f.isStopIncluded,f.data):f=new c(j[i-1].start,j[i-1].stop,j[i-1].isStartIncluded,j[i-1].isStopIncluded||f.stop.equals(j[i-1].stop)&&f.isStopIncluded,f.data),j.splice(i-1,1),--i):(h=d.compare(j[i-1].stop,f.stop),h>0||h===0&&j[i-1].isStopIncluded&&!f.isStopIncluded?j.splice(i-1,1,new c(j[i-1].start,f.start,j[i-1].isStartIncluded,!f.isStartIncluded,j[i-1].data),new c(f.stop,j[i-1].stop,!f.isStopIncluded,j[i-1].isStopIncluded,j[i-1].data)):j[i-1]=new c(j[i-1].start,f.start,j[i-1].isStartIncluded,!f.isStartIncluded,j[i-1].data))}while(i<j.length){h=d.compare(f.stop,j[i].start);if(!(h>0||h===0&&(f.isStopIncluded||j[i].isStartIncluded)))break;if(typeof g!="undefined"?g(j[i].data,f.data):j[i].data===f.data)f=new c(f.start,j[i].stop.greaterThan(f.stop)?j[i].stop:f.stop,f.isStartIncluded,j[i].stop.greaterThan(f.stop)?j[i].isStopIncluded:f.isStopIncluded,f.data),j.splice(i,1);else{j[i]=new c(f.stop,j[i].stop,!f.isStopIncluded,j[i].isStopIncluded,j[i].data);if(!j[i].isEmpty)break;j.splice(i,1)}}j.splice(i,0,f)}},f.prototype.removeInterval=function(d){if(typeof d=="undefined")throw new a("interval is required");if(d.isEmpty)return!1;var f=!1,g=this._intervals,h=b(g,d,e);h<0&&(h=~h);var i=d.start,j=d.stop,k=d.isStartIncluded,l=d.isStopIncluded;if(h>0){var m=g[h-1],n=m.stop;if(n.greaterThan(i)||n.equals(i)&&m.isStopIncluded&&k)f=!0,(n.greaterThan(j)||m.isStopIncluded&&!l&&n.equals(j))&&g.splice(h,0,new c(j,n,!l,m.isStopIncluded,m.data)),g[h-1]=new c(m.start,i,m.isStartIncluded,!k,m.data)}var o=g[h];h<g.length&&!k&&o.isStartIncluded&&i.equals(o.start)&&(f=!0,g.splice(h,0,new c(o.start,o.start,!0,!0,o.data)),++h,o=g[h]);while(h<g.length&&j.greaterThan(o.stop))f=!0,g.splice(h,1);return h<g.length&&j.equals(o.stop)&&(f=!0,!l&&o.isStopIncluded?h+1<g.length&&g[h+1].start.equals(j)&&o.data===g[h+1].data?(g.splice(h,1),g[h]=o=new c(o.start,o.stop,!0,o.isStopIncluded,o.data)):g[h]=o=new c(j,j,!0,!0,o.data):g.splice(h,1)),h<g.length&&(j.greaterThan(o.start)||j.equals(o.start)&&l&&o.isStartIncluded)&&(f=!0,g[h]=new c(j,o.stop,!l,o.isStopIncluded,o.data)),f},f.prototype.intersect=function(b,c,d){if(typeof b=="undefined")throw new a("timeIntervalCollection is required.");return this._intersectInternal(b,c,d)},f.prototype.intersectInterval=function(b,c,d){if(typeof b=="undefined")throw new a("interval is required.");var e=new f;return e.addInterval(b),this._intersectInternal(e,c,d)},f.prototype._intersectInternal=function(a,b,c){var d=0,e=0,g=new f,h=this._intervals,i=a._intervals;while(d<h.length&&e<i.length){var j=h[d],k=i[e];if(j.stop.lessThan(k.start))++d;else if(k.stop.lessThan(j.start))++e;else{if(typeof c!="undefined"||typeof b!="undefined"&&b(j,k)||typeof b=="undefined"&&k.data===j.data){var l=j.intersect(k,c);l.isEmpty||g.addInterval(l,b)}j.stop.lessThan(k.stop)||j.stop.equals(k.stop)&&!j.isStopIncluded&&k.isStopIncluded?++d:++e}}return g},f}),c("Core/computeSunPosition",["./isLeapYear","./DeveloperError","./Math","./Cartesian3","./Cartographic","./Matrix3","./JulianDate"],function(a,b,c,d,e,f,g){var h=[0,31,59,90,120,151,181,212,243,273,304,334],i=new d,j=new f(0,0,0,0,1,0,0,0,0),k=149597870700,l=new d,m=function(b,d){typeof b=="undefined"&&(b=new g);var e=(b.getTotalDays()-2451545)/36525,m=c.convertLongitudeRange(c.toRadians(357.5277233+35999.05034*e)),n=1.000140612-.016708617*Math.cos(m)-139589e-9*Math.cos(2*m),o=b.toDate(),p=o.getUTCMonth(),q=o.getUTCDate()+h[p];a(o.getUTCFullYear())&&p>1&&q++;var r=c.toRadians(360/365*(q-81)),s=9.87*Math.sin(2*r)-7.53*Math.cos(r)-1.5*Math.sin(r),t=b.getJulianTimeFraction(),u;t>=.5?u=t*24-12:u=12+t*24;var v=u+s/60,w=c.toRadians(15*(12-v)),x=Math.asin(.39795*Math.cos(c.toRadians(.98563*(q-173)))),y=0,z=Math.cos(y),A=Math.sin(y);j[0]=z,j[2]=-A,j[6]=A,j[8]=z;var B=Math.cos(x);i.x=B*Math.cos(w),i.y=B*Math.sin(w),i.z=Math.sin(x),f.multiplyByVector(j,i,l);var C=n*k;return l.multiplyByScalar(C,d)};return m}),c("Core/pointInsideTriangle2D",["./DeveloperError"],function(a){var b=function(b,c,d,e){if(!b||!c||!d||!e)throw new a("point, p0, p1, and p2 are required.");var f=d.subtract(c),g=e.subtract(c),h=b.subtract(c),i=f.dot(f),j=f.dot(g),k=f.dot(h),l=g.dot(g),m=g.dot(h),n=1/(i*l-j*j),o=(l*k-j*m)*n,p=(i*m-j*k)*n;return o>0&&p>0&&o+p<1};return b}),c("Core/PolygonPipeline",["./DeveloperError","./Math","./Cartesian2","./Cartesian3","./Ellipsoid","./EllipsoidTangentPlane","./defaultValue","./pointInsideTriangle2D","./ComponentDatatype","./PrimitiveType","./Queue","./WindingOrder"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){this.head=null,this.tail=null,this.length=0}function n(a,b,c){var d=b.subtract(a),e=c.subtract(b);return d.x*e.y-d.y*e.x>=0}function o(a){var b=a[0].x,c=0;for(var d=0;d<a.length;d++)a[d].x>b&&(b=a[d].x,c=d);return c}function p(a){var b=a[0][0].x,c=0;for(var d=0;d<a.length;d++){var e=a[d][o(a[d])].x;e>b&&(b=e,c=d)}return c}function q(a){var b=[];for(var c=0;c<a.length;c++){var d=a[(c-1+a.length)%a.length],e=a[c],f=a[(c+1)%a.length];n(d,e,f)||b.push(e)}return b}function r(a,b){for(var c=0;c<a.length;c++)if(b.equals(a[c]))return!0;return!1}function s(a,b,e){e=g(e,[]);var f=Number.MAX_VALUE,h=o(b),i=new d(b[h].x,a.y,0);e.push(h),e.push((h+1)%b.length);var j=b[0].x,k=j;for(var l=1;l<b.length;++l)b[l].x<j?j=b[l].x:b[l].x>k&&(k=b[l].x);k+=k-j;var m=new d(k,a.y,0);for(l=0;l<b.length;l++){var n=b[l],p=b[(l+1)%b.length];if((n.x>=a.x||p.x>=a.x)&&(n.y>=a.y&&p.y<=a.y||n.y<=a.y&&p.y>=a.y)){var q=(p.y-n.y)*(m.x-a.x)-(p.x-n.x)*(m.y-a.y);if(q!==0){q=1/q;var r=((p.x-n.x)*(a.y-n.y)-(p.y-n.y)*(a.x-n.x))*q,s=((m.x-a.x)*(a.y-n.y)-(m.y-a.y)*(a.x-n.x))*q;if(r>=0&&r<=1&&s>=0&&s<=1){var t=new c(a.x+r*(m.x-a.x),a.y+r*(m.y-a.y)),u=t.subtract(a);q=u.magnitudeSquared(),q<f&&(i=t,f=q,e[0]=l,e[1]=(l+1)%b.length)}}}}return i}function t(a,b){var d=p(b),e=b[d],f=o(e),g=e[f],i=[],j=s(g,a,i),k;if(r(a,j))k=j;else{var l=a[i[0]].subtract(g).magnitudeSquared(),m=a[i[1]].subtract(g).magnitudeSquared(),n=l<m?a[i[0]]:a[i[1]],t=q(a),u=t.indexOf(n);u!==-1&&t.splice(u,1);var v=[];for(var w=0;w<t.length;w++){var x=t[w];h(x,g,j,n)&&v.push(x)}var y=Number.MAX_VALUE;if(v.length>0){var z=new c(1,0,0);for(w=0;w<v.length;w++){var A=v[w].subtract(g),B=z.magnitude()*A.magnitude();if(B!==0){var C=Math.abs(Math.acos(z.dot(A)/B));C<y&&(y=C,n=v[w])}}}k=n}return a.indexOf(k)}function u(a,b,c){var d=x.computeWindingOrder2D(a);for(var e=0;e<b.length;e++){var g=b[e];g[0].equals(g[g.length-1])||g.push(g[0]);var h=x.computeWindingOrder2D(g);h===d&&g.reverse()}var i=f.fromPoints(a,c),j=i.projectPointsOntoPlane(a),k=[];for(e=0;e<b.length;e++)k.push(i.projectPointsOntoPlane(b[e]));var l=t(j,k),m=p(k),n=o(k[m]),q=b[m],r=[];for(e=0;e<a.length;e++)r.push(a[e]);var s,u=[];if(n!==0)for(s=0;s<=q.length;s++){var v=(s+n)%q.length;v!==0&&u.push(q[v])}else for(s=0;s<q.length;s++)u.push(q[(s+n)%q.length]);var w=r.lastIndexOf(a[l]);u.push(a[w]);var y=r.slice(0,w+1),z=r.slice(w+1);return r=y.concat(u,z),b.splice(m,1),r}m.prototype.add=function(a){if(a){var b={item:a,previous:this.tail,next:null};this.tail?(this.tail.next=b,this.tail=b):(this.head=b,this.tail=b),++this.length}},m.prototype.remove=function(a){a&&(a.previous&&a.next?(a.previous.next=a.next,a.next.previous=a.previous):a.previous?(a.previous.next=null,this.tail=a.previous):a.next?(a.next.previous=null,this.head=a.next):(this.head=null,this.tail=null),--this.length)};var v=new d,w=new d,x={cleanUp:function(b){if(!b)throw new a("positions is required.");var c=b.length;if(c<3)throw new a("At least three positions are required.");var d=[];for(var e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f];g.equals(h)||d.push(h)}return d},computeArea2D:function(b){if(!b)throw new a("positions is required.");var c=b.length;if(c<3)throw new a("At least three positions are required.");var d=0;for(var e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f];d+=g.x*h.y-h.x*g.y}return d*.5},computeWindingOrder2D:function(a){var b=x.computeArea2D(a);return b>=0?l.COUNTER_CLOCKWISE:l.CLOCKWISE},earClip2D:function(b){if(!b)throw new a("positions is required.");var c=b.length;if(c<3)throw new a("At least three positions are required.");var d=new m;for(var e=0;e<c;++e)d.add({position:b[e],index:e});var f=[],g=d.head,i=g.next,j=i.next,k=c*c;while(d.length>3){var l=g.item.position,o=i.item.position,p=j.item.position;if(n(l,o,p)){var q=!0;for(var r=j.next?j.next:d.head;r!==g;r=r.next?r.next:d.head)if(h(r.item.position,l,o,p)){q=!1;break}if(q){f.push(g.item.index),f.push(i.item.index),f.push(j.item.index),d.remove(i),i=j,j=j.next?j.next:d.head;continue}}g=g.next?g.next:d.head,i=i.next?i.next:d.head,j=j.next?j.next:d.head;if(--k===0)break}var s=d.head,t=s.next,u=t.next;return f.push(s.item.index),f.push(t.item.index),f.push(u.item.index),f},computeSubdivision:function(c,d,e){if(!c)throw new a("positions is required.");if(!d)throw new a("indices is required.");if(d.length<3)throw new a("At least three indices are required.");if(d.length%3!==0)throw new a("The number of indices must be divisable by three.");e=e||b.toRadians(1);if(e<=0)throw new a("granularity must be greater than zero.");var f=new k,g=d.length;for(var h=0;h<g;h+=3)f.enqueue({i0:d[h],i1:d[h+1],i2:d[h+2]});var l=c.slice(0),m=[],n={},o;while(f.length>0){var p=f.dequeue(),q=l[p.i0],r=l[p.i1],s=l[p.i2],t=q.angleBetween(r),u=r.angleBetween(s),v=s.angleBetween(q),w=Math.max(t,Math.max(u,v)),x;w>e?t===w?(x=Math.min(p.i0,p.i1).toString()+" "+Math.max(p.i0,p.i1).toString(),o=n[x],o||(l.push(q.add(r).multiplyByScalar(.5)),o=l.length-1,n[x]=o),f.enqueue({i0:p.i0,i1:o,i2:p.i2}),f.enqueue({i0:o,i1:p.i1,i2:p.i2})):u===w?(x=Math.min(p.i1,p.i2).toString()+" "+Math.max(p.i1,p.i2).toString(),o=n[x],o||(l.push(r.add(s).multiplyByScalar(.5)),o=l.length-1,n[x]=o),f.enqueue({i0:p.i1,i1:o,i2:p.i0}),f.enqueue({i0:o,i1:p.i2,i2:p.i0})):v===w&&(x=Math.min(p.i2,p.i0).toString()+" "+Math.max(p.i2,p.i0).toString(),o=n[x],o||(l.push(s.add(q).multiplyByScalar(.5)),o=l.length-1,n[x]=o),f.enqueue({i0:p.i2,i1:o,i2:p.i1}),f.enqueue({i0:o,i1:p.i0,i2:p.i1})):(m.push(p.i0),m.push(p.i1),m.push(p.i2))}var y=l.length,z=new Array(y*3),A=0;for(o=0;o<y;o++){var B=l[o];z[A++]=B.x,z[A++]=B.y,z[A++]=B.z}return{attributes:{position:{componentDatatype:i.FLOAT,componentsPerAttribute:3,values:z}},indexLists:[{primitiveType:j.TRIANGLES,values:m}]}},scaleToGeodeticHeight:function(a,b,c){c=g(c,e.WGS84);var f=v,h=w;b=b||0;if(a&&a.attributes&&a.attributes.position){var i=a.attributes.position.values,j=i.length;for(var k=0;k<j;k+=3)h.x=i[k],h.y=i[k+1],h.z=i[k+2],c.scaleToGeodeticSurface(h,h),c.geodeticSurfaceNormal(h,f),d.multiplyByScalar(f,b,f),d.add(h,f,h),i[k]=h.x,i[k+1]=h.y,i[k+2]=h.z}return a},eliminateHoles:function(b,c,f){if(typeof b=="undefined")throw new a("outerRing is required.");if(b.length===0)throw new a("outerRing must not be empty.");if(typeof c=="undefined")throw new a("innerRings is required.");f=g(f,e.WGS84);var h=[];for(var i=0;i<c.length;i++){var j=[];for(var k=0;k<c[i].length;k++)j.push(d.clone(c[i][k]));h.push(j)}var l=b;while(h.length>0)l=u(l,h,f);return l}};return x}),c("Core/requestAnimationFrame",[],function(){var a=window.requestAnimationFrame;if(typeof a=="undefined"){var b=["webkit","moz","ms","o"],c=0,d=b.length;while(c<d&&typeof a=="undefined")a=window[b[c]+"RequestAnimationFrame"],++c}if(typeof a=="undefined"){var e=0;a=function(a){var b=Date.now(),c=Math.max(16-(b-e),0);return e=b+c,setTimeout(function(){a(e)},c)}}var f=function(b){a(b)};return f}),c("DynamicScene/CzmlBoolean",[],function(){var a={unwrapInterval:function(a){var b=a["boolean"];return typeof b=="undefined"?a:b},isSampled:function(){return!1},getValue:function(a){return a}};return a}),c("DynamicScene/CzmlCartesian2",["../Core/Cartesian2"],function(a){var b=2,c={doublesPerValue:b,doublesPerInterpolationValue:b,unwrapInterval:function(a){return a.cartesian2},isSampled:function(a){return Array.isArray(a)&&a.length>b},getValue:function(b,c){return typeof c=="undefined"&&(c=new a),c.x=b[0],c.y=b[1],c},getValueFromArray:function(b,c,d){return typeof d=="undefined"&&(d=new a),d.x=b[c],d.y=b[c+1],d}};return c}),c("DynamicScene/CzmlCartesian3",["../Core/Cartesian3"],function(a){var b=3,c={doublesPerValue:b,doublesPerInterpolationValue:b,unwrapInterval:function(a){return a.cartesian},isSampled:function(a){return Array.isArray(a)&&a.length>b},getValue:function(b,c){return typeof c=="undefined"&&(c=new a),c.x=b[0],c.y=b[1],c.z=b[2],c},getValueFromArray:function(b,c,d){return typeof d=="undefined"&&(d=new a),d.x=b[c],d.y=b[c+1],d.z=b[c+2],d}};return c}),c("DynamicScene/CzmlCartographic",["../Core/Cartographic","../Core/Math"],function(a,b){var c=3,d={doublesPerValue:c,doublesPerInterpolationValue:c,unwrapInterval:function(a){var c=a.cartographicRadians;if(typeof c!="undefined")return c;var d=a.cartographicDegrees;if(typeof d=="undefined")return undefined;if(!this.isSampled(d))return[b.toRadians(d[0]),b.toRadians(d[1]),d[2]];var e=d.length;c=new Array(e);for(var f=0;f<e;f+=4)c[f]=d[f],c[f+1]=b.toRadians(d[f+1]),c[f+2]=b.toRadians(d[f+2]),c[f+3]=d[f+3];return c},isSampled:function(a){return Array.isArray(a)&&a.length>c},getValue:function(b,c){return typeof c=="undefined"&&(c=new a),c.longitude=b[0],c.latitude=b[1],c.height=b[2],c},getValueFromArray:function(b,c,d){return typeof d=="undefined"&&(d=new a),d.longitude=b[c],d.latitude=b[c+1],d.height=b[c+2],d}};return d}),c("DynamicScene/CzmlColor",["../Core/Color"],function(a){var b=4,c={doublesPerValue:b,doublesPerInterpolationValue:b,unwrapInterval:function(b){var c=b.rgbaf;if(typeof c!="undefined")return c;var d=b.rgba;if(typeof d=="undefined")return undefined;if(!this.isSampled(d))return[a.byteToFloat(d[0]),a.byteToFloat(d[1]),a.byteToFloat(d[2]),a.byteToFloat(d[3])];var e=d.length;c=new Array(e);for(var f=0;f<e;f+=5)c[f]=d[f],c[f+1]=a.byteToFloat(d[f+1]),c[f+2]=a.byteToFloat(d[f+2]),c[f+3]=a.byteToFloat(d[f+3]),c[f+4]=a.byteToFloat(d[f+4]);return c},isSampled:function(a){return Array.isArray(a)&&a.length>b},getValue:function(b,c){return typeof c=="undefined"&&(c=new a),c.red=b[0],c.green=b[1],c.blue=b[2],c.alpha=b[3],c},getValueFromArray:function(b,c,d){return typeof d=="undefined"&&(d=new a),d.red=b[c],d.green=b[c+1],d.blue=b[c+2],d.alpha=b[c+3],d}};return c}),c("DynamicScene/CzmlNumber",[],function(){var a=1,b={doublesPerValue:a,doublesPerInterpolationValue:a,unwrapInterval:function(a){var b=a.number;return typeof b=="undefined"?a:b},isSampled:function(a){return Array.isArray(a)},getValue:function(a){return a},getValueFromArray:function(a,b){return a[b]}};return b}),c("DynamicScene/CzmlString",[],function(){var a={unwrapInterval:function(a){var b=a.string;return typeof b=="undefined"?a:b},isSampled:function(){return!1},getValue:function(a){return a}};return a}),c("DynamicScene/CzmlUnitCartesian3",["../Core/Cartesian3"],function(a){var b=3,c={doublesPerValue:b,doublesPerInterpolationValue:b,unwrapInterval:function(a){return a.unitCartesian},isSampled:function(a){return Array.isArray(a)&&a.length>b},getValue:function(b,c){return typeof c=="undefined"&&(c=new a),c.x=b[0],c.y=b[1],c.z=b[2],c.normalize(c)},getValueFromArray:function(b,c,d){return typeof d=="undefined"&&(d=new a),d.x=b[c],d.y=b[c+1],d.z=b[c+2],d.normalize(d)}};return c}),c("DynamicScene/CzmlUnitQuaternion",["../Core/Quaternion","../Core/Cartesian3"],function(a,b){var c=3,d=4,e=new b,f=new b,g=new a,h=new a,i=new a,j={doublesPerValue:d,doublesPerInterpolationValue:c,unwrapInterval:function(a){return a.unitQuaternion},isSampled:function(a){return Array.isArray(a)&&a.length>d},packValuesForInterpolation:function(a,b,f,h){j.getValueFromArray(a,h*d,i),i.conjugate(i);for(var k=0,l=h-f+1;k<l;k++){var m=k*c;j.getValueFromArray(a,(f+k)*d,g),g.multiply(i,g),g.w<0&&g.negate(g),g.getAxis(e);var n=g.getAngle();b[m]=e.x*n,b[m+1]=e.y*n,b[m+2]=e.z*n}},getValue:function(b,c){return typeof c=="undefined"&&(c=new a),c.x=b[0],c.y=b[1],c.z=b[2],c.w=b[3],c.normalize(c)},getValueFromArray:function(b,c,d){return typeof d=="undefined"&&(d=new a),d.x=b[c],d.y=b[c+1],d.z=b[c+2],d.w=b[c+3],d.normalize(d)},getValueFromInterpolationResult:function(b,c,e,i,k){typeof c=="undefined"&&(c=new a),f.x=b[0],f.y=b[1],f.z=b[2];var l=f.magnitude();return j.getValueFromArray(e,k*d,h),l===0?(g.x=g.y=g.z=0,g.w=1):a.fromAxisAngle(f,l,g),c.normalize(g.multiply(h,c),c)}};return j}),c("DynamicScene/CzmlUnitSpherical",["../Core/Spherical"],function(a){var b=2,c={doublesPerValue:b,doublesPerInterpolationValue:b,unwrapInterval:function(a){return a.unitSpherical},isSampled:function(a){return Array.isArray(a)&&a.length>b},getValue:function(b,c){return typeof c=="undefined"&&(c=new a),c.clock=b[0],c.cone=b[1],c.magnitude=1,c},getValueFromArray:function(b,c,d){return typeof d=="undefined"&&(d=new a),d.clock=b[c],d.cone=b[c+1],d.magnitude=1,d}};return c}),c("DynamicScene/DynamicDirectionsProperty",["../Core/JulianDate","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/Cartesian3","../Core/Spherical","../Core/Iso8601"],function(a,b,c,d,e,f){function g(a){var b,c,f=[],g=a.unitSpherical;if(typeof g!="undefined"){for(b=0,c=g.length;b<c;b+=2)f.push(new e(g[b],g[b+1]));this.spherical=f}g=a.unitCartesian;if(typeof g!="undefined"){for(b=0,c=g.length;b<c;b+=3)f.push(new d(g[b],g[b+1],g[b+2],!0));this.cartesian=f}}g.prototype.getValueSpherical=function(){var a=this.spherical;if(typeof a=="undefined"){a=[],this.spherical=a;var b=this.cartesian;for(var c=0,d=b.length;c<d;c++)a.push(e.fromCartesian3(b[c]))}return a},g.prototype.getValueCartesian=function(){var a=this.cartesian;if(typeof a=="undefined"){a=[],this.cartesian=a;var b=this.spherical;for(var c=0,e=b.length;c<e;c++)a.push(d.fromSpherical(b[c]))}return a};var h=function(){this._propertyIntervals=new c};return h.prototype.processCzmlIntervals=function(a,b,c){if(Array.isArray(a))for(var d=0,e=a.length;d<e;d++)this._addCzmlInterval(a[d],b,c);else this._addCzmlInterval(a,b,c)},h.prototype.getValueSpherical=function(a){var b=this._propertyIntervals.findIntervalContainingDate(a);return typeof b=="undefined"?undefined:b.data.getValueSpherical()},h.prototype.getValueCartesian=function(a){var b=this._propertyIntervals.findIntervalContainingDate(a);return typeof b=="undefined"?undefined:b.data.getValueCartesian()},h.prototype._addCzmlInterval=function(a,c,d){var e=a.interval;typeof e=="undefined"?e=f.MAXIMUM_INTERVAL.clone():e=b.fromIso8601(e),typeof c!="undefined"&&(e=e.intersect(c));var h=this._propertyIntervals,i=h.findInterval(e.start,e.stop);typeof i=="undefined"&&(i=e,h.addInterval(i)),i.data=new g(a)},h}),c("DynamicScene/DynamicProperty",["../Core/DeveloperError","../Core/JulianDate","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/Iso8601","../Core/binarySearch","../Core/HermitePolynomialApproximation","../Core/LinearApproximation","../Core/LagrangePolynomialApproximation"],function(a,b,c,d,e,f,g,h,i){function k(){this.interpolationAlgorithm=h,this.numberOfPoints=h.getRequiredDataPoints(1),this.interpolationDegree=1,this.times=undefined,this.values=undefined,this.isSampled=!1,this.xTable=undefined,this.yTable=undefined}function l(a,c){return typeof a=="string"?b.fromIso8601(a):c.addSeconds(a)}var j={HERMITE:g,LAGRANGE:i,LINEAR:h},m=function(b){if(typeof b=="undefined")throw new a("valueType is required.");this.valueType=b,this._intervals=new d,this._cachedDate=undefined,this._cachedInterval=undefined};return m.prototype.processCzmlIntervals=function(a,b,c){if(Array.isArray(a))for(var d=0,e=a.length;d<e;d++)this._addCzmlInterval(a[d],b,c);else this._addCzmlInterval(a,b,c)},m.prototype.getValue=function(a,c){var d=this._cachedInterval,e=this.valueType,g=e.doublesPerValue;if(this._cachedDate!==a){this._cachedDate=a;if(typeof d=="undefined"||!d.contains(a))d=this._intervals.findIntervalContainingDate(a),this._cachedInterval=d}if(typeof d=="undefined")return undefined;var h=d.data,i=h.times,j=h.values;if(h.isSampled&&i.length>=0&&j.length>0){var k=f(i,a,b.compare);if(k<0){if(h.numberOfPoints<2)return undefined;k=~k,k>=i.length&&(k=i.length-1);var l=0,m=i.length-1,n=h.numberOfPoints-1,o=m-l+1;if(!(o<n+1)){var p=k-(n/2|0)-1;p<l&&(p=l);var q=p+n;q>m&&(q=m,p=q-n,p<l&&(p=l)),l=p,m=q}var r=m-l+1,s=e.doublesPerInterpolationValue,t=h.xTable,u=h.yTable;typeof t=="undefined"&&(t=h.xTable=new Array(h.numberOfPoints),u=h.yTable=new Array(h.numberOfPoints*s));for(var v=0;v<r;++v)t[v]=i[m].getSecondsDifference(i[l+v]);var w=e.packValuesForInterpolation;if(typeof w=="undefined"){var x=0,y=l*g,z=(m+1)*g;while(y<z)u[x]=j[y],y++,x++}else w(j,u,l,m);var A=i[m].getSecondsDifference(a),B=h.interpolationAlgorithm.interpolateOrderZero(A,t,u,s),C=e.getValueFromInterpolationResult;return typeof C=="undefined"?e.getValueFromArray(B,0,c):C(B,c,j,l,m)}return e.getValueFromArray(h.values,k*g,c)}return e.getValue(h.values,c)},m._mergeNewSamples=function(a,c,d,e,g,h){var i=0,j,k,m,n,o,p,q,r;while(i<e.length){q=l(e[i],a),m=f(c,q,b.compare);if(m<0){m=~m,o=[m,0],n=m*g,p=[n,0],k=undefined,r=c[m+1];while(i<e.length){q=l(e[i],a);if(typeof k!="undefined"&&b.compare(k,q)>=0||typeof r!="undefined"&&b.compare(q,r)>=0)break;o.push(q),i+=1;for(j=0;j<g;j++)p.push(e[i]),i+=1;k=q}Array.prototype.splice.apply(d,p),Array.prototype.splice.apply(c,o)}else{for(j=0;j<g;j++)i++,d[m*g+j]=e[i];i++}}},m.prototype._addCzmlInterval=function(a,b,d){var f=a.interval;typeof f=="undefined"?f=e.MAXIMUM_INTERVAL:f=c.fromIso8601(f),typeof b!="undefined"&&(f=f.intersect(b));var g=this.valueType.unwrapInterval(a,d);typeof g!="undefined"&&this._addCzmlIntervalUnwrapped(f.start,f.stop,g,a.epoch,a.interpolationAlgorithm,a.interpolationDegree)},m.prototype._addCzmlIntervalUnwrapped=function(a,d,e,f,g,h){var i=this._intervals,l=i.findInterval(a,d);this._cachedDate=undefined,this._cachedInterval=undefined;var n;typeof l=="undefined"?(n=new k,l=new c(a,d,!0,!0,n),i.addInterval(l)):n=l.data;var o=this.valueType;if(o.isSampled(e)){var p;typeof g!="undefined"&&(p=j[g],n.interpolationAlgorithm=p),typeof p!="undefined"&&typeof h!="undefined"&&(n.interpolationDegree=h,n.xTable=undefined,n.yTable=undefined),n.isSampled||(n.times=[],n.values=[],n.isSampled=!0),typeof f!="undefined"&&(f=b.fromIso8601(f)),m._mergeNewSamples(f,n.times,n.values,e,o.doublesPerValue,o),n.numberOfPoints=Math.min(n.interpolationAlgorithm.getRequiredDataPoints(n.interpolationDegree),n.times.length)}else n.times=undefined,n.values=e,n.isSampled=!1},m}),c("DynamicScene/DynamicPath",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty"],function(a,b,c,d,e,f){var g=function(){this.color=undefined,this.outlineColor=undefined,this.outlineWidth=undefined,this.show=undefined,this.width=undefined,this.leadTime=undefined,this.trailTime=undefined};return g.processCzmlPacket=function(b,h){var i=h.path;if(typeof i=="undefined")return!1;var j=!1,k=b.path;j=typeof k=="undefined",j&&(b.path=k=new g);var l=i.interval;typeof l!="undefined"&&(l=a.fromIso8601(l));if(typeof i.color!="undefined"){var m=k.color;typeof m=="undefined"&&(k.color=m=new f(e),j=!0),m.processCzmlIntervals(i.color,l)}if(typeof i.width!="undefined"){var n=k.width;typeof n=="undefined"&&(k.width=n=new f(d),j=!0),n.processCzmlIntervals(i.width,l)}if(typeof i.outlineColor!="undefined"){var o=k.outlineColor;typeof o=="undefined"&&(k.outlineColor=o=new f(e),j=!0),o.processCzmlIntervals(i.outlineColor,l)}if(typeof i.outlineWidth!="undefined"){var p=k.outlineWidth;typeof p=="undefined"&&(k.outlineWidth=p=new f(d),j=!0),p.processCzmlIntervals(i.outlineWidth,l)}if(typeof i.show!="undefined"){var q=k.show;typeof q=="undefined"&&(k.show=q=new f(c),j=!0),q.processCzmlIntervals(i.show,l)}if(typeof i.leadTime!="undefined"){var r=k.leadTime;typeof r=="undefined"&&(k.leadTime=r=new f(d),j=!0),r.processCzmlIntervals(i.leadTime,l)}if(typeof i.trailTime!="undefined"){var s=k.trailTime;typeof s=="undefined"&&(k.trailTime=s=new f(d),j=!0),s.processCzmlIntervals(i.trailTime,l)}return j},g.mergeProperties=function(a,c){var d=c.path;if(typeof d!="undefined"){var e=a.path;typeof e=="undefined"&&(a.path=e=new g),e.color=b(e.color,d.color),e.width=b(e.width,d.width),e.outlineColor=b(e.outlineColor,d.outlineColor),e.outlineWidth=b(e.outlineWidth,d.outlineWidth),e.show=b(e.show,d.show),e.leadTime=b(e.leadTime,d.leadTime),e.trailTime=b(e.trailTime,d.trailTime)}},g.undefineProperties=function(a){a.path=undefined},g}),c("DynamicScene/DynamicPoint",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty"],function(a,b,c,d,e,f){var g=function(){this.color=undefined,this.pixelSize=undefined,this.outlineColor=undefined,this.outlineWidth=undefined,this.show=undefined};return g.processCzmlPacket=function(b,h){var i=h.point;if(typeof i=="undefined")return!1;var j=!1,k=b.point;j=typeof k=="undefined",j&&(b.point=k=new g);var l=i.interval;typeof l!="undefined"&&(l=a.fromIso8601(l));if(typeof i.color!="undefined"){var m=k.color;typeof m=="undefined"&&(k.color=m=new f(e),j=!0),m.processCzmlIntervals(i.color,l)}if(typeof i.pixelSize!="undefined"){var n=k.pixelSize;typeof n=="undefined"&&(k.pixelSize=n=new f(d),j=!0),n.processCzmlIntervals(i.pixelSize,l)}if(typeof i.outlineColor!="undefined"){var o=k.outlineColor;typeof o=="undefined"&&(k.outlineColor=o=new f(e),j=!0),o.processCzmlIntervals(i.outlineColor,l)}if(typeof i.outlineWidth!="undefined"){var p=k.outlineWidth;typeof p=="undefined"&&(k.outlineWidth=p=new f(d),j=!0),p.processCzmlIntervals(i.outlineWidth,l)}if(typeof i.show!="undefined"){var q=k.show;typeof q=="undefined"&&(k.show=q=new f(c),j=!0),q.processCzmlIntervals(i.show,l)}return j},g.mergeProperties=function(a,c){var d=c.point;if(typeof d!="undefined"){var e=a.point;typeof e=="undefined"&&(a.point=e=new g),e.color=b(e.color,d.color),e.pixelSize=b(e.pixelSize,d.pixelSize),e.outlineColor=b(e.outlineColor,d.outlineColor),e.outlineWidth=b(e.outlineWidth,d.outlineWidth),e.show=b(e.show,d.show)}},g.undefineProperties=function(a){a.point=undefined},g}),c("DynamicScene/DynamicPolyline",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty"],function(a,b,c,d,e,f){var g=function(){this.color=undefined,this.outlineColor=undefined,this.outlineWidth=undefined,this.show=undefined,this.width=undefined};return g.processCzmlPacket=function(b,h){var i=h.polyline;if(typeof i=="undefined")return!1;var j=!1,k=b.polyline;j=typeof k=="undefined",j&&(b.polyline=k=new g);var l=i.interval;typeof l!="undefined"&&(l=a.fromIso8601(l));if(typeof i.color!="undefined"){var m=k.color;typeof m=="undefined"&&(k.color=m=new f(e),j=!0),m.processCzmlIntervals(i.color,l)}if(typeof i.width!="undefined"){var n=k.width;typeof n=="undefined"&&(k.width=n=new f(d),j=!0),n.processCzmlIntervals(i.width,l)}if(typeof i.outlineColor!="undefined"){var o=k.outlineColor;typeof o=="undefined"&&(k.outlineColor=o=new f(e),j=!0),o.processCzmlIntervals(i.outlineColor,l)}if(typeof i.outlineWidth!="undefined"){var p=k.outlineWidth;typeof p=="undefined"&&(k.outlineWidth=p=new f(d),j=!0),p.processCzmlIntervals(i.outlineWidth,l)}if(typeof i.show!="undefined"){var q=k.show;typeof q=="undefined"&&(k.show=q=new f(c),j=!0),q.processCzmlIntervals(i.show,l)}return j},g.mergeProperties=function(a,c){var d=c.polyline;if(typeof d!="undefined"){var e=a.polyline;typeof e=="undefined"&&(a.polyline=e=new g),e.color=b(e.color,d.color),e.width=b(e.width,d.width),e.outlineColor=b(e.outlineColor,d.outlineColor),e.outlineWidth=b(e.outlineWidth,d.outlineWidth),e.show=b(e.show,d.show)}},g.undefineProperties=function(a){a.polyline=undefined},g}),c("DynamicScene/DynamicPositionProperty",["../Core/DeveloperError","../Core/Ellipsoid","../Core/JulianDate","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/Iso8601","../Core/Cartesian3","../Core/Cartographic","./CzmlCartesian3","./CzmlCartographic","./DynamicProperty"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b.WGS84,m=[i,j],n=function(){this._dynamicProperties=[],this._propertyIntervals=new e,this._cachedTime=undefined,this._cachedInterval=undefined};return n.prototype.processCzmlIntervals=function(a,b){if(Array.isArray(a))for(var c=0,d=a.length;c<d;c++)this._addCzmlInterval(a[c],b);else this._addCzmlInterval(a,b)},n.prototype.getValueCartographic=function(b,c){if(typeof b=="undefined")throw new a("time is required.");var d=this._cachedInterval;if(this._cachedTime!==b){this._cachedTime=b;if(typeof d=="undefined"||!d.contains(b))d=this._propertyIntervals.findIntervalContainingDate(b),this._cachedInterval=d}if(typeof d=="undefined")return undefined;var e=d.data,f=e.valueType;return f===j?e.getValue(b,c):(c=d.cachedValue=e.getValue(b,d.cachedValue),typeof c!="undefined"&&(c=l.cartesianToCartographic(c)),c)},n.prototype.getValueCartesian=function(b,c){if(typeof b=="undefined")throw new a("time is required.");var d=this._cachedInterval;if(this._cachedTime!==b){this._cachedTime=b;if(typeof d=="undefined"||!d.contains(b))d=this._propertyIntervals.findIntervalContainingDate(b),this._cachedInterval=d}if(typeof d=="undefined")return undefined;var e=d.data,f=e.valueType;return f===i?e.getValue(b,c):(c=d.cachedValue=e.getValue(b,d.cachedValue),typeof c!="undefined"&&(c=l.cartographicToCartesian(c)),c)},n.prototype.getValueRangeCartesian=function(b,c,d,e){if(typeof b=="undefined")throw new a("start is required");if(typeof c=="undefined")throw new a("stop is required");typeof e=="undefined"&&(e=[]);var f=this._propertyIntervals,g=typeof b=="undefined"?0:f.indexOf(b),h=typeof c=="undefined"?f.length-1:f.indexOf(c);g<0&&(g=~g);if(g===f.getLength())return e.length=0,e;if(h<0){h=~h;if(h!==f.getLength())return e.length=0,e;h-=1}var j=0,k;k=this.getValueCartesian(b,e[j]),typeof k!="undefined"&&(e[j++]=k);var m,n=typeof d=="undefined"||d.lessThan(b)||d.greaterThan(c);for(var o=g;o<h+1;o++){var p,q=f.get(o),r=f.get(o+1),s=c;typeof r!="undefined"&&c.greaterThan(r.start)&&(s=r.start);var t=q.data,u=t.valueType,v=t._intervals.get(0),w=v.data.times;if(typeof w!="undefined"){var x;if(u===i)for(x=0;x<w.length;x++)p=w[x],!n&&p.greaterThanOrEquals(d)&&(k=t.getValue(d,e[j]),typeof k!="undefined"&&(e[j++]=k),n=!0),p.greaterThan(b)&&p.lessThan(s)&&(k=t.getValue(p,e[j]),typeof k!="undefined"&&(e[j++]=k));else for(x=0;x<w.length;x++)p=w[x],!n&&p.greaterThanOrEquals(d)&&(m=t.getValue(d,m),e[j++]=l.cartographicToCartesian(m),n=!0),p.greaterThan(b)&&p.lessThan(s)&&(m=t.getValue(p,m),e[j++]=l.cartographicToCartesian(m))}else p=q.start,n=n||p.greaterThanOrEquals(d),p.lessThan(s)&&(u===i?(k=t.getValue(p,e[j]),typeof k!="undefined"&&(e[j++]=k)):(m=t.getValue(p,m),e[j++]=l.cartographicToCartesian(m)))}return k=this.getValueCartesian(c,e[j]),typeof k!="undefined"&&(e[j++]=k),e.length=j,e},n.prototype._addCzmlInterval=function(a,b){this._cachedTime=undefined,this._cachedInterval=undefined;var c=a.interval,e,g,h;typeof c=="undefined"?c=f.MAXIMUM_INTERVAL.clone():c=d.fromIso8601(c),typeof b!="undefined"&&(c=c.intersect(b));var i=this._propertyIntervals,j=i.findInterval(c.start,c.stop);typeof j!="undefined"?(e=j.data,typeof e!="undefined"&&(g=e.valueType,h=g.unwrapInterval(a))):(j=c,i.addInterval(j));if(typeof h=="undefined")for(var l=0,n=m.length;l<n;l++){g=m[l],h=g.unwrapInterval(a);if(typeof h!="undefined"){e=new k(g),this._dynamicProperties.push(e),j.data=e;break}}typeof h!="undefined"&&e._addCzmlIntervalUnwrapped(c.start,c.stop,h,a.epoch,a.interpolationAlgorithm,a.interpolationDegree)},n}),c("DynamicScene/ReferenceProperty",["../Core/defaultValue","../Core/DeveloperError"],function(a,b){function c(b){var c=b._targetProperty;if(typeof c=="undefined"){var d=a(b._dynamicObjectCollection.compositeCollection,b._dynamicObjectCollection),e=d.getObject(b._targetObjectId);typeof e!="undefined"&&(c=e[b._targetPropertyName],b._targetProperty=c)}return c}var d=function(a,c,d){if(typeof a=="undefined")throw new b("dynamicObjectCollection is required.");if(typeof c=="undefined")throw new b("targetObjectId is required.");if(typeof d=="undefined")throw new b("targetPropertyName is required.");this._targetProperty=undefined,this._dynamicObjectCollection=a,this._targetObjectId=c,this._targetPropertyName=d};return d.fromString=function(a,c){if(typeof a=="undefined")throw new b("dynamicObjectCollection is required.");if(typeof c=="undefined")throw new b("referenceString is required.");var e=c.split(".");if(e.length!==2)throw new b("referenceString must contain a single . delineating the target object ID and property name.");return new d(a,e[0],e[1])},d.prototype.getValue=function(a,b){var d=c(this);return typeof d!="undefined"?d.getValue(a,b):undefined},d.prototype.getValueCartographic=function(a,b){var d=c(this);return typeof d!="undefined"?d.getValueCartographic(a,b):undefined},d.prototype.getValueCartesian=function(a,b){var d=c(this);return typeof d!="undefined"?d.getValueCartesian(a,b):undefined},d.prototype.getValueSpherical=function(a,b){var d=c(this);return typeof d!="undefined"?d.getValueSpherical(a,b):undefined},d}),c("DynamicScene/DynamicVertexPositionsProperty",["../Core/JulianDate","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/Cartesian3","../Core/Cartographic","../Core/Iso8601","../Core/Ellipsoid","./ReferenceProperty","./DynamicPositionProperty"],function(a,b,c,d,e,f,g,h,i){function k(a){var b,c,f=[],g;g=a.cartesian;if(typeof g!="undefined"){for(b=0,c=g.length;b<c;b+=3)f.push(new d(g[b],g[b+1],g[b+2]));this.cartesian=f}else{g=a.cartographicRadians;if(typeof g!="undefined"){for(b=0,c=g.length;b<c;b+=3)f.push(new e(g[b],g[b+1],g[b+2]));this.cartographic=f}else{g=a.cartographicDegrees;if(typeof g!="undefined"){for(b=0,c=g.length;b<c;b+=3)f.push(e.fromDegrees(g[b],g[b+1],g[b+2]));this.cartographic=f}}}}var j=g.WGS84;k.prototype.getValueCartographic=function(){return typeof this.cartographic=="undefined"&&(this.cartographic=j.cartesianArrayToCartographicArray(this.cartesian)),this.cartographic},k.prototype.getValueCartesian=function(){return typeof this.cartesian=="undefined"&&(this.cartesian=j.cartographicArrayToCartesianArray(this.cartographic)),this.cartesian};var l=function(){this._propertyIntervals=new c};return l.prototype.processCzmlIntervals=function(a,b,c){if(Array.isArray(a))for(var d=0,e=a.length;d<e;d++)this._addCzmlInterval(a[d],b,c);else this._addCzmlInterval(a,b,c)},l.prototype.getValueCartographic=function(a){var b=this._propertyIntervals.findIntervalContainingDate(a);if(typeof b=="undefined")return undefined;var c=b.data;if(Array.isArray(c)){var d=[];for(var e=0,f=c.length;e<f;e++){var g=c[e].getValueCartographic(a);typeof g!="undefined"&&d.push(g)}return d}return c.getValueCartographic()},l.prototype.getValueCartesian=function(a){var b=this._propertyIntervals.findIntervalContainingDate(a);if(typeof b=="undefined")return undefined;var c=b.data;if(Array.isArray(c)){var d=[];for(var e=0,f=c.length;e<f;e++){var g=c[e].getValueCartesian(a);typeof g!="undefined"&&d.push(g)}return d}return c.getValueCartesian()},l.prototype._addCzmlInterval=function(a,c,d){var e=a.interval;typeof e=="undefined"?e=f.MAXIMUM_INTERVAL.clone():e=b.fromIso8601(e),typeof c!="undefined"&&(e=e.intersect(c));var g=this._propertyIntervals,i=g.findInterval(e.start,e.stop);typeof i=="undefined"&&(i=e,g.addInterval(i));var j=a.references;if(typeof j=="undefined")i.data=new k(a);else{var l=[];for(var m=0,n=j.length;m<n;m++)l.push(h.fromString(d,j[m]));i.data=l}},l}),c("DynamicScene/DynamicObject",["../Core/createGuid","../Core/DeveloperError","../Core/TimeInterval","../Core/defaultValue","./DynamicProperty","./DynamicPositionProperty","./DynamicVertexPositionsProperty","./CzmlUnitQuaternion","./CzmlCartesian3"],function(a,b,c,d,e,f,g,h,i){var j=function(b){this._cachedAvailabilityDate=undefined,this._cachedAvailabilityValue=undefined,typeof b=="undefined"&&(b=a()),this.id=b,this.availability=undefined,this.position=undefined,this.orientation=undefined,this.billboard=undefined,this.cone=undefined,this.ellipsoid=undefined,this.label=undefined,this.path=undefined,this.point=undefined,this.polygon=undefined,this.polyline=undefined,this.pyramid=undefined,this.vertexPositions=undefined,this.viewFrom=undefined};return j.prototype.isAvailable=function(a){if(typeof a=="undefined")throw new b("time is required.");return typeof this.availability=="undefined"?!0:this._cachedAvailabilityDate===a?this._cachedAvailabilityValue:(this._cachedAvailabilityDate=a,this._cachedAvailabilityValue=this.availability.contains(a))},j.processCzmlPacketPosition=function(a,b){var c=b.position;if(typeof c=="undefined")return!1;var d=a.position,e=typeof d=="undefined";return e&&(a.position=d=new f),d.processCzmlIntervals(c),e},j.processCzmlPacketViewFrom=function(a,b){var c=b.viewFrom;if(typeof c=="undefined")return!1;var d=a.viewFrom,f=typeof d=="undefined";return f&&(a.viewFrom=d=new e(i)),d.processCzmlIntervals(c),f},j.processCzmlPacketOrientation=function(a,b){var c=b.orientation;if(typeof c=="undefined")return!1;var d=a.orientation,f=typeof d=="undefined";return f&&(a.orientation=d=new e(h)),d.processCzmlIntervals(c),f},j.processCzmlPacketVertexPositions=function(a,b,c){var d=b.vertexPositions;if(typeof d=="undefined")return!1;var e=a.vertexPositions,f=typeof a.vertexPositions=="undefined";return f&&(a.vertexPositions=e=new g),e.processCzmlIntervals(d,undefined,c),f},j.processCzmlPacketAvailability=function(a,b){var d=b.availability;if(typeof d=="undefined")return!1;var e=!1,f=c.fromIso8601(d);return typeof f!="undefined"&&(e=a._setAvailability(f)),e},j.mergeProperties=function(a,b){a.position=d(a.position,b.position),a.orientation=d(a.orientation,b.orientation),a.vertexPositions=d(a.vertexPositions,b.vertexPositions),a.viewFrom=d(a.viewFrom,b.viewFrom);var c=b.availability;typeof c!="undefined"&&a._setAvailability(c)},j.undefineProperties=function(a){a.position=undefined,a.orientation=undefined,a.vertexPositions=undefined,a.viewFrom=undefined,a._setAvailability(undefined)},j.prototype._setAvailability=function(a){var b=!c.equals(this.availability,a);return this.availability=a,this._cachedAvailabilityDate=undefined,this._cachedAvailabilityValue=undefined,b},j}),c("DynamicScene/DynamicObjectCollection",["../Core/Event","../Core/TimeInterval","../Core/Iso8601","../Core/DeveloperError","./DynamicObject"],function(a,b,c,d,e){var f=function(){this._hash={},this._array=[],this.compositeCollection=undefined,this.objectPropertiesChanged=new a,this.objectsRemoved=new a};return f.prototype.computeAvailability=function(){var a=c.MAXIMUM_VALUE,d=c.MINIMUM_VALUE,e,f,g,h=this._array;for(e=0,f=h.length;e<f;e++){g=h[e];var i=g.availability;if(typeof i!="undefined"){var j=i.start,k=i.stop;j.lessThan(a)&&!j.equals(c.MINIMUM_VALUE)&&(a=g.availability.start),k.greaterThan(d)&&!k.equals(c.MAXIMUM_VALUE)&&(d=g.availability.stop)}}return a===c.MAXIMUM_VALUE&&(a=c.MINIMUM_VALUE),d===c.MINIMUM_VALUE&&(d=c.MAXIMUM_VALUE),new b(a,d,!0,!0)},f.prototype.getObject=function(a){if(typeof a=="undefined")throw new d("id is required.");return this._hash[a]},f.prototype.getObjects=function(){return this._array},f.prototype.getOrCreateObject=function(a){if(typeof a=="undefined")throw new d("id is required.");var b=this._hash[a];return b||(b=new e(a),this._hash[a]=b,this._array.push(b)),b},f.prototype.clear=function(){var a=this._array;this._hash={},this._array=[],a.length>0&&this.objectsRemoved.raiseEvent(this,a)},f}),c("Renderer/BlendEquation",["../Core/Enumeration"],function(a){var b={ADD:new a(32774,"ADD"),SUBTRACT:new a(32778,"SUBTRACT"),REVERSE_SUBTRACT:new a(32779,"REVERSE_SUBTRACT"),validate:function(a){return a===b.ADD||a===b.SUBTRACT||a===b.REVERSE_SUBTRACT}};return b}),c("Renderer/BlendFunction",["../Core/Enumeration"],function(a){var b={ZERO:new a(0,"ZERO"),ONE:new a(1,"ONE"),SOURCE_COLOR:new a(768,"SOURCE_COLOR"),ONE_MINUS_SOURCE_COLOR:new a(769,"ONE_MINUS_SOURCE_COLOR"),DESTINATION_COLOR:new a(774,"DESTINATION_COLOR"),ONE_MINUS_DESTINATION_COLOR:new a(775,"ONE_MINUS_DESTINATION_COLOR"),SOURCE_ALPHA:new a(770,"SOURCE_ALPHA"),ONE_MINUS_SOURCE_ALPHA:new a(771,"ONE_MINUS_SOURCE_ALPHA"),DESTINATION_ALPHA:new a(772,"DESTINATION_ALPHA"),ONE_MINUS_DESTINATION_ALPHA:new a(773,"ONE_MINUS_DESTINATION_ALPHA"),CONSTANT_COLOR:new a(32769,"CONSTANT_COLOR"),ONE_MINUS_CONSTANT_COLOR:new a(32770,"ONE_MINUS_CONSTANT_COLOR"),CONSTANT_ALPHA:new a(32771,"CONSTANT_ALPHA"),ONE_MINUS_CONSTANT_ALPHA:new a(32772,"ONE_MINUS_CONSTANT_ALPHA"),SOURCE_ALPHA_SATURATE:new a(776,"SOURCE_ALPHA_SATURATE"),validate:function(a){return a===b.ZERO||a===b.ONE||a===b.SOURCE_COLOR||a===b.ONE_MINUS_SOURCE_COLOR||a===b.DESTINATION_COLOR||a===b.ONE_MINUS_DESTINATION_COLOR||a===b.SOURCE_ALPHA||a===b.ONE_MINUS_SOURCE_ALPHA||a===b.DESTINATION_ALPHA||a===b.ONE_MINUS_DESTINATION_ALPHA||a===b.CONSTANT_COLOR||a===b.ONE_MINUS_CONSTANT_COLOR||a===b.CONSTANT_ALPHA||a===b.ONE_MINUS_CONSTANT_ALPHA||a===b.SOURCE_ALPHA_SATURATE}};return b}),c("Renderer/BlendingState",["./BlendEquation","./BlendFunction"],function(a,b){var c={ALPHA_BLEND:{enabled:!0,equationRgb:a.ADD,equationAlpha:a.ADD,functionSourceRgb:b.SOURCE_ALPHA,functionSourceAlpha:b.SOURCE_ALPHA,functionDestinationRgb:b.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:b.ONE_MINUS_SOURCE_ALPHA},PRE_MULTIPLIED_ALPHA_BLEND:{enabled:!0,equationRgb:a.ADD,equationAlpha:a.ADD,functionSourceRgb:b.ONE,functionSourceAlpha:b.ONE,functionDestinationRgb:b.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:b.ONE_MINUS_SOURCE_ALPHA},ADDITIVE_BLEND:{enabled:!0,equationRgb:a.ADD,equationAlpha:a.ADD,functionSourceRgb:b.SOURCE_ALPHA,functionSourceAlpha:b.SOURCE_ALPHA,functionDestinationRgb:b.ONE,functionDestinationAlpha:b.ONE}};return c}),c("Renderer/Buffer",["../Core/DeveloperError","../Core/destroyObject"],function(a,b){var c=function(a,b,c,d,e){this._gl=a,this._bufferTarget=b,this._sizeInBytes=c,this._usage=d,this._buffer=e,this._vertexArrayDestroyable=!0};return c.prototype.copyFromArrayView=function(b,c){if(!b)throw new a("arrayView is required.");c=c||0;if(c+b.byteLength>this._sizeInBytes)throw new a("This buffer is not large enough.");var d=this._gl,e=this._bufferTarget;d.bindBuffer(e,this._buffer),d.bufferSubData(e,c,b),d.bindBuffer(e,null)},c.prototype._getBuffer=function(){return this._buffer},c.prototype.getSizeInBytes=function(){return this._sizeInBytes},c.prototype.getUsage=function(){return this._usage},c.prototype.getVertexArrayDestroyable=function(){return this._vertexArrayDestroyable},c.prototype.setVertexArrayDestroyable=function(a){this._vertexArrayDestroyable=a},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),b(this)},c}),c("Renderer/BufferUsage",["../Core/Enumeration"],function(a){var b={STREAM_DRAW:new a(35040,"STREAM_DRAW"),STATIC_DRAW:new a(35044,"STATIC_DRAW"),DYNAMIC_DRAW:new a(35048,"DYNAMIC_DRAW"),validate:function(a){return a===b.STREAM_DRAW||a===b.STATIC_DRAW||a===b.DYNAMIC_DRAW}};return b}),c("Renderer/ClearCommand",["../Core/DeveloperError"],function(a){var b=function(a){this.clearState=a,this.framebuffer=undefined};return b.prototype.execute=function(a,b){a.clear(this,b)},b}),c("Renderer/CommandLists",[],function(){var a=function(){this.colorList=[],this.pickList=[],this.overlayList=[]};return a.prototype.empty=function(){return this.colorList.length===0&&this.pickList.length===0&&this.overlayList.length===0},a.prototype.removeAll=function(){this.colorList.length=0,this.pickList.length=0,this.overlayList.length=0},a}),c("Renderer/CullFace",["../Core/Enumeration"],function(a){var b={FRONT:new a(1028,"FRONT"),BACK:new a(1029,"BACK"),FRONT_AND_BACK:new a(1032,"FRONT_AND_BACK"),validate:function(a){return a===b.FRONT||a===b.BACK||a===b.FRONT_AND_BACK}};return b}),c("Renderer/DepthFunction",["../Core/Enumeration"],function(a){var b={NEVER:new a(512,"NEVER"),LESS:new a(513,"LESS"),EQUAL:new a(514,"EQUAL"),LESS_OR_EQUAL:new a(515,"LEQUAL"),GREATER:new a(516,"GREATER"),NOT_EQUAL:new a(517,"NOTEQUAL"),GREATER_OR_EQUAL:new a(518,"GEQUAL"),ALWAYS:new a(519,"ALWAYS"),validate:function(a){return a===b.NEVER||a===b.LESS||a===b.EQUAL||a===b.LESS_OR_EQUAL||a===b.GREATER||a===b.NOT_EQUAL||a===b.GREATER_OR_EQUAL||a===b.ALWAYS}};return b}),c("Renderer/DrawCommand",["../Core/DeveloperError"],function(a){var b=function(){this.boundingVolume=undefined,this.modelMatrix=undefined,this.primitiveType=undefined,this.vertexArray=undefined,this.count=undefined,this.offset=undefined,this.shaderProgram=undefined,this.uniformMap=undefined,this.renderState=undefined,this.framebuffer=undefined};return b.prototype.execute=function(a,b){a.draw(this,b)},b}),c("Renderer/MipmapHint",["../Core/Enumeration"],function(a){var b={DONT_CARE:new a(4352,"DONT_CARE"),FASTEST:new a(4353,"FASTEST"),NICEST:new a(4354,"NICEST"),validate:function(a){return a===b.DONT_CARE||a===b.FASTEST||a===b.NICEST}};return b}),c("Renderer/PixelDatatype",["../Core/Enumeration"],function(a){var b={UNSIGNED_BYTE:new a(5121,"UNSIGNED_BYTE"),UNSIGNED_SHORT:new a(5123,"UNSIGNED_SHORT"),UNSIGNED_INT:new a(5125,"UNSIGNED_INT"),UNSIGNED_INT_24_8_WEBGL:new a(34042,"UNSIGNED_INT_24_8_WEBGL"),UNSIGNED_SHORT_4_4_4_4:new a(32819,"UNSIGNED_SHORT_4_4_4_4"),UNSIGNED_SHORT_5_5_5_1:new a(32820,"UNSIGNED_SHORT_5_5_5_1"),UNSIGNED_SHORT_5_6_5:new a(33635,"UNSIGNED_SHORT_5_6_5"),validate:function(a){return a===b.UNSIGNED_BYTE||a===b.UNSIGNED_SHORT||a===b.UNSIGNED_INT||a===b.UNSIGNED_INT_24_8_WEBGL||a===b.UNSIGNED_SHORT_4_4_4_4||a===b.UNSIGNED_SHORT_5_5_5_1||a===b.UNSIGNED_SHORT_5_6_5}};return b}),c("Renderer/PixelFormat",["../Core/Enumeration"],function(a){var b={DEPTH_COMPONENT:new a(6402,"DEPTH_COMPONENT"),DEPTH_STENCIL:new a(34041,"DEPTH_STENCIL"),ALPHA:new a(6406,"ALPHA"),RGB:new a(6407,"RGB"),RGBA:new a(6408,"RGBA"),LUMINANCE:new a(6409,"LUMINANCE"),LUMINANCE_ALPHA:new a(6410,"LUMINANCE_ALPHA"),validate:function(a){return a===b.DEPTH_COMPONENT||a===b.DEPTH_STENCIL||a===b.ALPHA||a===b.RGB||a===b.RGBA||a===b.LUMINANCE||a===b.LUMINANCE_ALPHA},isColorFormat:function(a){return a===b.ALPHA||a===b.RGB||a===b.RGBA||a===b.LUMINANCE||a===b.LUMINANCE_ALPHA},isDepthFormat:function(a){return a===b.DEPTH_COMPONENT||a===b.DEPTH_STENCIL}};return b}),c("Renderer/Framebuffer",["../Core/DeveloperError","../Core/destroyObject","./PixelFormat"],function(a,b,c){function e(a,b,c){a._bind();var d=a._gl;c?d.framebufferTexture2D(d.FRAMEBUFFER,b,c._getTarget(),c._getTexture(),0):d.framebufferTexture2D(d.FRAMEBUFFER,b,d.TEXTURE_2D,null,0),a._unBind()}function f(a,b,c){a._bind();var d=a._gl;c?d.framebufferRenderbuffer(d.FRAMEBUFFER,b,d.RENDERBUFFER,c._getRenderbuffer()):d.framebufferRenderbuffer(d.FRAMEBUFFER,b,d.RENDERBUFFER,null),a._unBind()}function g(a,b){a.destroyAttachments&&b&&b.destroy&&b.destroy()}var d=function(b,c){this._gl=b,this._framebuffer=b.createFramebuffer(),this._colorTexture=undefined,this._colorRenderbuffer=undefined,this._depthTexture=undefined,this._depthRenderbuffer=undefined,this._stencilRenderbuffer=undefined,this._depthStencilTexture=undefined,this._depthStencilRenderbuffer=undefined,this.destroyAttachments=!0;if(c){if(c.colorTexture&&c.colorRenderbuffer)throw new a("Cannot have both a color texture and color renderbuffer attachment.");if(c.depthTexture&&c.depthRenderbuffer)throw new a("Cannot have both a depth texture and depth renderbuffer attachment.");if(c.depthStencilTexture&&c.depthStencilRenderbuffer)throw new a("Cannot have both a depth-stencil texture and depth-stencil renderbuffer attachment.");var d=c.depthTexture||c.depthRenderbuffer,e=c.depthStencilTexture||c.depthStencilRenderbuffer;if(d&&e)throw new a("Cannot have both a depth and depth-stencil attachment.");if(c.stencilRenderbuffer&&e)throw new a("Cannot have both a stencil and depth-stencil attachment.");if(d&&c.stencilRenderbuffer)throw new a("Cannot have both a depth and stencil attachment.");c.colorTexture&&this.setColorTexture(c.colorTexture),c.colorRenderbuffer&&this.setColorRenderbuffer(c.colorRenderbuffer),c.depthTexture&&this.setDepthTexture(c.depthTexture),c.depthRenderbuffer&&this.setDepthRenderbuffer(c.depthRenderbuffer),c.stencilRenderbuffer&&this.setStencilRenderbuffer(c.stencilRenderbuffer),c.depthStencilTexture&&this.setDepthStencilTexture(c.depthStencilTexture),c.depthStencilRenderbuffer&&this.setDepthStencilRenderbuffer(c.depthStencilRenderbuffer)}};return d.prototype._bind=function(){var a=this._gl;a.bindFramebuffer(a.FRAMEBUFFER,this._framebuffer)},d.prototype._unBind=function(){var a=this._gl;a.bindFramebuffer(a.FRAMEBUFFER,null)},d.prototype.setColorTexture=function(b){if(b&&!c.isColorFormat(b.getPixelFormat()))throw new a("The color-texture pixel-format must be a color format.");e(this,this._gl.COLOR_ATTACHMENT0,b),g(this,this._colorTexture),this._colorTexture=b},d.prototype.getColorTexture=function(){return this._colorTexture},d.prototype.setColorRenderbuffer=function(a){f(this,this._gl.COLOR_ATTACHMENT0,a),g(this,this._colorRenderbuffer),this._colorRenderbuffer=a},d.prototype.getColorRenderbuffer=function(){return this._colorRenderbuffer},d.prototype.setDepthTexture=function(b){if(b&&b.getPixelFormat()!==c.DEPTH_COMPONENT)throw new a("The depth-texture pixel-format must be DEPTH_COMPONENT.");e(this,this._gl.DEPTH_ATTACHMENT,b),g(this,this._depthTexture),this._depthTexture=b},d.prototype.getDepthTexture=function(){return this._depthTexture},d.prototype.setDepthRenderbuffer=function(a){f(this,this._gl.DEPTH_ATTACHMENT,a),g(this,this._depthRenderbuffer),this._depthRenderbuffer=a},d.prototype.getDepthRenderbuffer=function(){return this._depthRenderbuffer},d.prototype.setStencilRenderbuffer=function(a){f(this,this._gl.STENCIL_ATTACHMENT,a),g(this,this._stencilRenderbuffer),this._stencilRenderbuffer=a},d.prototype.getStencilRenderbuffer=function(){return this._stencilRenderbuffer},d.prototype.setDepthStencilTexture=function(b){if(b&&b.getPixelFormat()!==c.DEPTH_STENCIL)throw new a("The depth-stencil pixel-format must be DEPTH_STENCIL.");e(this,this._gl.DEPTH_STENCIL_ATTACHMENT,b),g(this,this._depthStencilTexture),this._depthStencilTexture=b},d.prototype.getDepthStencilTexture=function(){return this._depthStencilTexture},d.prototype.setDepthStencilRenderbuffer=function(a){f(this,this._gl.DEPTH_STENCIL_ATTACHMENT,a),g(this,this._depthStencilRenderbuffer),this._depthStencilRenderbuffer=a},d.prototype.getDepthStencilRenderbuffer=function(){return this._depthStencilRenderbuffer},d.prototype.hasDepthAttachment=function(){return!!(this.getDepthTexture()||this.getDepthRenderbuffer()||this.getDepthStencilTexture()||this.getDepthStencilRenderbuffer())},d.prototype.isDestroyed=function(){return!1},d.prototype.destroy=function(){return this.destroyAttachments&&(this._colorTexture=this._colorTexture&&this._colorTexture.destroy&&this._colorTexture.destroy(),this._colorRenderbuffer=this._colorRenderbuffer&&this._colorRenderbuffer.destroy(),this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()),this._gl.deleteFramebuffer(this._framebuffer),b(this)},d}),c("Renderer/Renderbuffer",["../Core/DeveloperError","../Core/destroyObject"],function(a,b){function c(a,c,d,e){var f=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,f),a.renderbufferStorage(a.RENDERBUFFER,c,d,e),a.bindRenderbuffer(a.RENDERBUFFER,null),this.getFormat=function(){return c},this.getWidth=function(){return d},this.getHeight=function(){return e},this._getRenderbuffer=function(){return f},this.isDestroyed=function(){return!1},this.destroy=function(){return a.deleteRenderbuffer(f),b(this)}}return c}),c("Renderer/RenderbufferFormat",["../Core/Enumeration"],function(a){var b={RGBA4:new a(32854,"RGBA4"),RGB5_A1:new a(32855,"RGB5_A1"),RGB565:new a(36194,"RGB565"),DEPTH_COMPONENT16:new a(33189,"DEPTH_COMPONENT16"),STENCIL_INDEX8:new a(36168,"STENCIL_INDEX8"),DEPTH_STENCIL:new a(34041,"DEPTH_STENCIL"),validate:function(a){return a===b.RGBA4||a===b.RGB5_A1||a===b.RGB565||a===b.DEPTH_COMPONENT16||a===b.STENCIL_INDEX8||a===b.DEPTH_STENCIL}};return b}),c("Renderer/PickFramebuffer",["../Core/defaultValue","../Core/destroyObject","../Core/Color","../Core/DeveloperError","./ClearCommand","./RenderbufferFormat"],function(a,b,c,d,e,f){var g=function(a){this._context=a,this._fb=null,this._width=0,this._height=0,this._clearCommand=new e,this._clearCommand.clearState=a.createClearState({color:new c(0,0,0,1),depth:1,stencil:0})};g.prototype.begin=function(){var a=this._context;if(!this._fb||this._width!==a.getCanvas().clientWidth||this._height!==a.getCanvas().clientHeight)this._width=a.getCanvas().clientWidth,this._height=a.getCanvas().clientHeight,this._fb=this._fb&&this._fb.destroy(),this._fb=a.createFramebuffer({colorRenderbuffer:a.createRenderbuffer(),depthStencilRenderbuffer:a.createRenderbuffer({format:f.DEPTH_STENCIL})});return this._clearCommand.execute(a,this._fb),this._fb};var h=new c;return g.prototype.end=function(b){if(typeof b=="undefined")throw new d("screenSpaceRectangle is required.");var c=a(b.width,1),e=a(b.height,1),f=this._context.readPixels({x:b.x,y:b.y,width:c,height:e,framebuffer:this._fb}),g=Math.max(c,e),i=g*g,j=Math.floor(c*.5),k=Math.floor(e*.5),l=0,m=0,n=0,o=-1;for(var p=0;p<i;++p){if(-j<=l&&l<=j&&-k<=m&&m<=k){var q=4*((k-m)*c+l+j);h.red=f[q],h.green=f[q+1],h.blue=f[q+2],h.alpha=f[q+3];var r=this._context.getObjectByPickId(h);if(typeof r!="undefined")return r}if(l===m||l<0&&-l===m||l>0&&l===1-m){var s=n;n=-o,o=s}l+=n,m+=o}return undefined},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return this._fb=this._fb&&this._fb.destroy(),b(this)},g}),c("Renderer/ShaderCache",["../Core/destroyObject"],function(a){var b=function(a){this._context=a,this._shaders={},this._shadersToRelease={}};return b.prototype.getShaderProgram=function(a,b,c){var d=a+b,e;if(this._shaders[d])e=this._shaders[d];else{var f=this._context.createShaderProgram(a,b,c);e={cache:this,shaderProgram:f,keyword:d,count:0},f._cachedShader=e,this._shaders[d]=e}return++e.count,e.shaderProgram},b.prototype.destroyReleasedShaderPrograms=function(){var a=this._shadersToRelease;for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];c.count===0&&(delete this._shaders[c.keyword],c.shaderProgram.destroy())}this._shadersToRelease={}},b.prototype.releaseShaderProgram=function(a){if(a){var b=a._cachedShader;b&&--b.count===0&&(this._shadersToRelease[b.keyword]=b)}return null},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){var b=this._shaders;for(var c in b)b.hasOwnProperty(c)&&b[c].shaderProgram.destroy();return a(this)},b}),c("Renderer/StencilFunction",["../Core/Enumeration"],function(a){var b={NEVER:new a(512,"NEVER"),LESS:new a(513,"LESS"),EQUAL:new a(514,"EQUAL"),LESS_OR_EQUAL:new a(515,"LESS_OR_EQUAL"),GREATER:new a(516,"GREATER"),NOT_EQUAL:new a(517,"NOT_EQUAL"),GREATER_OR_EQUAL:new a(518,"GREATER_OR_EQUAL"),ALWAYS:new a(519,"ALWAYS"),validate:function(a){return a===b.NEVER||a===b.LESS||a===b.EQUAL||a===b.LESS_OR_EQUAL||a===b.GREATER||a===b.NOT_EQUAL||a===b.GREATER_OR_EQUAL||a===b.ALWAYS}};return b}),c("Renderer/StencilOperation",["../Core/Enumeration"],function(a){var b={ZERO:new a(0,"ZERO"),KEEP:new a(7680,"KEEP"),REPLACE:new a(7681,"REPLACE"),INCREMENT:new a(7682,"INCREMENT"),DECREMENT:new a(7683,"DECREMENT"),INVERT:new a(5386,"INVERT"),INCREMENT_WRAP:new a(34055,"INCREMENT_WRAP"),DECREMENT_WRAP:new a(34056,"DECREMENT_WRAP"),validate:function(a){return a===b.ZERO||a===b.KEEP||a===b.REPLACE||a===b.INCREMENT||a===b.DECREMENT||a===b.INVERT||a===b.INCREMENT_WRAP||a===b.DECREMENT_WRAP}};return b}),c("Renderer/TextureAtlas",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian2","../Core/BoundingRectangle","../Core/createGuid","./PixelFormat"],function(a,b,c,d,e,f){function g(a,b,d,e,f){this.bottomLeft=typeof a!="undefined"?a:new c,this.topRight=typeof b!="undefined"?b:new c,this.childNode1=d,this.childNode2=e,this.imageIndex=f}var h=function(b){b=typeof b!="undefined"?b:{};var d=b.context,h=b.pixelFormat,i=b.borderWidthInPixels,j=b.initialSize,k=b.images,l=b.image;if(typeof d=="undefined")throw new a("context is required.");h=typeof h!="undefined"?h:f.RGBA,i=typeof i!="undefined"?i:1;if(i<0)throw new a("borderWidthInPixels must be greater than or equal to zero.");j=typeof j!="undefined"?j:new c(16,16);if(j.x<1||j.y<1)throw new a("initialSize must be greater than zero.");this._context=d,this._pixelFormat=h,this._borderWidthInPixels=i,this._textureCoordinates=[],this._guid=e(),this._texture=this._context.createTexture2D({width:j.x,height:j.y,pixelFormat:this._pixelFormat}),this._root=new g(new c(0,0),new c(j.x,j.y)),typeof k!="undefined"&&k.length>0&&this.addImages(k),typeof l!="undefined"&&this.addImage(l)};return h.prototype._resizeAtlas=function(a){var b=this.getNumberOfImages(),d=2;if(b>0){var e=this._texture.getWidth(),f=this._texture.getHeight(),h=d*(e+a.width+this._borderWidthInPixels),i=d*(f+a.height+this._borderWidthInPixels),j=e/h,k=f/i,l=new g(new c(e+this._borderWidthInPixels,0),new c(h,f)),m=new g(new c(0,0),new c(h,f),this._root,l),n=new g(new c(0,f+this._borderWidthInPixels),new c(h,i)),o=new g(new c(0,0),new c(h,i),m,n);this._root=o;for(var p=0;p<this._textureCoordinates.length;p++){var q=this._textureCoordinates[p];typeof q!="undefined"&&(q.x*=j,q.y*=k,q.width*=j,q.height*=k)}var r=this._context.createTexture2D({width:h,height:i,pixelFormat:this._pixelFormat}),s=this._context.createFramebuffer({colorTexture:this._texture});s._bind(),r.copyFromFramebuffer(0,0,0,0,e,f),s._unBind(),s.destroy(),this._texture=r}else{var t=d*(a.width+this._borderWidthInPixels),u=d*(a.height+this._borderWidthInPixels);this._texture=this._texture&&this._texture.destroy(),this._texture=this._context.createTexture2D({width:t,height:u,pixelFormat:this._pixelFormat}),this._root=new g(new c(0,0),new c(t,u))}},h.prototype._findNode=function(a,b){if(typeof a=="undefined")return undefined;if(typeof a.childNode1=="undefined"&&typeof a.childNode2=="undefined"){if(typeof a.imageIndex!="undefined")return undefined;var d=a.topRight.x-a.bottomLeft.x,e=a.topRight.y-a.bottomLeft.y,f=d-b.width,h=e-b.height;if(f<0||h<0)return undefined;if(f===0&&h===0)return a;if(f>h){a.childNode1=new g(new c(a.bottomLeft.x,a.bottomLeft.y),new c(a.bottomLeft.x+b.width,a.topRight.y));var i=a.bottomLeft.x+b.width+this._borderWidthInPixels;i<a.topRight.x&&(a.childNode2=new g(new c(i,a.bottomLeft.y),new c(a.topRight.x,a.topRight.y)))}else{a.childNode1=new g(new c(a.bottomLeft.x,a.bottomLeft.y),new c(a.topRight.x,a.bottomLeft.y+b.height));var j=a.bottomLeft.y+b.height+this._borderWidthInPixels;j<a.topRight.y&&(a.childNode2=new g(new c(a.bottomLeft.x,j),new c(a.topRight.x,a.topRight.y)))}return this._findNode(a.childNode1,b)}return this._findNode(a.childNode1,b)||this._findNode(a.childNode2,b)},h.prototype._addImage=function(b,c){if(typeof b=="undefined")throw new a("image is required.");var e=this._findNode(this._root,b);if(typeof e!="undefined"){e.imageIndex=c;var f=this._texture.getWidth(),g=this._texture.getHeight(),h=e.topRight.x-e.bottomLeft.x,i=e.topRight.y-e.bottomLeft.y;this._textureCoordinates[c]=new d(e.bottomLeft.x/f,e.bottomLeft.y/g,h/f,i/g),this._texture.copyFrom(b,e.bottomLeft.x,e.bottomLeft.y)}else this._resizeAtlas(b),this._addImage(b,c)},h.prototype.addImage=function(a){var b=this.getNumberOfImages();return this._addImage(a,b),this._guid=e(),b},h.prototype.addImages=function(b){if(typeof b=="undefined"||b.length<1)throw new a("images is required and must have length greater than zero.");var c,d=[],f=b.length,g=this.getNumberOfImages();for(c=0;c<f;++c)d.push({image:b[c],index:c+g});d.sort(function(a,b){return Math.max(b.image.height,b.image.width)-Math.max(a.image.height,a.image.width)});for(c=0;c<f;++c){var h=d[c];this._addImage(h.image,h.index)}return this._guid=e(),g},h.prototype.addSubRegions=function(a,b){var c=this.addImage(a),f=this._texture.getWidth(),g=this._texture.getHeight(),h=this.getNumberOfImages(),i=b.length,j=this._textureCoordinates[c];for(var k=0;k<i;++k){var l=b[k];this._textureCoordinates.push(new d(j.x+l.x/f,j.y+l.y/g,l.width/f,l.height/g))}return this._guid=e(),h},h.prototype.getBorderWidthInPixels=function(){return this._borderWidthInPixels},h.prototype.getTextureCoordinates=function(){return this._textureCoordinates},h.prototype.getTexture=function(){return this._texture},h.prototype.getNumberOfImages=function(){return this._textureCoordinates.length},h.prototype.getGUID=function(){return this._guid},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),b(this)},h}),c("Renderer/TextureMagnificationFilter",["../Core/Enumeration"],function(a){var b={NEAREST:new a(9728,"NEAREST"),LINEAR:new a(9729,"LINEAR"),validate:function(a){return a===b.NEAREST||a===b.LINEAR}};return b}),c("Renderer/TextureMinificationFilter",["../Core/Enumeration"],function(a){var b={NEAREST:new a(9728,"NEAREST"),LINEAR:new a(9729,"LINEAR"),NEAREST_MIPMAP_NEAREST:new a(9984,"NEAREST_MIPMAP_NEAREST"),LINEAR_MIPMAP_NEAREST:new a(9985,"LINEAR_MIPMAP_NEAREST"),NEAREST_MIPMAP_LINEAR:new a(9986,"NEAREST_MIPMAP_LINEAR"),LINEAR_MIPMAP_LINEAR:new a(9987,"LINEAR_MIPMAP_LINEAR"),validate:function(a){return a===b.NEAREST||a===b.LINEAR||a===b.NEAREST_MIPMAP_NEAREST||a===b.LINEAR_MIPMAP_NEAREST||a===b.NEAREST_MIPMAP_LINEAR||a===b.LINEAR_MIPMAP_LINEAR}};return b}),c("Renderer/TextureWrap",["../Core/Enumeration"],function(a){var b={CLAMP:new a(33071,"CLAMP"),REPEAT:new a(10497,"REPEAT"),MIRRORED_REPEAT:new a(33648,"MIRRORED_REPEAT"),validate:function(a){return a===b.CLAMP||a===b.REPEAT||a===b.MIRRORED_REPEAT}};return b}),c("Renderer/CubeMapFace",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","./MipmapHint","./TextureMagnificationFilter","./TextureMinificationFilter","./TextureWrap"],function(a,b,c,d,e,f,g){var h=function(a,b,c,d,e,f,g,h){this._gl=a,this._texture=b,this._textureTarget=c,this._targetFace=d,this._pixelFormat=e,this._pixelDatatype=f,this._size=g,this._preMultiplyAlpha=h};return h.prototype.copyFrom=function(c,d,e){if(!c)throw new b("source is required.");d=a(d,0),e=a(e,0);var f=c.width,g=c.height;if(d<0)throw new b("xOffset must be greater than or equal to zero.");if(e<0)throw new b("yOffset must be greater than or equal to zero.");if(d+f>this._size)throw new b("xOffset + source.width must be less than or equal to getWidth().");if(e+g>this._size)throw new b("yOffset + source.height must be less than or equal to getHeight().");var h=this._gl,i=this._textureTarget;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._preMultiplyAlpha),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.activeTexture(h.TEXTURE0),h.bindTexture(i,this._texture),c.arrayBufferView?h.texSubImage2D(this._targetFace,0,d,e,f,g,+this._pixelFormat,+this._pixelDatatype,c.arrayBufferView):h.texSubImage2D(this._targetFace,0,d,e,+this._pixelFormat,+this._pixelDatatype,c),h.bindTexture(i,null)},h.prototype.copyFromFramebuffer=function(c,d,e,f,g,h){c=a(c,0),d=a(d,0),e=a(e,0),f=a(f,0),g=a(g,this._size),h=a(h,this._size);if(c<0)throw new b("xOffset must be greater than or equal to zero.");if(d<0)throw new b("yOffset must be greater than or equal to zero.");if(e<0)throw new b("framebufferXOffset must be greater than or equal to zero.");if(f<0)throw new b("framebufferYOffset must be greater than or equal to zero.");if(c+g>this._size)throw new b("xOffset + source.width must be less than or equal to getWidth().");if(d+h>this._size)throw new b("yOffset + source.height must be less than or equal to getHeight().");var i=this._gl,j=this._textureTarget;i.activeTexture(i.TEXTURE0),i.bindTexture(j,this._texture),i.copyTexSubImage2D(this._targetFace,0,c,d,e,f,g,h),i.bindTexture(j,null)},h.prototype.getPixelFormat=function(){return this._pixelFormat},h.prototype._getTexture=function(){return this._texture},h.prototype._getTarget=function(){return this._targetFace},h}),c("Renderer/CubeMap",["../Core/DeveloperError","../Core/destroyObject","../Core/Math","./MipmapHint","./TextureMagnificationFilter","./TextureMinificationFilter","./TextureWrap","./CubeMapFace"],function(a,b,c,d,e,f,g,h){var i=function(a,b,c,d,e,f,g,i){this._gl=a,this._textureFilterAnisotropic=b,this._textureTarget=c,this._texture=d,this._pixelFormat=e,this._pixelDatatype=f,this._size=g,this._preMultiplyAlpha=i,this._sampler=undefined,this._positiveX=new h(a,d,c,a.TEXTURE_CUBE_MAP_POSITIVE_X,e,f,g,i),this._negativeX=new h(a,d,c,a.TEXTURE_CUBE_MAP_NEGATIVE_X,e,f,g,i),this._positiveY=new h(a,d,c,a.TEXTURE_CUBE_MAP_POSITIVE_Y,e,f,g,i),this._negativeY=new h(a,d,c,a.TEXTURE_CUBE_MAP_NEGATIVE_Y,e,f,g,i),this._positiveZ=new h(a,d,c,a.TEXTURE_CUBE_MAP_POSITIVE_Z,e,f,g,i),this._negativeZ=new h(a,d,c,a.TEXTURE_CUBE_MAP_NEGATIVE_Z,e,f,g,i),this.setSampler()};return i.prototype.getPositiveX=function(){return this._positiveX},i.prototype.getNegativeX=function(){return this._negativeX},i.prototype.getPositiveY=function(){return this._positiveY},i.prototype.getNegativeY=function(){return this._negativeY},i.prototype.getPositiveZ=function(){return this._positiveZ},i.prototype.getNegativeZ=function(){return this._negativeZ},i.prototype.generateMipmap=function(b){if(this._size>1&&!c.isPowerOfTwo(this._size))throw new a("width and height must be a power of two to call generateMipmap().");b=b||d.DONT_CARE;if(!d.validate(b))throw new a("hint is invalid.");var e=this._gl,f=this._textureTarget;e.hint(e.GENERATE_MIPMAP_HINT,b),e.activeTexture(e.TEXTURE0),e.bindTexture(f,this._texture),e.generateMipmap(f),e.bindTexture(f,null)},i.prototype.setSampler=function(a){var b=a||{wrapS:g.CLAMP,wrapT:g.CLAMP,minificationFilter:f.LINEAR,magnificationFilter:e.LINEAR,maximumAnisotropy:1},c=this._gl,d=this._textureTarget;c.activeTexture(c.TEXTURE0),c.bindTexture(d,this._texture),c.texParameteri(d,c.TEXTURE_MIN_FILTER,b.minificationFilter),c.texParameteri(d,c.TEXTURE_MAG_FILTER,b.magnificationFilter),c.texParameteri(d,c.TEXTURE_WRAP_S,b.wrapS),c.texParameteri(d,c.TEXTURE_WRAP_T,b.wrapT),this._textureFilterAnisotropic&&c.texParameteri(d,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.maximumAnisotropy),c.bindTexture(d,null),this._sampler={wrapS:b.wrapS,wrapT:b.wrapT,minificationFilter:b.minificationFilter,magnificationFilter:b.magnificationFilter,maximumAnisotropy:b.maximumAnisotropy}},i.prototype.getSampler=function(){return this._sampler},i.prototype.getPixelFormat=function(){return this._pixelFormat},i.prototype.getPixelDatatype=function(){return this._pixelDatatype},i.prototype.getWidth=function(){return this._size},i.prototype.getHeight=function(){return this._size},i.prototype.getPreMultiplyAlpha=function(){return this._preMultiplyAlpha},i.prototype._getTexture=function(){return this._texture},i.prototype._getTarget=function(){return this._textureTarget},i.prototype.isDestroyed=function(){return!1},i.prototype.destroy=function(){return this._gl.deleteTexture(this._texture),this._positiveX=b(this._positiveX),this._negativeX=b(this._negativeX),this._positiveY=b(this._positiveY),this._negativeY=b(this._negativeY),this._positiveZ=b(this._positiveZ),this._negativeZ=b(this._negativeZ),b(this)},i}),c("Renderer/Texture",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian2","../Core/Math","./PixelFormat","./MipmapHint","./TextureMagnificationFilter","./TextureMinificationFilter","./TextureWrap"],function(a,b,c,d,e,f,g,h,i){var j=function(a,b,d,e,f,g,h,i,j){this._gl=a,this._textureFilterAnisotropic=b,this._textureTarget=d,this._texture=e,this._pixelFormat=f,this._pixelDatatype=g,this._width=h,this._height=i,this._dimensions=new c(h,i),this._preMultiplyAlpha=j,this._sampler=undefined,this.setSampler()};return j.prototype.copyFrom=function(b,c,d){if(!b)throw new a("source is required.");c=c||0,d=d||0;var f=b.width,g=b.height;if(e.isDepthFormat(this._pixelFormat))throw new a("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(c<0)throw new a("xOffset must be greater than or equal to zero.");if(d<0)throw new a("yOffset must be greater than or equal to zero.");if(c+f>this._width)throw new a("xOffset + source.width must be less than or equal to getWidth().");if(d+g>this._height)throw new a("yOffset + source.height must be less than or equal to getHeight().");var h=this._gl,i=this._textureTarget;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._preMultiplyAlpha),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.activeTexture(h.TEXTURE0),h.bindTexture(i,this._texture),b.arrayBufferView?h.texSubImage2D(i,0,c,d,f,g,+this._pixelFormat,+this._pixelDatatype,b.arrayBufferView):h.texSubImage2D(i,0,c,d,this._pixelFormat,this._pixelDatatype,b),h.bindTexture(i,null)},j.prototype.copyFromFramebuffer=function(b,c,d,f,g,h){b=b||0,c=c||0,d=d||0,f=f||0,g=g||this._width,h=h||this._height;if(e.isDepthFormat(this._pixelFormat))throw new a("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(b<0)throw new a("xOffset must be greater than or equal to zero.");if(c<0)throw new a("yOffset must be greater than or equal to zero.");if(d<0)throw new a("framebufferXOffset must be greater than or equal to zero.");if(f<0)throw new a("framebufferYOffset must be greater than or equal to zero.");if(b+g>this._width)throw new a("xOffset + source.width must be less than or equal to getWidth().");if(c+h>this._height)throw new a("yOffset + source.height must be less than or equal to getHeight().");var i=this._gl,j=this._textureTarget;i.activeTexture(i.TEXTURE0),i.bindTexture(j,this._texture),i.copyTexSubImage2D(j,0,b,c,d,f,g,h),i.bindTexture(j,null)},j.prototype.generateMipmap=function(b){if(e.isDepthFormat(this._pixelFormat))throw new a("Cannot call generateMipmap when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this._width>1&&!d.isPowerOfTwo(this._width))throw new a("width must be a power of two to call generateMipmap().");if(this._height>1&&!d.isPowerOfTwo(this._height))throw new a("height must be a power of two to call generateMipmap().");b=b||f.DONT_CARE;if(!f.validate(b))throw new a("hint is invalid.");var c=this._gl,g=this._textureTarget;c.hint(c.GENERATE_MIPMAP_HINT,b),c.activeTexture(c.TEXTURE0),c.bindTexture(g,this._texture),c.generateMipmap(g),c.bindTexture(g,null)},j.prototype.setSampler=function(a){var b=a||{wrapS:i.CLAMP,wrapT:i.CLAMP,minificationFilter:h.LINEAR,magnificationFilter:g.LINEAR,maximumAnisotropy:1},c=this._gl,d=this._textureTarget;c.activeTexture(c.TEXTURE0),c.bindTexture(d,this._texture),c.texParameteri(d,c.TEXTURE_MIN_FILTER,b.minificationFilter),c.texParameteri(d,c.TEXTURE_MAG_FILTER,b.magnificationFilter),c.texParameteri(d,c.TEXTURE_WRAP_S,b.wrapS),c.texParameteri(d,c.TEXTURE_WRAP_T,b.wrapT),this._textureFilterAnisotropic&&c.texParameteri(d,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.maximumAnisotropy),c.bindTexture(d,null),this._sampler={wrapS:b.wrapS,wrapT:b.wrapT,minificationFilter:b.minificationFilter,magnificationFilter:b.magnificationFilter,maximumAnisotropy:b.maximumAnisotropy}},j.prototype.getSampler=function(){return this._sampler},j.prototype.getPixelFormat=function(){return this._pixelFormat},j.prototype.getPixelDatatype=function(){return this._pixelDatatype},j.prototype.getWidth=function(){return this._width},j.prototype.getDimensions=function(){return this._dimensions},j.prototype.getPreMultiplyAlpha=function(){return this._preMultiplyAlpha},j.prototype.getHeight=function(){return this._height},j.prototype._getTexture=function(){return this._texture},j.prototype._getTarget=function(){return this._textureTarget},j.prototype.isDestroyed=function(){return!1},j.prototype.destroy=function(){return this._gl.deleteTexture(this._texture),b(this)},j}),c("Renderer/UniformDatatype",["../Core/Enumeration"],function(a){var b={FLOAT:new a(5126,"FLOAT",{getGLSL:function(){return"float"}}),FLOAT_VECTOR2:new a(35664,"FLOAT_VECTOR2",{getGLSL:function(){return"vec2"}}),FLOAT_VECTOR3:new a(35665,"FLOAT_VECTOR3",{getGLSL:function(){return"vec3"}}),FLOAT_VECTOR4:new a(35666,"FLOAT_VECTOR4",{getGLSL:function(){return"vec4"}}),INT:new a(5124,"INT",{getGLSL:function(){return"int"}}),INT_VECTOR2:new a(35667,"INT_VECTOR2",{getGLSL:function(){return"ivec2"}}),INT_VECTOR3:new a(35668,"INT_VECTOR3",{getGLSL:function(){return"ivec3"}}),INT_VECTOR4:new a(35669,"INT_VECTOR4",{getGLSL:function(){return"ivec4"}}),BOOL:new a(35670,"BOOL",{getGLSL:function(){return"bool"}}),BOOL_VECTOR2:new a(35671,"BOOL_VECTOR2",{getGLSL:function(){return"bvec2"}}),BOOL_VECTOR3:new a(35672,"BOOL_VECTOR3",{getGLSL:function(){return"bvec3"}}),BOOL_VECTOR4:new a(35673,"BOOL_VECTOR4",{getGLSL:function(){return"bvec4"}}),FLOAT_MATRIX2:new a(35674,"FLOAT_MATRIX2",{getGLSL:function(){return"mat2"}}),FLOAT_MATRIX3:new a(35675,"FLOAT_MATRIX3",{getGLSL:function(){return"mat3"}}),FLOAT_MATRIX4:new a(35676,"FLOAT_MATRIX4",{getGLSL:function(){return"mat4"}}),SAMPLER_2D:new a(35678,"SAMPLER_2D",{getGLSL:function(){return"sampler2D"}}),SAMPLER_CUBE:new a(35680,"SAMPLER_CUBE",{getGLSL:function(){return"samplerCube"}})};return b}),c("Renderer/VertexArray",["../Core/DeveloperError","../Core/destroyObject","../Core/ComponentDatatype"],function(a,b,c){var d=function(b,c,d){this._gl=b,this._attributes=[],this._indexBuffer=d;if(c)for(var e=0;e<c.length;++e)try{this._addAttribute(c[e],e)}catch(f){throw new a(f.message)}var g={};for(var h=0;h<this._attributes.length;++h){var i=this._attributes[h].index;if(g[i])throw new a("Index "+i+" is used by more than one attribute.");g[i]=!0}};return d.prototype._addAttribute=function(b,d){if(!b.vertexBuffer&&!b.value)throw new a("attribute must have a vertexBuffer or a value.");if(b.vertexBuffer&&b.value)throw new a("attribute cannot have both a vertexBuffer and a value.  It must have either a vertexBuffer property defining per-vertex data or a value property defining data for all vertices.");var e=b.value?b.value.length:b.componentsPerAttribute;if(e!==1&&e!==2&&e!==3&&e!==4)throw b.value?new a("attribute.value.length must be in the range [1, 4]."):new a("attribute.componentsPerAttribute must be in the range [1, 4].");if(b.componentDatatype){var f=b.componentDatatype;if(!c.validate(f))throw new a("attribute must have a valid componentDatatype or not specify it.")}if(b.strideInBytes&&b.strideInBytes>255)throw new a("attribute must have a strideInBytes less than or equal to 255 or not specify it.");var g={index:typeof b.index=="undefined"?d:b.index,enabled:typeof b.enabled=="undefined"?!0:b.enabled,vertexBuffer:b.vertexBuffer,value:b.value?b.value.slice(0):undefined,componentsPerAttribute:e,componentDatatype:b.componentDatatype||c.FLOAT,normalize:b.normalize||!1,offsetInBytes:b.offsetInBytes||0,strideInBytes:b.strideInBytes||0};if(g.vertexBuffer)g.vertexAttrib=function(a){a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer._getBuffer()),a.vertexAttribPointer(this.index,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes),a.enableVertexAttribArray(this.index)},g.disableVertexAttribArray=function(a){a.disableVertexAttribArray(this.index)};else{switch(g.componentsPerAttribute){case 1:g.vertexAttrib=function(a){a.vertexAttrib1fv(this.index,this.value)};break;case 2:g.vertexAttrib=function(a){a.vertexAttrib2fv(this.index,this.value)};break;case 3:g.vertexAttrib=function(a){a.vertexAttrib3fv(this.index,this.value)};break;case 4:g.vertexAttrib=function(a){a.vertexAttrib4fv(this.index,this.value)}}g.disableVertexAttribArray=function(a){}}this._attributes.push(g)},d.prototype.getAttribute=function(b){if(typeof b=="undefined")throw new a("index is required.");return this._attributes[b]},d.prototype.getNumberOfAttributes=function(){return this._attributes.length},d.prototype.addAttribute=function(b){if(b){var c=this._attributes,d=typeof b.index=="undefined"?c.length:b.index;for(var e=0;e<c.length;++e)if(d===c[e].index)throw new a("Index "+d+" is already in use.");try{this._addAttribute(b,d)}catch(f){throw new a(f.message)}}},d.prototype.removeAttribute=function(b){if(b){if(typeof b.index=="undefined")throw new a("Attribute must have an index.");var c=this._attributes;for(var d=0;d<c.length;++d)if(c[d].index===b.index)return c.splice(d,1),!0}return!1},d.prototype.getIndexBuffer=function(){return this._indexBuffer},d.prototype.setIndexBuffer=function(a){this._indexBuffer=a},d.prototype._bind=function(){var a=this._attributes,b=this._gl;for(var c=0;c<a.length;++c){var d=a[c];d.enabled&&d.vertexAttrib(b)}this._indexBuffer&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer._getBuffer())},d.prototype._unBind=function(){var a=this._attributes,b=this._gl;for(var c=0;c<a.length;++c){var d=a[c];d.enabled&&d.disableVertexAttribArray(b)}this._indexBuffer&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)},d.prototype._getNumberOfVertices=function(){if(this._attributes.length>0){var a=this._attributes[0],b=a.strideInBytes||a.componentsPerAttribute*a.componentDatatype.sizeInBytes;return a.vertexBuffer.getSizeInBytes()/b}return 0},d.prototype.isDestroyed=function(){return!1},d.prototype.destroy=function(){var a=this._attributes;for(var c=0;c<a.length;++c){var d=a[c].vertexBuffer;d&&!d.isDestroyed()&&d.getVertexArrayDestroyable()&&d.destroy()}var e=this._indexBuffer;return e&&e.getVertexArrayDestroyable()&&(this._indexBuffer=e.destroy()),b(this)},d}),c("Renderer/VertexArrayFacade",["../Core/DeveloperError","../Core/defaultValue","../Core/destroyObject","../Core/ComponentDatatype","./BufferUsage"],function(a,b,c,d,e){var f=function(b,c,d){function q(a,b){return b.componentDatatype.sizeInBytes-a.componentDatatype.sizeInBytes}if(!b)throw new a("context is required.");if(!c||c.length===0)throw new a("At least one attribute is required.");var g=f._verifyAttributes(c);d=d||0;var h={},i=[],j,k,l,m,n=g.length;for(var o=0;o<n;++o){var p=g[o];if(p.vertexBuffer){i.push(p);continue}l=p.purpose,j=h[l],typeof j=="undefined"&&(j=h[l]={}),m=p.usage.toString(),k=j[m],typeof k=="undefined"&&(k=j[m]=[]),k.push(p)}this._buffersByPurposeAndUsage={},this._allBuffers=[];for(l in h)if(h.hasOwnProperty(l)){j=h[l];var r=this._buffersByPurposeAndUsage[l];typeof r=="undefined"&&(r=this._buffersByPurposeAndUsage[l]={});for(m in j)if(j.hasOwnProperty(m)){k=j[m],k.sort(q);var s=f._vertexSizeInBytes(k),t;switch(m){case e.STATIC_DRAW.toString():t=e.STATIC_DRAW;break;case e.STREAM_DRAW.toString():t=e.STREAM_DRAW;break;case e.DYNAMIC_DRAW.toString():t=e.DYNAMIC_DRAW}var u={purpose:l,vertexSizeInBytes:s,vertexBuffer:undefined,usage:t,needsCommit:!1,arrayBuffer:undefined,arrayViews:f._createArrayViews(k,s)};r[m]=u,this._allBuffers.push(u)}}this._size=0,this._precreated=i,this._context=b,this.writers=undefined,this.vaByPurpose=undefined,this.resize(d)};f._verifyAttributes=function(c){var f=[];for(var g=0;g<c.length;++g){var h=c[g],i={index:typeof h.index=="undefined"?g:h.index,enabled:typeof h.enabled=="undefined"?!0:h.enabled,componentsPerAttribute:h.componentsPerAttribute,componentDatatype:h.componentDatatype||d.FLOAT,normalize:h.normalize||!1,purpose:b(h.purpose,"all"),vertexBuffer:h.vertexBuffer,usage:h.usage||e.STATIC_DRAW};f.push(i);if(i.componentsPerAttribute!==1&&i.componentsPerAttribute!==2&&i.componentsPerAttribute!==3&&i.componentsPerAttribute!==4)throw new a("attribute.componentsPerAttribute must be in the range [1, 4].");var j=i.componentDatatype;if(!d.validate(j))throw new a("Attribute must have a valid componentDatatype or not specify it.");if(!e.validate(i.usage))throw new a("Attribute must have a valid usage or not specify it.")}var k=new Array(f.length);for(var l=0;l<f.length;++l){var m=f[l],n=m.index,o=m.purpose;if(o!=="all"){var p=k[n];if(p===!0)throw new a("Index "+n+" is used by more than one attribute.");if(typeof p!="undefined"){if(p[o])throw new a("Index "+n+" is used by more than one attribute with the same purpose.")}else p=k[n]={};p[o]=!0}else{if(k[n])throw new a("Index "+n+" is used by more than one attribute.");k[n]=!0}}return f},f._vertexSizeInBytes=function(a){var b=0,c=a.length;for(var d=0;d<c;++d){var e=a[d];b+=e.componentsPerAttribute*e.componentDatatype.sizeInBytes}var f=c>0?a[0].componentDatatype.sizeInBytes:0,g=f>0?b%f:0,h=g===0?0:f-g;return b+=h,b},f._createArrayViews=function(a,b){var c=[],d=0,e=a.length;for(var f=0;f<e;++f){var g=a[f],h=g.componentDatatype;c.push({index:g.index,enabled:g.enabled,componentsPerAttribute:g.componentsPerAttribute,componentDatatype:h,normalize:g.normalize,offsetInBytes:d,vertexSizeInComponentType:b/h.sizeInBytes,view:undefined}),d+=g.componentsPerAttribute*h.sizeInBytes}return c},f.prototype.resize=function(a){this._size=a;var b=this._allBuffers;this.writers={};for(var c=0,d=b.length;c<d;++c){var e=b[c];f._resize(e,this._size);var g=this.writers[e.purpose];typeof g=="undefined"&&(g=this.writers[e.purpose]=[]),f._appendWriters(g,e)}this._destroyVA()},f._resize=function(a,b){if(a.vertexSizeInBytes>0){var c=new ArrayBuffer(b*a.vertexSizeInBytes);if(a.arrayBuffer){var d=new Uint8Array(c),e=new Uint8Array(a.arrayBuffer),f=e.length;for(var g=0;g<f;++g)d[g]=e[g]}var h=a.arrayViews,i=h.length;for(var j=0;j<i;++j){var k=h[j];k.view=k.componentDatatype.createArrayBufferView(c,k.offsetInBytes)}a.arrayBuffer=c}};var g=[function(a,b,c){return function(d,e){b[d*c]=e,a.needsCommit=!0}},function(a,b,c){return function(d,e,f){var g=d*c;b[g]=e,b[g+1]=f,a.needsCommit=!0}},function(a,b,c){return function(d,e,f,g){var h=d*c;b[h]=e,b[h+1]=f,b[h+2]=g,a.needsCommit=!0}},function(a,b,c){return function(d,e,f,g,h){var i=d*c;b[i]=e,b[i+1]=f,b[i+2]=g,b[i+3]=h,a.needsCommit=!0}}];return f._appendWriters=function(a,b){var c=b.arrayViews,d=c.length;for(var e=0;e<d;++e){var f=c[e];a[f.index]=g[f.componentsPerAttribute-1](b,f.view,f.vertexSizeInComponentType)}},f.prototype.commit=function(a){var b=!1,c=this._allBuffers,d;for(var e=0,g=c.length;e<g;++e)d=c[e],b=this._commit(d)||b;if(b||!this.va){var h=65536,i=this._buffersByPurposeAndUsage;this._destroyVA(),this.vaByPurpose={};for(var j in i)if(i.hasOwnProperty(j)){var k=i[j],l=[],m=Math.ceil(this._size/h);for(var n=0;n<m;++n){var o=[],p=i.all;if(p!==k)for(var q in p)if(p.hasOwnProperty(q)){var r=p[q];f._appendAttributes(o,r,n*r.vertexSizeInBytes*h)}for(var s in k)k.hasOwnProperty(s)&&(d=k[s],f._appendAttributes(o,d,n*d.vertexSizeInBytes*h));o=o.concat(this._precreated),l.push({va:this._context.createVertexArray(o,a),indicesCount:1.5*(n!==m-1?h:this._size%h)})}this.vaByPurpose[j]=l}}},f.prototype._commit=function(a){if(a.needsCommit&&a.vertexSizeInBytes>0){a.needsCommit=!1;var b=a.vertexBuffer,c=this._size*a.vertexSizeInBytes;if(!b||b.getSizeInBytes()<c)return b&&b.destroy(),a.vertexBuffer=this._context.createVertexBuffer(a.arrayBuffer,a.usage),a.vertexBuffer.setVertexArrayDestroyable(!1),!0;a.vertexBuffer.copyFromArrayView(a.arrayBuffer)}return!1},f._appendAttributes=function(a,b,c){var d=b.arrayViews,e=d.length;for(var f=0;f<e;++f){var g=d[f];a.push({index:g.index,enabled:g.enabled,componentsPerAttribute:g.componentsPerAttribute,componentDatatype:g.componentDatatype,normalize:g.normalize,vertexBuffer:b.vertexBuffer,offsetInBytes:c+g.offsetInBytes,strideInBytes:b.vertexSizeInBytes})}},f.prototype.subCommit=function(b,c){if(b<0||b>=this._size)throw new a("offsetInVertices must be greater than or equal to zero and less than the vertex array size.");if(b+c>this._size)throw new a("offsetInVertices + lengthInVertices cannot exceed the vertex array size.");var d=this._allBuffers;for(var e=0,f=d.length;e<f;++e)this._subCommit(d[e],b,c)},f.prototype._subCommit=function(a,b,c){if(a.needsCommit&&a.vertexSizeInBytes>0){var d=a.vertexSizeInBytes*b,e=a.vertexSizeInBytes*c;a.vertexBuffer.copyFromArrayView(new Uint8Array(a.arrayBuffer,d,e),d)}},f.prototype.endSubCommits=function(){var a=this._allBuffers;for(var b=0,c=a.length;b<c;++b)a[b].needsCommit=!1},f.prototype._destroyVA=function(){var a=this.vaByPurpose;if(typeof a=="undefined")return;for(var b in a)if(a.hasOwnProperty(b)){var c=a[b],d=c.length;for(var e=0;e<d;++e)c[e].va.destroy()}this.vaByPurpose=undefined},f.prototype.isDestroyed=function(){return!1},f.prototype.destroy=function(){var a=this._allBuffers;for(var b=0,d=a.length;b<d;++b){var e=a[b];e.vertexBuffer=e.vertexBuffer&&e.vertexBuffer.destroy()}return this._destroyVA(),c(this)},f}),c("Renderer/VertexLayout",["../Core/Enumeration"],function(a){var b={SEPARATE:new a(0,"SEPARATE"),INTERLEAVED:new a(1,"INTERLEAVED"),validate:function(a){return a===b.SEPARATE||a===b.INTERLEAVED}};return b}),c("Scene/BingMapsStyle",["../Core/Enumeration"],function(a){var b={AERIAL:new a(0,"AERIAL",{imagerySetName:"Aerial"}),AERIAL_WITH_LABELS:new a(1,"AERIAL_WITH_LABELS",{imagerySetName:"AerialWithLabels"}),ROAD:new a(2,"ROAD",{imagerySetName:"Road"}),ORDNANCE_SURVEY:new a(3,"ORDNANCE_SURVEY",{imagerySetName:"OrdnanceSurvey"}),COLLINS_BART:new a(4,"COLLINS_BART",{imagerySetName:"CollinsBart"})};return b}),c("Scene/CameraEventType",["../Core/Enumeration"],function(a){var b={LEFT_DRAG:new a(0,"LEFT_DRAG"),RIGHT_DRAG:new a(1,"RIGHT_DRAG"),MIDDLE_DRAG:new a(2,"MIDDLE_DRAG"),WHEEL:new a(3,"WHEEL")};return b}),c("Scene/CameraEventHandler",["../Core/DeveloperError","../Core/destroyObject","../Core/Math","../Core/EventHandler","../Core/MouseEventType","../Core/Cartesian2","./CameraEventType"],function(a,b,c,d,e,f,g){var h=function(b,h,i){if(typeof b=="undefined")throw new a("description.canvas is required.");if(typeof h=="undefined")throw new a("moveType is required.");this._eventHandler=new d(b),this._update=!0,this._movement=undefined,this._lastMovement=undefined,this._isDown=!1,this._pressTime=undefined,this._releaseTime=undefined;var j=this;if(h!==g.WHEEL){var k,l;if(h===g.LEFT_DRAG)k=e.LEFT_DOWN,l=e.LEFT_UP;else if(h===g.RIGHT_DRAG)k=e.RIGHT_DOWN,l=e.RIGHT_UP;else{if(h!==g.MIDDLE_DRAG)throw this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),new a("moveType must be of type CameraEventType.");k=e.MIDDLE_DOWN,l=e.MIDDLE_UP}this._eventHandler.setMouseAction(function(a){j._lastMovement=null,j._isDown=!0,j._pressTime=new Date},k,i),this._eventHandler.setMouseAction(function(a){j._isDown=!1,j._releaseTime=new Date},l,i),this._eventHandler.setMouseAction(function(a){j._isDown&&(j._update?(j._lastMovement=j._movement,j._movement=a,j._update=!1):j._movement.endPosition=a.endPosition.clone())},e.MOVE,i)}else this._eventHandler.setMouseAction(function(a){var b=2*c.toRadians(a);j._update?(j._movement={startPosition:new f(0,0),endPosition:new f(0,b),motion:new f(0,0)},j._lastMovement=j._movement,j._update=!1):j._movement.endPosition.y=j._movement.endPosition.y+b,j._pressTime=new Date,j._releaseTime=new Date(j._pressTime.getTime()+Math.abs(b)*5)},e.WHEEL,i)};return h.prototype.isMoving=function(){return!this._update},h.prototype.getMovement=function(){var a=this._movement;return this._update=!0,a},h.prototype.getLastMovement=function(){return this._lastMovement},h.prototype.isButtonDown=function(){return this._isDown},h.prototype.getButtonPressTime=function(){return this._pressTime},h.prototype.getButtonReleaseTime=function(){return this._releaseTime},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),b(this)},h}),c("Scene/CameraFlightController",["../Core/destroyObject","../Core/EventHandler","../Core/MouseEventType","../Core/Quaternion","../Core/Matrix3","../Core/Cartesian3","../Core/HermiteSpline"],function(a,b,c,d,e,f,g){var h=function(a,d,e,f,g,h){var i=e.getMaximumRadius(),j=d.frustum,k=j.near,l=j.near*Math.tan(.5*j.fovy),m=j.aspectRatio*l,n=i*k/m,o=i*k/l,p=Math.max(n,o),q=p-i;this._camera=d,this._start=new Date,this._end=new Date(this._start.getTime()+g*1e3),this._path=this._createPath(e,q,f,g),this._canceled=!1,this._complete=h;var r=this,s=function(){r._canceled=!0};this._handler=new b(a),this._handler.setMouseAction(s,c.LEFT_DOWN),this._handler.setMouseAction(s,c.RIGHT_DOWN),this._handler.setMouseAction(s,c.MIDDLE_DOWN)};return h.prototype._createPath=function(a,b,c,f){var h=this._camera.position,i=a.getMaximumRadius()+b,j=h.normalize().dot(c.normalize()),k,l,m=h.magnitude()>i;m?(k=.6,l=.35):(k=Math.max(.1,1-Math.abs(j)),l=.5),i=a.getMaximumRadius()+k*b;var n=c.normalize().multiplyByScalar(i),o=h.normalize().multiplyByScalar(i),p,q,r,s;if(h.magnitude()>i&&j>0){var t=h.subtract(n).multiplyByScalar(.5).add(n);p=[{point:h},{point:t},{point:n},{point:c}]}else{p=[{point:h}],r=Math.acos(o.normalize().dot(n.normalize())),q=o.cross(n);var u=l*r,v=m?r-u:r;for(var w=v;w>0;w-=u)s=e.fromQuaternion(d.fromAxisAngle(q,w)),p.push({point:s.multiplyByVector(n)});p.push({point:n},{point:c})}var x=f/(p.length-1);for(var y=0;y<p.length;++y)p[y].time=y*x;return new g(p)},h.prototype.update=function(){var a=new Date,b,c,d,e,g,h=a.getTime()>this._end.getTime()?this._end:a;b=(h.getTime()-this._start.getTime())/1e3,c=this._path.evaluate(b),d=f.UNIT_Z.cross(c).normalize(),e=c.cross(d).normalize(),g=f.ZERO,this._camera.lookAt(c,g,e);var i=h===this._end||this._canceled;return i&&!this._canceled&&typeof this._complete!="undefined"&&this._complete(),!i},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this._handler.destroy(),a(this)},h}),c("Scene/CameraHelpers",["../Core/Math","../Core/Cartesian2"],function(a,b){function c(a,b,c){var d=a.position,e=d.add(b.multiplyByScalar(c));a.position=e}function d(a,b){if(a<0)return 0;var c=(1-b)*25;return Math.exp(-c*a)}function e(b){return b.startPosition.equalsEpsilon(b.endPosition,a.EPSILON14)}function h(a,c,h,i,j){var k=a.getButtonPressTime(),l=a.getButtonReleaseTime(),m=k&&l&&(l.getTime()-k.getTime())/1e3,n=new Date,o=l&&(n.getTime()-l.getTime())/1e3;if(k&&l&&m<f&&o<=g){var p=d(o,c);if(!i[j]){var q=a.getLastMovement();if(!q||e(q))return;var r=(q.endPosition.x-q.startPosition.x)*.5,s=(q.endPosition.y-q.startPosition.y)*.5;i[j]={startPosition:new b(q.startPosition.x,q.startPosition.y),endPosition:new b(q.startPosition.x+r*p,q.startPosition.y+s*p),motion:new b(r,s)}}else i[j]={startPosition:i[j].endPosition.clone(),endPosition:new b(i[j].endPosition.x+i[j].motion.x*p,i[j].endPosition.y+i[j].motion.y*p),motion:new b(0,0)};if(isNaN(i[j].endPosition.x)||isNaN(i[j].endPosition.y)||e(i[j])){i[j]=undefined;return}a.isButtonDown()||h.apply(i,[i[j]])}else i[j]=undefined}function j(a,b,c){var d=a._zoomFactor*(c-i);d>a._maximumZoomRate&&(d=a._maximumZoomRate);var e=b.endPosition.y-b.startPosition.y;if(e===0)return;var f=e/a._canvas.clientHeight,g=d*f;if(g>0&&Math.abs(c-i)<1)return;c-g<i&&(g=c-i-1),g>0?a.zoomIn(g):a.zoomOut(-g)}function k(a,b){c(a,a.direction,b)}var f=.4,g=2,i=20;return{move:c,maxHeight:i,handleZoom:j,maintainInertia:h,zoom:k}}),c("Scene/CameraFreeLookController",["../Core/destroyObject","../Core/Math","../Core/EventModifier","../Core/Quaternion","../Core/Cartesian2","../Core/Cartesian3","../Core/Matrix3","./CameraEventHandler","./CameraEventType","./CameraHelpers"],function(a,b,c,d,e,f,g,h,i,j){var k=j.move,l=function(a,b){this._canvas=a,this._camera=b,this._handler=new h(a,i.LEFT_DRAG,c.SHIFT),this._maximumMoveRate=2e6,this._minimumMoveRate=2e-4,this._maximumTurnRate=Math.PI/8,this._minimumTurnRate=Math.PI/120,this._moveRate=1e5,this._turnRate=Math.PI/60,this.horizontalRotationAxis=undefined};return l.prototype.moveForward=function(a){k(this._camera,this._camera.direction,a||this._moveRate)},l.prototype.moveBackward=function(a){k(this._camera,this._camera.direction,-a||-this._moveRate)},l.prototype.moveUp=function(a){k(this._camera,this._camera.up,a||this._moveRate)},l.prototype.moveDown=function(a){k(this._camera,this._camera.up,-a||-this._moveRate)},l.prototype.moveRight=function(a){k(this._camera,this._camera.right,a||this._moveRate)},l.prototype.moveLeft=function(a){k(this._camera,this._camera.right,-a||-this._moveRate)},l.prototype.lookLeft=function(a){this.lookRight(-a||-this._turnRate)},l.prototype.lookRight=function(a){var b=a||this._turnRate,c=this._rotateTwoAxes(this._camera.direction,this._camera.right,this._camera.up,b);this._camera.direction=c[0],this._camera.right=c[1]},l.prototype.lookUp=function(a){this.lookDown(-a||-this._turnRate)},l.prototype.lookDown=function(a){var b=a||this._turnRate,c=this._rotateTwoAxes(this._camera.direction,this._camera.up,this._camera.right,b);this._camera.direction=c[0],this._camera.up=c[1]},l.prototype._rotateTwoAxes=function(a,b,c,e){var f=g.fromQuaternion(d.fromAxisAngle(c,e)),h=f.multiplyByVector(a),i=f.multiplyByVector(b);return[h,i]},l.prototype.rotate=function(a,b){var c=f.clone(a),e=b||this._moveRate,h=g.fromQuaternion(d.fromAxisAngle(c,e)),i=h.multiplyByVector(this._camera.direction),j=h.multiplyByVector(this._camera.up),k=h.multiplyByVector(this._camera.right);this._camera.direction=i,this._camera.up=j,this._camera.right=k},l.prototype.update=function(a){return this._handler.isMoving()&&this._look(this._handler.getMovement()),!0},l.prototype._look=function(a){var c=this._camera,h=this._canvas.clientWidth,i=this._canvas.clientHeight,j=Math.tan(c.frustum.fovy*.5),k=c.frustum.aspectRatio*j,l=c.frustum.near,m=new e(2/h*a.startPosition.x-1,2/i*(i-a.startPosition.y)-1),n=new e(2/h*a.endPosition.x-1,2/i*(i-a.endPosition.y)-1),o=c.position.add(c.direction.multiplyByScalar(l)),p=c.right.multiplyByScalar(m.x*l*k);p=o.add(p).subtract(c.position).normalize();var q=c.right.multiplyByScalar(n.x*l*k);q=o.add(q).subtract(c.position).normalize();var r=p.dot(q),s=0,t=typeof this.horizontalRotationAxis!="undefined"?this.horizontalRotationAxis:c.up;t=a.startPosition.x>a.endPosition.x?t:t.negate(),t=t.normalize(),r<1&&(s=Math.acos(r));var u=g.fromQuaternion(d.fromAxisAngle(t,s));1-Math.abs(c.direction.dot(t))>b.EPSILON6&&(c.direction=u.multiplyByVector(c.direction)),1-Math.abs(c.up.dot(t))>b.EPSILON6&&(c.up=u.multiplyByVector(c.up));var v=c.up.multiplyByScalar(m.y*l*j);v=o.add(v).subtract(c.position).normalize();var w=c.up.multiplyByScalar(n.y*l*j);w=o.add(w).subtract(c.position).normalize(),r=v.dot(w),s=0,t=v.cross(w),r<1&&!t.equalsEpsilon(f.ZERO,b.EPSILON14)?s=Math.acos(r):t=f.UNIT_X,u=g.fromQuaternion(d.fromAxisAngle(t,s)),1-Math.abs(c.direction.dot(t))>b.EPSILON6&&(c.direction=u.multiplyByVector(c.direction)),1-Math.abs(c.up.dot(t))>b.EPSILON6&&(c.up=u.multiplyByVector(c.up)),c.right=c.direction.cross(c.up)},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return this._handler=this._handler&&this._handler.destroy(),a(this)},l}),c("Scene/CameraSpindleControllerMode",["../Core/Enumeration"],function(a){var b={ROTATE:new a(0,"ROTATE"),PAN:new a(1,"PAN"),AUTO:new a(2,"AUTO")};return b}),c("Scene/CameraSpindleController",["../Core/destroyObject","../Core/FAR","../Core/Math","../Core/Quaternion","../Core/Matrix3","../Core/Ellipsoid","../Core/Cartesian3","../Core/Cartesian4","./CameraEventHandler","./CameraEventType","./CameraSpindleControllerMode","./CameraHelpers"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=l.handleZoom,n=l.maintainInertia,o=l.zoom,p=function(a,c,d){d=d||f.WGS84,this._canvas=a,this._camera=c,this._ellipsoid=d,this._zoomRate=1e5,this._moveRate=Math.PI/3600,this.inertiaSpin=.9,this.inertiaZoom=.8,this.constrainedAxis=undefined,this.mode=k.AUTO;var e=this._ellipsoid.getMaximumRadius();this._zoomFactor=5,this._minimumZoomRate=20,this._maximumZoomRate=b,this._rotateFactor=1/e,this._rotateRateRangeAdjustment=e,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._spinHandler=new i(a,j.LEFT_DRAG),this._zoomHandler=new i(a,j.RIGHT_DRAG),this._zoomWheel=new i(a,j.WHEEL),this._lastInertiaSpinMovement=undefined,this._lastInertiaZoomMovement=undefined,this._lastInertiaWheelZoomMovement=undefined};return p.prototype.setReferenceFrame=function(a,b){this._camera.transform=a,this.setEllipsoid(b)},p.prototype.getEllipsoid=function(){return this._ellipsoid},p.prototype.setEllipsoid=function(a){a=a||f.WGS84;var b=a.getMaximumRadius();this._ellipsoid=a,this._rotateFactor=1/b,this._rotateRateRangeAdjustment=b},p.prototype.rotate=function(a,b){var c=g.clone(a),f=typeof b!="undefined"?b:this._moveRate,h=e.fromQuaternion(d.fromAxisAngle(c,f)),i=this._camera;i.position=h.multiplyByVector(i.position),i.direction=h.multiplyByVector(i.direction),i.up=h.multiplyByVector(i.up),i.right=i.direction.cross(i.up)},p.prototype.moveDown=function(a){a=typeof a!="undefined"?a:this._moveRate,this._moveVertical(a)},p.prototype.moveUp=function(a){a=typeof a!="undefined"?-a:-this._moveRate,this._moveVertical(a)},p.prototype._moveVertical=function(a){var b=this._camera,d=b.position,e=g.normalize(d);if(typeof this.constrainedAxis!="undefined"){var f=e.equalsEpsilon(this.constrainedAxis,c.EPSILON2),h=e.equalsEpsilon(this.constrainedAxis.negate(),c.EPSILON2);if(!f&&!h){var i=g.normalize(this.constrainedAxis),j=e.dot(i),k=Math.acos(j);a>0&&a>k&&(a=k),j=e.dot(i.negate()),k=Math.acos(j),a<0&&-a>k&&(a=-k);var l=g.cross(i,e);this.rotate(l,a)}else(f&&a<0||h&&a>0)&&this.rotate(b.right,a)}else this.rotate(b.right,a)},p.prototype.moveRight=function(a){a=typeof a!="undefined"?-a:-this._moveRate,this._moveHorizontal(a)},p.prototype.moveLeft=function(a){a=typeof a!="undefined"?a:this._moveRate,this._moveHorizontal(a)},p.prototype._moveHorizontal=function(a){typeof this.constrainedAxis!="undefined"?this.rotate(this.constrainedAxis.normalize(),a):this.rotate(this._camera.up,a)},p.prototype.zoomIn=function(a){o(this._camera,typeof a!="undefined"?a:this._zoomRate)},p.prototype.zoomOut=function(a){o(this._camera,typeof a!="undefined"?-a:-this._zoomRate)},p.prototype.update=function(){var a=this._spinHandler,b=this._zoomHandler,c=this._zoomWheel,d=a&&a.isMoving()&&a.getMovement(),e=b&&b.isMoving(),f=c&&c.isMoving();return d&&this._spin(a.getMovement()),a&&!d&&this.inertiaSpin<1&&n(a,this.inertiaSpin,this._spin,this,"_lastInertiaSpinMovement"),e?this._zoom(b.getMovement()):f&&this._zoom(c.getMovement()),b&&!e&&this.inertiaZoom<1&&n(b,this.inertiaZoom,this._zoom,this,"_lastInertiaZoomMovement"),c&&!f&&this.inertiaZoom<1&&n(c,this.inertiaZoom,this._zoom,this,"_lastInertiaWheelZoomMovement"),!0},p.prototype._spin=function(a){this.mode===k.AUTO?typeof this._camera.pickEllipsoid(a.startPosition,this._ellipsoid)!="undefined"?this._pan(a):this._rotate(a):this.mode===k.ROTATE?this._rotate(a):this._pan(a)},p.prototype._rotate=function(a){var b=this._camera.position,c=b.magnitude(),d=this._rotateFactor*(c-this._rotateRateRangeAdjustment);d>this._maximumRotateRate&&(d=this._maximumRotateRate),d<this._minimumRotateRate&&(d=this._minimumRotateRate);var e=(a.endPosition.x-a.startPosition.x)/this._canvas.clientWidth,f=(a.endPosition.y-a.startPosition.y)/this._canvas.clientHeight,g=d*e*Math.PI*2,h=d*f*Math.PI;this._moveHorizontal(g),this._moveVertical(h)},p.prototype._pan=function(a){var b=this._camera,d=b.pickEllipsoid(a.startPosition,this._ellipsoid),e=b.pickEllipsoid(a.endPosition,this._ellipsoid);if(typeof d=="undefined"||typeof e=="undefined")return;var f=b.getInverseTransform();d=g.fromCartesian4(f.multiplyByPoint(d)),e=g.fromCartesian4(f.multiplyByPoint(e));if(typeof this.constrainedAxis=="undefined"){d=d.normalize(),e=e.normalize();var h=d.dot(e),i=d.cross(e);if(h<1&&!i.equalsEpsilon(g.ZERO,c.EPSILON14)){var j=Math.acos(h);this.rotate(i,j)}}else{var k=d.magnitude(),l=Math.atan2(d.y,d.x),m=Math.acos(d.z/k),n=e.magnitude(),o=Math.atan2(e.y,e.x),p=Math.acos(e.z/n),q=o-l,r=p-m,s=Math.acos(b.position.z/b.position.magnitude())+r;if(s<0||s>Math.PI)r=0;this._moveHorizontal(q),this._moveVertical(r)}},p.prototype._zoom=function(a){m(this,a,this._ellipsoid.cartesianToCartographic(this._camera.position).height)},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){return this._spinHandler=this._spinHandler&&this._spinHandler.destroy(),this._zoomHandler=this._zoomHandler&&this._zoomHandler.destroy(),this._zoomWheel=this._zoomWheel&&this._zoomWheel.destroy(),a(this)},p}),c("Scene/CameraCentralBodyController",["../Core/destroyObject","../Core/Ellipsoid","../Core/Cartesian3","../Core/Cartesian4","../Core/IntersectionTests","../Core/Math","../Core/Matrix4","../Core/Ray","../Core/Transforms","./CameraEventHandler","./CameraEventType","./CameraSpindleController","./CameraFreeLookController","./CameraHelpers"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=n.maxHeight,p=function(a,b,c){this._canvas=a,this._camera=b,this._rotateHandler=new j(a,k.MIDDLE_DRAG),this.spindleController=new l(a,b,c),this.freeLookController=new m(a,b)};return p.prototype.update=function(){var a=this._rotateHandler,b=a.isMoving()&&a.getMovement();return b&&this._rotate(a.getMovement()),this.spindleController.update(),this.freeLookController.update(),!0},p.prototype._rotate=function(a){var g=this._camera,j=this.spindleController.getEllipsoid(),k=g.position;if(j.cartesianToCartographic(k).height-o-1<f.EPSILON3&&a.endPosition.y-a.startPosition.y<0)return;var l=g.up,m=g.right,n=g.direction,p=g.transform,q=this.spindleController.getEllipsoid(),r=this.spindleController.constrainedAxis,s=new h(this._camera.getPositionWC(),this._camera.getDirectionWC()),t=e.rayEllipsoid(s,this.spindleController.getEllipsoid());if(typeof t=="undefined")return;var u=s.getPoint(t.start);u=c.fromCartesian4(g.getInverseTransform().multiplyByPoint(u));var v=i.eastNorthUpToFixedFrame(u),w=v.multiply(p);this.spindleController.constrainedAxis=c.UNIT_Z,this.spindleController.setReferenceFrame(w,b.UNIT_SPHERE);var x=g.getInverseTransform();g.position=c.fromCartesian4(x.multiplyByPoint(k)),g.up=c.fromCartesian4(x.multiplyByVector(new d(l.x,l.y,l.z,0))),g.right=c.fromCartesian4(x.multiplyByVector(new d(m.x,m.y,m.z,0))),g.direction=c.fromCartesian4(x.multiplyByVector(new d(n.x,n.y,n.z,0))),this.spindleController._rotate(a),k=g.position,l=g.up,m=g.right,n=g.direction,this.spindleController.constrainedAxis=r,this.spindleController.setReferenceFrame(p,q),g.position=c.fromCartesian4(w.multiplyByPoint(k)),g.up=c.fromCartesian4(w.multiplyByVector(new d(l.x,l.y,l.z,0))),g.right=c.fromCartesian4(w.multiplyByVector(new d(m.x,m.y,m.z,0))),g.direction=c.fromCartesian4(w.multiplyByVector(new d(n.x,n.y,n.z,0))),k=j.cartesianToCartographic(g.position),k.height<o+1&&(k.height=o+1,g.position=j.cartographicToCartesian(k),g.direction=c.fromCartesian4(w.getColumn(3).subtract(g.position)).normalize(),g.right=g.position.negate().cross(g.direction).normalize(),g.up=g.right.cross(g.direction))},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){return this._rotateHandler=this._rotateHandler&&this._rotateHandler.destroy(),this.spindleController=this.spindleController&&this.spindleController.destroy(),this.freeLookController=this.freeLookController&&this.freeLookController.destroy(),a(this)},p}),c("Scene/CentralBodySurfaceShaderSet",["../Core/destroyObject"],function(a){function b(a){this.baseVertexShaderString=undefined,this.baseFragmentShaderString=undefined,this._attributeIndices=a,this._shadersByTextureCount=[]}return b.prototype.invalidateShaders=function(){var a=this._shadersByTextureCount;for(var b=0,c=a.length;b<c;++b){var d=a[b];typeof d!="undefined"&&d.release()}this._shadersByTextureCount=[]},b.prototype.getShaderProgram=function(a,b){var c=this._shadersByTextureCount[b];if(typeof c=="undefined"){var d=this.baseVertexShaderString,e="#define TEXTURE_UNITS "+b+"\n"+this.baseFragmentShaderString+"vec3 computeDayColor(vec3 initialColor, vec2 textureCoordinates)\n"+"{\n"+"    vec3 color = initialColor;\n";for(var f=0;f<b;++f)e+="color = sampleAndBlend(\n   color,\n   u_dayTextures["+f+"],\n"+"   textureCoordinates,\n"+"   u_dayTextureTexCoordsExtent["+f+"],\n"+"   u_dayTextureTranslationAndScale["+f+"],\n"+"   u_dayTextureAlpha["+f+"],\n"+"   u_dayTextureBrightness["+f+"],\n"+"   u_dayTextureContrast["+f+"],\n"+"   u_dayTextureOneOverGamma["+f+"]);\n";e+="    return color;\n}",c=a.getShaderCache().getShaderProgram(d,e,this._attributeIndices),this._shadersByTextureCount[b]=c}return c},b.prototype.destroy=function(){var b=this._shadersByTextureCount;for(var c=0,d=b.length;c<d;++c){var e=b[c];typeof e!="undefined"&&e.release()}return a(this)},b}),c("Scene/CompositePrimitive",["../Core/createGuid","../Core/destroyObject","../Core/DeveloperError"],function(a,b,c){var d=function(){this._centralBody=undefined,this._primitives=[],this._guid=a(),this.destroyPrimitives=!0,this.show=!0};return d.prototype.getCentralBody=function(){return this._centralBody},d.prototype.setCentralBody=function(a){this._centralBody=this.destroyPrimitives&&this._centralBody&&this._centralBody.destroy(),this._centralBody=a},d.prototype.add=function(a){if(typeof a=="undefined")throw new c("primitive is required.");var b=a._external=a._external||{},d=b._composites=b._composites||{};d[this._guid]={composite:this},this._primitives.push(a)},d.prototype.remove=function(a){if(this.contains(a)){var b=this._primitives.indexOf(a);if(b!==-1)return this._primitives.splice(b,1),delete a._external._composites[this._guid],this.destroyPrimitives&&a.destroy(),!0}return!1},d.prototype.removeAll=function(){if(this.destroyPrimitives){var a=this._primitives,b=a.length;for(var c=0;c<b;++c)a[c].destroy()}this._primitives=[]},d.prototype.contains=function(a){return!!(a&&a._external&&a._external._composites&&a._external._composites[this._guid])},d.prototype._getPrimitiveIndex=function(a){if(!this.contains(a))throw new c("primitive is not in this composite.");return this._primitives.indexOf(a)},d.prototype.raise=function(a){if(typeof a!="undefined"){var b=this._getPrimitiveIndex(a),c=this._primitives;if(b!==c.length-1){var d=c[b];c[b]=c[b+1],c[b+1]=d}}},d.prototype.raiseToTop=function(a){if(typeof a!="undefined"){var b=this._getPrimitiveIndex(a),c=this._primitives;b!==c.length-1&&(c.splice(b,1),c.push(a))}},d.prototype.lower=function(a){if(typeof a!="undefined"){var b=this._getPrimitiveIndex(a),c=this._primitives;if(b!==0){var d=c[b];c[b]=c[b-1],c[b-1]=d}}},d.prototype.lowerToBottom=function(a){if(typeof a!="undefined"){var b=this._getPrimitiveIndex(a),c=this._primitives;b!==0&&(c.splice(b,1),c.unshift(a))}},d.prototype.get=function(a){if(typeof a=="undefined")throw new c("index is required.");return this._primitives[a]},d.prototype.getLength=function(){return this._primitives.length},d.prototype.update=function(a,b,c){if(!this.show)return;this._centralBody&&this._centralBody.update(a,b,c);var d=this._primitives,e=d.length;for(var f=0;f<e;++f){var g=d[f];g.update(a,b,c)}},d.prototype.isDestroyed=function(){return!1},d.prototype.destroy=function(){return this.removeAll(),this._centralBody=this.destroyPrimitives&&this._centralBody&&this._centralBody.destroy(),b(this)},d}),c("Scene/CullingVolume",["../Core/defaultValue","../Core/DeveloperError","../Core/Intersect"],function(a,b,c){var d=function(b){this.planes=a(b,[])};return d.prototype.getVisibility=function(a){if(typeof a=="undefined")throw new b("boundingVolume is required.");var d=this.planes,e=!1;for(var f=0,g=d.length;f<g;++f){var h=a.intersect(d[f]);if(h===c.OUTSIDE)return c.OUTSIDE;h===c.INTERSECTING&&(e=!0)}return e?c.INTERSECTING:c.INSIDE},d}),c("Scene/FrameState",[],function(){var a=function(){this.mode=undefined,this.morphTime=undefined,this.frameNumber=undefined,this.time=undefined,this.scene2D={projection:undefined},this.camera=undefined,this.cullingVolume=undefined,this.occluder=undefined,this.passes={color:!1,pick:!1,overlay:!1}};return a}),c("Scene/FrustumCommands",["../Core/defaultValue"],function(a){var b=function(b,c){this.near=a(b,0),this.far=a(c,0),this.commands=[]};return b}),c("Scene/HorizontalOrigin",["../Core/Enumeration"],function(a){var b={CENTER:new a(0,"CENTER"),LEFT:new a(1,"LEFT"),RIGHT:new a(-1,"RIGHT")};return b}),c("DynamicScene/CzmlHorizontalOrigin",["../Scene/HorizontalOrigin"],function(a){var b={unwrapInterval:function(a){var b=a.horizontalOrigin;return typeof b=="undefined"?a:b},isSampled:function(){return!1},getValue:function(b){return a[b]}};return b}),c("Scene/ImageryState",["../Core/Enumeration"],function(a){var b={UNLOADED:new a(0,"UNLOADED"),TRANSITIONING:new a(1,"TRANSITIONING"),RECEIVED:new a(2,"RECEIVED"),TEXTURE_LOADED:new a(3,"TEXTURE_LOADED"),READY:new a(4,"READY"),FAILED:new a(5,"FAILED"),INVALID:new a(6,"INVALID"),PLACEHOLDER:new a(7,"PLACEHOLDER")};return b}),c("Scene/Imagery",["../Core/destroyObject","./ImageryState"],function(a,b){var c=function(a,c,d,e,f){this.imageryLayer=a,this.x=c,this.y=d,this.level=e;if(e!==0){var g=c/2|0,h=d/2|0,i=e-1;this.parent=a.getImageryFromCache(g,h,i)}this.state=b.UNLOADED,this.imageUrl=undefined,this.image=undefined,this.texture=undefined,this.referenceCount=0;if(typeof f=="undefined"&&a.getImageryProvider().isReady()){var j=a.getImageryProvider().getTilingScheme();f=j.tileXYToExtent(c,d,e)}this.extent=f};return c.createPlaceholder=function(a){var d=new c(a,0,0,0);return d.addReference(),d.state=b.PLACEHOLDER,d},c.prototype.addReference=function(){++this.referenceCount},c.prototype.releaseReference=function(){return--this.referenceCount,this.referenceCount===0?(this.imageryLayer.removeImageryFromCache(this),typeof this.parent!="undefined"&&this.parent.releaseReference(),typeof this.image!="undefined"&&typeof this.image.destroy!="undefined"&&this.image.destroy(),typeof this.transformedImage!="undefined"&&typeof this.transformedImage.destroy!="undefined"&&this.transformedImage.destroy(),typeof this.texture!="undefined"&&typeof this.texture.destroy!="undefined"&&this.texture.destroy(),a(this),0):this.referenceCount},c}),c("Scene/LabelStyle",["../Core/Enumeration"],function(a){var b={FILL:new a(0,"FILL"),OUTLINE:new a(1,"OUTLINE"),FILL_AND_OUTLINE:new a(2,"FILL_AND_OUTLINE")};return b}),c("DynamicScene/CzmlLabelStyle",["../Scene/LabelStyle"],function(a){var b={unwrapInterval:function(a){var b=a.labelStyle;return typeof b=="undefined"?a:b},isSampled:function(){return!1},getValue:function(b){return a[b]}};return b}),c("Scene/NeverTileDiscardPolicy",[],function(){var a=function(a){};return a.prototype.isReady=function(){return!0},a.prototype.shouldDiscardImage=function(a){return!1},a}),c("Scene/OrthographicFrustum",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Matrix4","../Scene/CullingVolume"],function(a,b,c,d,e,f,g){function i(b){if(typeof b.right=="undefined"||typeof b.left=="undefined"||typeof b.top=="undefined"||typeof b.bottom=="undefined"||typeof b.near=="undefined"||typeof b.far=="undefined")throw new a("right, left, top, bottom, near, or far parameters are not set.");if(b.top!==b._top||b.bottom!==b._bottom||b.left!==b._left||b.right!==b._right||b.near!==b._near||b.far!==b._far){if(b.left>b.right)throw new a("right must be greater than left.");if(b.bottom>b.top)throw new a("top must be greater than bottom.");if(b.near<=0||b.near>b.far)throw new a("near must be greater than zero and less than far.");b._left=b.left,b._right=b.right,b._top=b.top,b._bottom=b.bottom,b._near=b.near,b._far=b.far,b._orthographicMatrix=f.computeOrthographicOffCenter(b.left,b.right,b.bottom,b.top,b.near,b.far)}}var h=function(){this.left=undefined,this._left=undefined,this.right=undefined,this._right=undefined,this.top=undefined,this._top=undefined,this.bottom=undefined,this._bottom=undefined,this.near=1,this._near=this.near,this.far=5e8,this._far=this.far,this._cullingVolume=new g,this._orthographicMatrix=undefined};h.prototype.getProjectionMatrix=function(){return i(this),this._orthographicMatrix};var j=new d,k=new d,l=new d;return h.prototype.computeCullingVolume=function(b,c,f){if(typeof b=="undefined")throw new a("position is required.");if(typeof c=="undefined")throw new a("direction is required.");if(typeof f=="undefined")throw new a("up is required.");var g=this._cullingVolume.planes,h=this.top,i=this.bottom,m=this.right,n=this.left,o=this.near,p=this.far,q=d.cross(c,f,j),r=k;d.multiplyByScalar(c,o,r),d.add(b,r,r);var s=l;d.multiplyByScalar(q,n,s),d.add(r,s,s);var t=g[0];return typeof t=="undefined"&&(t=g[0]=new e),t.x=q.x,t.y=q.y,t.z=q.z,t.w=-d.dot(q,s),d.multiplyByScalar(q,m,s),d.add(r,s,s),t=g[1],typeof t=="undefined"&&(t=g[1]=new e),t.x=-q.x,t.y=-q.y,t.z=-q.z,t.w=-d.dot(q.negate(),s),d.multiplyByScalar(f,i,s),d.add(r,s,s),t=g[2],typeof t=="undefined"&&(t=g[2]=new e),t.x=f.x,t.y=f.y,t.z=f.z,t.w=-d.dot(f,s),d.multiplyByScalar(f,h,s),d.add(r,s,s),t=g[3],typeof t=="undefined"&&(t=g[3]=new e),t.x=-f.x,t.y=-f.y,t.z=-f.z,t.w=-d.dot(f.negate(),s),t=g[4],typeof t=="undefined"&&(t=g[4]=new e),t.x=c.x,t.y=c.y,t.z=c.z,t.w=-d.dot(c,r),d.multiplyByScalar(c,p,s),d.add(b,s,s),t=g[5],typeof t=="undefined"&&(t=g[5]=new e),t.x=-c.x,t.y=-c.y,t.z=-c.z,t.w=-d.dot(c.negate(),s),this._cullingVolume},h.prototype.getPixelSize=function(b){i(this);if(typeof b=="undefined")throw new a("canvasDimensions is required.");var d=b.x,e=b.y;if(d<=0)throw new a("canvasDimensions.x must be grater than zero.");if(e<=0)throw new a("canvasDimensions.y must be grater than zero.");var f=this.right-this.left,g=this.top-this.bottom,h=f/d,j=g/e;return new c(h,j)},h.prototype.clone=function(){var a=new h;return a.left=this.left,a.right=this.right,a.top=this.top,a.bottom=this.bottom,a.near=this.near,a.far=this.far,a},h.prototype.equals=function(a){return typeof a!="undefined"&&this.right===a.right&&this.left===a.left&&this.top===a.top&&this.bottom===a.bottom&&this.near===a.near&&this.far===a.far},h}),c("Scene/PerspectiveOffCenterFrustum",["../Core/DeveloperError","../Core/defaultValue","../Core/destroyObject","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Matrix4","../Scene/CullingVolume"],function(a,b,c,d,e,f,g,h){function j(b){if(typeof b.right=="undefined"||typeof b.left=="undefined"||typeof b.top=="undefined"||typeof b.bottom=="undefined"||typeof b.near==" undefined"||typeof b.far=="undefined")throw new a("right, left, top, bottom, near, or far parameters are not set.");var c=b.top,d=b.bottom,e=b.right,f=b.left,h=b.near,i=b.far;if(c!==b._top||d!==b._bottom||f!==b._left||e!==b._right||h!==b._near||i!==b._far){if(b.near<=0||b.near>b.far)throw new a("near must be greater than zero and less than far.");b._left=f,b._right=e,b._top=c,b._bottom=d,b._near=h,b._far=i,b._perspectiveMatrix=g.computePerspectiveOffCenter(f,e,d,c,h,i),b._infinitePerspective=g.computeInfinitePerspectiveOffCenter(f,e,d,c,h)}}var i=function(){this.left=undefined,this._left=undefined,this.right=undefined,this._right=undefined,this.top=undefined,this._top=undefined,this.bottom=undefined,this._bottom=undefined,this.near=1,this._near=this.near,this.far=5e8,this._far=this.far,this._cullingVolume=new h,this._perspectiveMatrix=undefined,this._infinitePerspective=undefined};i.prototype.getProjectionMatrix=function(){return j(this),this._perspectiveMatrix},i.prototype.getInfiniteProjectionMatrix=function(){return j(this),this._infinitePerspective};var k=new e,l=new e,m=new e,n=new e;return i.prototype.computeCullingVolume=function(b,c,d){if(typeof b=="undefined")throw new a("position is required.");if(typeof c=="undefined")throw new a("direction is required.");if(typeof d=="undefined")throw new a("up is required.");var g=this._cullingVolume.planes,h=this.top,i=this.bottom,j=this.right,o=this.left,p=this.near,q=this.far,r=e.cross(c,d,k),s=l;e.multiplyByScalar(c,p,s),e.add(b,s,s);var t=m;e.multiplyByScalar(c,q,t),e.add(b,t,t);var u=n;e.multiplyByScalar(r,o,u),e.add(s,u,u),e.subtract(u,b,u),e.normalize(u,u),e.cross(u,d,u);var v=g[0];return typeof v=="undefined"&&(v=g[0]=new f),v.x=u.x,v.y=u.y,v.z=u.z,v.w=-e.dot(u,b),e.multiplyByScalar(r,j,u),e.add(s,u,u),e.subtract(u,b,u),e.normalize(u,u),e.cross(d,u,u),v=g[1],typeof v=="undefined"&&(v=g[1]=new f),v.x=u.x,v.y=u.y,v.z=u.z,v.w=-e.dot(u,b),e.multiplyByScalar(d,i,u),e.add(s,u,u),e.subtract(u,b,u),e.normalize(u,u),e.cross(r,u,u),v=g[2],typeof v=="undefined"&&(v=g[2]=new f),v.x=u.x,v.y=u.y,v.z=u.z,v.w=-e.dot(u,b),e.multiplyByScalar(d,h,u),e.add(s,u,u),e.subtract(u,b,u),e.normalize(u,u),e.cross(u,r,u),v=g[3],typeof v=="undefined"&&(v=g[3]=new f),v.x=u.x,v.y=u.y,v.z=u.z,v.w=-e.dot(u,b),v=g[4],typeof v=="undefined"&&(v=g[4]=new f),v.x=c.x,v.y=c.y,v.z=c.z,v.w=-e.dot(c,s),e.negate(c,u),v=g[5],typeof v=="undefined"&&(v=g[5]=new f),v.x=u.x,v.y=u.y,v.z=u.z,v.w=-e.dot(u,t),this._cullingVolume},i.prototype.getPixelSize=function(c,e){j(this);if(typeof c=="undefined")throw new a("canvasDimensions is required.");var f=c.x,g=c.y;if(f<=0)throw new a("canvasDimensions.x must be grater than zero.");if(g<=0)throw new a("canvasDimensions.y must be grater than zero.");e=b(e,this.near);var h=1/this.near,i=this.top*h,k=2*e*i/g;i=this.right*h;var l=2*e*i/f;return new d(l,k)},i.prototype.clone=function(){var a=new i;return a.right=this.right,a.left=this.left,a.top=this.top,a.bottom=this.bottom,a.near=this.near,a.far=this.far,a},i.prototype.equals=function(a){return typeof a!="undefined"&&this.right===a.right&&this.left===a.left&&this.top===a.top&&this.bottom===a.bottom&&this.near===a.near&&this.far===a.far},i}),c("Scene/PerspectiveFrustum",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian3","../Core/Cartesian4","../Core/Matrix4","../Scene/PerspectiveOffCenterFrustum"],function(a,b,c,d,e,f){function h(b){if(typeof b.fovy=="undefined"||typeof b.aspectRatio=="undefined"||typeof b.near=="undefined"||typeof b.far=="undefined")throw new a("fovy, aspectRatio, near, or far parameters are not set.");var c=b._offCenterFrustum;if(b.fovy!==b._fovy||b.aspectRatio!==b._aspectRatio||b.near!==b._near||b.far!==b._far){if(b.fovy<0||b.fovy>=Math.PI)throw new a("fovy must be in the range [0, PI).");if(b.aspectRatio<0)throw new a("aspectRatio must be positive.");if(b.near<0||b.near>b.far)throw new a("near must be greater than zero and less than far.");b._fovy=b.fovy,b._aspectRatio=b.aspectRatio,b._near=b.near,b._far=b.far,c.top=b.near*Math.tan(.5*b.fovy),c.bottom=-c.top,c.right=b.aspectRatio*c.top,c.left=-c.right,c.near=b.near,c.far=b.far}}var g=function(){this._offCenterFrustum=new f,this.fovy=undefined,this._fovy=undefined,this.aspectRatio=undefined,this._aspectRatio=undefined,this.near=1,this._near=this.near,this.far=5e8,this._far=this.far};return g.prototype.getProjectionMatrix=function(){return h(this),this._offCenterFrustum.getProjectionMatrix()},g.prototype.getInfiniteProjectionMatrix=function(){return h(this),this._offCenterFrustum.getInfiniteProjectionMatrix()},g.prototype.computeCullingVolume=function(a,b,c){return h(this),this._offCenterFrustum.computeCullingVolume(a,b,c)},g.prototype.getPixelSize=function(a,b){return h(this),this._offCenterFrustum.getPixelSize(a,b)},g.prototype.clone=function(){var a=new g;return a.fovy=this.fovy,a.aspectRatio=this.aspectRatio,a.near=this.near,a.far=this.far,a._offCenterFrustum=this._offCenterFrustum.clone(),a},g.prototype.equals=function(a){return typeof a=="undefined"?!1:(h(this),h(a),this.fovy===a.fovy&&this.aspectRatio===a.aspectRatio&&this.near===a.near&&this.far===a.far&&this._offCenterFrustum.equals(a._offCenterFrustum))},g}),c("Scene/Polyline",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/BoundingSphere","../Core/Cartesian3","../Core/Color","../Core/PolylinePipeline"],function(a,b,c,d,e,f,g){function r(a,b){++a._propertiesChanged[b];var c=a._polylineCollection;typeof c!="undefined"&&(c._updatePolyline(a,b),a._dirty=!0)}function s(a,b){if(a.length!==b.length)return!1;for(var c=0,d=a.length;c<d;++c)if(!e.equals(a[c],b[c]))return!1;return!0}var h={},i=function(b,c){b=a(b,h),this._show=a(b.show,!0),this._width=a(b.width,1),this._outlineWidth=a(b.outlineWidth,1),this._color=f.clone(a(b.color,f.WHITE)),this._outlineColor=f.clone(a(b.outlineColor,f.WHITE));var e=b.positions;typeof e=="undefined"&&(e=[]),this._positions=e,this._positionsLength=e.length,this._actualLength=e.length,this._propertiesChanged=new Uint32Array(q),this._polylineCollection=c,this._dirty=!1,this._pickId=undefined,this._pickIdThis=b._pickIdThis,this._segments=undefined,this._boundingVolume=d.fromPoints(this._positions),this._boundingVolume2D=new d},j=i.SHOW_INDEX=0,k=i.POSITION_INDEX=1,l=i.COLOR_INDEX=2,m=i.OUTLINE_COLOR_INDEX=3,n=i.WIDTH_INDEX=4,o=i.OUTLINE_WIDTH_INDEX=5,p=i.POSITION_SIZE_INDEX=6,q=i.NUMBER_OF_PROPERTIES=7;return i.prototype.getShow=function(){return this._show},i.prototype.setShow=function(a){if(typeof a=="undefined")throw new b("value is required.");a!==this._show&&(this._show=a,r(this,j))},i.prototype.getPositions=function(){return this._positions},i.prototype.setPositions=function(a){if(typeof a=="undefined")throw new b("value is required.");this._positionsLength!==a.length&&(this._positionsLength=a.length,r(this,p)),this._positions=a,this._boundingVolume=d.fromPoints(this._positions,this._boundingVolume),r(this,k)},i.prototype.getColor=function(){return this._color},i.prototype.setColor=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._color;f.equals(c,a)||(f.clone(a,c),r(this,l))},i.prototype.getWidth=function(){return this._width},i.prototype.setWidth=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._width;a!==c&&(this._width=a,r(this,n))},i.prototype.getOutlineWidth=function(){return this._outlineWidth},i.prototype.setOutlineWidth=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._outlineWidth;a!==c&&(this._outlineWidth=a,r(this,o))},i.prototype.getOutlineColor=function(){return this._outlineColor},i.prototype.setOutlineColor=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._outlineColor;f.equals(c,a)||(f.clone(a,c),r(this,m))},i.prototype.getPickId=function(a){return this._pickId=this._pickId||a.createPickId(this._pickIdThis||this),this._pickId},i.prototype._clean=function(){this._dirty=!1;var a=this._propertiesChanged;for(var b=0;b<q-1;++b)a[b]=0},i.prototype._getPositions2D=function(){var a=this._segments,b=[],c=a.length;for(var d=0;d<c;++d){var e=a[d],f=e.length;for(var g=0;g<f;++g)b.push(e[g].cartesian)}return b},i.prototype._createSegments=function(a){return g.wrapLongitude(a,this.getPositions())},i.prototype._setSegments=function(a){this._segments=a;var b=a.length,c=0;for(var d=0;d<b;++d){var e=a[d],f=e.length;c+=f}return c},i.prototype._getSegments=function(){return this._segments},i.prototype._segmentsLengthChanged=function(a){var b=this._segments;if(typeof b!="undefined"){var c=a.length;if(c!==b.length)return!0;for(var d=0;d<c;++d)if(a[d].length!==b[d].length)return!0;return!1}return!0},i.prototype.equals=function(a){return this===a||typeof a!="undefined"&&this._show===a._show&&this._width===a._width&&this._outlineWidth===a._outlineWidth&&this._horizontalOrigin===a._horizontalOrigin&&s(this._positions,a._positions)&&f.equals(this._color,a._color)&&f.equals(this._outlineColor,a._outlineColor)},i.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._polylineCollection=undefined},i}),c("Scene/Projections",["../Core/DeveloperError","../Core/Enumeration"],function(a,b){var c={WGS84:new b(0,"WGS84",{toWgs84:function(a,b){return b}}),MERCATOR:new b(1,"MERCATOR",{toWgs84:function(b,c){if(!b||typeof b.north=="undefined"||typeof b.south=="undefined")throw new a("extent, extent.north and extent.south are required.");if(!c)throw new a("image is required.");var d=parseInt(c.width,10),e=parseInt(c.height,10),f=d*4,g=document.createElement("canvas");g.width=d,g.height=e;var h=g.getContext("2d");h.drawImage(c,0,0);var i=h.getImageData(0,0,d,e).data,j=h.createImageData(d,e),k=j.data,l=(b.north-b.south)/e,m=b.north-.5*l,n=Math.sin(b.south),o=.5*Math.log((1+n)/(1-n));n=Math.sin(b.north);var p=.5*Math.log((1+n)/(1-n)),q=1/(p-o),r=e-1,s=0;for(;s<f;++s)k[s]=i[s];var t,u,v,w=1;for(;w<r;++w,m-=l){n=Math.sin(m),u=.5*Math.log((1+n)/(1-n)),v=Math.floor(r-r*(u-o)*q),t=s+f;for(var x=0;s<t;++s,++x)k[s]=i[v*f+x]}t=s+f;for(w=0;s<t;++s,++w)k[s]=i[s];return h.putImageData(j,0,0),g}})};return c}),c("Scene/SceneMode",["../Core/Enumeration"],function(a){var b={SCENE2D:new a(0,"SCENE2D",{morphTime:0}),COLUMBUS_VIEW:new a(1,"COLUMBUS_VIEW",{morphTime:0}),SCENE3D:new a(2,"SCENE3D",{morphTime:1}),MORPHING:new a(3,"MORPHING")};return b}),c("DynamicScene/DynamicObjectView",["../Core/defaultValue","../Core/DeveloperError","../Core/Math","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Quaternion","../Core/Matrix3","../Core/Ellipsoid","../Core/Transforms","../Scene/SceneMode"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,b,c,f,g,h,i){var j,k=a._controller2d,l=typeof k=="undefined"||k!==a._lastController||k.isDestroyed();if(l){var m=b.getControllers();m.removeAll(),a._lastController=a._controller2d=k=m.add2D(i),k.enableTranslate=!1,j=f.magnitude()}else c?j=f.magnitude():j=b.position.z;var n=g.getValueCartographic(h,a._lastCartographic);n.height=j,c||l?(k.setPositionCartographic(n),e.normalize(f,b.up),e.negate(b.up,b.up),e.cross(b.direction,b.up,b.right),b.up.z=0,e.normalize(b.up,b.up),b.right.z=0,e.normalize(b.right,b.right),d.clone(b.right,a._first2dUp)):b.position=i.project(n),a._lastDistance=b.frustum.right-b.frustum.left,d.clone(b.right,a._last2dUp)}function o(a,b,c,d,f,g,h){var i=t(a,b,c,d),l=f.getValueCartesian(g,a._lastCartesian);n=k.eastNorthUpToFixedFrame(l,h,n),i.setReferenceFrame(n,j.UNIT_SPHERE);var m=b.position;e.clone(m,a._lastOffset),a._lastDistance=e.magnitude(m)}function q(a,b,c,d,f,g,h,i){var k=t(a,b,c,d),l=f.getValueCartographic(g,a._lastCartographic),m=i.project(l);p.x=m.z,p.y=m.x,p.z=m.y;var n=b.transform;n.setColumn(3,p,n),k.setReferenceFrame(n,j.UNIT_SPHERE);var o=b.position;e.clone(o,a._lastOffset),a._lastDistance=e.magnitude(o)}function t(a,b,f,g){var j=a._controller3d,k=typeof j=="undefined"||j!==a._lastController||j.isDestroyed();if(k){var l=b.getControllers();l.removeAll(),a._lastController=a._controller3d=j=l.addSpindle(),j.constrainedAxis=e.UNIT_Z}if(f)b.lookAt(g,e.ZERO,e.UNIT_Z);else if(k){var m=a._first2dUp,n=a._last2dUp;if(!d.equals(m,n)){var o=Math.acos(m.x);m.y<0&&(o=c.TWO_PI-o);var p=Math.acos(n.x);n.y<0&&(p=c.TWO_PI-p),n.x=0,n.y=0,m.x=0,m.y=0;var q=o-p,t=h.fromAxisAngle(e.UNIT_Z,q,r);i.fromQuaternion(t,s).multiplyByVector(g,g)}g.normalize(g).multiplyByScalar(a._lastDistance,g),b.lookAt(g,e.ZERO,e.UNIT_Z)}return j}var n,p=new f(0,0,0,1),r=new h,s=new i,u=new e(1e4,-1e4,1e4),v=new e,w=function(b,c,f){this.dynamicObject=b,this.scene=c,this.ellipsoid=a(f,j.WGS84),this._lastScene=undefined,this._lastDynamicObject=undefined,this._lastController=undefined,this._controller2d=undefined,this._controller3d=undefined,this._lastCartesian=new e,this._lastCartographic=new g,this._lastDistance=undefined,this._lastOffset=new e,this._offsetScratch=new e,this._first2dUp=new d,this._last2dUp=new d};return w.prototype.update=function(a){if(typeof a=="undefined")throw new b("time is required.");var c=this.scene;if(typeof c=="undefined")throw new b("DynamicObjectView.scene is required.");var d=this.dynamicObject;if(typeof d=="undefined")throw new b("DynamicObjectView.dynamicObject is required.");var f=this.ellipsoid;if(typeof f=="undefined")throw new b("DynamicObjectView.ellipsoid is required.");var g=this.dynamicObject.position;if(typeof g=="undefined")throw new b("dynamicObject.position is required.");var h=d!==this._lastDynamicObject,i=this._offsetScratch;if(h){this._lastDynamicObject=d;var j=this.dynamicObject.viewFrom;(typeof j=="undefined"||typeof j.getValue(a,i)=="undefined")&&e.clone(u,i);var k=this._first2dUp,n=this._last2dUp;k.x=k.y=0,n.x=n.y=0,e.clone(i,this._lastOffset),this._lastDistance=i.magnitude(),e.equals(i.normalize(v),e.UNIT_Z)&&(i.y-=.01)}else typeof this._lastOffset!="undefined"?i=this._lastOffset:e.clone(u,i);var p=c!==this._lastScene;p&&(this._lastController=undefined,this._controller2d=undefined,this._controller3d=undefined,this._lastScene=c);var r=c.mode;r===l.SCENE2D?m(this,this.scene.getCamera(),h,i,g,a,c.scene2D.projection):r===l.SCENE3D?o(this,this.scene.getCamera(),h,i,g,a,f):r===l.COLUMBUS_VIEW&&q(this,this.scene.getCamera(),h,i,g,a,f,c.scene2D.projection)},w}),c("Renderer/UniformState",["../Core/DeveloperError","../Core/defaultValue","../Core/Ellipsoid","../Core/Matrix3","../Core/Matrix4","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/EncodedCartesian3","../Core/BoundingRectangle","../Core/Transforms","../Core/computeSunPosition","../Scene/SceneMode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function o(a,b){e.clone(b,a._view),e.getRotation(b,a._viewRotation),a._modelViewDirty=!0,a._modelViewRelativeToEyeDirty=!0,a._inverseModelViewDirty=!0,a._viewProjectionDirty=!0,a._modelViewProjectionDirty=!0,a._modelViewProjectionRelativeToEyeDirty=!0,a._modelViewInfiniteProjectionDirty=!0,a._normalDirty=!0,a._inverseNormalDirty=!0}function p(a,b){e.clone(b,a._inverseView),e.getRotation(b,a._inverseViewRotation)}function q(a,b){e.clone(b,a._projection),a._inverseProjectionDirty=!0,a._viewProjectionDirty=!0,a._modelViewProjectionDirty=!0,a._modelViewProjectionRelativeToEyeDirty=!0}function r(a,b){e.clone(b,a._infiniteProjection),a._modelViewInfiniteProjectionDirty=!0}function s(a,b){g.clone(b,a._cameraPosition),a._encodedCameraPositionMCDirty=!0}function v(a,b){b.mode===m.SCENE3D?(l(b.time,t),g.normalize(t,a._sunDirectionWC),d.multiplyByVector(a._viewRotation,t,u),g.normalize(u,a._sunDirectionEC),g.negate(a._sunDirectionEC,a._moonDirectionEC)):(t.x=1e6,t.y=-1e7,t.z=0,g.normalize(t,a._sunDirectionWC),d.multiplyByVector(a._viewRotation,t,u),g.normalize(u,a._sunDirectionEC),t.x=1e6,t.y=1e7,t.z=0,g.normalize(t,u),d.multiplyByVector(a._viewRotation,u,u),g.normalize(u,a._moonDirectionEC))}function w(a){if(a._viewportDirty){var b=a._viewport;e.computeOrthographicOffCenter(b.x,b.x+b.width,b.y,b.y+b.height,0,1,a._viewportOrthographicMatrix),e.computeViewportTransformation(b,0,1,a._viewportTransformation),a._viewportDirty=!1}}function x(a){a._inverseProjectionDirty&&(a._inverseProjectionDirty=!1,e.inverse(a._projection,a._inverseProjection))}function y(a){a._modelViewDirty&&(a._modelViewDirty=!1,e.multiply(a._view,a._model,a._modelView))}function z(a){if(a._modelViewRelativeToEyeDirty){a._modelViewRelativeToEyeDirty=!1;var b=a.getModelView(),c=a._modelViewRelativeToEye;c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3],c[4]=b[4],c[5]=b[5],c[6]=b[6],c[7]=b[7],c[8]=b[8],c[9]=b[9],c[10]=b[10],c[11]=b[11],c[12]=0,c[13]=0,c[14]=0,c[15]=b[15]}}function A(a){a._inverseModelViewDirty&&(a._inverseModelViewDirty=!1,e.inverse(a.getModelView(),a._inverseModelView))}function B(a){a._viewProjectionDirty&&(a._viewProjectionDirty=!1,e.multiply(a._projection,a._view,a._viewProjection))}function C(a){a._modelViewProjectionDirty&&(a._modelViewProjectionDirty=!1,e.multiply(a._projection,a.getModelView(),a._modelViewProjection))}function D(a){a._modelViewProjectionRelativeToEyeDirty&&(a._modelViewProjectionRelativeToEyeDirty=!1,e.multiply(a._projection,a.getModelViewRelativeToEye(),a._modelViewProjectionRelativeToEye))}function E(a){a._modelViewInfiniteProjectionDirty&&(a._modelViewInfiniteProjectionDirty=!1,e.multiply(a._infiniteProjection,a.getModelView(),a._modelViewInfiniteProjection))}function G(a){a._normalDirty&&(a._normalDirty=!1,e.transpose(a.getInverseModelView(),F),e.getRotation(F,a._normal))}function H(a){a._inverseNormalDirty&&(a._inverseNormalDirty=!1,e.getRotation(a.getInverseModelView(),a._inverseNormal))}function J(a){a._encodedCameraPositionMCDirty&&(a._encodedCameraPositionMCDirty=!1,a.getInverseModel().multiplyByPoint(a._cameraPosition,I),i.fromCartesian(I,a._encodedCameraPositionMC))}var n=function(){this._viewport=new j,this._viewportDirty=!1,this._viewportOrthographicMatrix=e.IDENTITY.clone(),this._viewportTransformation=e.IDENTITY.clone(),this._model=e.IDENTITY.clone(),this._view=e.IDENTITY.clone(),this._inverseView=e.IDENTITY.clone(),this._projection=e.IDENTITY.clone(),this._infiniteProjection=e.IDENTITY.clone(),this._entireFrustum=new f,this._frameNumber=1,this._time=undefined,this._temeToPseudoFixed=d.IDENTITY.clone(),this._inverseModelDirty=!0,this._inverseModel=new e,this._viewRotation=new d,this._inverseViewRotation=new d,this._inverseProjectionDirty=!0,this._inverseProjection=new e,this._modelViewDirty=!0,this._modelView=new e,this._modelViewRelativeToEyeDirty=!0,this._modelViewRelativeToEye=new e,this._inverseModelViewDirty=!0,this._inverseModelView=new e,this._viewProjectionDirty=!0,this._viewProjection=new e,this._modelViewProjectionDirty=!0,this._modelViewProjection=new e,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewProjectionRelativeToEye=new e,this._modelViewInfiniteProjectionDirty=!0,this._modelViewInfiniteProjection=new e,this._normalDirty=!0,this._normal=new d,this._inverseNormalDirty=!0,this._inverseNormal=new d,this._encodedCameraPositionMCDirty=!0,this._encodedCameraPositionMC=new i,this._cameraPosition=new g,this._sunDirectionWC=new g,this._sunDirectionEC=new g,this._moonDirectionEC=new g},t=new g,u=new g;n.prototype.updateFrustum=function(a){q(this,a.getProjectionMatrix()),typeof a.getInfiniteProjectionMatrix!="undefined"&&r(this,a.getInfiniteProjectionMatrix())},n.prototype.update=function(a){var b=a.camera;o(this,b.getViewMatrix()),p(this,b.getInverseViewMatrix()),s(this,b.getPositionWC()),v(this,a),this._entireFrustum.x=b.frustum.near,this._entireFrustum.y=b.frustum.far,this.updateFrustum(b.frustum),this._frameNumber=a.frameNumber,this._time=a.time,this._temeToPseudoFixed=k.computeTemeToPseudoFixedMatrix(a.time)},n.prototype.setViewport=function(a){j.equals(a,this._viewport)||(j.clone(a,this._viewport),this._viewportDirty=!0)},n.prototype.getViewport=function(){return this._viewport},n.prototype.getViewportOrthographic=function(){return w(this),this._viewportOrthographicMatrix},n.prototype.getViewportTransformation=function(){return w(this),this._viewportTransformation},n.prototype.setModel=function(a){e.clone(a,this._model),this._inverseModelDirty=!0,this._modelViewDirty=!0,this._modelViewRelativeToEyeDirty=!0,this._inverseModelViewDirty=!0,this._modelViewProjectionDirty=!0,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewInfiniteProjectionDirty=!0,this._normalDirty=!0,this._inverseNormalDirty=!0,this._encodedCameraPositionMCDirty=!0},n.prototype.getModel=function(){return this._model},n.prototype.getInverseModel=function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,this._model.inverse(this._inverseModel)),this._inverseModel},n.prototype.getView=function(){return this._view},n.prototype.getViewRotation=function(){return this._viewRotation},n.prototype.getInverseView=function(){return this._inverseView},n.prototype.getInverseViewRotation=function(){return this._inverseViewRotation},n.prototype.getProjection=function(){return this._projection},n.prototype.getInverseProjection=function(){return x(this),this._inverseProjection},n.prototype.getInfiniteProjection=function(){return this._infiniteProjection},n.prototype.getModelView=function(){return y(this),this._modelView},n.prototype.getModelViewRelativeToEye=function(){return z(this),this._modelViewRelativeToEye},n.prototype.getInverseModelView=function(){return A(this),this._inverseModelView},n.prototype.getViewProjection=function(){return B(this),this._viewProjection},n.prototype.getModelViewProjection=function(){return C(this),this._modelViewProjection},n.prototype.getModelViewProjectionRelativeToEye=function(){return D(this),this._modelViewProjectionRelativeToEye},n.prototype.getModelViewInfiniteProjection=function(){return E(this),this._modelViewInfiniteProjection};var F=new e;n.prototype.getNormal=function(){return G(this),this._normal},n.prototype.getInverseNormal=function(){return H(this),this._inverseNormal},n.prototype.getEntireFrustum=function(){return this._entireFrustum},n.prototype.getSunDirectionWC=function(){return this._sunDirectionWC},n.prototype.getSunDirectionEC=function(){return this._sunDirectionEC},n.prototype.getMoonDirectionEC=function(){return this._moonDirectionEC};var I=new g;return n.prototype.getEncodedCameraPositionMCHigh=function(){return J(this),this._encodedCameraPositionMC.high},n.prototype.getEncodedCameraPositionMCLow=function(){return J(this),this._encodedCameraPositionMC.low},n.prototype.getFrameNumber=function(){return this._frameNumber},n.prototype.getTime=function(){return this._time},n.prototype.getTemeToPseudoFixedMatrix=function(){return this._temeToPseudoFixed},n.prototype.getHighResolutionSnapScale=function(){return 1},n}),c("Scene/TerrainProvider",["../Core/DeveloperError","../Core/ComponentDatatype","../Renderer/BufferUsage","../Core/IndexDatatype"],function(a,b,c,d){function e(){throw this.tilingScheme=undefined,this.levelZeroMaximumGeometricError=undefined,new a("This type should not be instantiated directly.")}function g(a,b,c,d,e){return a[b++]=c,a[b++]=d,a[b++]=d,a[b++]=e,a[b++]=e,a[b++]=c,b}function h(a){var b=a.length,c=new Uint16Array(2*b),d=0;for(var e=0;e<b;e+=3)d=g(c,d,a[e],a[e+1],a[e+2]);return c}e.attributeIndices={position3D:0,textureCoordinates:1},e.wireframe=!1;var f=[];return e.getRegularGridIndices=function(a,b){var c=f[a];typeof c=="undefined"&&(f[a]=c=[]);var d=c[b];if(typeof d=="undefined"){d=c[b]=new Uint16Array((a-1)*(b-1)*6);var e=0,g=0;for(var h=0;h<b-1;++h){for(var i=0;i<a-1;++i){var j=e,k=j+a,l=k+1,m=j+1;d[g++]=j,d[g++]=k,d[g++]=m,d[g++]=m,d[g++]=k,d[g++]=l,++e}++e}}return d},e.createTileEllipsoidGeometryFromBuffers=function(a,f,g){var i=b.FLOAT,j=g.vertices,k=a.createVertexBuffer(j,c.STATIC_DRAW),l=5*i.sizeInBytes,m=[{index:e.attributeIndices.position3D,vertexBuffer:k,componentDatatype:i,componentsPerAttribute:3,offsetInBytes:0,strideInBytes:l},{index:e.attributeIndices.textureCoordinates,vertexBuffer:k,componentDatatype:i,componentsPerAttribute:2,offsetInBytes:3*i.sizeInBytes,strideInBytes:l}],n=g.indices.indexBuffers||{},o=n[a.getId()];if(typeof o=="undefined"||o.isDestroyed()){var p=g.indices;e.wireframe&&(p=h(g.indices)),o=a.createIndexBuffer(p,c.STATIC_DRAW,d.UNSIGNED_SHORT),o.setVertexArrayDestroyable(!1),o.referenceCount=1,n[a.getId()]=o,g.indices.indexBuffers=n}else++o.referenceCount;f.vertexArray=a.createVertexArray(m,o)},e.heightmapTerrainQuality=.25,e.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(a,b,c){return a.getMaximumRadius()*2*Math.PI*e.heightmapTerrainQuality/(b*c)},e.prototype.getLevelMaximumGeometricError=function(a){return this.levelZeroMaximumGeometricError/(1<<a)},e.prototype.requestTileGeometry=function(b){throw new a("This type should not be instantiated directly.")},e.prototype.transformGeometry=function(b,c){throw new a("This type should not be instantiated directly.")},e.prototype.createResources=function(b,c){throw new a("This type should not be instantiated directly.")},e}),c("Scene/TexturePool",["../Core/destroyObject","../Core/DeveloperError","../Renderer/PixelDatatype","../Renderer/PixelFormat","../Renderer/Texture"],function(a,b,c,d,e){function g(a,b,c){return typeof f=="undefined"&&(f=function(a,b,c){this._texture=a,this._textureTypeKey=b,this._pool=c},Object.keys(e.prototype).forEach(function(a){f.prototype[a]=function(){var b=this._texture;return b[a].apply(b,arguments)}}),f.prototype.destroy=function(){var a=this._pool._free[this._textureTypeKey];typeof a=="undefined"&&(a=this._pool._free[this._textureTypeKey]=[]),a.length>=8?this._texture.destroy():a.push(this)}),new f(a,b,c)}var f,h=function(){this._free={}};return h.prototype.createTexture2D=function(a,e){if(!e)throw new b("description is required.");var f=e.source,h=typeof f!="undefined"?f.width:e.width,i=typeof f!="undefined"?f.height:e.height,j=+(e.pixelFormat||d.RGBA),k=+(e.pixelDatatype||c.UNSIGNED_BYTE),l=+(e.preMultiplyAlpha||j===d.RGB||j===d.LUMINANCE),m=JSON.stringify([h,i,j,k,l]),n=this._free[m];if(typeof n!="undefined"&&n.length>0){var o=n.pop();return typeof f!="undefined"&&o.copyFrom(f),o}return g(a.createTexture2D(e),m,this)},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){var b=this._free;return Object.keys(b).forEach(function(a){b[a].forEach(function(a){a._texture.destroy()})}),a(this)},h}),c("Scene/TileDiscardPolicy",["../Core/DeveloperError"],function(a){var b=function(b){throw new a("This type should not be instantiated directly.")};return b.prototype.isReady=function(){throw new a("This type should not be instantiated directly.")},b.prototype.shouldDiscardImage=function(b){throw new a("This type should not be instantiated directly.")},b}),c("Scene/TileImagery",[],function(){var a=function(a,b){this.imagery=a,this.textureCoordinateExtent=b,this.originalImagery=undefined,this.textureTranslationAndScale=undefined};return a.prototype.freeResources=function(){this.imagery.releaseReference(),typeof this.originalImagery!="undefined"&&this.originalImagery.releaseReference()},a}),c("Scene/TileLoadQueue",[],function(){var a=function(){this.head=undefined,this.tail=undefined,this._insertionPoint=undefined};return a.prototype.remove=function(a){var b=a.loadPrevious,c=a.loadNext;a===this.head?this.head=c:b.loadNext=c,a===this.tail?this.tail=b:c.loadPrevious=b,a.loadPrevious=undefined,a.loadNext=undefined},a.prototype.markInsertionPoint=function(){this._insertionPoint=this.head},a.prototype.insertBeforeInsertionPoint=function(a){var b=this._insertionPoint;if(b===a)return;if(typeof this.head=="undefined"){a.loadPrevious=undefined,a.loadNext=undefined,this.head=a,this.tail=a;return}(typeof a.loadPrevious!="undefined"||typeof a.loadNext!="undefined")&&this.remove(a);if(typeof b=="undefined"){a.loadPrevious=this.tail,a.loadNext=undefined,this.tail.loadNext=a,this.tail=a;return}var c=b.loadPrevious;a.loadPrevious=c,typeof c!="undefined"&&(c.loadNext=a),a.loadNext=b,b.loadPrevious=a,b===this.head&&(this.head=a)},a}),c("Scene/TileState",["../Core/Enumeration"],function(a){var b={UNLOADED:new a(0,"UNLOADED"),TRANSITIONING:new a(1,"TRANSITIONING"),RECEIVED:new a(2,"RECEIVED"),TRANSFORMED:new a(3,"TRANSFORMED"),READY:new a(4,"READY"),FAILED:new a(5,"FAILED"),INVALID:new a(6,"INVALID")};return b}),c("Scene/Tile",["../Core/DeveloperError","./TileState"],function(a,b){var c=function(c){if(typeof c=="undefined")throw new a("description is required.");if(typeof c.x=="undefined"||typeof c.y=="undefined"){if(typeof c.extent=="undefined")throw new a("Either description.extent is required or description.x and description.y are required.")}else if(c.x<0||c.y<0)throw new a("description.x and description.y must be greater than or equal to zero.");if(typeof c.level=="undefined"||c.zoom<0)throw new a("description.level is required and must be greater than or equal to zero.");if(typeof c.tilingScheme=="undefined")throw new a("description.tilingScheme is required.");this.tilingScheme=c.tilingScheme,this.x=c.x,this.y=c.y,this.level=c.level,this.parent=c.parent,this.children=undefined,this.extent=this.tilingScheme.tileXYToExtent(this.x,this.y,this.level),this.vertexArray=undefined,this.center=undefined,this.maxHeight=undefined,this.boundingSphere3D=undefined,this.state=b.UNLOADED,this.loadPrevious=undefined,this.loadNext=undefined,this.replacementPrevious=undefined,this.replacementNext=undefined,this.imagery=[],this.transientData=undefined,this.distance=0,this.southwestCornerCartesian=undefined,this.northeastCornerCartesian=undefined,this.westNormal=undefined,this.southNormal=undefined,this.eastNormal=undefined,this.northNormal=undefined,this.occludeePointInScaledSpace=undefined};return c.prototype.getChildren=function(){if(typeof this.children=="undefined"){var a=this.tilingScheme,b=this.level+1,d=this.x*2,e=this.y*2;this.children=[new c({tilingScheme:a,x:d,y:e,level:b,parent:this}),new c({tilingScheme:a,x:d+1,y:e,level:b,parent:this}),new c({tilingScheme:a,x:d,y:e+1,level:b,parent:this}),new c({tilingScheme:a,x:d+1,y:e+1,level:b,parent:this})]}return this.children},c.prototype.freeResources=function(){this.state=b.UNLOADED,this.doneLoading=!1,this.renderable=!1;if(typeof this.vertexArray!="undefined"){var a=this.vertexArray.getIndexBuffer();this.vertexArray.destroy(),this.vertexArray=undefined,!a.isDestroyed()&&typeof a.referenceCount!="undefined"&&(--a.referenceCount,a.referenceCount===0&&a.destroy())}typeof this.transientData!="undefined"&&typeof this.transientData.destroy!="undefined"&&this.transientData.destroy(),this.transientData=undefined;var c,d,e=this.imagery;for(c=0,d=e.length;c<d;++c)e[c].freeResources();this.imagery.length=0;if(typeof this.children!="undefined")for(c=0,d=this.children.length;c<d;++c)this.children[c].freeResources()},c}),c("Scene/TileReplacementQueue",["./TileState"],function(a){var b=function(){this.head=undefined,this.tail=undefined,this.count=0,this._lastBeforeStartOfFrame=undefined};return b.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head},b.prototype.trimTiles=function(b){var c=this.tail,d=!0;while(d&&typeof this._lastBeforeStartOfFrame!="undefined"&&this.count>b&&typeof c!="undefined"){d=c!==this._lastBeforeStartOfFrame;var e=c.replacementPrevious;c.state!==a.TRANSITIONING&&(c.freeResources(),this._remove(c)),c=e}},b.prototype._remove=function(a){var b=a.replacementPrevious,c=a.replacementNext;a===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=c),a===this.head?this.head=c:b.replacementNext=c,a===this.tail?this.tail=b:c.replacementPrevious=b,a.replacementPrevious=undefined,a.replacementNext=undefined,--this.count},b.prototype.markTileRendered=function(a){var b=this.head;if(b===a){a===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=a.replacementNext);return}++this.count;if(typeof b=="undefined"){a.replacementPrevious=undefined,a.replacementNext=undefined,this.head=a,this.tail=a;return}(typeof a.replacementPrevious!="undefined"||typeof a.replacementNext!="undefined")&&this._remove(a),a.replacementPrevious=undefined,a.replacementNext=b,b.replacementPrevious=a,this.head=a},b}),c("Scene/CentralBodySurface",["../Core/defaultValue","../Core/destroyObject","../Core/BoundingSphere","../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/CubeMapEllipsoidTessellator","../Core/DeveloperError","../Core/Ellipsoid","../Core/EllipsoidalOccluder","../Core/Intersect","../Core/Matrix4","../Core/MeshFilters","../Core/PrimitiveType","../Core/Queue","../Core/WebMercatorProjection","../Renderer/DrawCommand","./ImageryState","./SceneMode","./TerrainProvider","./TileLoadQueue","./TileReplacementQueue","./TileState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){function z(a,b){return a.imagery.imageryLayer._layerIndex-b.imagery.imageryLayer._layerIndex}function A(a){a._imageryLayerCollection._update();if(a._layerOrderChanged){a._layerOrderChanged=!1;var b=a._tileReplacementQueue.head;while(typeof b!="undefined")b.imagery.sort(z),b=b.replacementNext}}function B(a,b,c){var d=a._debug;if(d.suspendLodUpdate)return;var e,f,g=a._tilesToRenderByTextureCount;for(e=0,f=g.length;e<f;++e){var h=g[e];typeof h!="undefined"&&(h.length=0)}if(typeof a._levelZeroTiles=="undefined")return;var i=a._tileTraversalQueue;i.clear(),d.maxDepth=0,d.tilesVisited=0,d.tilesCulled=0,d.tilesRendered=0,d.texturesRendered=0,d.tilesWaitingForChildren=0,a._tileLoadQueue.markInsertionPoint(),a._tileReplacementQueue.markStartOfRenderFrame();var j=c.camera.getPositionWC(),k=a._terrainProvider.tilingScheme.getEllipsoid(),l=k.cartesianToCartographic(j);a._ellipsoidalOccluder.setCameraPosition(j);var m,n=a._levelZeroTiles;for(e=0,f=n.length;e<f;++e)m=n[e],m.doneLoading||O(a,m),m.renderable&&G(a,c,m)?i.enqueue(m):++d.tilesCulled;while(typeof (m=i.dequeue())!="undefined"){++d.tilesVisited,a._tileReplacementQueue.markTileRendered(m),m.level>d.maxDepth&&(d.maxDepth=m.level);if(C(a,b,c,j,l,m)<a._maxScreenSpaceError)E(a,m);else if(N(a,c,m)){var o=m.children;for(e=0,f=o.length;e<f;++e)G(a,c,o[e])?i.enqueue(o[e]):++d.tilesCulled}else++d.tilesWaitingForChildren,E(a,m)}d.enableDebugOutput&&(d.tilesVisited!==d.lastTilesVisited||d.tilesRendered!==d.lastTilesRendered||d.texturesRendered!==d.lastTexturesRendered||d.tilesCulled!==d.lastTilesCulled||d.maxDepth!==d.lastMaxDepth||d.tilesWaitingForChildren!==d.lastTilesWaitingForChildren)&&(console.log("Visited "+d.tilesVisited+", Rendered: "+d.tilesRendered+", Textures: "+d.texturesRendered+", Culled: "+d.tilesCulled+", Max Depth: "+d.maxDepth+", Waiting for children: "+d.tilesWaitingForChildren),d.lastTilesVisited=d.tilesVisited,d.lastTilesRendered=d.tilesRendered,d.lastTexturesRendered=d.texturesRendered,d.lastTilesCulled=d.tilesCulled,d.lastMaxDepth=d.maxDepth,d.lastTilesWaitingForChildren=d.tilesWaitingForChildren)}function C(a,b,c,d,e,f){if(c.mode===t.SCENE2D)return D(a,b,c,d,e,f);var g=f.extent,h=1;if(c.mode===t.SCENE3D){var i=0;g.south>0?i=g.south:g.north<0&&(i=g.north),h=Math.cos(i)}var j=h*a._terrainProvider.getLevelMaximumGeometricError(f.level),k=Math.sqrt(M(c,d,e,f));f.distance=k;var l=b.getCanvas(),m=l.clientHeight,n=c.camera,o=n.frustum,p=o.fovy;return j*m/(2*k*Math.tan(.5*p))}function D(a,b,c,d,e,f){var g=c.camera,h=g.frustum,i=b.getCanvas(),j=i.clientWidth,k=i.clientHeight,l=a._terrainProvider.getLevelMaximumGeometricError(f.level),m=Math.max(h.top-h.bottom,h.right-h.left)/Math.max(j,k);return l/m}function E(a,b){var c=0,d=b.imagery;for(var e=0,f=d.length;e<f;++e){var g=d[e];g.imagery.state===s.READY&&++c}var h=a._tilesToRenderByTextureCount[c];typeof h=="undefined"&&(h=[],a._tilesToRenderByTextureCount[c]=h),h.push(b);var i=a._debug;++i.tilesRendered,i.texturesRendered+=c}function G(a,b,d){var e=b.cullingVolume,g=d.boundingSphere3D;b.mode!==t.SCENE3D&&(g=F,c.fromExtent2D(d.extent,b.scene2D.projection,g),g.center=new f(0,g.center.x,g.center.y),b.mode===t.MORPHING&&(g=c.union(d.boundingSphere3D,g,g)));if(e.getVisibility(g)===l.OUTSIDE)return!1;if(b.mode===t.SCENE3D){var h=d.occludeePointInScaledSpace;return typeof h=="undefined"?!0:a._ellipsoidalOccluder.isScaledSpacePointVisible(h)}return!0}function M(a,b,c,d){var e=d.southwestCornerCartesian,g=d.northeastCornerCartesian,h=d.westNormal,i=d.southNormal,j=d.eastNormal,k=d.northNormal,l=d.maxHeight;a.mode!==t.SCENE3D&&(e=a.scene2D.projection.project(d.extent.getSouthwest(),H),e.z=e.y,e.y=e.x,e.x=0,g=a.scene2D.projection.project(d.extent.getNortheast(),I),g.z=g.y,g.y=g.x,g.x=0,h=J,j=f.UNIT_Y,i=K,k=f.UNIT_Z,l=0);var m=b.subtract(e,L),n=m.dot(h),o=m.dot(i),p=b.subtract(g,L),q=p.dot(j),r=p.dot(k),s;a.mode===t.SCENE3D?s=c.height:s=b.x;var u=s-l,v=0;return n>0?v+=n*n:q>0&&(v+=q*q),o>0?v+=o*o:r>0&&(v+=r*r),u>0&&(v+=u*u),v}function N(a,b,c){if(c.level===a._terrainProvider.maxLevel)return!1;var d=!0,e=c.getChildren();for(var f=0,g=e.length;f<g;++f){var h=e[f];a._tileReplacementQueue.markTileRendered(h),h.doneLoading||O(a,h),h.renderable||(d=!1)}return d}function O(a,b){a._tileLoadQueue.insertBeforeInsertionPoint(b)}function P(a,b,c){var d=a._tileLoadQueue,e=a._terrainProvider,f=d.head;if(typeof f=="undefined")return;var g=Date.now(),h=a._loadQueueTimeSlice,i=g+h;do{var j,k;if(f.state===x.UNLOADED){f.state=x.TRANSITIONING,e.requestTileGeometry(f);if(f.state!==x.UNLOADED){a._tileReplacementQueue.markTileRendered(f),a._tileReplacementQueue.trimTiles(100);var l=a._imageryLayerCollection;for(j=0,k=l.getLength();j<k;++j){var m=l.get(j);m.show&&m._createTileImagerySkeletons(f,e)}}}f.state===x.RECEIVED&&(f.state=x.TRANSITIONING,e.transformGeometry(b,f)),f.state===x.TRANSFORMED&&(f.state=x.TRANSITIONING,e.createResources(b,f));var n=f.state===x.READY,o=!1,p=f.imagery;for(j=0,k=p.length;j<k;++j){if(o&&Date.now()>=i)break;var q=p[j],r=q.imagery,t=r.imageryLayer;r.state===s.PLACEHOLDER&&(t.getImageryProvider().isReady()&&(q.freeResources(),p.splice(j,1),t._createTileImagerySkeletons(f,e,j),--j,k=p.length),o=!0),r.state===s.UNLOADED&&(r.state=s.TRANSITIONING,t._requestImagery(r),o=!0),r.state===s.RECEIVED&&(r.state=s.TRANSITIONING,t._createTexture(b,r),o=!0),r.state===s.TEXTURE_LOADED&&(r.state=s.TRANSITIONING,t._reprojectTexture(b,r),o=!0);if(r.state===s.FAILED||r.state===s.INVALID){var u=r.parent;while(typeof u!="undefined"&&(u.state===s.FAILED||u.state===s.INVALID))u=u.parent;if(typeof u=="undefined"){q.freeResources(),p.splice(j,1),--j,k=p.length;continue}q.originalImagery=r,u.addReference(),q.imagery=u,r=u,o=!0}var v=r.state===s.READY;v&&typeof q.textureTranslationAndScale=="undefined"&&(q.textureTranslationAndScale=t._calculateTextureTranslationAndScale(f,q),o=!0),n=n&&v}j===k&&n&&(f.renderable=!0,f.doneLoading=!0,d.remove(f)),f=f.loadNext}while(Date.now()<i&&typeof f!="undefined")}function Q(a,b,c,d,e,f,i){if(typeof a._debug!="undefined"&&typeof a._debug.boundingSphereTile!="undefined"){if(!a._debug.boundingSphereVA){var k=a._debug.boundingSphereTile.boundingSphere3D.radius,l=h.compute(new j(k,k,k),10);n.toWireframeInPlace(l),a._debug.boundingSphereVA=b.createVertexArrayFromMesh({mesh:l,attributeIndices:n.createAttributeIndices(l)})}var m=a._debug.boundingSphereTile.center,p=S();T(p,d),p.center3D=m;var q=c.camera.getViewMatrix(),s=q.multiplyByVector(new g(m.x,m.y,m.z,1));p.modifiedModelView=q.setColumn(3,s,p.modifiedModelView),p.dayTextures[0]=b.getDefaultTexture(),p.dayTextureTranslationAndScale[0]=new g(0,0,1,1),p.dayTextureTexCoordsExtent[0]=new g(0,0,1,1),p.dayTextureAlpha[0]=1;var t=new r;t.shaderProgram=e.getShaderProgram(b,1),t.renderState=f,t.primitiveType=o.LINES,t.vertexArray=a._debug.boundingSphereVA,t.uniformMap=p,i.push(t)}}function R(a,b){return a.distance-b.distance}function S(){return{u_center3D:function(){return this.center3D},u_tileExtent:function(){return this.tileExtent},u_modifiedModelView:function(){return this.modifiedModelView},u_dayTextures:function(){return this.dayTextures},u_dayTextureTranslationAndScale:function(){return this.dayTextureTranslationAndScale},u_dayTextureTexCoordsExtent:function(){return this.dayTextureTexCoordsExtent},u_dayTextureAlpha:function(){return this.dayTextureAlpha},u_dayTextureBrightness:function(){return this.dayTextureBrightness},u_dayTextureContrast:function(){return this.dayTextureContrast},u_dayTextureOneOverGamma:function(){return this.dayTextureOneOverGamma},u_dayIntensity:function(){return this.dayIntensity},u_southAndNorthLatitude:function(){return this.southAndNorthLatitude},u_southMercatorYLowAndHighAndOneOverHeight:function(){return this.southMercatorYLowAndHighAndOneOverHeight},center3D:undefined,modifiedModelView:new m,tileExtent:new g,dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsExtent:[],dayTextureAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureOneOverGamma:[],dayIntensity:0,southAndNorthLatitude:new e(0,0),southMercatorYLowAndHighAndOneOverHeight:new f(0,0,0)}}function T(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function Z(a,b,d,e,h,i,j,k,l){var n=d.camera.getViewMatrix(),p=b.getMaximumTextureImageUnits(),v=a._tileCommands,w=a._tileCommandUniformMaps,x=-1,y=a._tilesToRenderByTextureCount;for(var z=0,A=y.length;z<A;++z){var B=y[z];if(typeof B=="undefined"||B.length===0)continue;B.sort(R);var C=e.getShaderProgram(b,z);for(var D=0,E=B.length;D<E;D++){var F=B[D],G=F.center,H=W,I=0,J=0,K=0,L=0,M=0;if(h!==t.SCENE3D){var N=i.project(F.extent.getSouthwest()),O=i.project(F.extent.getNortheast());H.x=N.x,H.y=N.y,H.z=O.x,H.w=O.y,h!==t.MORPHING&&(G=X,G.x=0,G.y=(H.z+H.x)*.5,G.z=(H.w+H.y)*.5,H.x-=G.y,H.y-=G.z,H.z-=G.y,H.w-=G.z);if(i instanceof q){I=F.extent.south,J=F.extent.north;var P=q.geodeticLatitudeToMercatorAngle(I),Q=q.geodeticLatitudeToMercatorAngle(J);U[0]=P,K=U[0],L=P-U[0],M=1/(Q-P)}}var Z=Y;Z.x=G.x,Z.y=G.y,Z.z=G.z,Z.w=1,m.multiplyByVector(n,Z,Z),n.setColumn(3,Z,V);var $=F.imagery,_=0,ab=$.length;do{var bb=0;++x;var cb=v[x];typeof cb=="undefined"&&(cb=new r,v[x]=cb,w[x]=S());var db=w[x];T(db,j),db.center3D=F.center,g.clone(H,db.tileExtent),db.southAndNorthLatitude.x=I,db.southAndNorthLatitude.y=J,db.southMercatorYLowAndHighAndOneOverHeight.x=L,db.southMercatorYLowAndHighAndOneOverHeight.y=K,db.southMercatorYLowAndHighAndOneOverHeight.z=M,m.clone(V,db.modifiedModelView);while(bb<p&&_<ab){var eb=$[_],fb=eb.imagery,gb=fb.imageryLayer;++_;if(fb.state!==s.READY)continue;typeof eb.textureTranslationAndScale=="undefined"&&(eb.textureTranslationAndScale=gb._calculateTextureTranslationAndScale(F,eb)),db.dayTextures[bb]=fb.texture,db.dayTextureTranslationAndScale[bb]=eb.textureTranslationAndScale,db.dayTextureTexCoordsExtent[bb]=eb.textureCoordinateExtent,typeof gb.alpha=="function"?db.dayTextureAlpha[bb]=gb.alpha(d,gb,fb.x,fb.y,fb.level):db.dayTextureAlpha[bb]=gb.alpha,typeof gb.brightness=="function"?db.dayTextureBrightness[bb]=gb.brightness(d,gb,fb.x,fb.y,fb.level):db.dayTextureBrightness[bb]=gb.brightness,typeof gb.contrast=="function"?db.dayTextureContrast[bb]=gb.contrast(d,gb,fb.x,fb.y,fb.level):db.dayTextureContrast[bb]=gb.contrast,typeof gb.gamma=="function"?db.dayTextureOneOverGamma[bb]=1/gb.gamma(d,gb,fb.x,fb.y,fb.level):db.dayTextureOneOverGamma[bb]=1/gb.gamma,++bb}db.dayTextures.length=bb,k.push(cb),cb.shaderProgram=C,cb.renderState=l,cb.primitiveType=u.wireframe?o.LINES:o.TRIANGLES,cb.vertexArray=F.vertexArray,cb.uniformMap=db;var hb=F.boundingSphere3D;d.mode!==t.SCENE3D&&(hb=c.fromExtent2D(F.extent,d.scene2D.projection),hb.center=new f(hb.center.z,hb.center.x,hb.center.y),d.mode===t.MORPHING&&(hb=c.union(F.boundingSphere3D,hb,hb))),cb.boundingVolume=hb}while(_<ab)}}v.length=Math.max(0,x)}var y=function(b){if(typeof b.terrainProvider=="undefined")throw new i("description.terrainProvider is required.");if(typeof b.imageryLayerCollection=="undefined")throw new i("description.imageryLayerCollection is required.");this._terrainProvider=b.terrainProvider,this._imageryLayerCollection=b.imageryLayerCollection,this._maxScreenSpaceError=a(b.maxScreenSpaceError,2),this._imageryLayerCollection.layerAdded.addEventListener(y.prototype._onLayerAdded,this),this._imageryLayerCollection.layerRemoved.addEventListener(y.prototype._onLayerRemoved,this),this._imageryLayerCollection.layerMoved.addEventListener(y.prototype._onLayerMoved,this),this._imageryLayerCollection.layerShownOrHidden.addEventListener(y.prototype._onLayerShownOrHidden,this),this._layerOrderChanged=!1;var c=this._terrainProvider.tilingScheme;this._levelZeroTiles=c.createLevelZeroTiles(),this._tilesToRenderByTextureCount=[],this._tileCommands=[],this._tileCommandUniformMaps=[],this._tileTraversalQueue=new p,this._tileLoadQueue=new v,this._tileReplacementQueue=new w,this._loadQueueTimeSlice=5;var d=c.getEllipsoid();this._ellipsoidalOccluder=new k(d,f.ZERO),this._debug={enableDebugOutput:!1,boundingSphereTile:undefined,boundingSphereVA:undefined,maxDepth:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,texturesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTexturesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1}};y.prototype.update=function(a,b,c,d,e,f,g,h){A(this),B(this,a,b),P(this,a,b),Z(this,a,b,e,g,h,d,c,f),Q(this,a,b,d,e,f,c)},y.prototype._onLayerAdded=function(a,b){if(typeof this._levelZeroTiles=="undefined")return;if(a.show){var c=this._tileReplacementQueue.head;while(typeof c!="undefined")a._createTileImagerySkeletons(c,this._terrainProvider)&&(c.doneLoading=!1),c=c.replacementNext;this._layerOrderChanged=!0}},y.prototype._onLayerRemoved=function(a,b){if(typeof this._levelZeroTiles=="undefined")return;var c=this._tileReplacementQueue.head;while(typeof c!="undefined"){var d=c.imagery,e=-1,f=0;for(var g=0,h=d.length;g<h;++g){var i=d[g],j=i.imagery;if(j.imageryLayer===a)e===-1&&(e=g),i.freeResources(),++f;else if(e!==-1)break}e!==-1&&d.splice(e,f),a.isBaseLayer()&&(c.renderable=!1),c=c.replacementNext}},y.prototype._onLayerMoved=function(a,b,c){if(typeof this._levelZeroTiles=="undefined")return;this._layerOrderChanged=!0},y.prototype._onLayerShownOrHidden=function(a,b,c){if(typeof this._levelZeroTiles=="undefined")return;c?this._onLayerAdded(a,b):this._onLayerRemoved(a,b)},y.prototype.isDestroyed=function(){return!1},y.prototype.destroy=function(){var a=this._levelZeroTiles;for(var c=0;c<a.length;++c)a[c].freeResources();typeof this._terrainProvider.destroy!="undefined"&&this._terrainProvider.destroy(),this._imageryLayerCollection.destroy();var d=this._debug;return typeof d!="undefined"&&typeof d.boundingSphereVA!="undefined"&&d.boundingSphereVA.destroy(),b(this)};var F=new c,H=new f(0,0,0),I=new f(0,0,0),J=f.UNIT_Y.negate(),K=f.UNIT_Z.negate(),L=new f(0,0,0);y.prototype.debugShowBoundingSphereOfTileAt=function(a){var b=this._tilesToRenderByTextureCount,c,d;for(var e=0;e<b.length&&typeof c=="undefined";++e){var f=b[e];if(typeof f=="undefined")continue;for(var g=0;g<f.length;++g){d=f[g];if(d.extent.contains(a)){c=d;break}}}typeof c!="undefined"&&console.log("x: "+c.x+" y: "+c.y+" level: "+c.level),this._debug.boundingSphereTile=c,this._debug.boundingSphereVA=undefined},y.prototype.debugToggleLodUpdate=function(a){this._debug.suspendLodUpdate=!this._debug.suspendLodUpdate};var U=typeof Float32Array!="undefined"?new Float32Array(1):undefined,V=new m,W=new g,X=new f,Y=new g;return y}),c("Scene/TilingScheme",["../Core/DeveloperError","./Tile"],function(a,b){var c=function(c){throw new a("This type should not be instantiated directly.  Instead, use WebMercatorTilingScheme or GeographicTilingScheme.")};return c.prototype.getEllipsoid=function(){throw new a("This type should not be instantiated directly.")},c.prototype.getExtent=function(){throw new a("This type should not be instantiated directly.")},c.prototype.getProjection=function(){throw new a("This type should not be instantiated directly.")},c.prototype.getNumberOfXTilesAtLevel=function(b){throw new a("This type should not be instantiated directly.")},c.prototype.getNumberOfYTilesAtLevel=function(b){throw new a("This type should not be instantiated directly.")},c.prototype.createLevelZeroTiles=function(){throw new a("This type should not be instantiated directly.")},c.prototype.extentToNativeExtent=function(b,c){throw new a("This type should not be instantiated directly.")},c.prototype.tileXYToNativeExtent=function(b,c,d,e){throw new a("This type should not be instantiated directly.")},c.prototype.tileXYToExtent=function(b,c,d,e){throw new a("This type should not be instantiated directly.")},c.prototype.positionToTileXY=function(b,c,d){throw new a("This type should not be instantiated directly.")},c.createRectangleOfLevelZeroTiles=function(c,d,e){if(typeof c=="undefined")throw new a("tilingScheme is required.");if(typeof d=="undefined")throw new a("numberOfLevelZeroTilesX is required.");if(typeof e=="undefined")throw new a("numberOfLevelZeroTilesY is required.");var f=new Array(d*e),g=0;for(var h=0;h<e;++h)for(var i=0;i<d;++i)f[g++]=new b({tilingScheme:c,x:i,y:h,level:0});return f},c}),c("Scene/GeographicTilingScheme",["../Core/defaultValue","../Core/DeveloperError","../Core/Math","../Core/Cartesian2","../Core/Ellipsoid","../Core/Extent","../Core/GeographicProjection","./TilingScheme"],function(a,b,c,d,e,f,g,h){var i=function(c){c=a(c,{}),this._ellipsoid=a(c.ellipsoid,e.WGS84),this._extent=a(c.extent,f.MAX_VALUE),this._projection=new g(this._ellipsoid),this._numberOfLevelZeroTilesX=a(c.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=a(c.numberOfLevelZeroTilesY,1)};return i.prototype.getEllipsoid=function(){return this._ellipsoid},i.prototype.getExtent=function(){return this._extent},i.prototype.getProjection=function(){return this._projection},i.prototype.getNumberOfXTilesAtLevel=function(a){return this._numberOfLevelZeroTilesX<<a},i.prototype.getNumberOfYTilesAtLevel=function(a){return this._numberOfLevelZeroTilesY<<a},i.prototype.createLevelZeroTiles=function(){return h.createRectangleOfLevelZeroTiles(this,this._numberOfLevelZeroTilesX,this._numberOfLevelZeroTilesY)},i.prototype.extentToNativeExtent=function(a,d){if(typeof a=="undefined")throw new b("extent is required.");var e=c.toDegrees(a.west),g=c.toDegrees(a.south),h=c.toDegrees(a.east),i=c.toDegrees(a.north);return typeof d=="undefined"?new f(e,g,h,i):(d.west=e,d.south=g,d.east=h,d.north=i,d)},i.prototype.tileXYToNativeExtent=function(a,b,d,e){var f=this.tileXYToExtent(a,b,d,e);return f.west=c.toDegrees(f.west),f.south=c.toDegrees(f.south),f.east=c.toDegrees(f.east),f.north=c.toDegrees(f.north),f},i.prototype.tileXYToExtent=function(a,b,c,d){var e=this._extent,g=this.getNumberOfXTilesAtLevel(c),h=this.getNumberOfYTilesAtLevel(c),i=(e.east-e.west)/g,j=a*i+e.west,k=(a+1)*i+e.west,l=(e.north-e.south)/h,m=e.north-b*l,n=e.north-(b+1)*l;return typeof d=="undefined"&&(d=new f(j,n,k,m)),d.west=j,d.south=n,d.east=k,d.north=m,d},i.prototype.positionToTileXY=function(a,b,c){var e=this._extent;if(a.latitude>e.north||a.latitude<e.south||a.longitude<e.west||a.longitude>e.east)return undefined;var f=this.getNumberOfXTilesAtLevel(b),g=this.getNumberOfYTilesAtLevel(b),h=(e.east-e.west)/f,i=(e.north-e.south)/g,j=(a.longitude-e.west)/h|0;j>=f&&(j=f-1);var k=(e.north-a.latitude)/i|0;return k>=g&&(k=g-1),typeof c=="undefined"?new d(j,k):(c.x=j,c.y=k,c)},i}),c("Scene/VerticalOrigin",["../Core/Enumeration"],function(a){var b={CENTER:new a(0,"CENTER"),BOTTOM:new a(1,"BOTTOM"),TOP:new a(-1,"TOP")};return b}),c("DynamicScene/CzmlVerticalOrigin",["../Scene/VerticalOrigin"],function(a){var b={unwrapInterval:function(a){var b=a.verticalOrigin;return typeof b=="undefined"?a:b},isSampled:function(){return!1},getValue:function(b){return a[b]}};return b}),c("DynamicScene/DynamicLabel",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlCartesian2","./CzmlCartesian3","./CzmlNumber","./CzmlString","./CzmlHorizontalOrigin","./CzmlVerticalOrigin","./CzmlLabelStyle","./CzmlColor","./DynamicProperty"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=function(){this.text=undefined,this.font=undefined,this.style=undefined,this.fillColor=undefined,this.outlineColor=undefined,this.horizontalOrigin=undefined,this.verticalOrigin=undefined,this.eyeOffset=undefined,this.pixelOffset=undefined,this.scale=undefined,this.show=undefined};return m.processCzmlPacket=function(b,n){var o=n.label;if(typeof o=="undefined")return!1;var p=!1,q=b.label;p=typeof q=="undefined",p&&(b.label=q=new m);var r=o.interval;typeof r!="undefined"&&(r=a.fromIso8601(r));if(typeof o.fillColor!="undefined"){var s=q.fillColor;typeof s=="undefined"&&(q.fillColor=s=new l(k),p=!0),s.processCzmlIntervals(o.fillColor,r)}if(typeof o.outlineColor!="undefined"){var t=q.outlineColor;typeof t=="undefined"&&(q.outlineColor=t=new l(k),p=!0),t.processCzmlIntervals(o.outlineColor,r)}if(typeof o.eyeOffset!="undefined"){var u=q.eyeOffset;typeof u=="undefined"&&(q.eyeOffset=u=new l(e),p=!0),u.processCzmlIntervals(o.eyeOffset,r)}if(typeof o.horizontalOrigin!="undefined"){var v=q.horizontalOrigin;typeof v=="undefined"&&(q.horizontalOrigin=v=new l(h),p=!0),v.processCzmlIntervals(o.horizontalOrigin,r)}if(typeof o.text!="undefined"){var w=q.text;typeof w=="undefined"&&(q.text=w=new l(g),p=!0),w.processCzmlIntervals(o.text,r)}if(typeof o.pixelOffset!="undefined"){var x=q.pixelOffset;typeof x=="undefined"&&(q.pixelOffset=x=new l(d),p=!0),x.processCzmlIntervals(o.pixelOffset,r)}if(typeof o.scale!="undefined"){var y=q.scale;typeof y=="undefined"&&(q.scale=y=new l(f),p=!0),y.processCzmlIntervals(o.scale,r)}if(typeof o.show!="undefined"){var z=q.show;typeof z=="undefined"&&(q.show=z=new l(c),p=!0),z.processCzmlIntervals(o.show,r)}if(typeof o.verticalOrigin!="undefined"){var A=q.verticalOrigin;typeof A=="undefined"&&(q.verticalOrigin=A=new l(i),p=!0),A.processCzmlIntervals(o.verticalOrigin,r)}if(typeof o.font!="undefined"){var B=q.font;typeof B=="undefined"&&(q.font=B=new l(g),p=!0),B.processCzmlIntervals(o.font,r)}if(typeof o.style!="undefined"){var C=q.style;typeof C=="undefined"&&(q.style=C=new l(j),p=!0),C.processCzmlIntervals(o.style,r)}return p},m.mergeProperties=function(a,c){var d=c.label;if(typeof d!="undefined"){var e=a.label;typeof e=="undefined"&&(a.label=e=new m),e.text=b(e.text,d.text),e.font=b(e.font,d.font),e.show=b(e.show,d.show),e.style=b(e.style,d.style),e.fillColor=b(e.fillColor,d.fillColor),e.outlineColor=b(e.outlineColor,d.outlineColor),e.scale=b(e.scale,d.scale),e.horizontalOrigin=b(e.horizontalOrigin,d.horizontalOrigin),e.verticalOrigin=b(e.verticalOrigin,d.verticalOrigin),e.eyeOffset=b(e.eyeOffset,d.eyeOffset),e.pixelOffset=b(e.pixelOffset,d.pixelOffset)}},m.undefineProperties=function(a){a.label=undefined},m}),c("Scene/Billboard",["../Core/defaultValue","../Core/DeveloperError","../Core/Color","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Math","./HorizontalOrigin","./VerticalOrigin","./SceneMode"],function(a,b,c,d,e,f,g,h,i,j){function v(a,b){var c=a._billboardCollection;typeof c!="undefined"&&(c._updateBillboard(a,b),a._dirty=!0)}var k={},l=function(b,f){b=a(b,k),this._show=a(b.show,!0),this._position=e.clone(a(b.position,e.ZERO)),this._actualPosition=this._position.clone(),this._pixelOffset=d.clone(a(b.pixelOffset,d.ZERO)),this._eyeOffset=e.clone(a(b.eyeOffset,e.ZERO)),this._verticalOrigin=a(b.verticalOrigin,i.CENTER),this._horizontalOrigin=a(b.horizontalOrigin,h.CENTER),this._scale=a(b.scale,1),this._imageIndex=a(b.imageIndex,-1),this._color=c.clone(a(b.color,c.WHITE)),this._pickId=undefined,this._pickIdThis=b._pickIdThis,this._billboardCollection=f,this._dirty=!1,this._index=-1},m=l.SHOW_INDEX=0,n=l.POSITION_INDEX=1,o=l.PIXEL_OFFSET_INDEX=2,p=l.EYE_OFFSET_INDEX=3,q=l.HORIZONTAL_ORIGIN_INDEX=4,r=l.VERTICAL_ORIGIN_INDEX=5,s=l.SCALE_INDEX=6,t=l.IMAGE_INDEX_INDEX=7,u=l.COLOR_INDEX=8;l.NUMBER_OF_PROPERTIES=9,l.prototype.getPickId=function(a){return this._pickId=this._pickId||a.createPickId(this._pickIdThis||this),this._pickId},l.prototype.getShow=function(){return this._show},l.prototype.setShow=function(a){if(typeof a=="undefined")throw new b("value is required.");a!==this._show&&(this._show=a,v(this,m))},l.prototype.getPosition=function(){return this._position},l.prototype.setPosition=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._position;e.equals(c,a)||(e.clone(a,c),e.clone(a,this._actualPosition),v(this,n))},l.prototype._getActualPosition=function(){return this._actualPosition},l.prototype._setActualPosition=function(a){e.clone(a,this._actualPosition),v(this,n)},l.prototype.getPixelOffset=function(){return this._pixelOffset},l.prototype.setPixelOffset=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._pixelOffset;d.equals(c,a)||(d.clone(a,c),v(this,o))},l.prototype.getEyeOffset=function(){return this._eyeOffset},l.prototype.setEyeOffset=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._eyeOffset;e.equals(c,a)||(e.clone(a,c),v(this,p))},l.prototype.getHorizontalOrigin=function(){return this._horizontalOrigin},l.prototype.setHorizontalOrigin=function(a){if(typeof a=="undefined")throw new b("value is required.");this._horizontalOrigin!==a&&(this._horizontalOrigin=a,v(this,q))},l.prototype.getVerticalOrigin=function(){return this._verticalOrigin},l.prototype.setVerticalOrigin=function(a){if(typeof a=="undefined")throw new b("value is required.");this._verticalOrigin!==a&&(this._verticalOrigin=a,v(this,r))},l.prototype.getScale=function(){return this._scale},l.prototype.setScale=function(a){if(typeof a=="undefined")throw new b("value is required.");this._scale!==a&&(this._scale=a,v(this,s))},l.prototype.getImageIndex=function(){return this._imageIndex},l.prototype.setImageIndex=function(a){if(typeof a!="number")throw new b("value is required and must be a number.");this._imageIndex!==a&&(this._imageIndex=a,v(this,t))},l.prototype.getColor=function(){return this._color},l.prototype.setColor=function(a){if(typeof a=="undefined")throw new b("value is required.");var d=this._color;c.equals(d,a)||(c.clone(a,d),v(this,u))};var w=new f;return l._computeActualPosition=function(a,b,c,d){var f=b.mode;if(f===j.SCENE3D)return a;var h=b.scene2D.projection,i,k;d.multiplyByPoint(a,w);if(f===j.MORPHING){i=h.getEllipsoid().cartesianToCartographic(w),k=h.project(i);var l=g.lerp(k.z,w.x,c),m=g.lerp(k.x,w.y,c),n=g.lerp(k.y,w.z,c);return new e(l,m,n)}i=h.getEllipsoid().cartesianToCartographic(w),k=h.project(i);if(f===j.SCENE2D)return new e(0,k.x,k.y);if(f===j.COLUMBUS_VIEW)return new e(k.z,k.x,k.y)},l._computeScreenSpacePosition=function(a,b,c,e,f,g){var h=g.getView().multiply(a),i=h.multiplyByPoint(b),j=c.multiplyComponents(i.normalize());i.x+=c.x+j.x,i.y+=c.y+j.y,i.z+=j.z;var k=g.getProjection().multiplyByVector(i);k.x/=k.w,k.y/=k.w,k.z/=k.w;var l=g.getViewportTransformation().multiplyByPoint(k),m=e.multiplyByScalar(g.getHighResolutionSnapScale());return l.x+=m.x,l.y+=m.y,f?new d(Math.floor(l.x),Math.floor(l.y)):new d(l.x,l.y)},l.prototype.computeScreenSpacePosition=function(a){var c=this._billboardCollection;if(typeof c=="undefined")throw new b("Billboard must be in a collection.  Was it removed?");if(!a)throw new b("uniformState is required.");return l._computeScreenSpacePosition(c.modelMatrix,this._actualPosition,this._eyeOffset,this._pixelOffset,this.clampToPixel,a)},l.prototype.equals=function(a){return this===a||typeof a!="undefined"&&this._show===a._show&&this._imageIndex===a._imageIndex&&this._scale===a._scale&&this._verticalOrigin===a._verticalOrigin&&this._horizontalOrigin===a._horizontalOrigin&&e.equals(this._position,a._position)&&c.equals(this._color,a._color)&&d.equals(this._pixelOffset,a._pixelOffset)&&e.equals(this._eyeOffset,a._eyeOffset)},l.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=undefined},l}),c("Scene/Label",["../Core/defaultValue","../Core/DeveloperError","../Core/Cartesian2","../Core/Cartesian3","../Core/Color","./Billboard","./LabelStyle","./HorizontalOrigin","./VerticalOrigin"],function(a,b,c,d,e,f,g,h,i){function k(a){!a._rebindAllGlyphs&&!a._repositionAllGlyphs&&a._labelCollection._labelsToUpdate.push(a),a._rebindAllGlyphs=!0}function l(a){!a._rebindAllGlyphs&&!a._repositionAllGlyphs&&a._labelCollection._labelsToUpdate.push(a),a._repositionAllGlyphs=!0}var j={},m=function(b,f,k){b=a(b,j),this._text=a(b.text,""),this._show=a(b.show,!0),this._font=a(b.font,"30px sans-serif"),this._fillColor=e.clone(a(b.fillColor,e.WHITE)),this._outlineColor=e.clone(a(b.outlineColor,e.BLACK)),this._style=a(b.style,g.FILL),this._verticalOrigin=a(b.verticalOrigin,i.BOTTOM),this._horizontalOrigin=a(b.horizontalOrigin,h.LEFT),this._pixelOffset=c.clone(a(b.pixelOffset,c.ZERO)),this._eyeOffset=d.clone(a(b.eyeOffset,d.ZERO)),this._position=d.clone(a(b.position,d.ZERO)),this._scale=a(b.scale,1),this._labelCollection=f,this._index=k,this._glyphs=[],this._rebindAllGlyphs=!0,this._repositionAllGlyphs=!0};return m.prototype.getShow=function(){return this._show},m.prototype.setShow=function(a){if(typeof a=="undefined")throw new b("value is required.");if(a!==this._show){this._show=a;var c=this._glyphs;for(var d=0,e=c.length;d<e;d++){var f=c[d];typeof f.billboard!="undefined"&&f.billboard.setShow(a)}}},m.prototype.getPosition=function(){return this._position},m.prototype.setPosition=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._position;if(!d.equals(c,a)){d.clone(a,c);var e=this._glyphs;for(var f=0,g=e.length;f<g;f++){var h=e[f];typeof h.billboard!="undefined"&&h.billboard.setPosition(a)}}},m.prototype.getText=function(){return this._text},m.prototype.setText=function(a){if(typeof a=="undefined")throw new b("value is required.");a!==this._text&&(this._text=a,k(this))},m.prototype.getFont=function(){return this._font},m.prototype.setFont=function(a){if(typeof a=="undefined")throw new b("value is required.");this._font!==a&&(this._font=a,k(this))},m.prototype.getFillColor=function(){return this._fillColor},m.prototype.setFillColor=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._fillColor;e.equals(c,a)||(e.clone(a,c),k(this))},m.prototype.getOutlineColor=function(){return this._outlineColor},m.prototype.setOutlineColor=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._outlineColor;e.equals(c,a)||(e.clone(a,c),k(this))},m.prototype.getStyle=function(){return this._style},m.prototype.setStyle=function(a){if(typeof a=="undefined")throw new b("value is required.");this._style!==a&&(this._style=a,k(this))},m.prototype.getPixelOffset=function(){return this._pixelOffset},m.prototype.setPixelOffset=function(a){if(typeof a=="undefined")throw new b("value is required.");var d=this._pixelOffset;c.equals(d,a)||(c.clone(a,d),l(this))},m.prototype.getEyeOffset=function(){return this._eyeOffset},m.prototype.setEyeOffset=function(a){if(typeof a=="undefined")throw new b("value is required.");var c=this._eyeOffset;if(!d.equals(c,a)){d.clone(a,c);var e=this._glyphs;for(var f=0,g=e.length;f<g;f++){var h=e[f];typeof h.billboard!="undefined"&&h.billboard.setEyeOffset(a)}}},m.prototype.getHorizontalOrigin=function(){return this._horizontalOrigin},m.prototype.setHorizontalOrigin=function(a){if(typeof a=="undefined")throw new b("value is required.");this._horizontalOrigin!==a&&(this._horizontalOrigin=a,l(this))},m.prototype.getVerticalOrigin=function(){return this._verticalOrigin},m.prototype.setVerticalOrigin=function(a){if(typeof a=="undefined")throw new b("value is required.");this._verticalOrigin!==a&&(this._verticalOrigin=a,l(this))},m.prototype.getScale=function(){return this._scale},m.prototype.setScale=function(a){if(typeof a=="undefined")throw new b("value is required.");if(this._scale!==a){this._scale=a;var c=this._glyphs;for(var d=0,e=c.length;d<e;d++){var f=c[d];typeof f.billboard!="undefined"&&f.billboard.setScale(a)}l(this)}},m.prototype.computeScreenSpacePosition=function(a,c){if(typeof a=="undefined")throw new b("uniformState is required.");if(typeof c=="undefined")throw new b("frameState is required.");var d=this._labelCollection,e=d.modelMatrix,g=f._computeActualPosition(this._position,c,d.morphTime,e);return f._computeScreenSpacePosition(e,g,this._eyeOffset,this._pixelOffset,d.clampToPixel,a)},m.prototype.equals=function(a){return this===a||typeof a!="undefined"&&this._show===a._show&&this._scale===a._scale&&this._style===a._style&&this._verticalOrigin===a._verticalOrigin&&this._horizontalOrigin===a._horizontalOrigin&&this._text===a._text&&this._font===a._font&&d.equals(this._position,a._position)&&e.equals(this._fillColor,a._fillColor)&&e.equals(this._outlineColor,a._outlineColor)&&c.equals(this._pixelOffset,a._pixelOffset)&&d.equals(this._eyeOffset,a._eyeOffset)},m.prototype.isDestroyed=function(){return!1},m}),c("Scene/WebMercatorTilingScheme",["../Core/defaultValue","../Core/DeveloperError","../Core/Math","../Core/Ellipsoid","../Core/Extent","../Core/Cartesian2","../Core/Cartographic","../Core/WebMercatorProjection","./TilingScheme"],function(a,b,c,d,e,f,g,h,i){var j=function(c){c=a(c,{}),this._ellipsoid=a(c.ellipsoid,d.WGS84),this._numberOfLevelZeroTilesX=a(c.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=a(c.numberOfLevelZeroTilesY,1),this._projection=new h(this._ellipsoid);if(typeof c.extentSouthwestInMeters!="undefined"&&typeof c.extentNortheastInMeters!="undefined")this._extentSouthwestInMeters=c.extentSouthwestInMeters,this._extentNortheastInMeters=c.extentNortheastInMeters;else{var g=this._ellipsoid.getMaximumRadius()*Math.PI;this._extentSouthwestInMeters=new f(-g,-g),this._extentNortheastInMeters=new f(g,g)}var i=this._projection.unproject(this._extentSouthwestInMeters),j=this._projection.unproject(this._extentNortheastInMeters);this._extent=new e(i.longitude,i.latitude,j.longitude,j.latitude)};return j.prototype.getEllipsoid=function(){return this._ellipsoid},j.prototype.getExtent=function(){return this._extent},j.prototype.getProjection=function(){return this._projection},j.prototype.getNumberOfXTilesAtLevel=function(a){return this._numberOfLevelZeroTilesX<<a},j.prototype.getNumberOfYTilesAtLevel=function(a){return this._numberOfLevelZeroTilesY<<a},j.prototype.createLevelZeroTiles=function(){return i.createRectangleOfLevelZeroTiles(this,this._numberOfLevelZeroTilesX,this._numberOfLevelZeroTilesY)},j.prototype.extentToNativeExtent=function(a,b){var c=this._projection,d=c.project(a.getSouthwest()),f=c.project(a.getNortheast());return typeof b=="undefined"?new e(d.x,d.y,f.x,f.y):(b.west=d.x,b.south=d.y,b.east=f.x,b.north=f.y,b)},j.prototype.tileXYToNativeExtent=function(a,b,c,d){var f=this.getNumberOfXTilesAtLevel(c),g=this.getNumberOfYTilesAtLevel(c),h=(this._extentNortheastInMeters.x-this._extentSouthwestInMeters.x)/f,i=this._extentSouthwestInMeters.x+a*h,j=this._extentSouthwestInMeters.x+(a+1)*h,k=(this._extentNortheastInMeters.y-this._extentSouthwestInMeters.y)/g,l=this._extentNortheastInMeters.y-b*k,m=this._extentNortheastInMeters.y-(b+1)*k;return typeof d=="undefined"?new e(i,m,j,l):(d.west=i,d.south=m,d.east=j,d.north=l,d)},j.prototype.tileXYToExtent=function(a,b,c,d){var e=this.tileXYToNativeExtent(a,b,c,d),g=this._projection,h=g.unproject(new f(e.west,e.south)),i=g.unproject(new f(e.east,e.north));return e.west=h.longitude,e.south=h.latitude,e.east=i.longitude,e.north=i.latitude,e},j.prototype.positionToTileXY=function(a,b,c){var d=this._extent;if(a.latitude>d.north||a.latitude<d.south||a.longitude<d.west||a.longitude>d.east)return undefined;var e=this.getNumberOfXTilesAtLevel(b),g=this.getNumberOfYTilesAtLevel(b),h=this._extentNortheastInMeters.x-this._extentSouthwestInMeters.x,i=h/e,j=this._extentNortheastInMeters.y-this._extentSouthwestInMeters.y,k=j/g,l=this._projection,m=l.project(a),n=m.x-this._extentSouthwestInMeters.x,o=this._extentNortheastInMeters.y-m.y,p=n/i|0;p>=e&&(p=e-1);var q=o/k|0;return q>=g&&(q=g-1),typeof c=="undefined"?new f(p,q):(c.x=p,c.y=q,c)},j}),c("Shaders/BillboardCollectionFS",[],function(){return"uniform sampler2D u_atlas;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef RENDER_FOR_PICK\nvarying vec4 v_pickColor;\n#else\nvarying vec4 v_color;\n#endif\n\nvoid main()\n{\n#ifdef RENDER_FOR_PICK\n    vec4 vertexColor = vec4(1.0, 1.0, 1.0, 1.0);\n#else\n    vec4 vertexColor = v_color;\n#endif\n    \n    vec4 color = texture2D(u_atlas, v_textureCoordinates) * vertexColor;\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n    \n#ifdef RENDER_FOR_PICK\n    gl_FragColor = v_pickColor;\n#else\n    gl_FragColor = color;\n#endif\n}"}),c("Shaders/BillboardCollectionVS",[],function(){return"attribute vec3 positionHigh;\nattribute vec3 positionLow;\nattribute vec2 direction;                       // in screen space\nattribute vec4 textureCoordinatesAndImageSize;  // size in normalized texture coordinates\nattribute vec3 originAndShow;                   // show is 0.0 (false) or 1.0 (true)\nattribute vec2 pixelOffset;\nattribute vec4 eyeOffsetAndScale;                       // eye offset in meters\n\n#ifdef RENDER_FOR_PICK\nattribute vec4 pickColor;\n#else\nattribute vec4 color;\n#endif\n\nuniform vec2 u_atlasSize;\nuniform float u_clampToPixel; // clamp is 1.0 (true) or 0.0 (false)\n\nuniform float u_morphTime;\n\nconst vec2 czm_highResolutionSnapScale = vec2(1.0, 1.0);    // TODO\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef RENDER_FOR_PICK\nvarying vec4 v_pickColor;\n#else\nvarying vec4 v_color;\n#endif\n\nvoid main() \n{\n    // Modifying this shader may also require modifications to Billboard.computeScreenSpacePosition\n    \n    // unpack attributes\n    vec3 eyeOffset = eyeOffsetAndScale.xyz;\n    float scale = eyeOffsetAndScale.w;\n    vec2 textureCoordinates = textureCoordinatesAndImageSize.xy;\n    vec2 imageSize = textureCoordinatesAndImageSize.zw;\n    vec2 origin = originAndShow.xy;\n    float show = originAndShow.z;\n    \n    ///////////////////////////////////////////////////////////////////////////\n    \n    vec4 p = vec4(czm_translateRelativeToEye(positionHigh, positionLow), 1.0);\n    vec4 positionEC = czm_modelViewRelativeToEye * p;\n    positionEC = czm_eyeOffset(positionEC, eyeOffset);\n    positionEC.xyz *= show;\n    \n    ///////////////////////////////////////////////////////////////////////////     \n    \n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n    \n    vec2 halfSize = u_atlasSize * imageSize * 0.5 * scale * czm_highResolutionSnapScale;\n    halfSize *= ((direction * 2.0) - 1.0);\n\n    positionWC.xy += (origin * abs(halfSize)) + halfSize;\n    positionWC.xy += (pixelOffset * czm_highResolutionSnapScale);\n    positionWC.xy = mix(positionWC.xy, floor(positionWC.xy), u_clampToPixel);\n\n    gl_Position = czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\n    v_textureCoordinates = textureCoordinates;\n\n#ifdef RENDER_FOR_PICK\n    v_pickColor = pickColor;\n#else\n    v_color = color;\n#endif\n}\n"}),c("Scene/BillboardCollection",["../Core/DeveloperError","../Core/combine","../Core/destroyObject","../Core/Math","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/EncodedCartesian3","../Core/Matrix4","../Core/ComponentDatatype","../Core/IndexDatatype","../Core/PrimitiveType","../Core/BoundingSphere","../Renderer/BlendingState","../Renderer/BufferUsage","../Renderer/CommandLists","../Renderer/DrawCommand","../Renderer/VertexArrayFacade","./SceneMode","./Billboard","./HorizontalOrigin","../Shaders/BillboardCollectionVS","../Shaders/BillboardCollectionFS"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function M(a){if(a._billboardsRemoved){a._billboardsRemoved=!1;var b=[],c=a._billboards,d=c.length;for(var e=0,f=0;e<d;++e){var g=c[e];g&&(g._index=f++,b.push(g))}a._billboards=b}}function N(a){var b=16384;a._primitivesCache=a._primitivesCache||{};var c=a._primitivesCache;c._billboardCollection=c._billboardCollection||{};var d=c._billboardCollection;if(d.directionsVertexBuffer)return d.directionsVertexBuffer;d.directionsVertexBuffer=d.directionsVertexBuffer&&d.directionsVertexBuffer.destroy();var e=new Uint8Array(b*4*2);for(var f=0,g=0;f<b;++f)e[g++]=0,e[g++]=0,e[g++]=255,e[g++]=0,e[g++]=255,e[g++]=255,e[g++]=0,e[g++]=255;return d.directionsVertexBuffer=a.createVertexBuffer(e,o.STATIC_DRAW),d.directionsVertexBuffer.setVertexArrayDestroyable(!1),d.directionsVertexBuffer}function O(a){var b=16384;a._primitivesCache=a._primitivesCache||{};var c=a._primitivesCache;c._billboardCollection=c._billboardCollection||{};var d=c._billboardCollection;if(d.indexBuffer)return d.indexBuffer;var e=b*6,f=new Uint16Array(e);for(var g=0,h=0;g<e;g+=6,h+=4)f[g+0]=h+0,f[g+1]=h+1,f[g+2]=h+2,f[g+3]=h+0,f[g+4]=h+2,f[g+5]=h+3;return d.indexBuffer=a.createIndexBuffer(f,o.STATIC_DRAW,k.UNSIGNED_SHORT),d.indexBuffer.setVertexArrayDestroyable(!1),d.indexBuffer}function P(a,b,c){var d=N(a);return new r(a,[{index:H.positionHigh,componentsPerAttribute:3,componentDatatype:j.FLOAT,usage:c[y]},{index:H.positionLow,componentsPerAttribute:3,componentDatatype:j.FLOAT,usage:c[y]},{index:H.pixelOffset,componentsPerAttribute:2,componentDatatype:j.FLOAT,usage:c[z]},{index:H.eyeOffsetAndScale,componentsPerAttribute:4,componentDatatype:j.FLOAT,usage:c[D]},{index:H.textureCoordinatesAndImageSize,componentsPerAttribute:4,normalize:!0,componentDatatype:j.UNSIGNED_SHORT,usage:c[E]},{index:H.pickColor,componentsPerAttribute:4,normalize:!0,componentDatatype:j.UNSIGNED_BYTE,usage:o.STATIC_DRAW,purpose:K},{index:H.color,componentsPerAttribute:4,normalize:!0,componentDatatype:j.UNSIGNED_BYTE,usage:c[F],purpose:J},{index:H.originAndShow,componentsPerAttribute:3,componentDatatype:j.BYTE,usage:c[x]},{index:H.direction,vertexBuffer:d,componentsPerAttribute:2,normalize:!0,componentDatatype:j.UNSIGNED_BYTE}],4*b)}function R(a,b,c,d,e){var f=e._index*4,g=e._getActualPosition();a._mode===s.SCENE3D&&a._baseVolume.expand(g,a._baseVolume),h.fromCartesian(g,Q);var i=d[I],j=i[H.positionHigh],k=Q.high;j(f+0,k.x,k.y,k.z),j(f+1,k.x,k.y,k.z),j(f+2,k.x,k.y,k.z),j(f+3,k.x,k.y,k.z);var l=i[H.positionLow],m=Q.low;l(f+0,m.x,m.y,m.z),l(f+1,m.x,m.y,m.z),l(f+2,m.x,m.y,m.z),l(f+3,m.x,m.y,m.z)}function S(a,b,c,d,e){var f=e._index*4,g=e.getPixelOffset();a._maxPixelOffset=Math.max(a._maxPixelOffset,g.x,g.y);var h=d[I],i=h[H.pixelOffset];i(f+0,g.x,g.y),i(f+1,g.x,g.y),i(f+2,g.x,g.y),i(f+3,g.x,g.y)}function T(a,b,c,d,e){var f=e._index*4,g=e.getEyeOffset(),h=e.getScale();a._maxEyeOffset=Math.max(a._maxEyeOffset,Math.abs(g.x),Math.abs(g.y),Math.abs(g.z)),a._maxScale=Math.max(a._maxScale,h);var i=d[I],j=i[H.eyeOffsetAndScale];j(f+0,g.x,g.y,g.z,h),j(f+1,g.x,g.y,g.z,h),j(f+2,g.x,g.y,g.z,h),j(f+3,g.x,g.y,g.z,h)}function U(a,b,c,d,e){var f=e._index*4,g=e.getPickId(b).unnormalizedRgb,h=d[K],i=h[H.pickColor];i(f+0,g.red,g.green,g.blue,255),i(f+1,g.red,g.green,g.blue,255),i(f+2,g.red,g.green,g.blue,255),i(f+3,g.red,g.green,g.blue,255)}function V(a,b,c,d,e){var f=e._index*4,g=e.getColor(),h=d[J],i=h[H.color];i(f+0,g.red*255,g.green*255,g.blue*255,g.alpha*255),i(f+1,g.red*255,g.green*255,g.blue*255,g.alpha*255),i(f+2,g.red*255,g.green*255,g.blue*255,g.alpha*255),i(f+3,g.red*255,g.green*255,g.blue*255,g.alpha*255)}function W(a,b,c,d,e){var f=e._index*4,g=e.getHorizontalOrigin().value,h=e.getVerticalOrigin().value,i=e.getShow();e.getColor().alpha===0&&(i=!1),a._allHorizontalCenter=a._allHorizontalCenter&&g===u.CENTER.value;var j=d[I],k=j[H.originAndShow];k(f+0,g,h,i),k(f+1,g,h,i),k(f+2,g,h,i),k(f+3,g,h,i)}function X(b,c,d,e,f){var g=f._index*4,h=0,i=0,j=0,k=0,l=f.getImageIndex();if(l!==-1){var m=d[l];if(typeof m=="undefined")throw new a("Invalid billboard image index: "+l);h=m.x,i=m.y,j=m.width,k=m.height}var n=h+j,o=i+k;b._maxSize=Math.max(b._maxSize,j,k);var p=e[I],q=p[H.textureCoordinatesAndImageSize];q(g+0,h*65535,i*65535,j*65535,k*65535),q(g+1,n*65535,i*65535,j*65535,k*65535),q(g+2,n*65535,o*65535,j*65535,k*65535),q(g+3,h*65535,o*65535,j*65535,k*65535)}function Y(a,b,c,d,e){R(a,b,c,d,e),S(a,b,c,d,e),T(a,b,c,d,e),U(a,b,c,d,e),V(a,b,c,d,e),W(a,b,c,d,e),X(a,b,c,d,e)}function Z(a,b,c,d,e,f){var g;c.mode===s.SCENE3D?g=a._baseVolume:g=a._baseVolume2D;var h=b.length,i=new Array(h);for(var j=0;j<h;++j){var k=b[j],l=k.getPosition(),n=t._computeActualPosition(l,c,d,e);k._setActualPosition(n),f?i[j]=n:g.expand(n,g)}f&&m.fromPoints(i,g)}function $(a,b){var c=b.mode,d=b.scene2D.projection,e=a._billboards,f=a._billboardsToUpdate,g=a.morphTime,h=a._modelMatrix;a._mode!==c||a._projection!==d||c!==s.SCENE3D&&!h.equals(a.modelMatrix)?(a._mode=c,a._projection=d,a.modelMatrix.clone(h),a._createVertexArray=!0,(c===s.SCENE3D||c===s.SCENE2D||c===s.COLUMBUS_VIEW)&&Z(a,e,b,g,h,!0)):c===s.MORPHING?Z(a,e,b,g,h,!0):(c===s.SCENE2D||c===s.COLUMBUS_VIEW)&&Z(a,f,b,g,h,!1)}function cb(a,b,c,d){var e=c.camera,f=e.frustum,g=a._textureAtlas.getTexture().getDimensions(),h=Math.max(g.x,g.y),i,j,k,l=e.getPositionWC().subtract(d.center,ab),m=e.getDirectionWC().multiplyByScalar(l.dot(e.getDirectionWC()),bb),n=Math.max(0,m.magnitude()-d.radius),o=b.getCanvas();_.x=o.clientWidth,_.y=o.clientHeight;var p=f.getPixelSize(_,n);i=Math.max(p.x,p.y),j=i*a._maxScale*a._maxSize*h,a._allHorizontalCenter&&(j*=.5),k=i*a._maxPixelOffset+a._maxEyeOffset,d.radius+=j+k}var x=t.SHOW_INDEX,y=t.POSITION_INDEX,z=t.PIXEL_OFFSET_INDEX,A=t.EYE_OFFSET_INDEX,B=t.HORIZONTAL_ORIGIN_INDEX,C=t.VERTICAL_ORIGIN_INDEX,D=t.SCALE_INDEX,E=t.IMAGE_INDEX_INDEX,F=t.COLOR_INDEX,G=t.NUMBER_OF_PROPERTIES,H={positionHigh:0,positionLow:1,pixelOffset:2,eyeOffsetAndScale:3,textureCoordinatesAndImageSize:4,originAndShow:5,direction:6,pickColor:7,color:7},I="all",J="color",K="pick",L=function(){this._textureAtlas=undefined,this._textureAtlasGUID=undefined,this._destroyTextureAtlas=!0,this._sp=undefined,this._rs=undefined,this._vaf=undefined,this._rsPick=undefined,this._spPick=undefined,this._billboards=[],this._billboardsToUpdate=[],this._billboardsRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(G),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._baseVolume=new m,this._baseVolume2D=new m,this._boundingVolume=new m,this._commandLists=new p,this.modelMatrix=i.IDENTITY.clone(),this._modelMatrix=i.IDENTITY.clone(),this._mode=s.SCENE3D,this._projection=undefined,this.clampToPixel=!1,this.morphTime=this._mode.morphTime,this._buffersUsage=[o.STATIC_DRAW,o.STATIC_DRAW,o.STATIC_DRAW,o.STATIC_DRAW,o.STATIC_DRAW,o.STATIC_DRAW,o.STATIC_DRAW,o.STATIC_DRAW,o.STATIC_DRAW];var a=this;this._uniforms={u_atlas:function(){return a._textureAtlas.getTexture()},u_atlasSize:function(){return a._textureAtlas.getTexture().getDimensions()},u_clampToPixel:function(){return a.clampToPixel?1:0},u_morphTime:function(){return a.morphTime}}};L.prototype.add=function(a){var b=new t(a,this);return b._index=this._billboards.length,this._billboards.push(b),this._createVertexArray=!0,b},L.prototype.remove=function(a){return this.contains(a)?(this._billboards[a._index]=null,this._billboardsRemoved=!0,this._createVertexArray=!0,a._destroy(),!0):!1},L.prototype.removeAll=function(){this._destroyBillboards(),this._billboards=[],this._billboardsToUpdate=[],this._billboardsRemoved=!1,this._createVertexArray=!0},L.prototype._updateBillboard=function(a,b){a._dirty||this._billboardsToUpdate.push(a),++this._propertiesChanged[b]},L.prototype.contains=function(a){return typeof a!="undefined"&&a._billboardCollection===this},L.prototype.get=function(b){if(typeof b=="undefined")throw new a("index is required.");return M(this),this._billboards[b]},L.prototype.getLength=function(){return M(this),this._billboards.length},L.prototype.getTextureAtlas=function(){return this._textureAtlas},L.prototype.setTextureAtlas=function(a){this._textureAtlas!==a&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=a,this._createVertexArray=!0)},L.prototype.getDestroyTextureAtlas=function(){return this._destroyTextureAtlas},L.prototype.setDestroyTextureAtlas=function(a){this._destroyTextureAtlas=a},L.prototype.computeNewBuffersUsage=function(){var a=this._buffersUsage,b=!1,c=this._propertiesChanged;for(var d=0;d<G;++d){var e=c[d]===0?o.STATIC_DRAW:o.STREAM_DRAW;b=b||a[d]!==e,a[d]=e}return b};var Q=new h,_=new e,ab=new f,bb=new f;return L.prototype.update=function(a,b,c){var d=this._textureAtlas;if(typeof d=="undefined")return;var e=d.getTextureCoordinates();if(e.length===0)return;M(this),$(this,b);var f=this._billboards,g=f.length,h=this._propertiesChanged,j=d.getGUID(),k=this._createVertexArray||this._textureAtlasGUID!==j;this._textureAtlasGUID=j;var o;if(k||this.computeNewBuffersUsage()){this._createVertexArray=!1,this._vaf=this._vaf&&this._vaf.destroy();if(g>0){this._vaf=P(a,f.length,this._buffersUsage),o=this._vaf.writers;for(var p=0;p<g;++p){var r=this._billboards[p];r._dirty=!1,Y(this,a,e,o,r)}this._vaf.commit(O(a))}this._billboardsToUpdate=[]}else{var t=this._billboardsToUpdate,u=t.length;if(u){var I=[];h[y]&&I.push(R),h[z]&&I.push(S),(h[A]||h[D])&&I.push(T),h[E]&&I.push(X),h[F]&&I.push(V),(h[B]||h[C]||h[x])&&I.push(W),o=this._vaf.writers;if(u/g>.1){for(var L=0;L<u;++L){var N=t[L];N._dirty=!1;for(var Q=0;Q<I.length;++Q)I[Q](this,a,e,o,N)}this._vaf.commit(O(a))}else{for(var U=0;U<u;++U){var Z=t[U];Z._dirty=!1;for(var _=0;_<I.length;++_)I[_](this,a,e,o,Z);this._vaf.subCommit(Z._index*4,4)}this._vaf.endSubCommits()}this._billboardsToUpdate=[]}}for(var ab=0;ab<G;++ab)h[ab]=0;if(typeof this._vaf=="undefined"||typeof this._vaf.vaByPurpose=="undefined")return;var bb,db=i.IDENTITY;b.mode===s.SCENE3D?(db=this.modelMatrix,bb=m.clone(this._baseVolume,this._boundingVolume)):typeof this._baseVolume2D!="undefined"&&(bb=m.clone(this._baseVolume2D,this._boundingVolume)),cb(this,a,b,bb);var eb=b.passes,fb,gb,hb,ib,jb;this._commandLists.removeAll();if(eb.color){typeof this._sp=="undefined"&&(this._rs=a.createRenderState({depthTest:{enabled:!0},blending:n.ALPHA_BLEND}),this._sp=a.getShaderCache().getShaderProgram(v,w,H)),fb=this._vaf.vaByPurpose[J],gb=fb.length,hb=this._commandLists.colorList,hb.length=gb;for(jb=0;jb<gb;++jb)ib=hb[jb],typeof ib=="undefined"&&(ib=hb[jb]=new q),ib.boundingVolume=bb,ib.modelMatrix=db,ib.primitiveType=l.TRIANGLES,ib.count=fb[jb].indicesCount,ib.shaderProgram=this._sp,ib.uniformMap=this._uniforms,ib.vertexArray=fb[jb].va,ib.renderState=this._rs}if(eb.pick){typeof this._spPick=="undefined"&&(this._rsPick=a.createRenderState({depthTest:{enabled:!0}}),this._spPick=a.getShaderCache().getShaderProgram("#define RENDER_FOR_PICK 1\n"+v,"#define RENDER_FOR_PICK 1\n"+w,H)),fb=this._vaf.vaByPurpose[K],gb=fb.length,hb=this._commandLists.pickList,hb.length=gb;for(jb=0;jb<gb;++jb)ib=hb[jb],typeof ib=="undefined"&&(ib=hb[jb]=new q),ib.boundingVolume=bb,ib.modelMatrix=db,ib.primitiveType=l.TRIANGLES,ib.count=fb[jb].indicesCount,ib.shaderProgram=this._spPick,ib.uniformMap=this._uniforms,ib.vertexArray=fb[jb].va,ib.renderState=this._rsPick}this._commandLists.empty()||c.push(this._commandLists)},L.prototype.isDestroyed=function(){return!1},L.prototype.destroy=function(){return this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.release(),this._spPick=this._spPick&&this._spPick.release(),this._vaf=this._vaf&&this._vaf.destroy(),this._destroyBillboards(),c(this)},L.prototype._destroyBillboards=function(){var a=this._billboards,b=a.length;for(var c=0;c<b;++c)a[c]&&a[c]._destroy()},L}),c("Shaders/BuiltinFunctions",[],function(){return"/**\n * DOC_TBA\n *\n * @name czm_infinity\n * @glslConstant \n */\nconst float czm_infinity = 5906376272000.0; // Distance from the Sun to Pluto in meters.  TODO: What is best given lowp, mediump, and highp?\n\n/**\n * DOC_TBA\n *\n * @name czm_epsilon1\n * @glslConstant \n */\nconst float czm_epsilon1 = 0.1;\n        \n/**\n * DOC_TBA\n *\n * @name czm_epsilon2\n * @glslConstant \n */\nconst float czm_epsilon2 = 0.01;\n        \n/**\n * DOC_TBA\n *\n * @name czm_epsilon3\n * @glslConstant \n */\nconst float czm_epsilon3 = 0.001;\n        \n/**\n * DOC_TBA\n *\n * @name czm_epsilon4\n * @glslConstant \n */\nconst float czm_epsilon4 = 0.0001;\n        \n/**\n * DOC_TBA\n *\n * @name czm_epsilon5\n * @glslConstant \n */\nconst float czm_epsilon5 = 0.00001;\n        \n/**\n * DOC_TBA\n *\n * @name czm_epsilon6\n * @glslConstant \n */\nconst float czm_epsilon6 = 0.000001;\n        \n/**\n * DOC_TBA\n *\n * @name czm_epsilon7\n * @glslConstant \n */\nconst float czm_epsilon7 = 0.0000001;\n\n/**\n * DOC_TBA\n *\n * @name czm_equalsEpsilon\n * @glslFunction\n */\nbool czm_equalsEpsilon(float left, float right, float epsilon) {\n    return (abs(left - right) <= epsilon);\n}\n\nbool czm_equalsEpsilon(float left, float right) {\n    // Workaround bug in Opera Next 12.  Do not delegate to the other czm_equalsEpsilon.\n    return (abs(left - right) <= czm_epsilon7);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Returns the transpose of the matrix.  The input <code>matrix</code> can be \n * a <code>mat2</code>, <code>mat3</code>, or <code>mat4</code>.\n *\n * @name czm_transpose\n * @glslFunction\n *\n * @param {} matrix The matrix to transpose.\n *\n * @returns {} The transposed matrix.\n *\n * @example\n * // GLSL declarations\n * mat2 czm_transpose(mat2 matrix);\n * mat3 czm_transpose(mat3 matrix);\n * mat4 czm_transpose(mat4 matrix);\n *\n * // Tranpose a 3x3 rotation matrix to find its inverse.\n * mat3 eastNorthUpToEye = czm_eastNorthUpToEyeCoordinates(\n *     positionMC, normalEC);\n * mat3 eyeToEastNorthUp = czm_transpose(eastNorthUpToEye);\n */\nmat2 czm_transpose(mat2 matrix)\n{\n    return mat2(\n        matrix[0][0], matrix[1][0],\n        matrix[0][1], matrix[1][1]);\n}\n\nmat3 czm_transpose(mat3 matrix)\n{\n    return mat3(\n        matrix[0][0], matrix[1][0], matrix[2][0],\n        matrix[0][1], matrix[1][1], matrix[2][1],\n        matrix[0][2], matrix[1][2], matrix[2][2]);\n}\n\nmat4 czm_transpose(mat4 matrix)\n{\n    return mat4(\n        matrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],\n        matrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],\n        matrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],\n        matrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Transforms a position from model to window coordinates.  The transformation\n * from model to clip coordinates is done using {@link czm_modelViewProjection}.\n * The transform from normalized device coordinates to window coordinates is\n * done using {@link czm_viewportTransformation}, which assumes a depth range\n * of <code>near = 0</code> and <code>far = 1</code>.\n * <br /><br />\n * This transform is useful when there is a need to manipulate window coordinates\n * in a vertex shader as done by {@link BillboardCollection}.\n * <br /><br />\n * This function should not be confused with {@link czm_viewportOrthographic},\n * which is an orthographic projection matrix that transforms from window \n * coordinates to clip coordinates.\n *\n * @name czm_modelToWindowCoordinates\n * @glslFunction\n *\n * @param {vec4} position The position in model coordinates to transform.\n *\n * @returns {vec4} The transformed position in window coordinates.\n *\n * @see czm_eyeToWindowCoordinates\n * @see czm_modelViewProjection\n * @see czm_viewportTransformation\n * @see czm_viewportOrthographic\n * @see BillboardCollection\n *\n * @example\n * vec4 positionWC = czm_modelToWindowCoordinates(positionMC);\n */\nvec4 czm_modelToWindowCoordinates(vec4 position)\n{\n    vec4 q = czm_modelViewProjection * position;                // clip coordinates\n    q.xyz /= q.w;                                                // normalized device coordinates\n    q.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz; // window coordinates\n    return q;\n}\n\n/**\n * Transforms a position from eye to window coordinates.  The transformation\n * from eye to clip coordinates is done using {@link czm_projection}.\n * The transform from normalized device coordinates to window coordinates is\n * done using {@link czm_viewportTransformation}, which assumes a depth range\n * of <code>near = 0</code> and <code>far = 1</code>.\n * <br /><br />\n * This transform is useful when there is a need to manipulate window coordinates\n * in a vertex shader as done by {@link BillboardCollection}.\n *\n * @name czm_eyeToWindowCoordinates\n * @glslFunction\n *\n * @param {vec4} position The position in eye coordinates to transform.\n *\n * @returns {vec4} The transformed position in window coordinates.\n *\n * @see czm_modelToWindowCoordinates\n * @see czm_projection\n * @see czm_viewportTransformation\n * @see BillboardCollection\n *\n * @example\n * vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n */\nvec4 czm_eyeToWindowCoordinates(vec4 positionEC)\n{\n    vec4 q = czm_projection * positionEC;                       // clip coordinates\n    q.xyz /= q.w;                                                // normalized device coordinates\n    q.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz; // window coordinates\n    return q;\n}\n\n/**\n * Transforms a position from window to eye coordinates.\n * The transform from window to normalized device coordinates is done using components\n * of (@link czm_viewport} and {@link czm_viewportTransformation} instead of calculating\n * the inverse of <code>czm_viewportTransformation</code>. The transformation from \n * normalized device coordinates to clip coordinates is done using <code>positionWC.w</code>,\n * which is expected to be the scalar used in the perspective divide. The transformation\n * from clip to eye coordinates is done using {@link czm_inverseProjection}.\n *\n * @name czm_windowToEyeCoordinates\n * @glslFunction\n *\n * @param {vec4} fragmentCoordinate The position in window coordinates to transform.\n *\n * @returns {vec4} The transformed position in eye coordinates.\n *\n * @see czm_modelToWindowCoordinates\n * @see czm_eyeToWindowCoordinates\n * @see czm_inverseProjection\n * @see czm_viewport\n * @see czm_viewportTransformation\n *\n * @example\n * vec4 positionEC = czm_windowToEyeCoordinates(gl_FragCoord);\n */\nvec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)\n{\n    float x = 2.0 * (fragmentCoordinate.x - czm_viewport.x) / czm_viewport.z - 1.0;\n    float y = 2.0 * (fragmentCoordinate.y - czm_viewport.y) / czm_viewport.w - 1.0;\n    float z = (fragmentCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\n    vec4 q = vec4(x, y, z, 1.0);\n    q /= fragmentCoordinate.w;\n    q = czm_inverseProjection * q;\n    return q;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_eyeOffset\n * @glslFunction\n *\n * @param {vec4} positionEC DOC_TBA.\n * @param {vec3} eyeOffset DOC_TBA.\n *\n * @returns {vec4} DOC_TBA.\n */\nvec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)\n{\n    // This equation is approximate in x and y.\n    vec4 p = positionEC;\n    vec4 zEyeOffset = normalize(p) * eyeOffset.z;\n    p.xy += eyeOffset.xy + zEyeOffset.xy;\n    p.z += zEyeOffset.z;\n    return p;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_geodeticSurfaceNormal\n * @glslFunction\n *\n * @param {vec3} positionOnEllipsoid DOC_TBA\n * @param {vec3} ellipsoidCenter DOC_TBA\n * @param {vec3} oneOverEllipsoidRadiiSquared DOC_TBA\n * \n * @returns {vec3} DOC_TBA.\n */\nvec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)\n{\n    return normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_ellipsoidWgs84TextureCoordinates\n * @glslFunction\n */\nvec2 czm_ellipsoidWgs84TextureCoordinates(vec3 normal)\n{\n    return vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);\n}\n\n/**\n * Computes a 3x3 rotation matrix that transforms vectors from an ellipsoid's east-north-up coordinate system \n * to eye coordinates.  In east-north-up coordinates, x points east, y points north, and z points along the \n * surface normal.  East-north-up can be used as an ellipsoid's tangent space for operations such as bump mapping.\n * <br /><br />\n * The ellipsoid is assumed to be centered at the model coordinate's origin.\n *\n * @name czm_eastNorthUpToEyeCoordinates\n * @glslFunction\n *\n * @param {vec3} positionMC The position on the ellipsoid in model coordinates.\n * @param {vec3} normalEC The normalized ellipsoid surface normal, at <code>positionMC</code>, in eye coordinates.\n *\n * @returns {mat3} A 3x3 rotation matrix that transforms vectors from the east-north-up coordinate system to eye coordinates.\n *\n * @example\n * // Transform a vector defined in the east-north-up coordinate \n * // system, (0, 0, 1) which is the surface normal, to eye \n * // coordinates.\n * mat3 m = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\n * vec3 normalEC = m * vec3(0.0, 0.0, 1.0);\n */\nmat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)\n{\n    vec3 tangentMC = normalize(vec3(-positionMC.y, positionMC.x, 0.0));  // normalized surface tangent in model coordinates\n    vec3 tangentEC = normalize(czm_normal * tangentMC);                  // normalized surface tangent in eye coordiantes\n    vec3 bitangentEC = normalize(cross(normalEC, tangentEC));            // normalized surface bitangent in eye coordinates\n\n    return mat3(\n        tangentEC.x,   tangentEC.y,   tangentEC.z,\n        bitangentEC.x, bitangentEC.y, bitangentEC.z,\n        normalEC.x,    normalEC.y,    normalEC.z);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Used as input to every material's czm_getMaterial function. \n *\n * @name czm_materialInput\n * @glslStruct\n *\n * @property {float} s 1D texture coordinates.\n * @property {vec2} st 2D texture coordinates.\n * @property {vec3} str 3D texture coordinates.\n * @property {vec3} normalEC Unperturbed surface normal in eye coordinates.\n * @property {mat3} tangentToEyeMatrix Matrix for converting a tangent space normal to eye space.\n * @property {vec3} positionToEyeEC Vector from the fragment to the eye in eye coordinates.  The magnitude is the distance in meters from the fragment to the eye.\n * @property {vec3} positionMC Position in model coordinates.\n */\nstruct czm_materialInput\n{\n    float s;\n    vec2 st;\n    vec3 str;\n    vec3 normalEC;\n    mat3 tangentToEyeMatrix;\n    vec3 positionToEyeEC;\n    vec3 positionMC;\n};\n\n/**\n * Holds material information that can be used for lighting. Returned by all czm_getMaterial functions.\n *\n * @name czm_material\n * @glslStruct\n *\n * @property {vec3} diffuse Incoming light that scatters evenly in all directions.\n * @property {float} specular Intensity of incoming light reflecting in a single direction.\n * @property {float} shininess The sharpness of the specular reflection.  Higher values create a smaller, more focused specular highlight.\n * @property {vec3} normal Surface's normal in eye coordinates. It is used for effects such as normal mapping. The default is the surface's unmodified normal.\n * @property {vec3} emission Light emitted by the material equally in all directions. The default is vec3(0.0), which emits no light.\n * @property {float} alpha Opacity of this material. 0.0 is completely transparent; 1.0 is completely opaque.\n */\nstruct czm_material\n{\n    vec3 diffuse;\n    float specular;\n    float shininess;\n    vec3 normal;\n    vec3 emission;\n    float alpha;\n};\n\n/**\n * An czm_material with default values. Every material's czm_getMaterial\n * should use this default material as a base for the material it returns.\n * The default normal value is given by materialInput.normalEC.\n *\n * @name czm_getDefaultMaterial\n * @glslFunction \n *\n * @param {czm_materialInput} input The input used to construct the default material.\n * \n * @returns {czm_material} The default material.\n *\n * @see czm_materialInput\n * @see czm_material\n * @see czm_getMaterial\n */\nczm_material czm_getDefaultMaterial(czm_materialInput materialInput)\n{\n    czm_material material;\n    material.diffuse = vec3(0.0);\n    material.specular = 0.0;\n    material.shininess = 1.0;\n    material.normal = materialInput.normalEC;\n    material.emission = vec3(0.0);\n    material.alpha = 1.0;\n    return material;\n}\n\nfloat getLambertDiffuse(vec3 lightDirection, czm_material material)\n{\n    return max(dot(lightDirection, material.normal), 0.0);\n}\n\nfloat getSpecular(vec3 lightDirection, vec3 toEye, czm_material material)\n{\n    vec3 toReflectedLight = reflect(-lightDirection, material.normal);\n    float specular = max(dot(toReflectedLight, toEye), 0.0);\n\n    return pow(specular, material.shininess);\n}\n\n/**\n * Computes a color using the Phong lighting model.\n *\n * @name czm_phong\n * @glslFunction\n *\n * @param {vec3} toEye A normalized vector from the fragment to the eye in eye coordinates.\n * @param {czm_material} material The fragment's material.\n * \n * @returns {vec4} The computed color.\n * \n * @example\n * vec3 positionToEyeEC = // ...\n * czm_material material = // ...\n * gl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n *\n * @see czm_getMaterial\n */\nvec4 czm_phong(vec3 toEye, czm_material material)\n{\n    // Diffuse from directional light sources at eye (for top-down and horizon views)\n    float diffuse = getLambertDiffuse(vec3(0.0, 0.0, 1.0), material) + getLambertDiffuse(vec3(0.0, 1.0, 0.0), material);\n\n    // Specular from sun and pseudo-moon\n    float specular = getSpecular(czm_sunDirectionEC, toEye, material) + getSpecular(czm_moonDirectionEC, toEye, material);\n\n    vec3 ambient = vec3(0.0);\n    vec3 color = ambient + material.emission;\n    color += material.diffuse * diffuse;\n    color += material.specular * specular;\n\n    return vec4(color, material.alpha);\n}\n\n/**\n * Computes the luminance of a color. \n *\n * @name czm_luminance\n * @glslFunction\n *\n * @param {vec3} rgb The color.\n * \n * @returns {float} The luminance.\n *\n * @example\n * float light = luminance(vec3(0.0)); // 0.0\n * float dark = luminance(vec3(1.0));  // ~1.0 \n */\nfloat czm_luminance(vec3 rgb)\n{\n    // Algorithm from Chapter 10 of Graphics Shaders.\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    return dot(rgb, W);\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_multiplyWithColorBalance\n * @glslFunction\n */\nvec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)\n{\n    // Algorithm from Chapter 10 of Graphics Shaders.\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    \n    vec3 target = left * right;\n    float leftLuminance = dot(left, W);\n    float rightLuminance = dot(right, W);\n    float targetLuminance = dot(target, W);\n    \n    return ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * The maximum latitude, in radians, both North and South, supported by a Web Mercator\n * (EPSG:3857) projection.  Technically, the Mercator projection is defined\n * for any latitude up to (but not including) 90 degrees, but it makes sense\n * to cut it off sooner because it grows exponentially with increasing latitude.\n * The logic behind this particular cutoff value, which is the one used by\n * Google Maps, Bing Maps, and Esri, is that it makes the projection\n * square.  That is, the extent is equal in the X and Y directions.\n *\n * The constant value is computed as follows:\n *   czm_pi * 0.5 - (2.0 * atan(exp(-czm_pi)))\n *\n * @name czm_webMercatorMaxLatitude\n * @glslConstant\n */\nconst float czm_webMercatorMaxLatitude = 1.4844222297453323669610967939;\n\n/**\n * Specifies a flat, 2D map.\n *\n * @name czm_scene2D\n * @glslConstant \n */\nconst int czm_scene2D = 0;\n\n/**\n * Specifies 2.D Columbus View.\n *\n * @name czm_columbusView\n * @glslConstant \n */\nconst int czm_columbusView = 1;\n\n/**\n * Specifies a 3D globe.\n *\n * @name czm_scene3D\n * @glslConstant \n */\nconst int czm_scene3D = 2;\n\n/**\n * Specifies that the scene is morphing between modes.\n * \n * @name czm_morphing\n * @glslConstant\n */\nconst int czm_morphing = 3;\n\n/**\n * DOC_TBA\n *\n * @name czm_columbusViewMorph\n * @glslFunction\n */\nvec4 czm_columbusViewMorph(vec3 position2D, vec3 position3D, float time)\n{\n    // Just linear for now.\n    vec3 p = mix(position2D, position3D, time);\n    return vec4(p, 1.0);\n} \n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_ray\n * @glslStruct\n */\nstruct czm_ray\n{\n    vec3 origin;\n    vec3 direction;\n};\n\n/**\n * Computes the point along a ray at the given time.  <code>time</code> can be positive, negative, or zero.\n *\n * @name czm_pointAlongRay\n * @glslFunction\n *\n * @param {czm_ray} ray The ray to compute the point along.\n * @param {float} time The time along the ray.\n * \n * @returns {vec3} The point along the ray at the given time.\n * \n * @example\n * czm_ray ray = czm_ray(vec3(0.0), vec3(1.0, 0.0, 0.0)); // origin, direction\n * vec3 v = czm_pointAlongRay(ray, 2.0); // (2.0, 0.0, 0.0)\n */\nvec3 czm_pointAlongRay(czm_ray ray, float time)\n{\n    return ray.origin + (time * ray.direction);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_raySegment\n * @glslStruct\n */\nstruct czm_raySegment\n{\n    float start;\n    float stop;\n};\n\n/**\n * DOC_TBA\n *\n * @name czm_emptyRaySegment\n * @glslConstant \n */\nconst czm_raySegment czm_emptyRaySegment = czm_raySegment(-czm_infinity, -czm_infinity);\n\n/**\n * DOC_TBA\n *\n * @name czm_fullRaySegment\n * @glslConstant \n */\nconst czm_raySegment czm_fullRaySegment = czm_raySegment(0.0, czm_infinity);\n\n/**\n * Determines if a time interval is empty.\n *\n * @name czm_isEmpty\n * @glslFunction \n * \n * @param {czm_raySegment} interval The interval to test.\n * \n * @returns {bool} <code>true</code> if the time interval is empty; otherwise, <code>false</code>.\n *\n * @example\n * bool b0 = czm_isEmpty(czm_emptyRaySegment);      // true\n * bool b1 = czm_isEmpty(czm_raySegment(0.0, 1.0)); // false\n * bool b2 = czm_isEmpty(czm_raySegment(1.0, 1.0)); // false, contains 1.0.\n */\nbool czm_isEmpty(czm_raySegment interval)\n{\n    return (interval.stop < 0.0);\n}\n\n/**\n * Determines if a time interval is empty.\n *\n * @name czm_isFull\n * @glslFunction \n * \n * @param {czm_raySegment} interval The interval to test.\n * \n * @returns {bool} <code>true</code> if the time interval is empty; otherwise, <code>false</code>.\n *\n * @example\n * bool b0 = czm_isEmpty(czm_emptyRaySegment);      // true\n * bool b1 = czm_isEmpty(czm_raySegment(0.0, 1.0)); // false\n * bool b2 = czm_isEmpty(czm_raySegment(1.0, 1.0)); // false, contains 1.0.\n */\nbool czm_isFull(czm_raySegment interval)\n{\n    return (interval.start == 0.0 && interval.stop == czm_infinity);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_ellipsoid\n * @glslStruct\n */\nstruct czm_ellipsoid\n{\n    vec3 center;\n    vec3 radii;\n    vec3 inverseRadii;\n    vec3 inverseRadiiSquared;\n};\n\n/**\n * DOC_TBA\n *\n * @name czm_ellipsoidNew\n * @glslFunction\n *\n */\nczm_ellipsoid czm_ellipsoidNew(vec3 center, vec3 radii)\n{\n    vec3 inverseRadii = vec3(1.0 / radii.x, 1.0 / radii.y, 1.0 / radii.z);\n    vec3 inverseRadiiSquared = inverseRadii * inverseRadii;\n    czm_ellipsoid temp = czm_ellipsoid(center, radii, inverseRadii, inverseRadiiSquared);\n    return temp;\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_ellipsoidContainsPoint\n * @glslFunction\n *\n */\nbool czm_ellipsoidContainsPoint(czm_ellipsoid ellipsoid, vec3 point)\n{\n    vec3 scaled = ellipsoid.inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;\n    return (dot(scaled, scaled) <= 1.0);\n}\n\n/**\n * DOC_TBA\n *\n *\n * @name czm_rayEllipsoidIntersectionInterval\n * @glslFunction\n */\nczm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, czm_ellipsoid ellipsoid)\n{\n   // ray and ellipsoid center in eye coordinates.  radii in model coordinates.\n    vec3 q = ellipsoid.inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;\n    vec3 w = ellipsoid.inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;\n   \n    q = q - ellipsoid.inverseRadii * (czm_inverseModelView * vec4(ellipsoid.center, 1.0)).xyz;\n    \n    float q2 = dot(q, q);\n    float qw = dot(q, w);\n    \n    if (q2 > 1.0) // Outside ellipsoid.\n    {\n        if (qw >= 0.0) // Looking outward or tangent (0 intersections).\n        {\n            return czm_emptyRaySegment;\n        }\n        else // qw < 0.0.\n        {\n            float qw2 = qw * qw;\n            float difference = q2 - 1.0; // Positively valued.\n            float w2 = dot(w, w);\n            float product = w2 * difference;\n            \n            if (qw2 < product) // Imaginary roots (0 intersections).\n            {\n                return czm_emptyRaySegment;     \n            }   \n            else if (qw2 > product) // Distinct roots (2 intersections).\n            {\n                float discriminant = qw * qw - product;\n                float temp = -qw + sqrt(discriminant); // Avoid cancellation.\n                float root0 = temp / w2;\n                float root1 = difference / temp;\n                if (root0 < root1)\n                {\n                    czm_raySegment i = czm_raySegment(root0, root1);\n                    return i;\n                }\n                else\n                {\n                    czm_raySegment i = czm_raySegment(root1, root0);\n                    return i;\n                }\n            }\n            else // qw2 == product.  Repeated roots (2 intersections).\n            {\n                float root = sqrt(difference / w2);\n                czm_raySegment i = czm_raySegment(root, root);\n                return i;\n            }\n        }\n    }\n    else if (q2 < 1.0) // Inside ellipsoid (2 intersections).\n    {\n        float difference = q2 - 1.0; // Negatively valued.\n        float w2 = dot(w, w);\n        float product = w2 * difference; // Negatively valued.\n        if (qw < 0.0) // Looking inward.\n        {\n            float discriminant = qw * qw - product;\n            float temp = qw - sqrt(discriminant); // Avoid cancellation.  Negatively valued.\n            czm_raySegment i = czm_raySegment(0.0, difference / temp);\n            return i;\n        }\n        else if (qw > 0.0) // Looking outward.\n        {\n            float discriminant = qw * qw - product;\n            float temp = qw + sqrt(discriminant); // Avoid cancellation. Positively valued.\n            czm_raySegment i = czm_raySegment(0.0, temp / w2);\n            return i;\n        }\n        else // qw == 0.0 // Looking tangent.\n        {\n            float temp = sqrt(-product);\n            czm_raySegment i = czm_raySegment(0.0, temp / w2);\n            return i;\n        }\n    }\n    else // q2 == 1.0. On ellipsoid.\n    {\n        if (qw < 0.0) // Looking inward.\n        {\n            float w2 = dot(w, w);\n            czm_raySegment i = czm_raySegment(0.0, -qw / w2);\n            return i;\n        }\n        else // qw >= 0.0.  Looking outward or tangent.\n        {\n            return czm_emptyRaySegment;\n        }\n    }\n}\n\n/**\n * Returns the WGS84 ellipsoid, with its center at the origin of world coordinates, in eye coordinates.\n *\n * @name czm_getWgs84EllipsoidEC\n * @glslFunction\n *\n * @returns {czm_ellipsoid} The WGS84 ellipsoid, with its center at the origin of world coordinates, in eye coordinates.\n *\n * @see Ellipsoid.getWgs84\n *\n * @example\n * czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\n */\nczm_ellipsoid czm_getWgs84EllipsoidEC()\n{\n    return czm_ellipsoidNew(\n        czm_view[3].xyz,                               // center\n        vec3(6378137.0, 6378137.0, 6356752.314245));   // radii\n}\n\n/**\n * Computes the fraction of a Web Wercator extent at which a given geodetic latitude is located.\n *\n * @name czm_latitudeToWebMercatorFraction\n * @glslFunction\n *\n * @param {float} The geodetic latitude, in radians.\n * @param {float} The low portion of the Web Mercator coordinate of the southern boundary of the extent.\n * @param {float} The high portion of the Web Mercator coordinate of the southern boundary of the extent.\n * @param {float} The total height of the extent in Web Mercator coordinates.\n *\n * @returns {float} The fraction of the extent at which the latitude occurs.  If the latitude is the southern\n *          boundary of the extent, the return value will be zero.  If it is the northern boundary, the return\n *          value will be 1.0.  Latitudes in between are mapped according to the Web Mercator projection.\n */ \nfloat czm_latitudeToWebMercatorFraction(float latitude, float southMercatorYLow, float southMercatorYHigh, float oneOverMercatorHeight)\n{\n    float sinLatitude = sin(latitude);\n    float mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));\n    \n    // mercatorY - southMercatorY in simulated double precision.\n    float t1 = 0.0 - southMercatorYLow;\n    float e = t1 - 0.0;\n    float t2 = ((-southMercatorYLow - e) + (0.0 - (t1 - e))) + mercatorY - southMercatorYHigh;\n    float highDifference = t1 + t2;\n    float lowDifference = t2 - (highDifference - t1);\n    \n    return highDifference * oneOverMercatorHeight + lowDifference * oneOverMercatorHeight;\n}\n\n/**\n * Translates a position (or any <code>vec3</code>) that was encoded with {@link EncodedCartesian3},\n * and then provided to the shader as separate <code>high</code> and <code>low</code> bits to\n * be relative to the eye.  As shown in the example, the position can then be transformed in eye\n * or clip coordinates using {@link czm_modelViewRelativeToEye} or {@link czm_modelViewProjectionRelativeToEye},\n * respectively.\n * <p>\n * This technique, called GPU RTE, eliminates jittering artifacts when using large coordinates as\n * described in <a href=\"http://blogs.agi.com/insight3d/index.php/2008/09/03/precisions-precisions/\">Precisions, Precisions</a>.\n * </p>\n *\n * @name czm_translateRelativeToEye\n * @glslFunction\n *\n * @param {vec3} high The position's high bits.\n * @param {vec3} low The position's low bits.\n * @returns {vec3} The position translated to be relative to the camera's position.\n *\n * @example\n * attribute vec3 positionHigh;\n * attribute vec3 positionLow;\n * \n * void main() \n * {\n *   vec3 p = czm_translateRelativeToEye(positionHigh, positionLow);\n *   gl_Position = czm_modelViewProjectionRelativeToEye * vec4(p, 1.0);\n * }\n *\n * @see czm_modelViewRelativeToEye\n * @see czm_modelViewProjectionRelativeToEye\n * @see EncodedCartesian3\n */\nvec3 czm_translateRelativeToEye(vec3 high, vec3 low)\n{\n    vec3 highDifference = high - czm_encodedCameraPositionMCHigh;\n    vec3 lowDifference = low - czm_encodedCameraPositionMCLow;\n\n    return highDifference + lowDifference;\n}\n"}),c("Renderer/ShaderProgram",["../Core/DeveloperError","../Core/RuntimeError","../Core/destroyObject","../Core/Math","../Core/Matrix2","../Core/Matrix3","../Core/Matrix4","./UniformDatatype","../Shaders/BuiltinFunctions"],function(a,b,c,d,e,f,g,h,i){function k(a,c){switch(c){case a.FLOAT:return function(){return h.FLOAT};case a.FLOAT_VEC2:return function(){return h.FLOAT_VECTOR2};case a.FLOAT_VEC3:return function(){return h.FLOAT_VECTOR3};case a.FLOAT_VEC4:return function(){return h.FLOAT_VECTOR4};case a.INT:return function(){return h.INT};case a.INT_VEC2:return function(){return h.INT_VECTOR2};case a.INT_VEC3:return function(){return h.INT_VECTOR3};case a.INT_VEC4:return function(){return h.INT_VECTOR4};case a.BOOL:return function(){return h.BOOL};case a.BOOL_VEC2:return function(){return h.BOOL_VECTOR2};case a.BOOL_VEC3:return function(){return h.BOOL_VECTOR3};case a.BOOL_VEC4:return function(){return h.BOOL_VECTOR4};case a.FLOAT_MAT2:return function(){return h.FLOAT_MATRIX2};case a.FLOAT_MAT3:return function(){return h.FLOAT_MATRIX3};case a.FLOAT_MAT4:return function(){return h.FLOAT_MATRIX4};case a.SAMPLER_2D:return function(){return h.SAMPLER_2D};case a.SAMPLER_CUBE:return function(){return h.SAMPLER_CUBE};default:throw new b("Unrecognized uniform type: "+c)}}function o(a){var b=a.indexOf("#version");if(b!==-1){var c=a.indexOf("\n",b);if(b!==-1){var d=a.substring(b,c+1),e=a.substring(0,b)+"//"+a.substring(b);return{versionDirective:d,modifiedSource:e}}}return{versionDirective:"",modifiedSource:a}}function p(a,b){var c=a[b],d="uniform "+c.getDatatype().getGLSL()+" "+b,e=c.getSize();return e===1?d+=";":d+="["+e.toString()+"];",d}function q(a){var b=a,c=j;for(var d in c)if(c.hasOwnProperty(d)){var e=p(c,d),f=b.indexOf(e);f!==-1&&(b=b.substring(0,f)+"/*"+b.substring(f,e.length)+"*/"+b.substring(f+e.length))}return b}function r(){return"#ifdef GL_FRAGMENT_PRECISION_HIGH \n  precision highp float; \n#else \n  precision mediump float; \n#endif \n\n"}function s(){var a={czm_pi:Math.PI.toString(),czm_oneOverPi:d.ONE_OVER_PI.toString(),czm_piOverTwo:d.PI_OVER_TWO.toString(),czm_piOverThree:d.PI_OVER_THREE.toString(),czm_piOverFour:d.PI_OVER_FOUR.toString(),czm_piOverSix:d.PI_OVER_SIX.toString(),czm_threePiOver2:d.THREE_PI_OVER_TWO.toString(),czm_twoPi:d.TWO_PI.toString(),czm_oneOverTwoPi:d.ONE_OVER_TWO_PI.toString(),czm_radiansPerDegree:d.RADIANS_PER_DEGREE.toString(),czm_degreesPerRadian:d.DEGREES_PER_RADIAN.toString()},b="";for(var c in a)a.hasOwnProperty(c)&&(b+="const float "+c+" = "+a[c]+"; \n");return b+=" \n",b}function t(){var a="",b=j;for(var c in b)b.hasOwnProperty(c)&&(a+=p(b,c)+" \n");return a+="\n",a}function v(a,c,d,e,f){var g=o(d),h=o(e),i=g.versionDirective+u()+q(g.modifiedSource),j=h.versionDirective+r()+u()+q(h.modifiedSource),k=a.createShader(a.VERTEX_SHADER);a.shaderSource(k,i),a.compileShader(k);var l=a.getShaderInfoLog(k);c&&l&&l.length&&console.log("[GL] Vertex shader compile log: "+l);if(!a.getShaderParameter(k,a.COMPILE_STATUS))throw a.deleteShader(k),console.error("[GL] Vertex shader compile log: "+l),new b("Vertex shader failed to compile.  Compile log: "+l);var m=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(m,j),a.compileShader(m);var n=a.getShaderInfoLog(m);c&&n&&n.length&&console.log("[GL] Fragment shader compile log: "+n);if(!a.getShaderParameter(m,a.COMPILE_STATUS))throw a.deleteShader(k),a.deleteShader(m),console.error("[GL] Fragment shader compile log: "+n),new b("Fragment shader failed to compile.  Compile log: "+n);var p=a.createProgram();a.attachShader(p,k),a.attachShader(p,m),a.deleteShader(k),a.deleteShader(m);if(f)for(var s in f)f.hasOwnProperty(s)&&a.bindAttribLocation(p,f[s],s);a.linkProgram(p);var t=a.getProgramInfoLog(p);c&&t&&t.length&&console.log("[GL] Shader program link log: "+t);if(!a.getProgramParameter(p,a.LINK_STATUS))throw a.deleteProgram(p),console.error("[GL] Shader program link log: "+t),new b("Program failed to link.  Link log: "+t);return p}function w(a,b,c){var d={};for(var e=0;e<c;++e){var f=a.getActiveAttrib(b,e),g=a.getAttribLocation(b,f.name);d[f.name]={name:f.name,type:f.type,index:g}}return d}function x(a,b){var c={},d=[],e=[],f=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var g=0;g<f;++g){var h=a.getActiveUniform(b,g),i="[0]",j=h.name.indexOf(i,h.name.length-i.length)!==-1?h.name.slice(0,h.name.length-3):h.name;if(j.indexOf("gl_")!==0)if(h.name.indexOf("[")<0){var k=a.getUniformLocation(b,j),n=a.getUniform(b,k),o=new l(a,h,j,k,n);c[j]=o,o._setSampler?e.push(o):d.push(o)}else{var p=[],q=[];for(var r=0;r<h.size;++r){var s=a.getUniformLocation(b,j+"["+r+"]");p.push(s),q.push(a.getUniform(b,s))}var t=new m(a,h,j,p,q);c[j]=t,t._setSampler?e.push(t):d.push(t)}}return{allUniforms:c,uniforms:d,samplerUniforms:e}}function y(a){var b=[],c={};for(var d in a)if(a.hasOwnProperty(d)){var e=j[d];e?b.push({uniform:a[d],automaticUniform:e}):c[d]=a[d]}return{automaticUniforms:b,manualUniforms:c}}var j={czm_viewport:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_VECTOR4},getValue:function(a){var b=a.getViewport();return{x:b.x,y:b.y,z:b.width,w:b.height}}},czm_viewportOrthographic:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getViewportOrthographic()}},czm_viewportTransformation:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getViewportTransformation()}},czm_model:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getModel()}},czm_inverseModel:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getInverseModel()}},czm_view:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getView()}},czm_viewRotation:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX3},getValue:function(a){return a.getViewRotation()}},czm_inverseView:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getInverseView()}},czm_inverseViewRotation:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX3},getValue:function(a){return a.getInverseViewRotation()}},czm_projection:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getProjection()}},czm_inverseProjection:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getInverseProjection()}},czm_infiniteProjection:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getInfiniteProjection()}},czm_modelView:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getModelView()}},czm_modelViewRelativeToEye:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getModelViewRelativeToEye()}},czm_inverseModelView:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getInverseModelView()}},czm_viewProjection:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getViewProjection()}},czm_modelViewProjection:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getModelViewProjection()}},czm_modelViewProjectionRelativeToEye:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getModelViewProjectionRelativeToEye()}},czm_modelViewInfiniteProjection:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX4},getValue:function(a){return a.getModelViewInfiniteProjection()}},czm_normal:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX3},getValue:function(a){return a.getNormal()}},czm_inverseNormal:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX3},getValue:function(a){return a.getInverseNormal()}},czm_entireFrustum:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_VECTOR2},getValue:function(a){return a.getEntireFrustum()}},czm_sunDirectionEC:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_VECTOR3},getValue:function(a){return a.getSunDirectionEC()}},czm_sunDirectionWC:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_VECTOR3},getValue:function(a){return a.getSunDirectionWC()}},czm_moonDirectionEC:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_VECTOR3},getValue:function(a){return a.getMoonDirectionEC()}},czm_encodedCameraPositionMCHigh:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_VECTOR3},getValue:function(a){return a.getEncodedCameraPositionMCHigh()}},czm_encodedCameraPositionMCLow:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_VECTOR3},getValue:function(a){return a.getEncodedCameraPositionMCLow()}},czm_viewerPositionWC:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_VECTOR3},getValue:function(a){return a.getInverseView().getTranslation()}},czm_frameNumber:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT},getValue:function(a){return a.getFrameNumber()}},czm_temeToPseudoFixed:{getSize:function(){return 1},getDatatype:function(){return h.FLOAT_MATRIX3},getValue:function(a){return a.getTemeToPseudoFixedMatrix()}}},l=function(c,d,h,i,j){this.value=j,this.getName=function(){return h},this.getDatatype=k(c,d.type),this._getLocation=function(){return i},this._set=function(){switch(d.type){case c.FLOAT:return function(){c.uniform1f(i,this.value)};case c.FLOAT_VEC2:return function(){var a=this.value;c.uniform2f(i,a.x,a.y)};case c.FLOAT_VEC3:return function(){var a=this.value;c.uniform3f(i,a.x,a.y,a.z)};case c.FLOAT_VEC4:return function(){var b=this.value;if(typeof b.red!="undefined")c.uniform4f(i,b.red,b.green,b.blue,b.alpha);else{if(typeof b.x=="undefined")throw new a('Invalid vec4 value for uniform "'+d.name+'".');c.uniform4f(i,b.x,b.y,b.z,b.w)}};case c.SAMPLER_2D:case c.SAMPLER_CUBE:return undefined;case c.INT:case c.BOOL:return function(){c.uniform1i(i,this.value)};case c.INT_VEC2:case c.BOOL_VEC2:return function(){var a=this.value;c.uniform2i(i,a.x,a.y)};case c.INT_VEC3:case c.BOOL_VEC3:return function(){var a=this.value;c.uniform3i(i,a.x,a.y,a.z)};case c.INT_VEC4:case c.BOOL_VEC4:return function(){var a=this.value;c.uniform4i(i,a.x,a.y,a.z,a.w)};case c.FLOAT_MAT2:return function(){c.uniformMatrix2fv(i,!1,e.toArray(this.value))};case c.FLOAT_MAT3:return function(){c.uniformMatrix3fv(i,!1,f.toArray(this.value))};case c.FLOAT_MAT4:return function(){c.uniformMatrix4fv(i,!1,g.toArray(this.value))};default:throw new b("Unrecognized uniform type: "+d.type+' for uniform "'+d.name+'".')}}();if(d.type===c.SAMPLER_2D||d.type===c.SAMPLER_CUBE)this._setSampler=function(a){return c.activeTexture(c.TEXTURE0+a),c.bindTexture(this.value._getTarget(),this.value._getTexture()),c.uniform1i(i,a),a+1},this._clearSampler=function(a){return c.activeTexture(c.TEXTURE0+a),c.bindTexture(this.value._getTarget(),null),a+1}},m=function(c,d,h,i,j){this.value=j;var l=i;this.getName=function(){return h},this.getDatatype=k(c,d.type),this._getLocations=function(){return l},this._set=function(){switch(d.type){case c.FLOAT:return function(){for(var a=0;a<l.length;++a)c.uniform1f(l[a],this.value[a])};case c.FLOAT_VEC2:return function(){for(var a=0;a<l.length;++a){var b=this.value[a];c.uniform2f(l[a],b.x,b.y)}};case c.FLOAT_VEC3:return function(){for(var a=0;a<l.length;++a){var b=this.value[a];c.uniform3f(l[a],b.x,b.y,b.z)}};case c.FLOAT_VEC4:return function(){for(var b=0;b<l.length;++b){var d=this.value[b];if(typeof d.red!="undefined")c.uniform4f(l[b],d.red,d.green,d.blue,d.alpha);else{if(typeof d.x=="undefined")throw new a("Invalid vec4 value.");c.uniform4f(l[b],d.x,d.y,d.z,d.w)}}};case c.SAMPLER_2D:case c.SAMPLER_CUBE:return undefined;case c.INT:case c.BOOL:return function(){for(var a=0;a<l.length;++a)c.uniform1i(l[a],this.value[a])};case c.INT_VEC2:case c.BOOL_VEC2:return function(){for(var a=0;a<l.length;++a){var b=this.value[a];c.uniform2i(l[a],b.x,b.y)}};case c.INT_VEC3:case c.BOOL_VEC3:return function(){for(var a=0;a<l.length;++a){var b=this.value[a];c.uniform3i(l[a],b.x,b.y,b.z)}};case c.INT_VEC4:case c.BOOL_VEC4:return function(){for(var a=0;a<l.length;++a){var b=this.value[a];c.uniform4i(l[a],b.x,b.y,b.z,b.w)}};case c.FLOAT_MAT2:return function(){for(var a=0;a<l.length;++a)c.uniformMatrix2fv(l[a],!1,e.toArray(this.value[a]))};case c.FLOAT_MAT3:return function(){for(var a=0;a<l.length;++a)c.uniformMatrix3fv(l[a],!1,f.toArray(this.value[a]))};case c.FLOAT_MAT4:return function(){for(var a=0;a<l.length;++a)c.uniformMatrix4fv(l[a],!1,g.toArray(this.value[a]))};default:throw new b("Unrecognized uniform type: "+d.type)}}();if(d.type===c.SAMPLER_2D||d.type===c.SAMPLER_CUBE)this._setSampler=function(a){for(var b=0;b<l.length;++b){var d=this.value[b],e=a+b;c.activeTexture(c.TEXTURE0+e),c.bindTexture(d._getTarget(),d._getTexture()),c.uniform1i(l[b],e)}return a+l.length},this._clearSampler=function(a){for(var b=0;b<l.length;++b)c.activeTexture(c.TEXTURE0+a+b),c.bindTexture(this.value[b]._getTarget(),null);return a+l.length}},n=function(a,b,c,d,e){var f=v(a,b,c,d,e),g=a.getProgramParameter(f,a.ACTIVE_ATTRIBUTES),h=x(a,f),i=y(h.allUniforms);this._gl=a,this._program=f,this._numberOfVertexAttributes=g,this._vertexAttributes=w(a,f,g),this._allUniforms=h.allUniforms,this._uniforms=h.uniforms,this._samplerUniforms=h.samplerUniforms,this._automaticUniforms=i.automaticUniforms,this._manualUniforms=i.manualUniforms},u=function(){var a=s()+t()+i+"\n\n"+"#line 0 \n";return u=function(){return a},a};return n.prototype.getVertexAttributes=function(){return this._vertexAttributes},n.prototype.getNumberOfVertexAttributes=function(){return this._numberOfVertexAttributes},n.prototype.getAllUniforms=function(){return this._allUniforms},n.prototype.getManualUniforms=function(){return this._manualUniforms},n.prototype._bind=function(){this._gl.useProgram(this._program)},n.prototype._unBind=function(){this._gl.useProgram(null);var a=this._samplerUniforms,b=0,c=a.length;for(var d=0;d<c;++d)b=a[d]._clearSampler(b)},n.prototype._setUniforms=function(b,c,d){var e,f,g=this._uniforms,h=this._samplerUniforms,i=this._manualUniforms,j=this._automaticUniforms;if(b)for(var k in i)i.hasOwnProperty(k)&&(i[k].value=b[k]());e=j.length;for(f=0;f<e;++f)j[f].uniform.value=j[f].automaticUniform.getValue(c);e=g.length;for(f=0;f<e;++f)g[f]._set();var l=0;e=h.length;for(f=0;f<e;++f)l=h[f]._setSampler(l);if(d){var m=this._gl,n=this._program;m.validateProgram(n);if(!m.getProgramParameter(n,m.VALIDATE_STATUS))throw new a("Program validation failed.  Link log: "+m.getProgramInfoLog(n))}},n.prototype.isDestroyed=function(){return!1},n.prototype.destroy=function(){return this._gl.deleteProgram(this._program),c(this)},n.prototype.release=function(){return this._cachedShader?this._cachedShader.cache.releaseShaderProgram(this):this.destroy()},n}),c("Renderer/Context",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/IndexDatatype","../Core/RuntimeError","../Core/PrimitiveType","../Core/WindingOrder","../Core/BoundingRectangle","../Core/createGuid","../Core/Matrix4","./Buffer","./BufferUsage","./BlendEquation","./BlendFunction","./CubeMap","./CullFace","./DepthFunction","./Framebuffer","./MipmapHint","./PixelDatatype","./PixelFormat","./PickFramebuffer","./Renderbuffer","./RenderbufferFormat","./ShaderCache","./ShaderProgram","./StencilFunction","./StencilOperation","./Texture","./TextureAtlas","./TextureMagnificationFilter","./TextureMinificationFilter","./TextureWrap","./UniformState","./VertexArray","./VertexLayout"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){function L(a,b){var c="OpenGL Error:  ";switch(b){case a.INVALID_ENUM:c+="Invalid enumeration";break;case a.INVALID_VALUE:c+="Invalid value";break;case a.INVALID_OPERATION:c+="Invalid operation";break;case a.OUT_OF_MEMORY:c+="Out of memory";break;case a.CONTEXT_LOST_WEBGL:c+="Context lost";break;default:c+="Unknown"}return c}function M(a,b,c,d){var e=L(a,d)+": "+b.name+"(";for(var f=0;f<c.length;++f)f!==0&&(e+=", "),e+=c[f];return e+=");",e}function N(a,b,c){var d=a.getError();if(d!==a.NO_ERROR)throw new f(M(a,b,c,d))}function O(a,b){function c(c){return function(){var d=c.apply(a,arguments);return b(a,c,arguments),d}}if(!b)return a;var d={};for(var e in a){var f=a[e];typeof f=="function"?d[e]=c(f):d[e]=f}return d}function R(a,c,d,e){var f;if(typeof d=="number")f=d;else{if(typeof d!="object"||typeof d.byteLength=="undefined")throw new b("typedArrayOrSizeInBytes must be either a typed array or a number.");f=d.byteLength}if(f<=0)throw new b("typedArrayOrSizeInBytes must be greater than zero.");if(!m.validate(e))throw new b("usage is invalid.");var g=a.createBuffer();return a.bindBuffer(c,g),a.bufferData(c,d,e),a.bindBuffer(c,null),new l(a,c,f,e,g)}var P=function(a,c){if(!window.WebGLRenderingContext)throw new f("The browser does not support WebGL.  Visit http://get.webgl.org.");if(!a)throw new b("canvas is required.");this._canvas=a,typeof c=="undefined"&&(c={}),typeof c.stencil=="undefined"&&(c.stencil=!0),typeof c.alpha=="undefined"&&(c.alpha=!1),this._originalGLContext=a.getContext("webgl",c)||a.getContext("experimental-webgl",c);if(!this._originalGLContext)throw new f("The browser supports WebGL, but initialization failed.");this._id=j(),this._validateFB=!1,this._validateSP=!1,this._logShaderCompilation=!1,this._throwOnWebGLError=!1,this._shaderCache=new z(this);var e=this._gl=this._originalGLContext;this._version=e.getParameter(e.VERSION),this._shadingLanguageVersion=e.getParameter(e.SHADING_LANGUAGE_VERSION),this._vendor=e.getParameter(e.VENDOR),this._renderer=e.getParameter(e.RENDERER),this._redBits=e.getParameter(e.RED_BITS),this._greenBits=e.getParameter(e.GREEN_BITS),this._blueBits=e.getParameter(e.BLUE_BITS),this._alphaBits=e.getParameter(e.ALPHA_BITS),this._depthBits=e.getParameter(e.DEPTH_BITS),this._stencilBits=e.getParameter(e.STENCIL_BITS),this._maximumCombinedTextureImageUnits=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._maximumCubeMapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._maximumFragmentUniformVectors=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this._maximumTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this._maximumRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this._maximumTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._maximumVaryingVectors=e.getParameter(e.MAX_VARYING_VECTORS),this._maximumVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this._maximumVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maximumVertexUniformVectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this._aliasedLineWidthRange=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),this._aliasedPointSizeRange=e.getParameter(e.ALIASED_POINT_SIZE_RANGE),this._maximumViewportDimensions=e.getParameter(e.MAX_VIEWPORT_DIMS),this._standardDerivatives=e.getExtension("OES_standard_derivatives"),this._depthTexture=e.getExtension("WEBKIT_WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture");var g=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic");this._textureFilterAnisotropic=g,this._maximumTextureFilterAnisotropy=g?e.getParameter(g.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1;var h=e.getParameter(e.COLOR_CLEAR_VALUE);this._clearColor=new d(h[0],h[1],h[2],h[3]),this._clearDepth=e.getParameter(e.DEPTH_CLEAR_VALUE),this._clearStencil=e.getParameter(e.STENCIL_CLEAR_VALUE),this._defaultClearColor=new d(h[0],h[1],h[2],h[3]),this._defaultClearDepth=this._clearDepth,this._defaultClearStencil=this._clearStencil,this._us=new I,this._currentFramebuffer=undefined,this._currentSp=undefined,this._defaultTexture=undefined,this._defaultCubeMap=undefined};P.prototype._enableOrDisable=function(a,b){b?this._gl.enable(a):this._gl.disable(a)},P.prototype._applyFrontFace=function(a){this._gl.frontFace(a)},P.prototype._applyCull=function(a){var b=this._gl,c=a.enabled;this._enableOrDisable(b.CULL_FACE,c),c&&b.cullFace(a.face)},P.prototype._applyLineWidth=function(a){this._gl.lineWidth(a)},P.prototype._applyPolygonOffset=function(a){var b=this._gl,c=a.enabled;this._enableOrDisable(b.POLYGON_OFFSET_FILL,c),c&&b.polygonOffset(a.factor,a.units)},P.prototype._applyScissorTest=function(a){var b=this._gl,c=a.enabled;this._enableOrDisable(b.SCISSOR_TEST,c);if(c){var d=a.rectangle;b.scissor(d.x,d.y,d.width,d.height)}},P.prototype._applyDepthRange=function(a){var b=a.near,c=a.far;this._gl.depthRange(b,c)},P.prototype._applyDepthTest=function(a){var b=this._gl,c=a.enabled;this._enableOrDisable(b.DEPTH_TEST,c),c&&b.depthFunc(a.func)},P.prototype._applyColorMask=function(a){this._gl.colorMask(a.red,a.green,a.blue,a.alpha)},P.prototype._applyDepthMask=function(a){this._gl.depthMask(a)},P.prototype._applyStencilMask=function(a){this._gl.stencilMask(a)},P.prototype._applyBlending=function(a){var b=this._gl,c=a.enabled;this._enableOrDisable(b.BLEND,c);if(c){var d=a.color,e=a.equationRgb,f=a.equationAlpha,g=a.functionSourceRgb,h=a.functionDestinationRgb,i=a.functionSourceAlpha,j=a.functionDestinationAlpha;b.blendColor(d.red,d.green,d.blue,d.alpha),b.blendEquationSeparate(e,f),b.blendFuncSeparate(g,h,i,j)}},P.prototype._applyStencilTest=function(a){var b=this._gl,c=a.enabled;this._enableOrDisable(b.STENCIL_TEST,c);if(c){var d=a.frontFunction,e=a.backFunction,f=a.reference,g=a.mask;b.stencilFunc(a.frontFunction,a.reference,a.mask),b.stencilFuncSeparate(b.BACK,e,f,g),b.stencilFuncSeparate(b.FRONT,d,f,g);var h=a.frontOperation,i=h.fail,j=h.zFail,k=h.zPass;b.stencilOpSeparate(b.FRONT,i,j,k);var l=a.backOperation,m=l.fail,n=l.zFail,o=l.zPass;b.stencilOpSeparate(b.BACK,m,n,o)}},P.prototype._applySampleCoverage=function(a){var b=this._gl,c=a.enabled;this._enableOrDisable(b.SAMPLE_COVERAGE,c),c&&b.sampleCoverage(a.value,a.invert)},P.prototype._applyDither=function(a){this._enableOrDisable(this._gl.DITHER,a)};var Q=new i;return P.prototype._applyViewport=function(a){typeof a=="undefined"&&(a=Q,a.width=this._canvas.clientWidth,a.height=this._canvas.clientHeight),this._us.setViewport(a),this._gl.viewport(a.x,a.y,a.width,a.height)},P.prototype._applyRenderState=function(a){this._applyFrontFace(a.frontFace),this._applyCull(a.cull),this._applyLineWidth(a.lineWidth),this._applyPolygonOffset(a.polygonOffset),this._applyScissorTest(a.scissorTest),this._applyDepthRange(a.depthRange),this._applyDepthTest(a.depthTest),this._applyColorMask(a.colorMask),this._applyDepthMask(a.depthMask),this._applyStencilMask(a.stencilMask),this._applyBlending(a.blending),this._applyStencilTest(a.stencilTest),this._applySampleCoverage(a.sampleCoverage),this._applyDither(a.dither),this._applyViewport(a.viewport)},P.prototype.getId=function(){return this._id},P.prototype.getCanvas=function(){return this._canvas},P.prototype.getShaderCache=function(){return this._shaderCache},P.prototype.getUniformState=function(){return this._us},P.prototype.getVersion=function(){return this._version},P.prototype.getShadingLanguageVersion=function(){return this._shadingLanguageVersion},P.prototype.getVendor=function(){return this._vendor},P.prototype.getRenderer=function(){return this._renderer},P.prototype.getRedBits=function(){return this._redBits},P.prototype.getGreenBits=function(){return this._greenBits},P.prototype.getBlueBits=function(){return this._blueBits},P.prototype.getAlphaBits=function(){return this._alphaBits},P.prototype.getDepthBits=function(){return this._depthBits},P.prototype.getStencilBits=function(){return this._stencilBits},P.prototype.getMaximumCombinedTextureImageUnits=function(){return this._maximumCombinedTextureImageUnits},P.prototype.getMaximumCubeMapSize=function(){return this._maximumCubeMapSize},P.prototype.getMaximumFragmentUniformVectors=function(){return this._maximumFragmentUniformVectors},P.prototype.getMaximumTextureImageUnits=function(){return this._maximumTextureImageUnits},P.prototype.getMaximumRenderbufferSize=function(){return this._maximumRenderbufferSize},P.prototype.getMaximumTextureSize=function(){return this._maximumTextureSize},P.prototype.getMaximumVaryingVectors=function(){return this._maximumVaryingVectors},P.prototype.getMaximumVertexAttributes=function(){return this._maximumVertexAttributes},P.prototype.getMaximumVertexTextureImageUnits=function(){return this._maximumVertexTextureImageUnits},P.prototype.getMaximumVertexUniformVectors=function(){return this._maximumVertexUniformVectors},P.prototype.getMinimumAliasedLineWidth=function(){return this._aliasedLineWidthRange[0]},P.prototype.getMaximumAliasedLineWidth=function(){return this._aliasedLineWidthRange[1]},P.prototype.getMinimumAliasedPointSize=function(){return this._aliasedPointSizeRange[0]},P.prototype.getMaximumAliasedPointSize=function(){return this._aliasedPointSizeRange[1]},P.prototype.getMaximumViewportWidth=function(){return this._maximumViewportDimensions[0]},P.prototype.getMaximumViewportHeight=function(){return this._maximumViewportDimensions[1]},P.prototype.getStandardDerivatives=function(){return!!this._standardDerivatives},P.prototype.getDepthTexture=function(){return!!this._depthTexture},P.prototype.getTextureFilterAnisotropic=function(){return!!this._textureFilterAnisotropic},P.prototype.getMaximumTextureFilterAnisotropy=function(){return this._maximumTextureFilterAnisotropy},P.prototype.getValidateFramebuffer=function(){return this._validateFB},P.prototype.setValidateFramebuffer=function(a){this._validateFB=a},P.prototype.getValidateShaderProgram=function(){return this._validateSP},P.prototype.setValidateShaderProgram=function(a){this._validateSP=a},P.prototype.getThrowOnWebGLError=function(){return this._throwOnWebGLError},P.prototype.setThrowOnWebGLError=function(a){this._throwOnWebGLError=a,this._gl=O(this._originalGLContext,a?N:null)},P.prototype.getLogShaderCompilation=function(){return this._logShaderCompilation},P.prototype.setLogShaderCompilation=function(a){this._logShaderCompilation=a},P.prototype.getDefaultTexture=function(){return this._defaultTexture===undefined&&(this._defaultTexture=this.createTexture2D({source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])}})),this._defaultTexture},P.prototype.getDefaultCubeMap=function(){if(this._defaultCubeMap===undefined){var a={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=this.createCubeMap({source:{positiveX:a,negativeX:a,positiveY:a,negativeY:a,positiveZ:a,negativeZ:a}})}return this._defaultCubeMap},P.prototype.createShaderProgram=function(a,b,c){return new A(this._gl,this._logShaderCompilation,a,b,c)},P.prototype.createVertexBuffer=function(a,b){return R(this._gl,this._gl.ARRAY_BUFFER,a,b)},P.prototype.createIndexBuffer=function(a,c,d){var f;if(d===e.UNSIGNED_BYTE)f=Uint8Array.BYTES_PER_ELEMENT;else{if(d!==e.UNSIGNED_SHORT)throw new b("Invalid indexDatatype.");f=Uint16Array.BYTES_PER_ELEMENT}var g=this._gl,h=R(g,g.ELEMENT_ARRAY_BUFFER,a,c),i=h.getSizeInBytes()/f;return h.getIndexDatatype=function(){return d},h.getBytesPerIndex=function(){return f},h.getNumberOfIndices=function(){return i},h},P.prototype.createVertexArray=function(a,b){return new J(this._gl,a,b)},P.prototype.createTexture2D=function(c){if(!c)throw new b("description is required.");var d=c.source,e=typeof d!="undefined"?d.width:c.width,g=typeof d!="undefined"?d.height:c.height;if(typeof e=="undefined"||typeof g=="undefined")throw new b("description requires a source field to create an initialized texture or width and height fields to create a blank texture.");if(e<=0)throw new b("Width must be greater than zero.");if(e>this._maximumTextureSize)throw new b("Width must be less than or equal to the maximum texture size ("+this._maximumTextureSize+").  Check getMaximumTextureSize().");if(g<=0)throw new b("Height must be greater than zero.");if(g>this._maximumTextureSize)throw new b("Height must be less than or equal to the maximum texture size ("+this._maximumTextureSize+").  Check getMaximumTextureSize().");var h=a(c.pixelFormat,v.RGBA);if(!v.validate(h))throw new b("Invalid description.pixelFormat.");var i=a(c.pixelDatatype,u.UNSIGNED_BYTE);if(!u.validate(i))throw new b("Invalid description.pixelDatatype.");if(h===v.DEPTH_COMPONENT&&i!==u.UNSIGNED_SHORT&&i!==u.UNSIGNED_INT)throw new b("When description.pixelFormat is DEPTH_COMPONENT, description.pixelDatatype must be UNSIGNED_SHORT or UNSIGNED_INT.");if(h===v.DEPTH_STENCIL&&i!==u.UNSIGNED_INT_24_8_WEBGL)throw new b("When description.pixelFormat is DEPTH_STENCIL, description.pixelDatatype must be UNSIGNED_INT_24_8_WEBGL.");if(v.isDepthFormat(h)){if(d)throw new b("When description.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, source cannot be provided.");if(!this.getDepthTexture())throw new f("When description.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, this WebGL implementation must support WEBGL_depth_texture.  Check getDepthTexture().")}var j=c.preMultiplyAlpha||h===v.RGB||h===v.LUMINANCE,k=this._gl,l=k.TEXTURE_2D,m=k.createTexture();return k.activeTexture(k.TEXTURE0),k.bindTexture(l,m),d?(k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j),k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!0),d.arrayBufferView?k.texImage2D(l,0,h,e,g,0,h,i,d.arrayBufferView):k.texImage2D(l,0,h,h,i,d)):k.texImage2D(l,0,h,e,g,0,h,i,null),k.bindTexture(l,null),new D(k,this._textureFilterAnisotropic,l,m,h,i,e,g,j)},P.prototype.createTexture2DFromFramebuffer=function(c,d,e,f,g){c=c||v.RGB,d=a(d,0),e=a(e,0),f=a(f,this._canvas.clientWidth),g=a(g,this._canvas.clientHeight);if(!v.validate(c))throw new b("Invalid pixelFormat.");if(v.isDepthFormat(c))throw new b("pixelFormat cannot be DEPTH_COMPONENT or DEPTH_STENCIL.");if(d<0)throw new b("framebufferXOffset must be greater than or equal to zero.");if(e<0)throw new b("framebufferYOffset must be greater than or equal to zero.");if(d+f>this._canvas.clientWidth)throw new b("framebufferXOffset + width must be less than or equal to getCanvas().clientWidth");if(e+g>this._canvas.clientHeight)throw new b("framebufferYOffset + height must be less than or equal to getCanvas().clientHeight.");var h=this._gl,i=h.TEXTURE_2D,j=h.createTexture();return h.activeTexture(h.TEXTURE0),h.bindTexture(i,j),h.copyTexImage2D(i,0,c,d,e,f,g,0),h.bindTexture(i,null),new D(h,this._textureFilterAnisotropic,i,j,c,undefined,f,g)},P.prototype.createTextureAtlas=function(a){return a=a||{},a.context=this,new E(a)},P.prototype.createCubeMap=function(c){function q(a,b){b.arrayBufferView?m.texImage2D(a,0,j,i,i,0,j,k,b.arrayBufferView):m.texImage2D(a,0,j,j,k,b)}if(!c)throw new b("description is required.");var d=c.source,e,f;if(d){var g=[d.positiveX,d.negativeX,d.positiveY,d.negativeY,d.positiveZ,d.negativeZ];if(!g[0]||!g[1]||!g[2]||!g[3]||!g[4]||!g[5])throw new b("description.source requires positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ faces.");e=g[0].width,f=g[0].height;for(var h=1;h<6;++h)if(Number(g[h].width)!==e||Number(g[h].height)!==f)throw new b("Each face in description.source must have the same width and height.")}else e=c.width,f=c.height;if(typeof e=="undefined"||typeof f=="undefined")throw new b("description requires a source field to create an initialized cube map or width and height fields to create a blank cube map.");if(e!==f)throw new b("Width must equal height.");var i=e;if(i<=0)throw new b("Width and height must be greater than zero.");if(i>this._maximumCubeMapSize)throw new b("Width and height must be less than or equal to the maximum cube map size ("+this._maximumCubeMapSize+").  Check getMaximumCubeMapSize().");var j=a(c.pixelFormat,v.RGBA);if(!v.validate(j))throw new b("Invalid description.pixelFormat.");if(v.isDepthFormat(j))throw new b("description.pixelFormat cannot be DEPTH_COMPONENT or DEPTH_STENCIL.");var k=a(c.pixelDatatype,u.UNSIGNED_BYTE);if(!u.validate(k))throw new b("Invalid description.pixelDatatype.");var l=c.preMultiplyAlpha||j===v.RGB||j===v.LUMINANCE,m=this._gl,n=m.TEXTURE_CUBE_MAP,o=m.createTexture();return m.activeTexture(m.TEXTURE0),m.bindTexture(n,o),d?(m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,!0),q(m.TEXTURE_CUBE_MAP_POSITIVE_X,d.positiveX),q(m.TEXTURE_CUBE_MAP_NEGATIVE_X,d.negativeX),q(m.TEXTURE_CUBE_MAP_POSITIVE_Y,d.positiveY),q(m.TEXTURE_CUBE_MAP_NEGATIVE_Y,d.negativeY),q(m.TEXTURE_CUBE_MAP_POSITIVE_Z,d.positiveZ),q(m.TEXTURE_CUBE_MAP_NEGATIVE_Z,d.negativeZ)):(m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X,0,j,i,i,0,j,k,null),m.texImage2D(m.TEXTURE_CUBE_MAP_NEGATIVE_X,0,j,i,i,0,j,k,null),m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_Y,0,j,i,i,0,j,k,null),m.texImage2D(m.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,j,i,i,0,j,k,null),m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_Z,0,j,i,i,0,j,k,null),m.texImage2D(m.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,j,i,i,0,j,k,null)),m.bindTexture(n,null),new p(m,this._textureFilterAnisotropic,n,o,j,k,i,l)},P.prototype.createFramebuffer=function(a){return new s(this._gl,a)},P.prototype.createRenderbuffer=function(a){a=a||{};var c=a.format||y.RGBA4,d=typeof a.width=="undefined"?this._canvas.clientWidth:a.width,e=typeof a.height=="undefined"?this._canvas.clientHeight:a.height,f=this._gl;if(!y.validate(c))throw new b("Invalid format.");if(d<=0)throw new b("Width must be greater than zero.");if(d>this.getMaximumRenderbufferSize())throw new b("Width must be less than or equal to the maximum renderbuffer size ("+this.getMaximumRenderbufferSize()+").  Check getMaximumRenderbufferSize().");if(e<=0)throw new b("Height must be greater than zero.");if(e>this.getMaximumRenderbufferSize())throw new b("Height must be less than or equal to the maximum renderbuffer size ("+this.getMaximumRenderbufferSize()+").  Check getMaximumRenderbufferSize().");return new x(f,c,d,e)},P.prototype.createRenderState=function(a){var c=a||{},e=c.cull||{},g=c.polygonOffset||{},j=c.scissorTest||{},k=j.rectangle||{},l=c.depthRange||{},m=c.depthTest||{},p=c.colorMask||{},s=c.blending||{},t=s.color||{},u=c.stencilTest||{},v=u.frontOperation||{},w=u.backOperation||{},x=c.sampleCoverage||{},y=c.viewport,z={frontFace:typeof c.frontFace=="undefined"?h.COUNTER_CLOCKWISE:c.frontFace,cull:{enabled:typeof e.enabled=="undefined"?!1:e.enabled,face:typeof e.face=="undefined"?q.BACK:e.face},lineWidth:typeof c.lineWidth=="undefined"?1:c.lineWidth,polygonOffset:{enabled:typeof g.enabled=="undefined"?!1:g.enabled,factor:typeof g.factor=="undefined"?0:g.factor,units:typeof g.units=="undefined"?0:g.units},scissorTest:{enabled:typeof j.enabled=="undefined"?!1:j.enabled,rectangle:i.clone(k)},depthRange:{near:typeof l.near=="undefined"?0:l.near,far:typeof l.far=="undefined"?1:l.far},depthTest:{enabled:typeof m.enabled=="undefined"?!1:m.enabled,func:typeof m.func=="undefined"?r.LESS:m.func},colorMask:{red:typeof p.red=="undefined"?!0:p.red,green:typeof p.green=="undefined"?!0:p.green,blue:typeof p.blue=="undefined"?!0:p.blue,alpha:typeof p.alpha=="undefined"?!0:p.alpha},depthMask:typeof c.depthMask=="undefined"?!0:c.depthMask,stencilMask:typeof c.stencilMask=="undefined"?-1:c.stencilMask,blending:{enabled:typeof s.enabled=="undefined"?!1:s.enabled,color:new d(typeof t.red=="undefined"?0:t.red,typeof t.green=="undefined"?0:t.green,typeof t.blue=="undefined"?0:t.blue,typeof t.alpha=="undefined"?0:t.alpha),equationRgb:typeof s.equationRgb=="undefined"?n.ADD:s.equationRgb,equationAlpha:typeof s.equationAlpha=="undefined"?n.ADD:s.equationAlpha,functionSourceRgb:typeof s.functionSourceRgb=="undefined"?o.ONE:s.functionSourceRgb,functionSourceAlpha:typeof s.functionSourceAlpha=="undefined"?o.ONE:s.functionSourceAlpha,functionDestinationRgb:typeof s.functionDestinationRgb=="undefined"?o.ZERO:s.functionDestinationRgb,functionDestinationAlpha:typeof s.functionDestinationAlpha=="undefined"?o.ZERO:s.functionDestinationAlpha},stencilTest:{enabled:typeof u.enabled=="undefined"?!1:u.enabled,frontFunction:typeof u.frontFunction=="undefined"?B.ALWAYS:u.frontFunction,backFunction:typeof u.backFunction=="undefined"?B.ALWAYS:u.backFunction,reference:typeof u.reference=="undefined"?0:u.reference,mask:typeof u.mask=="undefined"?-1:u.mask,frontOperation:{fail:typeof v.fail=="undefined"?C.KEEP:v.fail,zFail:typeof v.zFail=="undefined"?C.KEEP:v.zFail,zPass:typeof v.zPass=="undefined"?C.KEEP:v.zPass},backOperation:{fail:typeof w.fail=="undefined"?C.KEEP:w.fail,zFail:typeof w.zFail=="undefined"?C.KEEP:w.zFail,zPass:typeof w.zPass=="undefined"?C.KEEP:w.zPass}},sampleCoverage:{enabled:typeof x.enabled=="undefined"?!1:x.enabled,value:typeof x.value=="undefined"?1:x.value,invert:typeof x.invert=="undefined"?!1:x.invert},dither:typeof c.dither=="undefined"?!0:c.dither};if(!h.validate(z.frontFace))throw new b("Invalid renderState.frontFace.");if(!q.validate(z.cull.face))throw new b("Invalid renderState.cull.face.");if(z.lineWidth<this._aliasedLineWidthRange[0]||z.lineWidth>this._aliasedLineWidthRange[1])throw new f("renderState.lineWidth is out of range.  Check getMinimumAliasedLineWidth() and getMaximumAliasedLineWidth().");if(z.scissorTest.rectangle.width<0||z.scissorTest.rectangle.height<0)throw new b("renderState.scissorTest.rectangle.width and renderState.scissorTest.rectangle.height must be greater than or equal to zero.");if(z.depthRange.near>z.depthRange.far)throw new b("renderState.depthRange.near can not be greater than renderState.depthRange.far.");if(z.depthRange.near<0)throw new b("renderState.depthRange.near must be greater than or equal to zero.");if(z.depthRange.far>1)throw new b("renderState.depthRange.far must be less than or equal to one.");if(!r.validate(z.depthTest.func))throw new b("Invalid renderState.depthTest.func.");if(z.blending.color.red<0||z.blending.color.red>1||z.blending.color.green<0||z.blending.color.green>1||z.blending.color.blue<0||z.blending.color.blue>1||z.blending.color.alpha<0||z.blending.color.alpha>1)throw new b("renderState.blending.color components must be greater than or equal to zero and less than or equal to one.");if(!n.validate(z.blending.equationRgb))throw new b("Invalid renderState.blending.equationRgb.");if(!n.validate(z.blending.equationAlpha))throw new b("Invalid renderState.blending.equationAlpha.");if(!o.validate(z.blending.functionSourceRgb))throw new b("Invalid renderState.blending.functionSourceRgb.");if(!o.validate(z.blending.functionSourceAlpha))throw new b("Invalid renderState.blending.functionSourceAlpha.");if(!o.validate(z.blending.functionDestinationRgb))throw new b("Invalid renderState.blending.functionDestinationRgb.");if(!o.validate(z.blending.functionDestinationAlpha))throw new b("Invalid renderState.blending.functionDestinationAlpha.");if(!B.validate(z.stencilTest.frontFunction))throw new b("Invalid renderState.stencilTest.frontFunction.");if(!B.validate(z.stencilTest.backFunction))throw new b("Invalid renderState.stencilTest.backFunction.");if(!C.validate(z.stencilTest.frontOperation.fail))throw new b("Invalid renderState.stencilTest.frontOperation.fail.");if(!C.validate(z.stencilTest.frontOperation.zFail))throw new b("Invalid renderState.stencilTest.frontOperation.zFail.");if(!C.validate(z.stencilTest.frontOperation.zPass))throw new b("Invalid renderState.stencilTest.frontOperation.zPass.");if(!C.validate(z.stencilTest.backOperation.fail))throw new b("Invalid renderState.stencilTest.backOperation.fail.");if(!C.validate(z.stencilTest.backOperation.zFail))throw new b("Invalid renderState.stencilTest.backOperation.zFail.");if(!C.validate(z.stencilTest.backOperation.zPass))throw new b("Invalid renderState.stencilTest.backOperation.zPass.");if(typeof vieport!="undefined"){if(y.width<0)throw new b("renderState.viewport.width must be greater than or equal to zero.");if(y.width>this.getMaximumViewportWidth())throw new f("renderState.viewport.width must be less than or equal to the maximum viewport width ("+this.getMaximumViewportWidth().toString()+").  Check getMaximumViewportWidth().");if(y.height<0)throw new b("renderState.viewport.height must be greater than or equal to zero.");if(y.height>this.getMaximumViewportHeight())throw new f("renderState.viewport.height must be less than or equal to the maximum viewport height ("+this.getMaximumViewportHeight().toString()+").  Check getMaximumViewportHeight().");z.viewport=new i(y.x,y.y,typeof y.width=="undefined"?this._canvas.clientWidth:y.width,typeof y.height=="undefined"?this._canvas.clientHeight:y.height)}return z},P.prototype.createSampler=function(a){var c={wrapS:a.wrapS||H.CLAMP,wrapT:a.wrapT||H.CLAMP,minificationFilter:a.minificationFilter||G.LINEAR,magnificationFilter:a.magnificationFilter||F.LINEAR,maximumAnisotropy:typeof a.maximumAnisotropy!="undefined"?a.maximumAnisotropy:1};if(!H.validate(c.wrapS))throw new b("Invalid sampler.wrapS.");if(!H.validate(c.wrapT))throw new b("Invalid sampler.wrapT.");if(!G.validate(c.minificationFilter))throw new b("Invalid sampler.minificationFilter.");if(!F.validate(c.magnificationFilter))throw new b("Invalid sampler.magnificationFilter.");if(c.maximumAnisotropy<1)throw new b("sampler.maximumAnisotropy must be greater than or equal to one.");return c},P.prototype.createClearState=function(a){var c=a||{},e=c.scissorTest||{},f=e.rectangle||{},g=c.colorMask||{},h=c.color,i=c.depth,j=c.stencil;typeof h=="undefined"&&typeof i=="undefined"&&typeof j=="undefined"&&(h=this._defaultClearColor,i=this._defaultClearDepth,j=this._defaultClearStencil);var k={scissorTest:{enabled:typeof e.enabled=="undefined"?!1:e.enabled,rectangle:{x:typeof f.x=="undefined"?0:f.x,y:typeof f.y=="undefined"?0:f.y,width:typeof f.width=="undefined"?0:f.width,height:typeof f.height=="undefined"?0:f.height}},colorMask:{red:typeof g.red=="undefined"?!0:g.red,green:typeof g.green=="undefined"?!0:g.green,blue:typeof g.blue=="undefined"?!0:g.blue,alpha:typeof g.alpha=="undefined"?!0:g.alpha},depthMask:typeof c.depthMask=="undefined"?!0:c.depthMask,stencilMask:typeof c.stencilMask=="undefined"?-1:c.stencilMask,dither:typeof c.dither=="undefined"?!0:c.dither,framebuffer:c.framebuffer,color:typeof h!="undefined"?d.clone(h):undefined,depth:i,stencil:j};if(k.scissorTest.rectangle.width<0||k.scissorTest.rectangle.height<0)throw new b("clearState.scissorTest.rectangle.width and clearState.scissorTest.rectangle.height must be greater than or equal to zero.");return k},P.prototype._validateFramebuffer=function(a){if(this._validateFB){var c=this._gl,d=c.checkFramebufferStatus(c.FRAMEBUFFER);if(d!==c.FRAMEBUFFER_COMPLETE){var e;switch(d){case c.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:e="Framebuffer is not complete.  Incomplete attachment: at least one attachment point with a renderbuffer or texture attached has its attached object no longer in existence or has an attached image with a width or height of zero, or the color attachment point has a non-color-renderable image attached, or the depth attachment point has a non-depth-renderable image attached, or the stencil attachment point has a non-stencil-renderable image attached.  Color-renderable formats include GL_RGBA4, GL_RGB5_A1, and GL_RGB565. GL_DEPTH_COMPONENT16 is the only depth-renderable format. GL_STENCIL_INDEX8 is the only stencil-renderable format.";break;case c.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:e="Framebuffer is not complete.  Incomplete dimensions: not all attached images have the same width and height.";break;case c.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:e="Framebuffer is not complete.  Missing attachment: no images are attached to the framebuffer.";break;case c.FRAMEBUFFER_UNSUPPORTED:e="Framebuffer is not complete.  Unsupported: the combination of internal formats of the attached images violates an implementation-dependent set of restrictions."}throw new b(e)}}},P.prototype.clear=function(b,c){var e;typeof b!="undefined"&&typeof b.clearState!="undefined"?e=b.clearState:e=this.createClearState();var f=this._gl,g=0;e=e||this.createClearState();var h=e.color,i=e.depth,j=e.stencil;typeof h!="undefined"&&(d.equals(this._clearColor,h)||(d.clone(h,this._clearColor),f.clearColor(h.red,h.green,h.blue,h.alpha)),g|=f.COLOR_BUFFER_BIT),typeof i!="undefined"&&(i!==this._clearDepth&&(this._clearDepth=i,f.clearDepth(i)),g|=f.DEPTH_BUFFER_BIT),typeof j!="undefined"&&(j!==this._clearStencil&&(this._clearStencil=j,f.clearStencil(j)),g|=f.STENCIL_BUFFER_BIT),this._applyScissorTest(e.scissorTest),this._applyColorMask(e.colorMask),this._applyDepthMask(e.depthMask),this._applyStencilMask(e.stencilMask),this._applyDither(e.dither),c=a(e.framebuffer,c),c&&(c._bind(),this._validateFramebuffer(c)),f.clear(g),c&&c._unBind()},P.prototype.draw=function(a,b){this.beginDraw(a,b),this.continueDraw(a),this.endDraw()},P.prototype.beginDraw=function(c,d){if(typeof c=="undefined")throw new b("command is required.");if(typeof c.shaderProgram=="undefined")throw new b("command.shaderProgram is required.");d=a(c.framebuffer,d);var e=c.shaderProgram,f=c.renderState||this.createRenderState();if(d&&f.depthTest&&f.depthTest.enabled&&!d.hasDepthAttachment())throw new b("The depth test can not be enabled (command.renderState.depthTest.enabled) because the framebuffer (command.framebuffer) does not have a depth or depth-stencil renderbuffer.");this._applyRenderState(f),d&&(d._bind(),this._validateFramebuffer(d)),e._bind(),this._currentFramebuffer=d,this._currentSp=e},P.prototype.continueDraw=function(c){var d=this._currentSp;if(typeof d=="undefined")throw new b("beginDraw must be called before continueDraw.");if(typeof c=="undefined")throw new b("command is required.");var e=c.primitiveType;if(!g.validate(e))throw new b("command.primitiveType is required and must be valid.");if(typeof c.vertexArray=="undefined")throw new b("command.vertexArray is required.");var f=c.vertexArray,h=f.getIndexBuffer(),i=c.offset,j=c.count;h?(i=(i||0)*h.getBytesPerIndex(),j=j||h.getNumberOfIndices()):(i=i||0,j=j||f._getNumberOfVertices());if(i<0)throw new b("command.offset must be omitted or greater than or equal to zero.");j>0&&(this._us.setModel(a(c.modelMatrix,k.IDENTITY)),d._setUniforms(c.uniformMap,this._us,this._validateSP),f._bind(),h?this._gl.drawElements(e,j,h.getIndexDatatype().value,i):this._gl.drawArrays(e,i,j),f._unBind())},P.prototype.endDraw=function(){this._currentFramebuffer&&(this._currentFramebuffer._unBind(),this._currentFramebuffer=undefined),this._currentSp._unBind(),this._currentSp=undefined},P.prototype.readPixels=function(a){a=a||{};var c=Math.max(a.x||0,0),d=Math.max(a.y||0,0),e=a.width||this._canvas.clientWidth,f=a.height||this._canvas.clientHeight,g=a.framebuffer||null;if(e<=0)throw new b("readState.width must be greater than zero.");if(f<=0)throw new b("readState.height must be greater than zero.");var h=new Uint8Array(4*e*f);g&&(g._bind(),this._validateFramebuffer(g));var i=this._gl;return i.readPixels(c,d,e,f,i.RGBA,i.UNSIGNED_BYTE,h),g&&g._unBind(),h},P.prototype._interleaveAttributes=function(a){function b(a){return a.values.length/a.componentsPerAttribute}function c(a){return a.componentDatatype.sizeInBytes*a.componentsPerAttribute}var d,e,g,h=[];for(e in a)a.hasOwnProperty(e)&&a[e].values&&h.push(e);var i,j=h.length;if(j>0){i=b(a[h[0]]);for(d=1;d<j;++d){var k=b(a[h[d]]);if(k!==i)throw new f("Each attribute list must have the same number of vertices.  Attribute "+h[d]+" has a different number of vertices "+"("+k.toString()+")"+" than attribute "+h[0]+" ("+i.toString()+").")}}h.sort(function(b,c){return a[c].componentDatatype.sizeInBytes-a[b].componentDatatype.sizeInBytes});var l=0,m={};for(d=0;d<j;++d)e=h[d],g=a[e],m[e]=l,l+=c(g);if(l>0){var n=a[h[0]].componentDatatype.sizeInBytes,o=l%n;o!==0&&(l+=n-o);var p=i*l,q=new ArrayBuffer(p),r={};for(d=0;d<j;++d){e=h[d];var s=a[e].componentDatatype.sizeInBytes;r[e]={pointer:a[e].componentDatatype.toTypedArray(q),index:m[e]/s,strideInComponentType:l/s}}for(d=0;d<i;++d)for(var t=0;t<j;++t){e=h[t],g=a[e];var u=g.values,v=r[e],w=v.pointer,x=g.componentsPerAttribute;for(var y=0;y<x;++y)w[v.index+y]=u[d*x+y];v.index+=v.strideInComponentType}return{buffer:q,offsetsInBytes:m,vertexSizeInBytes:l}}return undefined},P.prototype._createVertexArrayAttributes=function(a){var b=a||{},c=b.mesh||{},d=b.attributeIndices||{},e=b.bufferUsage||m.DYNAMIC_DRAW,f=b.vertexLayout&&b.vertexLayout===K.INTERLEAVED,g,h,i=[],j=c.attributes;if(f){var k=this._interleaveAttributes(j);if(k){var l=this.createVertexBuffer(k.buffer,e),n=k.offsetsInBytes,o=k.vertexSizeInBytes;for(g in j)j.hasOwnProperty(g)&&(h=j[g],h.values?i.push({index:d[g],vertexBuffer:l,componentDatatype:h.componentDatatype,componentsPerAttribute:h.componentsPerAttribute,normalize:h.normalize,offsetInBytes:n[g],strideInBytes:o}):i.push({index:d[g],value:h.value,componentDatatype:h.componentDatatype,normalize:h.normalize}))}}else for(g in j)j.hasOwnProperty(g)&&(h=j[g],i.push({index:d[g],vertexBuffer:h.values?this.createVertexBuffer(h.componentDatatype.toTypedArray(h.values),e):undefined,value:h.value?h.value:undefined,componentDatatype:h.componentDatatype,componentsPerAttribute:h.componentsPerAttribute,normalize:h.normalize}));return this.createVertexArray(i)},P.prototype.createVertexArrayFromMesh=function(a){var c=a||{},d=c.mesh||{},f=c.bufferUsage||m.DYNAMIC_DRAW,g;if(d.indexLists){g=d.indexLists;if(g.length!==1)throw new b("The mesh must have zero or one index lists.  This mesh has "+g.length.toString()+" index lists.")}var h=this._createVertexArrayAttributes(a);return g&&h.setIndexBuffer(this.createIndexBuffer(new Uint16Array(g[0].values),f,e.UNSIGNED_SHORT)),h},P.prototype.createPickFramebuffer=function(){return new w(this)},P.prototype.getObjectByPickId=function(a){return undefined},P.prototype.createPickId=function(a){function e(a){var b="r"+a.red+"g"+a.green+"b"+a.blue;return b}function g(a){if(++c.blue===256){c.blue=0;if(++c.green===256){c.green=0;if(++c.red===256)throw new f("Out of unique Rgb colors.")}}var g={unnormalizedRgb:new d(c.red,c.green,c.blue,1),normalizedRgba:d.fromBytes(c.red,c.green,c.blue,255),destroy:function(){return null}};return b[e(g.unnormalizedRgb)]=a,g}function h(a){return b[e(a)]}var b={},c=new d(0,0,0,0);return this.createPickId=g,this.getObjectByPickId=h,g(a)},P.prototype.isDestroyed=function(){return!1},P.prototype.destroy=function(){return this._shaderCache=this._shaderCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),c(this)},P}),c("Shaders/CentralBodyFS",[],function(){return"//#define SHOW_TILE_BOUNDARIES\n//#define SHOW_TEXTURE_BOUNDARIES\n\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTexCoordsExtent[TEXTURE_UNITS];\n#endif\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\n\nvarying vec2 v_textureCoordinates;\n\nvec3 sampleAndBlend(\n    vec3 previousColor,\n    sampler2D texture,\n    vec2 tileTextureCoordinates,\n    vec4 textureCoordinateExtent,\n    vec4 textureCoordinateTranslationAndScale,\n    float textureAlpha,\n    float textureBrightness,\n    float textureContrast,\n    float textureOneOverGamma)\n{\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\n    //    tileTextureCoordinates.s < textureCoordinateExtent.s ||\n    //    tileTextureCoordinates.s > textureCoordinateExtent.p ||\n    //    tileTextureCoordinates.t < textureCoordinateExtent.t ||\n    //    tileTextureCoordinates.t > textureCoordinateExtent.q\n    // In other words, the alpha is zero if the fragment is outside the extent\n    // covered by this texture.  Would an actual 'if' yield better performance?\n    vec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates); \n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n    \n    alphaMultiplier = step(vec2(0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n    \n    vec2 translation = textureCoordinateTranslationAndScale.xy;\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\n    vec4 sample = texture2D(texture, textureCoordinates);\n    vec3 color = sample.rgb;\n    float alpha = sample.a;\n    \n    color = mix(vec3(0.0, 0.0, 0.0), color, textureBrightness);\n    color = mix(vec3(0.5, 0.5, 0.5), color, textureContrast);\n    \n    color = pow(color, vec3(textureOneOverGamma));\n\n#ifdef SHOW_TEXTURE_BOUNDARIES\n    if (textureCoordinates.x < (1.0/256.0) || textureCoordinates.x > (255.0/256.0) ||\n        textureCoordinates.y < (1.0/256.0) || textureCoordinates.y > (255.0/256.0))\n    {\n        color = vec3(1.0, 1.0, 0.0);\n        alpha = 1.0;\n    }\n#endif\n\n    return mix(previousColor, color, alpha * textureAlpha);\n}\n\nvec3 computeDayColor(vec3 initialColor, vec2 textureCoordinates);\n\nvoid main()\n{\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\n    // fragments on the edges of tiles even though the vertex shader is outputting\n    // coordinates strictly in the 0-1 range.\n    vec3 initialColor = vec3(0.0, 0.0, 0.5);\n    vec3 startDayColor = computeDayColor(initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\n    \n#ifdef SHOW_TILE_BOUNDARIES\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n    {\n        startDayColor = vec3(1.0, 0.0, 0.0);\n    }\n#endif\n\n    gl_FragColor = vec4(startDayColor, 1.0);\n}\n"}),c("Shaders/CentralBodyFSDepth",[],function(){return"varying vec4 positionEC;\n\nvoid main()\n{\n    // TODO: make arbitrary ellipsoid\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\n    \n    vec3 direction = normalize(positionEC.xyz);\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n    \n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\n    if (!czm_isEmpty(intersection))\n    {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n    }\n    else\n    {\n        discard;\n    }\n}"}),c("Shaders/CentralBodyFSPole",[],function(){return"uniform vec3 u_color;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    // TODO: make arbitrary ellipsoid\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\n    vec3 direction = normalize(czm_windowToEyeCoordinates(gl_FragCoord).xyz);\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\n    \n    if (!czm_isEmpty(intersection))\n    {\n        vec3 positionEC = czm_pointAlongRay(ray, intersection.start);\n        vec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\n	    \n	    vec3 normalMC = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), vec3(1.0)));\n	    vec3 normalEC = normalize(czm_normal * normalMC);\n	    \n        vec3 startDayColor = u_color;\n		\n        gl_FragColor = vec4(startDayColor, 1.0);\n    }\n    else\n    {\n        discard;\n    }\n}"}),c("Shaders/CentralBodyVS",[],function(){return"attribute vec3 position3D;\nattribute vec2 textureCoordinates;\n\nuniform float u_morphTime;\n\nuniform vec3 u_center3D;\nuniform mat4 u_modifiedModelView;\nuniform vec4 u_tileExtent;\n\n// Uniforms for 2D Mercator projection\nuniform vec2 u_southAndNorthLatitude;\nuniform vec3 u_southMercatorYLowAndHighAndOneOverHeight;\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\n\nvarying vec2 v_textureCoordinates;\n\n// These functions are generated at runtime.\nvec4 getPosition(vec3 position3DWC);\nfloat get2DYPositionFraction();\n\nvec4 getPosition3DMode(vec3 position3DWC)\n{\n    return czm_projection * (u_modifiedModelView * vec4(position3D, 1.0));\n}\n\nfloat get2DMercatorYPositionFraction()\n{\n    // The width of a tile at level 11, in radians and assuming a single root tile, is\n    //   2.0 * czm_pi / pow(2.0, 11.0)\n    // We want to just linearly interpolate the 2D position from the texture coordinates\n    // when we're at this level or higher.  The constant below is the expression\n    // above evaluated and then rounded up at the 4th significant digit.\n    const float maxTileWidth = 0.003068;\n    float positionFraction = textureCoordinates.y;\n    float southLatitude = u_southAndNorthLatitude.x;\n    float northLatitude = u_southAndNorthLatitude.y;\n    if (northLatitude - southLatitude > maxTileWidth)\n    {\n        float southMercatorYLow = u_southMercatorYLowAndHighAndOneOverHeight.x;\n        float southMercatorYHigh = u_southMercatorYLowAndHighAndOneOverHeight.y;\n        float oneOverMercatorHeight = u_southMercatorYLowAndHighAndOneOverHeight.z;\n\n        float currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\n        currentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\n        positionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorYLow, southMercatorYHigh, oneOverMercatorHeight);\n    }    \n    return positionFraction;\n}\n\nfloat get2DGeographicYPositionFraction()\n{\n    return textureCoordinates.y;\n}\n\nvec4 getPosition2DMode(vec3 position3DWC)\n{\n    float yPositionFraction = get2DYPositionFraction();\n    vec4 rtcPosition2D = vec4(0.0, mix(u_tileExtent.st, u_tileExtent.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);  \n    return czm_projection * (u_modifiedModelView * rtcPosition2D);\n}\n\nvec4 getPositionColumbusViewMode(vec3 position3DWC)\n{\n    return getPosition2DMode(position3DWC);\n}\n\nvec4 getPositionMorphingMode(vec3 position3DWC)\n{\n    // We do not do RTC while morphing, so there is potential for jitter.\n    // This is unlikely to be noticable, though.\n    float yPositionFraction = get2DYPositionFraction();\n    vec3 position2DWC = vec3(0.0, mix(u_tileExtent.st, u_tileExtent.pq, vec2(textureCoordinates.x, yPositionFraction)));\n    vec4 morphPosition = czm_columbusViewMorph(position2DWC, position3DWC, u_morphTime);\n    return czm_modelViewProjection * morphPosition;\n}\n\nvoid main() \n{\n    vec3 position3DWC = position3D + u_center3D;\n\n    gl_Position = getPosition(position3DWC);\n    \n    v_positionEC = (czm_modelView * vec4(position3DWC, 1.0)).xyz;\n    v_positionMC = position3DWC;                                 // position in model coordinates\n    v_textureCoordinates = textureCoordinates;\n}\n"}),c("Shaders/CentralBodyVSDepth",[],function(){return"attribute vec4 position;\n\nvarying vec4 positionEC;\n\nvoid main()\n{\n    positionEC = czm_modelView * position;\n    gl_Position = czm_projection * positionEC;\n}"}),c("Shaders/CentralBodyVSPole",[],function(){return"attribute vec4 position;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    float x = (position.x - czm_viewport.x) / czm_viewport.z;\n    float y = (position.y - czm_viewport.y) / czm_viewport.w;\n    v_textureCoordinates = vec2(x, y);\n    \n    gl_Position = czm_viewportOrthographic * position;\n}"}),c("Shaders/ComplexConicSensorVolumeFS",[],function(){return'#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n#endif  \n\nuniform float u_sensorRadius;\nuniform float u_outerHalfAngle;\nuniform float u_innerHalfAngle;\nuniform float u_maximumClockAngle;\nuniform float u_minimumClockAngle;\nuniform bool u_showIntersection;    \nuniform vec4 u_pickColor;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_sensorVertexWC;\nvarying vec3 v_sensorVertexEC;\nvarying vec3 v_sensorAxisEC;\n\n#ifndef RENDER_FOR_PICK\n\nczm_materialInput getMaterialInput(float sensorRadius, vec3 pointEC, vec3 normalEC)\n{\n    czm_materialInput materialInput;\n\n    vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\n    materialInput.positionToEyeEC = -v_positionEC; \n    materialInput.normalEC = normalEC;\n    \n    materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\n    materialInput.str = pointMC / sensorRadius; \n    materialInput.positionMC = pointMC;\n    \n    return materialInput;\n}\nvec4 getOuterColor(float sensorRadius, vec3 pointEC, vec3 normalEC)\n{\n    sensorErode(sensorRadius, pointEC);\n    \n    czm_materialInput materialInput = getMaterialInput(sensorRadius, pointEC, normalEC);\n    czm_material material = czm_getOuterMaterial(materialInput);\n    \n    //Final\n    vec3 positionToEyeEC = normalize(-v_positionEC);\n    \n    return czm_phong(positionToEyeEC, material);\n}\n\nvec4 getInnerColor(float sensorRadius, vec3 pointEC, vec3 normalEC)\n{\n    sensorErode(sensorRadius, pointEC);\n    \n    czm_materialInput materialInput = getMaterialInput(sensorRadius, pointEC, normalEC);\n    czm_material material = czm_getInnerMaterial(materialInput);\n    \n    //Final\n    vec3 positionToEyeEC = normalize(-v_positionEC);\n\n    return czm_phong(positionToEyeEC, material);        \n}\n\nvec4 getCapColor(float sensorRadius, vec3 pointEC, vec3 normalEC)\n{\n    sensorErode(sensorRadius, pointEC);\n    \n    czm_materialInput materialInput = getMaterialInput(sensorRadius, pointEC, normalEC);\n    czm_material material = czm_getCapMaterial(materialInput);\n    \n    //Final\n    vec3 positionToEyeEC = normalize(-v_positionEC);\n\n    return czm_phong(positionToEyeEC, material);        \n}\n\nvec4 getSilhouetteColor(float sensorRadius, vec3 pointEC, vec3 normalEC)\n{\n    sensorErode(sensorRadius, pointEC);\n    \n    czm_materialInput materialInput = getMaterialInput(sensorRadius, pointEC, normalEC);\n    czm_material material = czm_getSilhouetteMaterial(materialInput);\n    \n    //Final\n    vec3 positionToEyeEC = normalize(-v_positionEC);\n\n    return czm_phong(positionToEyeEC, material);        \n}\n\n#endif\n\nbool czm_isOnOrNear(float d, czm_raySegment interval, float epsilon)\n{\n    bool answer = (czm_equalsEpsilon(d, interval.start, epsilon) || czm_equalsEpsilon(d, interval.stop, epsilon));\n    return answer;\n}\n\nbool czm_isOnOrNear(float d, czm_raySegmentCollection coneIntervals, float epsilon)\n{\n    // Can have a maximum of two ray segments from cone intersection.\n    bool answer = (coneIntervals.count > 0 && (czm_isOnOrNear(d, coneIntervals.intervals[0], epsilon)))\n               || (coneIntervals.count > 1 && (czm_isOnOrNear(d, coneIntervals.intervals[1], epsilon)));\n    return answer;\n}\n\nbool czm_isOnOrNearSensor(float d, czm_raySegmentCollection outerIntervals, czm_raySegmentCollection innerIntervals, float epsilon)\n{\n    bool answer = czm_isOnOrNear(d, outerIntervals, epsilon) || czm_isOnOrNear(d, innerIntervals, epsilon);\n    return answer;\n}\n\nbool ellipsoidSensorIntersection(czm_raySegment sphereInterval,\n    czm_raySegmentCollection outerIntervals, czm_raySegmentCollection innerIntervals,\n    czm_raySegmentCollection clockIntervals,\n    czm_raySegment ellipsoidInterval, czm_raySegment silhouetteHalfspaceInterval, czm_raySegmentCollection solid)\n{\n    if (czm_isEmpty(ellipsoidInterval))\n    {\n        return false;\n    }\n\n    float t = ellipsoidInterval.start;\n\n#ifdef GL_OES_standard_derivatives\n    // TODO: This seems to be too aggressive in some areas, and too conservative in others\n    float epsilon = max(abs(dFdx(t)), abs(dFdy(t)));\n#else\n    // TODO:  Don\'t hardcode this.\n    float epsilon = t / 500.0;\n#endif\n\n    float width = 2.0;  // TODO: Expose as a uniform\n    epsilon *= width;           \n\n    // TODO: Rework this once the ray segments have associated boundary surfaces with their start/stop values.\n    if (solid.count > 0)\n    {\n        float d = solid.intervals[0].start;\n        if (d == ellipsoidInterval.start\n         && (czm_isOnOrNear(d, silhouetteHalfspaceInterval, epsilon)\n          || czm_isOnOrNear(d, sphereInterval, epsilon) \n          || czm_isOnOrNear(d, clockIntervals, epsilon) \n          || czm_isOnOrNearSensor(d, outerIntervals, innerIntervals, epsilon))) return true;\n        d = solid.intervals[0].stop;\n        if (d == ellipsoidInterval.start\n         && (czm_isOnOrNear(d, silhouetteHalfspaceInterval, epsilon)\n          || czm_isOnOrNear(d, sphereInterval, epsilon) \n          || czm_isOnOrNear(d, clockIntervals, epsilon) \n          || czm_isOnOrNearSensor(d, outerIntervals, innerIntervals, epsilon))) return true;\n\n	    if (solid.count > 1)\n	    {\n	        d = solid.intervals[1].start;\n	        if (d == ellipsoidInterval.start\n	         && (czm_isOnOrNear(d, silhouetteHalfspaceInterval, epsilon)\n	          || czm_isOnOrNear(d, sphereInterval, epsilon) \n              || czm_isOnOrNear(d, clockIntervals, epsilon) \n	          || czm_isOnOrNearSensor(d, outerIntervals, innerIntervals, epsilon))) return true;\n	        d = solid.intervals[1].stop;\n            if (d == ellipsoidInterval.start\n             && (czm_isOnOrNear(d, silhouetteHalfspaceInterval, epsilon)\n              || czm_isOnOrNear(d, sphereInterval, epsilon) \n              || czm_isOnOrNear(d, clockIntervals, epsilon) \n              || czm_isOnOrNearSensor(d, outerIntervals, innerIntervals, epsilon))) return true;\n	    }\n	    \n	    return false;\n    }\n    else\n    {\n        false;\n    }\n}\n\nvec4 shade(\n    czm_ray ray,\n    float nearestRayTime,\n    czm_sphere sphere,\n    czm_cone outerCone,\n    czm_cone innerCone,\n    czm_halfspace maxClock,\n    czm_halfspace minClock,\n	czm_ellipsoidSilhouetteCone silhouetteCone,\n	czm_ellipsoidSilhouetteHalfspace silhouetteHalfspace,    \n    czm_raySegment sphereInterval,\n    czm_raySegmentCollection outerConeInterval,\n    czm_raySegmentCollection innerConeInterval,\n    czm_raySegment maxClockInterval,\n    czm_raySegment minClockInterval,\n    czm_raySegmentCollection clockIntervals,\n    czm_raySegment silhouetteConeInterval,\n    czm_raySegment silhouetteHalfspaceInterval,\n    czm_raySegment ellipsoidInterval,\n    czm_raySegmentCollection intervals)\n{\n#ifdef RENDER_FOR_PICK\n    return u_pickColor;\n#else\n    vec3 nearestPoint = czm_pointAlongRay(ray, nearestRayTime);\n\n    // Visualization TODO:  Segment stop surface can be used to determine which pixels to "fill" \n    // in order to indicate projection onto the ellipsoid surface.\n\n    if (u_showIntersection && ellipsoidSensorIntersection(sphereInterval,\n        outerConeInterval, innerConeInterval, clockIntervals,\n        ellipsoidInterval, silhouetteHalfspaceInterval, intervals))\n    {\n        return getIntersectionColor(u_sensorRadius, nearestPoint);\n    } \n\n    vec3 positionToEyeEC = -ray.direction;               // normalized position-to-eye vector in eye coordinates\n    vec3 czm_sunDirectionEC = czm_sunDirectionEC;           // normalized position-to-sun vector in eye coordinates\n\n    for (int i = 0; i < czm_raySegmentCollectionCapacity; ++i)\n    {\n	    if (i < outerConeInterval.count &&\n	       ((nearestRayTime == outerConeInterval.intervals[i].start) ||      // Viewer outside sensor CSG volume\n	        (nearestRayTime == outerConeInterval.intervals[i].stop)))         // Viewer inside\n	    {\n	        // Shade outer cone\n	        vec3 normal = czm_coneNormal(outerCone, nearestPoint);\n	        normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n	        return getOuterColor(u_sensorRadius, nearestPoint, normal);\n	    }\n    }\n    \n    for (int i = 0; i < czm_raySegmentCollectionCapacity; ++i)\n    {\n	    if (i < innerConeInterval.count &&\n	       ((nearestRayTime == innerConeInterval.intervals[i].start) ||  // Viewer outside sensor CSG volume\n	        (nearestRayTime == innerConeInterval.intervals[i].stop)))     // Viewer inside\n	    {\n	        // Shade inner cone\n	        vec3 normal = -czm_coneNormal(innerCone, nearestPoint);\n	        normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n	        return getInnerColor(u_sensorRadius, nearestPoint, normal);       \n	    }\n    }\n    \n    if ((nearestRayTime == sphereInterval.start) ||    // Viewer outside sensor CSG volume\n        (nearestRayTime == sphereInterval.stop))       // Viewer inside\n    {\n        // Shade top cap\n        vec3 normal = czm_sphereNormal(sphere, nearestPoint);\n        normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n        return getCapColor(u_sensorRadius, nearestPoint, normal);     \n    }\n\n    if ((nearestRayTime == maxClockInterval.start) ||    // Viewer outside sensor CSG volume\n        (nearestRayTime == maxClockInterval.stop))       // Viewer inside\n    {\n        // Shade top cap\n        vec3 normal = maxClock.normal;\n        normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n        return getOuterColor(u_sensorRadius, nearestPoint, normal);        \n    }\n\n    if ((nearestRayTime == minClockInterval.start) ||    // Viewer outside sensor CSG volume\n        (nearestRayTime == minClockInterval.stop))       // Viewer inside\n    {\n        // Shade top cap\n        vec3 normal = minClock.normal;\n        normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n        return getOuterColor(u_sensorRadius, nearestPoint, normal);        \n    }\n\n    if ((nearestRayTime == silhouetteConeInterval.start) ||    // Viewer outside sensor CSG volume\n        (nearestRayTime == silhouetteConeInterval.stop))       // Viewer inside\n    {\n        vec3 normal = czm_ellipsoidSilhouetteConeNormal(silhouetteCone, nearestPoint); // Normal is already inverted.\n        normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n        return getSilhouetteColor(u_sensorRadius, nearestPoint, normal);   \n    }\n\n    // Should never happen\n   return vec4(1.0, 0.0, 0.0, 1.0);\n#endif\n}\n\nvec4 shade(\n    czm_ray ray,\n    float nearestRayTime,\n    czm_sphere sphere,\n    czm_cone outerCone,\n    czm_cone innerCone,\n    czm_halfspace maxClock,\n    czm_halfspace minClock,\n    czm_raySegment sphereInterval,\n    czm_raySegmentCollection outerConeInterval,\n    czm_raySegmentCollection innerConeInterval,\n    czm_raySegment maxClockInterval,\n    czm_raySegment minClockInterval,\n    czm_raySegmentCollection intervals)\n{\n#ifdef RENDER_FOR_PICK\n    return u_pickColor;\n#else\n    vec3 nearestPoint = czm_pointAlongRay(ray, nearestRayTime);\n\n    vec3 positionToEyeEC = -ray.direction;               // normalized position-to-eye vector in eye coordinates\n\n    for (int i = 0; i < czm_raySegmentCollectionCapacity; ++i)\n    {\n        if (i < outerConeInterval.count &&\n           ((nearestRayTime == outerConeInterval.intervals[i].start) ||      // Viewer outside sensor CSG volume\n            (nearestRayTime == outerConeInterval.intervals[i].stop)))         // Viewer inside\n        {\n            // Shade outer cone\n            vec3 normal = czm_coneNormal(outerCone, nearestPoint);\n            normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n            return getOuterColor(u_sensorRadius, nearestPoint, normal);\n        }\n    }\n    \n    for (int i = 0; i < czm_raySegmentCollectionCapacity; ++i)\n    {\n        if (i < innerConeInterval.count &&\n           ((nearestRayTime == innerConeInterval.intervals[i].start) ||  // Viewer outside sensor CSG volume\n            (nearestRayTime == innerConeInterval.intervals[i].stop)))     // Viewer inside\n        {\n            // Shade inner cone\n            vec3 normal = -czm_coneNormal(innerCone, nearestPoint);\n            normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n            return getInnerColor(u_sensorRadius, nearestPoint, normal);       \n        }\n    }\n    \n    if ((nearestRayTime == sphereInterval.start) ||    // Viewer outside sensor CSG volume\n        (nearestRayTime == sphereInterval.stop))       // Viewer inside\n    {\n        // Shade top cap\n        vec3 normal = czm_sphereNormal(sphere, nearestPoint);\n        normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n        return getCapColor(u_sensorRadius, nearestPoint, normal);      \n    }\n    \n    if ((nearestRayTime == maxClockInterval.start) ||    // Viewer outside sensor CSG volume\n        (nearestRayTime == maxClockInterval.stop))       // Viewer inside\n    {\n        // Shade top cap\n        vec3 normal = maxClock.normal;\n        normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n        return getOuterColor(u_sensorRadius, nearestPoint, normal);       \n    }\n\n    if ((nearestRayTime == minClockInterval.start) ||    // Viewer outside sensor CSG volume\n        (nearestRayTime == minClockInterval.stop))       // Viewer inside\n    {\n        // Shade top cap\n        vec3 normal = minClock.normal;\n        normal = mix(normal, -normal, step(normal.z, 0.0));  // Normal facing viewer\n        return getOuterColor(u_sensorRadius, nearestPoint, normal);      \n    }\n\n   // Should never happen\n   return vec4(1.0, 0.0, 0.0, 1.0);\n#endif\n}\n\nvoid main()\n{\n    czm_ray ray = czm_ray(vec3(0.0), normalize(v_positionEC));  // Ray from eye to fragment in eye coordinates\n\n    // Determine the sensor primitive intervals.\n\n    czm_sphere sphere = czm_sphere(v_sensorVertexEC, u_sensorRadius);\n    czm_raySegment sphereInterval = czm_raySphereIntersectionInterval(ray, sphere);\n    if (czm_isEmpty(sphereInterval))\n    {\n        discard;\n    }\n\n    vec3 coneAxisEC = normalize(v_sensorAxisEC);    \n\n    czm_cone outerCone = czm_coneNew(v_sensorVertexEC, coneAxisEC, u_outerHalfAngle);\n    czm_raySegmentCollection outerConeInterval = czm_rayConeIntersectionInterval(ray, outerCone);\n    if (outerConeInterval.count == 0)\n    {\n        discard;\n    }\n\n    czm_cone innerCone = czm_coneNew(v_sensorVertexEC, coneAxisEC, u_innerHalfAngle);\n    czm_raySegmentCollection innerConeInterval = czm_rayConeIntersectionInterval(ray, innerCone);\n    \n    // Build up the CSG representation of the sensor.    \n    czm_raySegmentCollection difference = (innerConeInterval.count == 0) ? outerConeInterval : czm_subtraction(outerConeInterval, innerConeInterval);\n    if (difference.count == 0)\n    {\n        discard;\n    }\n    czm_raySegmentCollection capped = czm_intersection(difference, sphereInterval);\n    if (capped.count == 0)\n    {\n        discard;\n    }\n\n    vec3 maxNormal = normalize((czm_modelView * vec4(-sin(u_maximumClockAngle), cos(u_maximumClockAngle), 0.0, 0.0)).xyz);\n    czm_halfspace maxClock = czm_halfspace(v_sensorVertexEC, maxNormal);\n    czm_raySegment maxClockInterval = czm_rayHalfspaceIntersectionInterval(ray, maxClock);\n\n    vec3 minNormal = normalize((czm_modelView * vec4(sin(u_minimumClockAngle), -cos(u_minimumClockAngle), 0.0, 0.0)).xyz);\n    czm_halfspace minClock = czm_halfspace(v_sensorVertexEC, minNormal);\n    czm_raySegment minClockInterval = czm_rayHalfspaceIntersectionInterval(ray, minClock);\n\n    czm_raySegmentCollection clockIntervals = ((u_maximumClockAngle - u_minimumClockAngle) > czm_pi)\n        ? (czm_isEmpty(maxClockInterval) \n	        ? (czm_isEmpty(minClockInterval) ? czm_raySegmentCollectionNew() : czm_raySegmentCollectionNew(minClockInterval))\n	        : (czm_isEmpty(minClockInterval) ? czm_raySegmentCollectionNew(maxClockInterval) : czm_union(maxClockInterval, minClockInterval)))\n        : ((czm_isEmpty(maxClockInterval) || czm_isEmpty(minClockInterval)) ? czm_raySegmentCollectionNew() : czm_raySegmentCollectionNew(czm_intersection(maxClockInterval, minClockInterval)));\n\n    czm_raySegmentCollection sensor = (clockIntervals.count == 0) ? czm_raySegmentCollectionNew() : czm_intersection(capped, clockIntervals);\n    if (sensor.count == 0)\n    {\n        discard;\n    }\n\n    // Determine the obstruction primitive intervals.\n\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\n\n    czm_ellipsoidSilhouetteCone silhouetteCone = czm_ellipsoidSilhouetteConeNew(ellipsoid, v_sensorVertexEC);\n    czm_raySegment silhouetteConeInterval = czm_rayEllipsoidSilhouetteConeIntersectionInterval(ray, silhouetteCone);\n\n    if (czm_isEmpty(silhouetteConeInterval))\n    {\n        gl_FragColor = shade(ray, sensor.intervals[0].start,\n            sphere, outerCone, innerCone, maxClock, minClock,\n            sphereInterval, outerConeInterval, innerConeInterval, maxClockInterval, minClockInterval,\n            sensor);\n    }\n    else\n    {	\n	    czm_ellipsoidSilhouetteHalfspace silhouetteHalfspace = czm_ellipsoidSilhouetteHalfspaceNew(ellipsoid, v_sensorVertexEC);    \n	    czm_raySegment silhouetteHalfspaceInterval = czm_rayEllipsoidSilhouetteHalfspaceIntersectionInterval(ray, silhouetteHalfspace);\n	    \n	    // Build up the CSG representation of the composite.\n	    czm_raySegment temp = (czm_isEmpty(silhouetteHalfspaceInterval)) ? czm_emptyRaySegment : czm_intersection(silhouetteConeInterval, silhouetteHalfspaceInterval);\n	    czm_raySegmentCollection stuff = (czm_isEmpty(temp)) ? sensor : czm_subtraction(sensor, temp);\n	    if (stuff.count == 0)\n	    {\n	       discard;\n	    }\n\n        czm_raySegment ellipsoidInterval = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\n	    czm_raySegmentCollection result = (czm_isEmpty(ellipsoidInterval)) ? stuff : czm_subtraction(stuff, ellipsoidInterval);\n	    \n	    if ((result.count == 0)\n	        || (!czm_isEmpty(ellipsoidInterval) && (result.intervals[0].start > ellipsoidInterval.start))) // Fails depth test with ellipsoid\n	    {\n	        discard;\n	    }\n	    \n	    gl_FragColor = shade(ray, result.intervals[0].start,\n	        sphere, outerCone, innerCone, maxClock, minClock,\n	        silhouetteCone, silhouetteHalfspace,\n	        sphereInterval, outerConeInterval, innerConeInterval, maxClockInterval, minClockInterval, clockIntervals,\n	        silhouetteConeInterval, silhouetteHalfspaceInterval, ellipsoidInterval,\n	        result);\n    }\n}\n'}),c("Shaders/ComplexConicSensorVolumeVS",[],function(){return"attribute vec4 position;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_sensorVertexWC;\nvarying vec3 v_sensorVertexEC;\nvarying vec3 v_sensorAxisEC;\n\nvoid main()\n{\n    gl_Position = czm_modelViewInfiniteProjection * position;\n    v_positionEC = (czm_modelView * position).xyz;\n    \n    // These transforms could be done once on the CPU, but there are only five vertices.\n    // We could also hand-optimize the zeros out if the compiler doesn't already.\n    vec4 sensorVertexMC = vec4(0.0, 0.0, 0.0, 1.0);\n    v_sensorVertexWC = (czm_model * sensorVertexMC).xyz;\n    v_sensorVertexEC = (czm_modelView * sensorVertexMC).xyz;\n    v_sensorAxisEC = czm_normal * vec3(0.0, 0.0, 1.0);\n}"}),c("Shaders/ConstructiveSolidGeometry",[],function(){return"float _czm_addWithCancellationCheck(float left, float right, float tolerance)\n{\n    float difference = left + right;\n    if ((sign(left) != sign(right)) && abs(difference / max(abs(left), abs(right))) < tolerance)\n    {\n        return 0.0;\n    }\n    else\n    {\n        return difference;\n    }\n}\n        \n/**\n * DOC_TBA\n *\n * @name czm_quadraticRoots\n * @glslStruct\n */\nstruct czm_quadraticRoots\n{\n    int numberOfRoots;\n    float root0;\n    float root1;\n};\n\n/**\n * Computes the real-valued roots of the 2nd order polynomial function of one variable with only real coefficients.\n *\n * @name czm_quadraticRealPolynomialRealRoots\n * @glslFunction\n *\n * @param {float} a The coefficient of the 2nd order monomial.\n * @param {float} b The coefficient of the 1st order monomial.\n * @param {float} c The coefficient of the 0th order monomial.\n * \n * @returns {czm_quadraticRoots} Zero, one, or two real-valued roots.\n * \n * @example\n * czm_quadraticRoots r = czm_quadraticRealPolynomialRealRoots(2.0, -4.0, -6.0); // 2(x + 1)(x - 3)\n * // The result is r.numberOfRoots = 2, r.root0 = -1.0, and r.root1 = 3.0.\n */\nczm_quadraticRoots czm_quadraticRealPolynomialRealRoots(float a, float b, float c)\n{\n    // This function's return statements have an ANGLE workaround:  http://code.google.com/p/angleproject/issues/detail?id=185\n\n    const float tolerance = czm_epsilon7;\n\n    if (a == 0.0)\n    {\n        if (b == 0.0)\n        {\n            // Constant function: c = 0.  No real polynomial roots possible.\n            czm_quadraticRoots r = czm_quadraticRoots(0, 0.0, 0.0);\n            return r;\n        }\n        else\n        {\n            // Linear function: b * x + c = 0.\n            czm_quadraticRoots r = czm_quadraticRoots(1, -c / b, 0.0);\n            return r;           \n        }\n    }\n    else if (b == 0.0)\n    {\n        if (c == 0.0)\n        {\n            // 2nd order monomial: a * x^2 = 0.\n            czm_quadraticRoots r = czm_quadraticRoots(2, 0.0, 0.0);\n            return r;\n        }\n        else\n        {\n            float cMagnitude = abs(c);\n            float aMagnitude = abs(a);\n    \n            if ((cMagnitude < aMagnitude) && (cMagnitude / aMagnitude < tolerance)) // c ~= 0.0.\n            {\n                // 2nd order monomial: a * x^2 = 0.\n                czm_quadraticRoots r = czm_quadraticRoots(2, 0.0, 0.0);\n                return r;\n            }\n            else if ((cMagnitude > aMagnitude) && (aMagnitude / cMagnitude < tolerance)) // a ~= 0.0.\n            {\n                // Constant function: c = 0.\n                czm_quadraticRoots r = czm_quadraticRoots(0, 0.0, 0.0);\n                return r;\n            }\n            else\n            {\n                // a * x^2 + c = 0\n                float ratio = -c / a;\n    \n                if (ratio < 0.0)\n                {\n                    // Both roots are complex.\n                    czm_quadraticRoots r = czm_quadraticRoots(0, 0.0, 0.0);\n                    return r;\n                }\n                else\n                {\n                    // Both roots are real.\n                    float root = sqrt(ratio);\n    \n                    // Return them in ascending order.\n                    czm_quadraticRoots r = czm_quadraticRoots(2, -root, root);\n                    return r;\n                }\n            }\n        }\n    }\n    else if (c == 0.0)\n    {\n        // a * x^2 + b * x = 0\n        float ratio = -b / a;\n    \n        // Return them in ascending order.\n        if (ratio < 0.0)\n        {\n            czm_quadraticRoots r = czm_quadraticRoots(2, ratio, 0.0);\n            return r;           \n        }\n        else\n        {\n            czm_quadraticRoots r = czm_quadraticRoots(2, 0.0, ratio);\n            return r;\n        }\n    }\n    else\n    {\n        // a * x^2 + b * x + c = 0\n        float b2 = b * b;\n        float four_ac = 4.0 * a * c;\n        float radicand = _czm_addWithCancellationCheck(b2, -four_ac, tolerance);\n    \n        if (radicand < 0.0)\n        {\n            // Both roots are complex.\n            czm_quadraticRoots r = czm_quadraticRoots(0, 0.0, 0.0);\n            return r;\n        }\n        else\n        {\n            // Both roots are real.\n            float q = -0.5 * _czm_addWithCancellationCheck(b, sign(b) * sqrt(radicand), tolerance);\n    \n            // Return them in ascending order.\n            if (b > 0.0)\n            {\n                // q < 0.0\n                czm_quadraticRoots r = czm_quadraticRoots(2, q / a, c / q);\n                return r;               \n            }\n            else\n            {\n                // q > 0.0\n                czm_quadraticRoots r = czm_quadraticRoots(2, c / q, q / a);\n                return r;               \n            }\n        }\n    }\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_sphere\n * @glslStruct\n */\nstruct czm_sphere\n{\n    vec3 center;\n    float radius;\n};\n\n/**\n * DOC_TBA\n *\n * @name czm_raySphereIntersectionInterval\n * @glslFunction\n *\n * @see czm_sphereNormal\n */\nczm_raySegment czm_raySphereIntersectionInterval(czm_ray ray, czm_sphere sphere)\n{\n    // From Real-Time Rendering, Section 16.6.2, Optimized Ray/Sphere Intersection Solution, Page 741\n    \n    // This function's return statements have an ANGLE workaround:  http://code.google.com/p/angleproject/issues/detail?id=185\n    \n    // PERFORMANCE_IDEA:  A more optimized but less friendly function could take radius squared directly, \n    // assume a center or origin of zero, etc.\n    \n    vec3 l = sphere.center - ray.origin;\n    float s = dot(l, ray.direction);\n    float l2 = dot(l, l);\n    float r2 = sphere.radius * sphere.radius;\n    \n    if ((s < 0.0) // Looking away from sphere.\n    && (l2 > r2)) // Outside of sphere.\n    {\n        return czm_emptyRaySegment;  // ray does not intersect (at least not along the indicated direction).\n    }\n    \n    float s2 = s * s;\n    float m2 = l2 - s2;\n    \n    if (m2 > r2) // Discriminant is negative, yielding only imaginary roots.\n    {\n        return czm_emptyRaySegment;  // ray does not intersect.\n    }\n    \n    float q = sqrt(r2 - m2);\n\n    if (czm_equalsEpsilon(q, 0.0)) // Discriminant is zero, yielding a double root.\n    {\n        return czm_raySegment(s, s);  // ray is tangent.\n    }\n        \n    if (l2 > r2) // Outside of sphere.\n    {\n	    czm_raySegment i = czm_raySegment(s - q, s + q);\n	    return i;\n    }\n    else if (l2 < r2) // Inside of sphere.\n   	{\n        czm_raySegment i = czm_raySegment(0.0, s + q);\n        return i;\n    }\n    else if (s > 0.0) // On sphere and looking inward.\n    {\n        czm_raySegment i = czm_raySegment(0.0, s + q);\n        return i;\n    }\n    else // On sphere and looking outward or tangent.\n    {\n        return czm_emptyRaySegment;\n   	}\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_sphereNormal\n * @glslFunction\n *\n * @see czm_raySphereIntersectionInterval \n * @see czm_pointAlongRay\n */\nvec3 czm_sphereNormal(czm_sphere sphere, vec3 pointOnSphere)\n{\n    return normalize(pointOnSphere - sphere.center);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_cone\n * @glslStruct\n */\nstruct czm_cone\n{\n    vec3 vertex;\n    vec3 axis;          // Unit-length direction vector\n    float halfAperture;    // Measured from the cone axis to the cone wall\n	// PERFORMANCE_IDEA: Make sure all of these are used...\n    float cosineOfHalfAperture;\n    float cosineSquaredOfHalfAperture;\n    float sineOfHalfAperture;\n    float sineSquaredOfHalfAperture;\n    mat3 intersectionMatrix;\n};\n\nczm_cone czm_coneNew(vec3 vertex, vec3 axis, float halfAperture)\n{\n	float cosineOfHalfAperture = cos(halfAperture);\n	float cosineSquaredOfHalfAperture = cosineOfHalfAperture * cosineOfHalfAperture;\n	float sineOfHalfAperture = sin(halfAperture);\n	float sineSquaredOfHalfAperture = sineOfHalfAperture * sineOfHalfAperture;\n	\n    float x2 = axis.x * axis.x;\n    float y2 = axis.y * axis.y;\n    float z2 = axis.z * axis.z;\n    float xy = axis.x * axis.y;\n    float yz = axis.y * axis.z;\n    float zx = axis.z * axis.x;\n\n    // This is a symmetric matrix.\n    mat3 intersectionMatrix = mat3(\n    	cosineSquaredOfHalfAperture - x2, -xy,                              -zx,\n		-xy,                              cosineSquaredOfHalfAperture - y2, -yz,\n		-zx,                              -yz,                              cosineSquaredOfHalfAperture - z2);            \n	\n    czm_cone temp = czm_cone(vertex, axis, halfAperture,\n    	cosineOfHalfAperture, cosineSquaredOfHalfAperture,\n    	sineOfHalfAperture, sineSquaredOfHalfAperture, intersectionMatrix);\n    return temp;\n}\n\n/**\n * Determines if a point is in, or on the boundary, of an infinite cone.\n *\n * @name czm_coneContainsPoint\n * @glslFunction\n *\n * @param {czm_cone} cone The infinite cone.\n * @param {vec3} point The point to test for containment.\n *\n * @returns {bool} <code>true</code> if the point is in the infinite cone; otherwise, <code>false</code>.\n *\n * @see czm_rayConeIntersectionInterval\n *\n * @example\n * czm_cone cone = czm_coneNew(vec3(0.0), vec3(0.0, 0.0, 1.0), radians(45.0)); // vertex, axis, halfAperture\n * vec3 point = vec3(1.0, 0.0, 0.0);\n * bool b = czm_coneContainsPoint(cone, point)); // false\n */\nbool czm_coneContainsPoint(czm_cone cone, vec3 point)\n{\n    vec3 n = normalize(point - cone.vertex);\n    return (dot(n, cone.axis) >= cone.cosineOfHalfAperture);\n}\n\nbool _czm_rayIntersectsReflectedCone(czm_ray ray, czm_cone cone, float time, float cosine)\n{\n    vec3 s = ray.origin + (time * ray.direction) - cone.vertex;  // The vector from the origin is at (vertex + s)\n    vec3 sUnit = normalize(s);\n    float c = dot(sUnit, cone.axis);\n    \n    return (sign(c) != sign(cosine));\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_rayConeIntersectionInterval\n * @glslFunction\n *\n * @see czm_coneNormal\n * @see czm_coneContainsPoint\n */\nczm_raySegmentCollection czm_rayConeIntersectionInterval(czm_ray ray, czm_cone cone)\n{\n    vec3 temp = ray.origin - cone.vertex;\n\n    float t2 = dot(temp, temp);\n\n    float cosineNu = dot(ray.direction, cone.axis);\n\n    if (t2 == 0.0) // At vertex.\n    {\n        if (cosineNu >= cone.cosineOfHalfAperture) // Looking inward or along surface.\n        {\n            return czm_raySegmentCollectionNew(czm_fullRaySegment);\n        }\n        else // Looking outward.\n        {\n            return czm_raySegmentCollectionNew();\n        }\n    }\n    else // Not at vertex\n    {\n        float projection = dot(normalize(temp), cone.axis);\n\n        if (projection == cone.cosineOfHalfAperture) // On surface.\n        {\n            vec3 u = ray.direction;\n\n            mat3 crossProductMatrix = mat3(0.0, -u.z, u.y,\n                                            u.z, 0.0, -u.x,\n                                           -u.y, u.x, 0.0);\n            if (length(crossProductMatrix * temp) == 0.0) // Looking along surface.\n            {\n                if (dot(temp, u) > 0.0) // Looking away from vertex.\n                {\n                    return czm_raySegmentCollectionNew(czm_fullRaySegment);\n                }\n                else // Looking toward vertex.\n                {\n                    czm_raySegment i = czm_raySegment(0.0, length(temp));\n                    return czm_raySegmentCollectionNew(i);\n                }\n            }\n            else // Looking tangent at surface.\n            {\n                return czm_raySegmentCollectionNew();\n            }\n        }\n        else // Not on surface\n        {\n            vec3 t = normalize(temp);\n\n            float cosineAlpha2 = cone.cosineOfHalfAperture * cone.cosineOfHalfAperture;\n\n            float cosineTau = dot(t, cone.axis);\n            float cosineDelta = dot(t, ray.direction);\n\n            float cosineNu2 = cosineNu * cosineNu;\n            float cosineTau2 = cosineTau * cosineTau;\n\n            float stuff = cosineTau * cosineNu;\n\n            float positiveTerm = cosineNu2 + cosineTau2;\n            float negativeTerm = (cosineDelta * cosineDelta - 1.0) * cosineAlpha2;\n            float signedTerm = -2.0 * stuff * cosineDelta;\n\n            if (signedTerm > 0.0)\n            {\n                positiveTerm = positiveTerm + signedTerm;\n            }\n            else if (signedTerm < 0.0)\n            {\n                negativeTerm = negativeTerm + signedTerm;\n            }\n\n            float d = 4.0 * cosineAlpha2 * (positiveTerm + negativeTerm);\n\n            if (d < 0.0) // Imaginary roots.  No intersections.\n            {\n                if (cone.cosineOfHalfAperture < 0.0) // Obtuse cone.\n                {\n                    return czm_raySegmentCollectionNew(czm_fullRaySegment);\n                }\n                else // Acute cone.\n                {\n                    return czm_raySegmentCollectionNew();\n                }\n            }\n            else if (d > 0.0) // Distinct real roots.  Two intersections.\n            {\n                float a = cosineNu2 - cosineAlpha2;\n                float c = cosineTau2 - cosineAlpha2;\n                float b = 2.0 * (stuff - cosineDelta * cosineAlpha2);\n\n                float s = (b == 0.0) ? 1.0 : sign(b);\n                float q = -(b + s * sqrt(d)) / 2.0;\n\n                float first = q / a;\n                float second = c / q;\n                if (second < first)\n                {\n                    float thing = first;\n                    first = second;\n                    second = thing;\n                }\n\n                // Check roots to ensure that they are non-negative and intersect the desired nape of the cone.\n                bool firstTest = (first >= 0.0) && !(sign(dot(t + first * ray.direction, cone.axis)) == -sign(cone.cosineOfHalfAperture));\n                bool secondTest = (second >= 0.0) && !(sign(dot(t + second * ray.direction, cone.axis)) == -sign(cone.cosineOfHalfAperture));\n\n                float m = sqrt(t2);\n\n                if (cosineTau > cone.cosineOfHalfAperture) // Inside cone.\n                {\n                    if (firstTest && secondTest)\n                    {\n                        // Ray starts inside cone and exits; then enters and never exits.\n                        czm_raySegment one = czm_raySegment(0.0, m * first);\n                        czm_raySegment two = czm_raySegment(m * second, czm_infinity);\n                        return czm_raySegmentCollectionNew(one, two);\n                    }\n                    else if (firstTest)\n                    {\n                        // Ray starts inside cone and exits.\n                        czm_raySegment i = czm_raySegment(0.0, m * first);\n                        return czm_raySegmentCollectionNew(i);\n                    }\n                    else if (secondTest)\n                    {\n                        // Ray starts inside cone and exits.\n                        czm_raySegment i = czm_raySegment(0.0, m * second);\n                        return czm_raySegmentCollectionNew(i);\n                    }\n                    else\n                    {\n                        // Ray starts inside cone and never exits.\n                        return czm_raySegmentCollectionNew(czm_fullRaySegment);\n                    }\n                }\n                else\n                {\n                    if (firstTest && secondTest)\n                    {\n                        // Ray enters and exits.\n                        czm_raySegment i = czm_raySegment(m * first, m * second);\n                        return czm_raySegmentCollectionNew(i);\n                    }\n                    else if (firstTest)\n                    {\n                        // Ray enters and never exits.\n                        czm_raySegment i = czm_raySegment(m * first, czm_infinity);\n                        return czm_raySegmentCollectionNew(i);\n                    }\n                    else if (secondTest)\n                    {\n                        // Ray enters and never exits.\n                        czm_raySegment i = czm_raySegment(m * second, czm_infinity);\n                        return czm_raySegmentCollectionNew(i);\n                    }\n                    else\n                    {\n                        // Ray never enters.\n                        return czm_raySegmentCollectionNew();\n                    }\n                }\n            }\n            else // (d == 0.0)  Repeated real roots.  Two intersections.\n            {\n                if (cone.cosineOfHalfAperture == 0.0) // Planar cone.\n                {\n                    if (cosineTau >= 0.0) // Inside or on surface.\n                    {\n                        if (cosineNu >= 0.0) // Looking inward or tangent.\n                        {\n                            // Ray starts inside cone and never exits.\n                            return czm_raySegmentCollectionNew(czm_fullRaySegment);\n                        }\n                        else\n                        {\n                            // Ray starts inside cone and intersects.\n                            czm_raySegment i = czm_raySegment(0.0, -sqrt(t2) * cosineTau / cosineNu);\n                            return czm_raySegmentCollectionNew(i);\n                        }\n                    }\n                    else // Outside.\n                    {\n                        if (cosineNu <= 0.0) // Looking outward or tangent.\n                        {\n                            // Ray starts outside cone and never enters.\n                            return czm_raySegmentCollectionNew();\n                        }\n                        else\n                        {\n                            // Ray starts outside cone and intersects.\n                            czm_raySegment i = czm_raySegment(-sqrt(t2) * cosineTau / cosineNu, czm_infinity);\n                            return czm_raySegmentCollectionNew(i);\n                        }\n                    }\n                }\n                else\n                {\n                    float a = cosineNu2 - cosineAlpha2;\n                    float c = cosineTau2 - cosineAlpha2;\n                    float b = 2.0 * (stuff - cosineDelta * cosineAlpha2);\n\n                    float root = (a == 0.0) ? -sign(b) * czm_infinity : (-sign(b) / sign(a)) * sqrt(c / a);\n\n                    // Check roots to ensure that they are non-negative and intersect the desired nape of the cone.\n                    bool rootTest = (root >= 0.0) && !(sign(dot(t + root * ray.direction, cone.axis)) == -sign(cone.cosineOfHalfAperture));\n\n                    float m = sqrt(t2);\n\n                    if (cosineTau > cone.cosineOfHalfAperture) // Inside cone.\n                    {\n                        if (rootTest)\n                        {\n                            // Ray starts inside cone and exits or becomes tangent.\n                            czm_raySegment i = czm_raySegment(0.0, m * root);\n                            return czm_raySegmentCollectionNew(i);\n                        }\n                        else\n                        {\n                            // Ray starts inside cone and never exits.\n                            return czm_raySegmentCollectionNew(czm_fullRaySegment);\n                        }\n                    }\n                    else\n                    {\n                        if (rootTest)\n                        {\n                            if (c < 0.0) // Outside both napes of the cone.\n                            {\n                                // Ray starts outside cone and becomes tangent.\n                                float thing = m * root;\n                                czm_raySegment i = czm_raySegment(thing, thing);\n                                return czm_raySegmentCollectionNew(i);\n                            }\n                            else\n                            {\n                                // Ray starts outside cone and enters at vertex.\n                                float thing = m * root;\n                                czm_raySegment i = czm_raySegment(thing, czm_infinity);\n                                return czm_raySegmentCollectionNew(i);\n                            }\n                        }\n                        else\n                        {\n                            // Ray never enters.\n                            return czm_raySegmentCollectionNew();\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_rayConeIntersectNormal\n * @glslFunction \n *\n * @see czm_rayConeIntersectionInterval\n * @see czm_pointAlongRay\n *\n * @example\n * // Compute the outward-facing cone normal where a ray first intersects a cone\n * czm_ray ray = czm_ray(vec3(0.0), vec3(0.0, 0.0, 1.0)); // origin, direction\n * czm_cone cone = czm_coneNew(vec3(0.0, 0.0, 1.0), vec3(0.0, 0.0, 1.0), radians(45.0)); // vertex, axis, halfAperture\n * czm_raySegment i = czm_rayConeIntersectionInterval(ray, cone);\n * vec3 normal = czm_coneNormal(cone, czm_pointAlongRay(ray, i.start));\n */\nvec3 czm_coneNormal(czm_cone cone, vec3 pointOnCone)\n{\n    // PERFORMANCE_IDEA: Remove duplicate computation with _czm_rayIntersectsReflectedCone\n    vec3 s = pointOnCone - cone.vertex;     // Vector from the origin is at (vertex + s)\n    vec3 sUnit = normalize(s);\n    return normalize((cone.cosineOfHalfAperture * sUnit - cone.axis) / cone.sineOfHalfAperture);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_ellipsoidSilhouetteCone\n * @glslStruct\n */\nstruct czm_ellipsoidSilhouetteCone\n{\n    czm_ellipsoid ellipsoid;\n    vec3 pointOutsideEllipsoid;\n    czm_cone coneInScaledSpace;\n};\n\n/**\n * DOC_TBA\n *\n * @name czm_ellipsoidSilhouetteConeNormal\n * @glslFunction\n *\n */\nvec3 czm_ellipsoidSilhouetteConeNormal(czm_ellipsoidSilhouetteCone cone, vec3 pointOnCone)\n{\n    vec3 pointOnScaledCone = cone.ellipsoid.inverseRadii * (czm_inverseView * vec4(pointOnCone, 1.0)).xyz;\n\n    vec3 scaledNormal = czm_coneNormal(cone.coneInScaledSpace, pointOnScaledCone);\n\n    vec3 temp = -normalize(czm_viewRotation * (cone.ellipsoid.radii * scaledNormal));\n    \n    return temp;\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_ellipsoidSilhouetteConeNew\n * @glslFunction\n *\n */\nczm_ellipsoidSilhouetteCone czm_ellipsoidSilhouetteConeNew(czm_ellipsoid ellipsoid, vec3 pointOutsideEllipsoid)\n{\n	vec3 q = ellipsoid.inverseRadii * (czm_inverseView * vec4(pointOutsideEllipsoid, 1.0)).xyz;\n	vec3 axis = -normalize(q);\n	\n	float q2 = dot(q, q);\n	float sineSquaredOfHalfAperture = 1.0 / q2;\n	float sineOfHalfAperture = sqrt(sineSquaredOfHalfAperture);\n	float cosineSquaredOfHalfAperture = 1.0 - sineSquaredOfHalfAperture;\n	float cosineOfHalfAperture = sqrt(cosineSquaredOfHalfAperture);\n	float halfAperture = atan(sineOfHalfAperture / cosineOfHalfAperture);\n	\n    float x2 = axis.x * axis.x;\n    float y2 = axis.y * axis.y;\n    float z2 = axis.z * axis.z;\n    float xy = axis.x * axis.y;\n    float yz = axis.y * axis.z;\n    float zx = axis.z * axis.x;\n\n    // This is a symmetric matrix.\n    mat3 intersectionMatrix = mat3(\n    	cosineSquaredOfHalfAperture - x2, -xy,                              -zx,\n		-xy,                              cosineSquaredOfHalfAperture - y2, -yz,\n		-zx,                              -yz,                              cosineSquaredOfHalfAperture - z2);            \n	\n	czm_cone coneInScaledSpace = czm_cone(q, axis, halfAperture,\n		cosineOfHalfAperture, cosineSquaredOfHalfAperture,\n		sineOfHalfAperture, sineSquaredOfHalfAperture, intersectionMatrix);\n\n    // ANGLE workaround:  http://code.google.com/p/angleproject/issues/detail?id=185		\n	czm_ellipsoidSilhouetteCone temp = czm_ellipsoidSilhouetteCone(ellipsoid, pointOutsideEllipsoid, coneInScaledSpace);\n	return temp;\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_rayEllipsoidSilhouetteConeIntersectionInterval\n * @glslFunction\n *\n */\nczm_raySegment czm_rayEllipsoidSilhouetteConeIntersectionInterval(czm_ray ray, czm_ellipsoidSilhouetteCone cone)\n{\n	// Determine the ray in the scaled space.\n	vec3 origin = cone.ellipsoid.inverseRadii * (czm_inverseView * vec4(ray.origin, 1.0)).xyz;\n	vec3 direction = normalize(cone.ellipsoid.inverseRadii * (czm_inverseViewRotation * ray.direction));\n	czm_ray rayInScaledSpace = czm_ray(origin, direction);\n	\n	// Perform the intersection in the scaled space.\n	czm_raySegmentCollection collection = czm_rayConeIntersectionInterval(rayInScaledSpace, cone.coneInScaledSpace);\n\n	if (collection.count == 0) // No intersection.\n	{\n		return czm_emptyRaySegment;\n	}\n	else // Intersection.\n	{\n        czm_raySegment interval = collection.intervals[0];\n        \n		// Honor ray origin case (start == 0.0).\n		float start = interval.start;\n		if (start != 0.0)\n		{\n			// Determine start in unscaled space.\n			vec3 temp = (czm_view * vec4(cone.ellipsoid.radii * czm_pointAlongRay(rayInScaledSpace, start), 1.0)).xyz;\n			start = dot(temp, ray.direction);\n		}\n		\n		// Honor infinite ray (stop == infinity).\n		float stop = interval.stop;\n		if (stop != czm_infinity)\n		{\n			// Determine stop in unscaled space.\n			vec3 temp = (czm_view * vec4(cone.ellipsoid.radii * czm_pointAlongRay(rayInScaledSpace, stop), 1.0)).xyz;\n			stop = dot(temp, ray.direction);\n		}\n		\n		return czm_raySegment(start, stop);\n	}\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_halfspace\n * @glslStruct\n */\nstruct czm_halfspace\n{\n	vec3 center;\n	vec3 normal; // Unit vector.\n};\n\n/**\n * DOC_TBA\n *\n * @name czm_rayHalfspaceIntersectionInterval\n * @glslFunction\n *\n */\nczm_raySegment czm_rayHalfspaceIntersectionInterval(czm_ray ray, czm_halfspace halfspace)\n{\n	float numerator = dot(halfspace.center - ray.origin, halfspace.normal);\n	float denominator = dot(ray.direction, halfspace.normal);\n	\n	if (numerator > 0.0) // Inside.\n	{\n		if (denominator > 0.0) // Looking outward.\n		{\n			return czm_raySegment(0.0, numerator / denominator);\n		}\n		else // Looking inward or parallel.\n		{\n			return czm_fullRaySegment;		\n		}\n	}\n	else if (numerator < 0.0) // Outside.\n	{\n		if (denominator < 0.0 ) // Looking inward.\n		{\n			return czm_raySegment(numerator / denominator, czm_infinity);		\n		}\n		else // Looking outward or parallel.\n		{\n			return czm_emptyRaySegment;\n		}\n	}\n	else // On surface.\n	{\n		if (denominator < 0.0 ) // Looking inward.\n		{\n			return czm_fullRaySegment;		\n		}\n		else // Looking outward or parallel.\n		{\n			return czm_emptyRaySegment;\n		}\n	}\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_ellipsoidSilhouetteHalfspace\n * @glslStruct\n */\nstruct czm_ellipsoidSilhouetteHalfspace\n{\n    czm_ellipsoid ellipsoid;\n    vec3 pointOutsideEllipsoid;\n    czm_halfspace halfspaceInScaledSpace;\n};\n\n/**\n * DOC_TBA\n *\n * @name czm_ellipsoidSilhouetteHalfspaceNew\n * @glslFunction\n *\n */\nczm_ellipsoidSilhouetteHalfspace czm_ellipsoidSilhouetteHalfspaceNew(czm_ellipsoid ellipsoid, vec3 pointOutsideEllipsoid)\n{\n	vec3 q = ellipsoid.inverseRadii * (czm_inverseView * vec4(pointOutsideEllipsoid, 1.0)).xyz;\n	float magnitude = 1.0 / length(q);\n	vec3 normal = normalize(q);\n	vec3 center = magnitude * normal;      \n	\n	czm_halfspace halfspaceInScaledSpace = czm_halfspace(center, normal);\n\n    // ANGLE workaround:  http://code.google.com/p/angleproject/issues/detail?id=185		\n	czm_ellipsoidSilhouetteHalfspace temp = czm_ellipsoidSilhouetteHalfspace(ellipsoid, pointOutsideEllipsoid, halfspaceInScaledSpace);\n	return temp;\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_rayEllipsoidSilhouetteHalfspaceIntersectionInterval\n * @glslFunction\n *\n */\nczm_raySegment czm_rayEllipsoidSilhouetteHalfspaceIntersectionInterval(czm_ray ray, czm_ellipsoidSilhouetteHalfspace halfspace)\n{\n	// Determine the ray in the scaled space.\n	vec3 origin = halfspace.ellipsoid.inverseRadii * (czm_inverseView * vec4(ray.origin, 1.0)).xyz;\n	vec3 direction = halfspace.ellipsoid.inverseRadii * (czm_inverseViewRotation * ray.direction);\n	czm_ray rayInScaledSpace = czm_ray(origin, direction);\n	\n	// Perform the intersection in the scaled space.\n	czm_raySegment interval = czm_rayHalfspaceIntersectionInterval(rayInScaledSpace, halfspace.halfspaceInScaledSpace);\n\n	if (czm_isEmpty(interval)) // No intersection.\n	{\n		return interval;\n	}\n	else // Intersection.\n	{\n		// Honor ray origin case (start == 0.0).\n		float start = interval.start;\n		if (start != 0.0)\n		{\n			// Determine start in unscaled space.\n			vec3 temp = (czm_view * vec4(halfspace.ellipsoid.radii * czm_pointAlongRay(rayInScaledSpace, start), 1.0)).xyz;\n			start = dot(temp, ray.direction);\n		}\n		\n		// Honor infinite ray (stop == infinity).\n		float stop = interval.stop;\n		if (stop != czm_infinity)\n		{\n			// Determine stop in unscaled space.\n			vec3 temp = (czm_view * vec4(halfspace.ellipsoid.radii * czm_pointAlongRay(rayInScaledSpace, stop), 1.0)).xyz;\n			stop = dot(temp, ray.direction);\n		}\n		\n		return czm_raySegment(start, stop);\n	}\n}\n"}),c("Shaders/CustomSensorVolumeFS",[],function(){return"#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n#endif  \n\nuniform bool u_showIntersection;\nuniform bool u_showThroughEllipsoid;\n\nuniform float u_sensorRadius;\nuniform vec4 u_pickColor;\n\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_sensorVertexWC;\nvarying vec3 v_sensorVertexEC;\n\n#ifndef RENDER_FOR_PICK\n\nvec4 getColor(float sensorRadius, vec3 pointEC)\n{\n    sensorErode(sensorRadius, pointEC);\n    \n    czm_materialInput materialInput;\n    \n    vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;                                \n    materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);   \n    materialInput.str = pointMC / sensorRadius;\n    materialInput.positionMC = pointMC;               \n    \n    vec3 positionToEyeEC = -v_positionEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    \n    vec3 normalEC = normalize(v_normalEC);\n    normalEC = mix(normalEC, -normalEC, step(normalEC.z, 0.0));  // Normal facing viewer\n    materialInput.normalEC = normalEC;\n    \n    czm_material material = czm_getMaterial(materialInput);\n    \n    return czm_phong(normalize(positionToEyeEC), material);        \n}\n\n#endif\n\nbool ellipsoidSensorIntersection(czm_raySegment ellipsoidInterval)\n{\n	if (czm_isEmpty(ellipsoidInterval))\n	{\n	    return false;\n	}\n\n    float t = ellipsoidInterval.start;\n\n#ifdef GL_OES_standard_derivatives\n    // TODO: This seems to be too aggressive in some areas, and too conservative in others\n    float epsilon = max(abs(dFdx(t)), abs(dFdy(t)));\n    \n    if (epsilon >= ellipsoidInterval.start)\n    {\n        // If the fragment is on the silhouette of the ellipsoid, the adjacent fragment\n        // will not hit the ellipsoid (its ellipsoidInterval.start will be zero),\n        // so the derivative will be large, and we would get false positives.\n        return false;\n    }\n#else\n    // TODO:  Don't hardcode this.\n    float epsilon = t / 500.0;\n#endif\n\n    float width = 2.0;  // TODO: Expose as a uniform\n    epsilon *= width;           \n\n    return czm_equalsEpsilon(t, length(v_positionEC), epsilon);\n}\n\nvec4 shade(czm_raySegment ellipsoidInterval)\n{\n#ifdef RENDER_FOR_PICK\n    return u_pickColor;\n#else\n    if (u_showIntersection && ellipsoidSensorIntersection(ellipsoidInterval))\n    {\n        return getIntersectionColor(u_sensorRadius, v_positionEC);\n    }\n    return getColor(u_sensorRadius, v_positionEC);\n#endif\n}\n\nbool czm_pointInEllipsoid(czm_ellipsoid ellipsoid, vec3 point)\n{\n    // TODO: Take into account ellipsoid's center; optimize with radii-squared; and move elsewhere\n    return (((point.x * point.x) / (ellipsoid.radii.x * ellipsoid.radii.x)) +\n            ((point.y * point.y) / (ellipsoid.radii.y * ellipsoid.radii.y)) +\n            ((point.z * point.z) / (ellipsoid.radii.z * ellipsoid.radii.z)) < 1.0);\n}\n\nvoid main()\n{\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\n\n    // Occluded by the ellipsoid?\n	if (!u_showThroughEllipsoid)\n	{\n	    // Discard if in the ellipsoid    \n	    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\n	    if (czm_pointInEllipsoid(ellipsoid, v_positionWC))\n	    {\n	        discard;\n	    }\n	\n	    // Discard if in the sensor's shadow\n	    if (inSensorShadow(v_sensorVertexWC, ellipsoid, v_positionEC))\n	    {\n	        discard;\n	    }\n    }\n    \n    // Discard if not in the sensor's sphere\n    // PERFORMANCE_IDEA: We can omit this check if the radius is Number.POSITIVE_INFINITY.\n    if (distance(v_positionEC, v_sensorVertexEC) > u_sensorRadius)\n    {\n        discard;\n    }\n\n    czm_ray ray = czm_ray(vec3(0.0), normalize(v_positionEC));  // Ray from eye to fragment in eye coordinates\n    czm_raySegment ellipsoidInterval = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\n\n    gl_FragColor = shade(ellipsoidInterval);\n}\n"}),c("Shaders/CustomSensorVolumeVS",[],function(){return"attribute vec4 position;\nattribute vec3 normal;\n\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_sensorVertexWC;\nvarying vec3 v_sensorVertexEC;\n\nvoid main()\n{\n    gl_Position = czm_modelViewProjection * position;\n    v_positionWC = (czm_model * position).xyz;\n    v_positionEC = (czm_modelView * position).xyz;\n    v_normalEC = czm_normal * normal;\n    \n    // This transform could be done once on the CPU.\n    // We could also hand-optimize the zeros out if the compiler doesn't already.\n    vec4 sensorVertexMC = vec4(0.0, 0.0, 0.0, 1.0);\n    v_sensorVertexWC = (czm_model * sensorVertexMC).xyz;\n    v_sensorVertexEC = (czm_modelView * sensorVertexMC).xyz;\n}"}),c("Shaders/EllipsoidFS",[],function(){return"uniform vec3 u_radii;\nuniform vec3 u_oneOverEllipsoidRadiiSquared;\n\nvarying vec3 v_positionEC;\n\nvoid main()\n{\n    czm_ellipsoid ellipsoid = czm_ellipsoidNew(czm_modelView[3].xyz, u_radii);\n    vec3 direction = normalize(v_positionEC);\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\n    \n    if (czm_isEmpty(intersection))\n    {\n        discard;\n    }\n        \n    // Pick the intersection point based on if the viewer is outside or inside the ellipsoid\n    bool hitFrontFace = (intersection.start != 0.0);\n    vec3 positionEC = czm_pointAlongRay(ray, hitFrontFace ? intersection.start : intersection.stop);\n    vec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\n    vec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));\n    vec3 normalMC = hitFrontFace ? geodeticNormal : -geodeticNormal;   // normalized surface normal (always facing the viewer) in model coordinates\n    vec3 normalEC = normalize(czm_normal * normalMC);                    // normalized surface normal in eye coordiantes\n    \n    vec2 st = czm_ellipsoidWgs84TextureCoordinates(geodeticNormal);\n    vec3 positionToEyeEC = -positionEC; \n                \n    czm_materialInput materialInput;\n    materialInput.s = st.s;\n    materialInput.st = st;\n    materialInput.str = (positionMC + u_radii) / u_radii;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.positionMC = positionMC;\n    czm_material material = czm_getMaterial(materialInput);\n\n	gl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n}\n"}),c("Shaders/EllipsoidVS",[],function(){return"attribute vec3 position;\n\nuniform vec3 u_radii;\n\nvarying vec3 v_positionEC;\n\nvoid main() \n{\n   // In the vertex data, the cube goes from (-1.0, -1.0, -1.0) to (1.0, 1.0, 1.0) in model coordinates.\n   // Scale to consider the radii.  We could also do this once on the CPU when using the BoxTessellator,\n   // but doing it here allows us to change the radii without rewriting the vertex data, and\n   // allows all ellipsoids to reuse the same vertex data.\n    vec4 p = vec4(u_radii * position, 1.0);\n    \n    v_positionEC = (czm_modelView * p).xyz;     // position in eye coordinates\n    gl_Position = czm_modelViewProjection * p;  // position in clip coordinates\n}\n"}),c("Shaders/Materials/AsphaltMaterial",[],function(){return"uniform vec4 asphaltColor;\nuniform float bumpSize;\nuniform float roughness;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    // From Stefan Gustavson's Procedural Textures in GLSL in OpenGL Insights\n    //Main cellular pattern\n    vec4 color = asphaltColor;\n    vec2 st = materialInput.st;\n    vec2 F = czm_cellular(st / bumpSize);\n    color.rgb -= (F.x / F.y) * 0.1;\n    \n    //Extra bumps for roughness\n    float noise = czm_snoise(st / bumpSize);\n    noise = pow(noise, 5.0) * roughness;\n    color.rgb += noise;\n\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}\n"}),c("Shaders/Materials/BlobMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float frequency;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    // From Stefan Gustavson's Procedural Textures in GLSL in OpenGL Insights\n    vec2 F = czm_cellular(materialInput.st * frequency);\n    float t = 1.0 - F.x * F.x;\n    \n    vec4 color = mix(lightColor, darkColor, t);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}"}),c("Shaders/Materials/BrickMaterial",[],function(){return"uniform vec4 brickColor;\nuniform vec4 mortarColor;\nuniform vec2 brickSize;\nuniform vec2 brickPct;\nuniform float brickRoughness;\nuniform float mortarRoughness;\n\n#define Integral(x, p) ((floor(x) * p) + max(fract(x) - (1.0 - p), 0.0))\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    // From OpenGL Shading Language (3rd edition) pg. 194, 501\n    vec2 st = materialInput.st;\n    vec2 position = st / brickSize;\n    if(fract(position.y * 0.5) > 0.5) {\n        position.x += 0.5;    \n    }\n        \n    //calculate whether to use brick or mortar (does AA)\n    vec2 filterWidth = vec2(0.02);\n    vec2 useBrick = (Integral(position + filterWidth, brickPct) - \n                       Integral(position, brickPct)) / filterWidth;\n    float useBrickFinal = useBrick.x * useBrick.y;\n    vec4 color = mix(mortarColor, brickColor, useBrickFinal);\n    \n    //Apply noise to brick\n    vec2 brickScaled = vec2(st.x / 0.1, st.y / 0.006);\n    float brickNoise = abs(czm_snoise(brickScaled) * brickRoughness / 5.0);\n    color.rg += brickNoise * useBrickFinal;\n    \n    //Apply noise to mortar\n    vec2 mortarScaled = st / 0.005;\n    float mortarNoise = max(czm_snoise(mortarScaled) * mortarRoughness, 0.0);\n    color.rgb += mortarNoise * (1.0 - useBrickFinal); \n\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}"}),c("Shaders/Materials/BumpMapMaterial",[],function(){return"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n    \n    vec2 centerPixel = fract(repeat * st);\n    float centerBump = texture2D(image, centerPixel).channel;\n    \n    float imageWidth = float(imageDimensions.x);\n    vec2 rightPixel = fract(repeat * (st + vec2(1.0 / imageWidth, 0.0)));\n    float rightBump = texture2D(image, rightPixel).channel;\n    \n    float imageHeight = float(imageDimensions.y);\n    vec2 leftPixel = fract(repeat * (st + vec2(0.0, 1.0 / imageHeight)));\n    float topBump = texture2D(image, leftPixel).channel;\n    \n    vec3 normalTangentSpace = normalize(vec3(centerBump - rightBump, centerBump - topBump, clamp(1.0 - strength, 0.1, 1.0)));\n    vec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\n \n    material.normal = normalEC;\n    material.diffuse = vec3(0.01);\n    \n    return material;\n}"}),c("Shaders/Materials/CementMaterial",[],function(){return"uniform vec4 cementColor;\nuniform float grainScale;\nuniform float roughness;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    float noise = czm_snoise(materialInput.st / grainScale);\n    noise = pow(noise, 5.0) * roughness;\n   \n    vec4 color = cementColor;\n    color.rgb += noise;\n    \n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}"}),c("Shaders/Materials/CheckerboardMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    // Fuzz Factor - Controls blurriness between light and dark colors\n    vec2 st = materialInput.st;\n    const float fuzz = 0.03;\n    \n    // From Stefan Gustavson's Procedural Textures in GLSL in OpenGL Insights\n    float b = mod(floor(repeat.s * st.s) + floor(repeat.t * st.t), 2.0);  // 0.0 or 1.0\n    \n    // Find the distance from the closest separator (region between two colors)\n    float scaledWidth = fract(repeat.s * st.s);\n    scaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\n    float scaledHeight = fract(repeat.t * st.t);\n    scaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\n    float value = min(scaledWidth, scaledHeight);\n    \n    //anti-aliasing\n    float val1 = clamp(value / fuzz, 0.0, 1.0);\n    float val2 = clamp((value - 0.5) / fuzz, 0.0, 1.0);\n    val1 = val1 * (1.0 - val2);\n    val1 = val1 * val1 * (3.0 - (2.0 * val1));\n    val1 = pow(val1, 0.5); //makes the transition nicer\n    \n    vec4 midColor = (lightColor + darkColor) / 2.0;\n    vec4 currentColor = mix(lightColor, darkColor, b);\n    \n    vec4 color = mix(midColor, currentColor, val1);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}\n"}),c("Shaders/Materials/DotMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    // From Stefan Gustavson's Procedural Textures in GLSL in OpenGL Insights\n    float b = smoothstep(0.3, 0.32, length(fract(repeat * materialInput.st) - 0.5));  // 0.0 or 1.0\n\n    vec4 color = mix(lightColor, darkColor, b);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}\n"}),c("Shaders/Materials/FacetMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float frequency;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    // From Stefan Gustavson's Procedural Textures in GLSL in OpenGL Insights\n    vec2 F = czm_cellular(materialInput.st * frequency);\n    float t = 0.1 + (F.y - F.x);\n        \n    vec4 color = mix(lightColor, darkColor, t);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}\n"}),c("Shaders/Materials/FresnelMaterial",[],function(){return"czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    vec3 normalWC = normalize(czm_inverseViewRotation * material.normal);\n    vec3 positionWC = normalize(czm_inverseViewRotation * materialInput.positionToEyeEC);\n    float cosAngIncidence = max(dot(normalWC, positionWC), 0.0);\n    \n    material.diffuse = mix(reflection.diffuse, refraction.diffuse, cosAngIncidence);\n    \n    return material;\n}\n"}),c("Shaders/Materials/GrassMaterial",[],function(){return"uniform vec4 grassColor;\nuniform vec4 dirtColor;\nuniform float patchiness;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    vec2 st = materialInput.st;\n    float noise1 = (czm_snoise(st * patchiness * 1.0)) * 1.0;\n    float noise2 = (czm_snoise(st * patchiness * 2.0)) * 0.5;\n    float noise3 = (czm_snoise(st * patchiness * 4.0)) * 0.25;\n    float noise = sin(noise1 + noise2 + noise3) * 0.1;\n    \n    vec4 color = mix(grassColor, dirtColor, noise);\n    \n    //Make thatch patterns\n    float verticalNoise = czm_snoise(vec2(st.x * 100.0, st.y * 20.0)) * 0.02;\n    float horizontalNoise = czm_snoise(vec2(st.x * 20.0, st.y * 100.0)) * 0.02;\n    float stripeNoise = min(verticalNoise, horizontalNoise);\n \n    color.rgb += stripeNoise;\n    \n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}"}),c("Shaders/Materials/NormalMapMaterial",[],function(){return"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    vec4 textureValue = texture2D(image, fract(repeat * materialInput.st));\n    vec3 normalTangentSpace = textureValue.channels;\n    normalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;\n    normalTangentSpace.z = clamp(1.0 - strength, 0.1, 1.0);\n    normalTangentSpace = normalize(normalTangentSpace);\n    vec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\n    \n    material.normal = normalEC;\n    \n    return material;\n}"}),c("Shaders/Materials/ReflectionMaterial",[],function(){return"uniform samplerCube cubeMap;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    vec3 normalWC = normalize(czm_inverseViewRotation * material.normal);\n    vec3 positionWC = normalize(czm_inverseViewRotation * materialInput.positionToEyeEC);\n    vec3 reflectedWC = reflect(positionWC, normalWC);\n    material.diffuse = textureCube(cubeMap, reflectedWC).channels;\n\n    return material;\n}"}),c("Shaders/Materials/RefractionMaterial",[],function(){return"uniform samplerCube cubeMap;\nuniform float indexOfRefractionRatio;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    vec3 normalWC = normalize(czm_inverseViewRotation * material.normal);\n    vec3 positionWC = normalize(czm_inverseViewRotation * materialInput.positionToEyeEC);\n    vec3 refractedWC = refract(positionWC, -normalWC, indexOfRefractionRatio);\n    material.diffuse = textureCube(cubeMap, refractedWC).channels;\n\n    return material;\n}"}),c("Shaders/Materials/StripeMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float offset;\nuniform float repeat;\nuniform bool horizontal;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    // Based on the Stripes Fragment Shader in the Orange Book (11.1.2)\n    // Fuzz Factor - Controls blurriness between light and dark colors\n    const float fuzz = 0.1;\n\n    float coord = mix(materialInput.st.s, materialInput.st.t, float(horizontal));\n    float value = fract((coord - offset) * (repeat * 0.5));\n    \n    //anti-aliasing\n    float val1 = clamp(value / fuzz, 0.0, 1.0);\n    float val2 = clamp((value - 0.5) / fuzz, 0.0, 1.0);\n    val1 = val1 * (1.0 - val2);\n    val1 = val1 * val1 * (3.0 - (2.0 * val1));\n\n    vec4 color = mix(lightColor, darkColor, val1);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}\n"}),c("Shaders/Materials/TieDyeMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float frequency;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    vec3 scaled = materialInput.str * frequency;\n    float t = abs(czm_snoise(scaled));\n    \n    vec4 color = mix(lightColor, darkColor, t);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}\n"}),c("Shaders/Materials/Water",[],function(){return"// Thanks for the contribution Jonas\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\n\nuniform sampler2D specularMap;\nuniform sampler2D normalMap;\nuniform vec4 baseWaterColor;\nuniform vec4 blendColor;\nuniform float frequency;\nuniform float animationSpeed;\nuniform float amplitude;\nuniform float specularIntensity;\nuniform float fadeFactor;\n\nvec4 getNoise(vec2 uv, float time, float angleInRadians) {\n\n    float cosAngle = cos(angleInRadians);\n    float sinAngle = sin(angleInRadians);\n    \n    // time dependent sampling directions\n    vec2 s0 = vec2(1.0/17.0, 0.0);\n    vec2 s1 = vec2(-1.0/29.0, 0.0);\n    vec2 s2 = vec2(1.0/101.0, 1.0/59.0);\n    vec2 s3 = vec2(-1.0/109.0, -1.0/57.0);\n    \n    // rotate sampling direction by specified angle\n    s0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));\n    s1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));\n    s2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));\n    s3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));\n    \n    vec2 uv0 = (uv/103.0) + (time * s0);\n    vec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);\n    vec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);\n    vec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);\n    \n    uv0 = fract(uv0);\n    uv1 = fract(uv1);\n    uv2 = fract(uv2);\n    uv3 = fract(uv3);\n    vec4 noise = (texture2D(normalMap, uv0)) +\n                 (texture2D(normalMap, uv1)) +\n                 (texture2D(normalMap, uv2)) +\n                 (texture2D(normalMap, uv3));\n                 \n    // average and scale to between -1 and 1\n    return ((noise / 4.0) - 0.5) * 2.0;\n}\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    float time = czm_frameNumber * animationSpeed;\n    \n    // fade is a function of the distance from the fragment and the frequency of the waves\n    float fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);\n            \n    float specularMapValue = texture2D(specularMap, materialInput.st).r;\n    \n    // note: not using directional motion at this time, just set the angle to 0.0;\n    vec4 noise = getNoise(materialInput.st * frequency, time, 0.0);\n    vec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));\n    \n    // fade out the normal perturbation as we move further from the water surface\n    normalTangentSpace.xy /= fade;\n        \n    // attempt to fade out the normal perturbation as we approach non water areas (low specular map value)\n    normalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);\n    \n    normalTangentSpace = normalize(normalTangentSpace);\n    \n    // get ratios for alignment of the new normal vector with a vector perpendicular to the tangent plane\n    float tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);\n    \n    // fade out water effect as specular map value decreases\n    material.alpha = specularMapValue;\n    \n    // base color is a blend of the water and non-water color based on the value from the specular map\n    // may need a uniform blend factor to better control this\n    material.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);\n    \n    // diffuse highlights are based on how perturbed the normal is\n    material.diffuse += (0.1 * tsPerturbationRatio);\n    \n    material.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);\n    \n    material.specular = specularIntensity;\n    material.shininess = 10.0;\n    \n    return material;\n}"}),c("Shaders/Materials/WoodMaterial",[],function(){return"uniform vec4 lightWoodColor;\nuniform vec4 darkWoodColor;\nuniform float ringFrequency;\nuniform vec2 noiseScale;\nuniform float grainFrequency;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    //Based on wood shader from OpenGL Shading Language (3rd edition) pg. 455\n    vec2 st = materialInput.st;\n    \n    vec2 noisevec;\n    noisevec.x = czm_snoise(st * noiseScale.x);\n    noisevec.y = czm_snoise(st * noiseScale.y);\n    \n    vec2 location = st + noisevec;\n    float dist = sqrt(location.x * location.x + location.y * location.y);\n    dist *= ringFrequency;\n    \n    float r = fract(dist + noisevec[0] + noisevec[1]) * 2.0;\n    if(r > 1.0)\n        r = 2.0 - r;\n        \n    vec4 color = mix(lightWoodColor, darkWoodColor, r);\n    \n    //streaks\n    r = abs(czm_snoise(vec2(st.x * grainFrequency, st.y * grainFrequency * 0.02))) * 0.2;\n    color.rgb += lightWoodColor.rgb * r;\n    \n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    \n    return material;\n}"}),c("Shaders/Noise",[],function(){return'#ifndef czm_NOISE\n#define czm_NOISE 1\n\n/*!\n * Description : Array and textureless GLSL 2D/3D/4D simplex \n *               noise functions.\n *      Author : Ian McEwan, Ashima Arts.\n *  Maintainer : ijm\n *     Lastmod : 20110822 (ijm)\n *     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n *               Distributed under the MIT License. See LICENSE file.\n *               https://github.com/ashima/webgl-noise\n */ \n\nvec4 _czm_mod289(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 _czm_mod289(vec3 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 _czm_mod289(vec2 x) \n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nfloat _czm_mod289(float x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n  \nvec4 _czm_permute(vec4 x)\n{\n    return _czm_mod289(((x*34.0)+1.0)*x);\n}\n\nvec3 _czm_permute(vec3 x)\n{\n    return _czm_mod289(((x*34.0)+1.0)*x);\n}\n\nfloat _czm_permute(float x) \n{\n    return _czm_mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 _czm_taylorInvSqrt(vec4 r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat _czm_taylorInvSqrt(float r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 _czm_grad4(float j, vec4 ip)\n{\n    const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n    vec4 p,s;\n\n    p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n    p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n    s = vec4(lessThan(p, vec4(0.0)));\n    p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www; \n\n    return p;\n}\n  \n/**\n * DOC_TBA\n *\n * Implemented by Ian McEwan, Ashima Arts, and distributed under the MIT License.  {@link https://github.com/ashima/webgl-noise}\n *\n * @name czm_snoise\n * @glslFunction\n *\n * @see <a href="https://github.com/ashima/webgl-noise">https://github.com/ashima/webgl-noise</a>\n * @see Stefan Gustavson\'s paper <a href="http://www.itn.liu.se/~stegu/simplexnoise/simplexnoise.pdf">Simplex noise demystified</a>\n */  \nfloat czm_snoise(vec2 v)\n{\n    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                       -0.577350269189626,  // -1.0 + 2.0 * C.x\n                        0.024390243902439); // 1.0 / 41.0\n    // First corner\n    vec2 i  = floor(v + dot(v, C.yy) );\n    vec2 x0 = v -   i + dot(i, C.xx);\n\n    // Other corners\n    vec2 i1;\n    //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n    //i1.y = 1.0 - i1.x;\n    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n    // x0 = x0 - 0.0 + 0.0 * C.xx ;\n    // x1 = x0 - i1 + 1.0 * C.xx ;\n    // x2 = x0 - 1.0 + 2.0 * C.xx ;\n    vec4 x12 = x0.xyxy + C.xxzz;\n    x12.xy -= i1;\n\n    // Permutations\n    i = _czm_mod289(i); // Avoid truncation effects in permutation\n    vec3 p = _czm_permute( _czm_permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 ));\n\n    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n    m = m*m ;\n    m = m*m ;\n\n    // Gradients: 41 points uniformly over a line, mapped onto a diamond.\n    // The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n    vec3 h = abs(x) - 0.5;\n    vec3 ox = floor(x + 0.5);\n    vec3 a0 = x - ox;\n\n    // Normalise gradients implicitly by scaling m\n    // Approximation of: m *= inversesqrt( a0*a0 + h*h );\n    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n    // Compute final noise value at P\n    vec3 g;\n    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n    return 130.0 * dot(m, g);\n}\n\nfloat czm_snoise(vec3 v)\n{ \n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n    // First corner\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n    // Other corners\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n\n    //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n    //   x1 = x0 - i1  + 1.0 * C.xxx;\n    //   x2 = x0 - i2  + 2.0 * C.xxx;\n    //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n    // Permutations\n    i = _czm_mod289(i); \n    vec4 p = _czm_permute( _czm_permute( _czm_permute( \n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n\n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n\n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n\n    //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n    //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n\n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n\n    //Normalise gradients\n    vec4 norm = _czm_taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n\n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n                                dot(p2,x2), dot(p3,x3) ) );\n}\n\nfloat czm_snoise(vec4 v)\n{\n    const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                          0.276393202250021,  // 2 * G4\n                          0.414589803375032,  // 3 * G4\n                         -0.447213595499958); // -1 + 4 * G4\n\n    // (sqrt(5) - 1)/4 = F4, used once below\n    #define F4 0.309016994374947451\n\n    // First corner\n    vec4 i  = floor(v + dot(v, vec4(F4)) );\n    vec4 x0 = v -   i + dot(i, C.xxxx);\n\n    // Other corners\n\n    // Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n    vec4 i0;\n    vec3 isX = step( x0.yzw, x0.xxx );\n    vec3 isYZ = step( x0.zww, x0.yyz );\n    //  i0.x = dot( isX, vec3( 1.0 ) );\n    i0.x = isX.x + isX.y + isX.z;\n    i0.yzw = 1.0 - isX;\n    //  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n    i0.y += isYZ.x + isYZ.y;\n    i0.zw += 1.0 - isYZ.xy;\n    i0.z += isYZ.z;\n    i0.w += 1.0 - isYZ.z;\n\n    // i0 now contains the unique values 0,1,2,3 in each channel\n    vec4 i3 = clamp( i0, 0.0, 1.0 );\n    vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n    vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n    //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n    //  x1 = x0 - i1  + 1.0 * C.xxxx\n    //  x2 = x0 - i2  + 2.0 * C.xxxx\n    //  x3 = x0 - i3  + 3.0 * C.xxxx\n    //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n    vec4 x1 = x0 - i1 + C.xxxx;\n    vec4 x2 = x0 - i2 + C.yyyy;\n    vec4 x3 = x0 - i3 + C.zzzz;\n    vec4 x4 = x0 + C.wwww;\n\n    // Permutations\n    i = _czm_mod289(i); \n    float j0 = _czm_permute( _czm_permute( _czm_permute( _czm_permute(i.w) + i.z) + i.y) + i.x);\n    vec4 j1 = _czm_permute( _czm_permute( _czm_permute( _czm_permute (\n               i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n             + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n             + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n             + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n    // Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n    // 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n    vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n    vec4 p0 = _czm_grad4(j0,   ip);\n    vec4 p1 = _czm_grad4(j1.x, ip);\n    vec4 p2 = _czm_grad4(j1.y, ip);\n    vec4 p3 = _czm_grad4(j1.z, ip);\n    vec4 p4 = _czm_grad4(j1.w, ip);\n\n    // Normalise gradients\n    vec4 norm = _czm_taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    p4 *= _czm_taylorInvSqrt(dot(p4,p4));\n\n    // Mix contributions from the five corners\n    vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n    vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n    m0 = m0 * m0;\n    m1 = m1 * m1;\n    return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n                  + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/*!\n * Cellular noise ("Worley noise") in 2D in GLSL.\n * Copyright (c) Stefan Gustavson 2011-04-19. All rights reserved.\n * This code is released under the conditions of the MIT license.\n * See LICENSE file for details.\n */\n \n//#ifdef GL_OES_standard_derivatives\n//    #extension GL_OES_standard_derivatives : enable\n//#endif  \n//\n//float aastep (float threshold , float value)\n//{\n//    float afwidth = 0.7 * length ( vec2 ( dFdx ( value ), dFdy ( value )));\n//    return smoothstep ( threshold - afwidth , threshold + afwidth , value );\n//}\n\n// Permutation polynomial: (34x^2 + x) mod 289\nvec3 _czm_permute289(vec3 x)\n{\n    return mod((34.0 * x + 1.0) * x, 289.0);\n}\n\n/**\n * DOC_TBA\n *\n * Implemented by Stefan Gustavson, and distributed under the MIT License.  {@link http://openglinsights.git.sourceforge.net/git/gitweb.cgi?p=openglinsights/openglinsights;a=tree;f=proceduraltextures}\n *\n * @name czm_cellular\n * @glslFunction\n *\n * @see Stefan Gustavson\'s chapter, <i>Procedural Textures in GLSL</i>, in <a href="http://www.openglinsights.com/">OpenGL Insights</a>.\n */  \nvec2 czm_cellular(vec2 P)\n// Cellular noise, returning F1 and F2 in a vec2.\n// Standard 3x3 search window for good F1 and F2 values\n{\n#define K 0.142857142857 // 1/7\n#define Ko 0.428571428571 // 3/7\n#define jitter 1.0 // Less gives more regular pattern\n    vec2 Pi = mod(floor(P), 289.0);\n    vec2 Pf = fract(P);\n    vec3 oi = vec3(-1.0, 0.0, 1.0);\n    vec3 of = vec3(-0.5, 0.5, 1.5);\n    vec3 px = _czm_permute289(Pi.x + oi);\n    vec3 p = _czm_permute289(px.x + Pi.y + oi); // p11, p12, p13\n    vec3 ox = fract(p*K) - Ko;\n    vec3 oy = mod(floor(p*K),7.0)*K - Ko;\n    vec3 dx = Pf.x + 0.5 + jitter*ox;\n    vec3 dy = Pf.y - of + jitter*oy;\n    vec3 d1 = dx * dx + dy * dy; // d11, d12 and d13, squared\n    p = _czm_permute289(px.y + Pi.y + oi); // p21, p22, p23\n    ox = fract(p*K) - Ko;\n    oy = mod(floor(p*K),7.0)*K - Ko;\n    dx = Pf.x - 0.5 + jitter*ox;\n    dy = Pf.y - of + jitter*oy;\n    vec3 d2 = dx * dx + dy * dy; // d21, d22 and d23, squared\n    p = _czm_permute289(px.z + Pi.y + oi); // p31, p32, p33\n    ox = fract(p*K) - Ko;\n    oy = mod(floor(p*K),7.0)*K - Ko;\n    dx = Pf.x - 1.5 + jitter*ox;\n    dy = Pf.y - of + jitter*oy;\n    vec3 d3 = dx * dx + dy * dy; // d31, d32 and d33, squared\n    // Sort out the two smallest distances (F1, F2)\n    vec3 d1a = min(d1, d2);\n    d2 = max(d1, d2); // Swap to keep candidates for F2\n    d2 = min(d2, d3); // neither F1 nor F2 are now in d3\n    d1 = min(d1a, d2); // F1 is now in d1\n    d2 = max(d1a, d2); // Swap to keep candidates for F2\n    d1.xy = (d1.x < d1.y) ? d1.xy : d1.yx; // Swap if smaller\n    d1.xz = (d1.x < d1.z) ? d1.xz : d1.zx; // F1 is in d1.x\n    d1.yz = min(d1.yz, d2.yz); // F2 is now not in d2.yz\n    d1.y = min(d1.y, d1.z); // nor in  d1.z\n    d1.y = min(d1.y, d2.x); // F2 is in d1.y, we\'re done.\n    return sqrt(d1.xy);\n}\n\n/*\n\n// Cellular noise, returning F1 and F2 in a vec2 and the\n// 2D vectors to each of the two closest points in a vec4.\n// Standard 3x3 search window for good F1 and F2 values.\nvoid czm_cellular(in vec2 P, out vec2 F, out vec4 d1d2)\n{\n#define K 0.142857142857 // 1/7\n#define Ko 0.428571428571 // 3/7\n#define jitter 1.0 // Less gives more regular pattern\n    vec2 Pi = mod(floor(P), 289.0);\n    vec2 Pf = fract(P);\n    vec3 oi = vec3(-1.0, 0.0, 1.0);\n    vec3 of = vec3(-0.5, 0.5, 1.5);\n    vec3 px = _czm_permute289(Pi.x + oi);\n    vec3 p = _czm_permute289(px.x + Pi.y + oi); // p11, p12, p13\n    vec3 ox = fract(p*K) - Ko;\n    vec3 oy = mod(floor(p*K),7.0)*K - Ko;\n    vec3 d1x = Pf.x + 0.5 + jitter*ox;\n    vec3 d1y = Pf.y - of + jitter*oy;\n    vec3 d1 = d1x * d1x + d1y * d1y; // d11, d12 and d13, squared\n    p = _czm_permute289(px.y + Pi.y + oi); // p21, p22, p23\n    ox = fract(p*K) - Ko;\n    oy = mod(floor(p*K),7.0)*K - Ko;\n    vec3 d2x = Pf.x - 0.5 + jitter*ox;\n    vec3 d2y = Pf.y - of + jitter*oy;\n    vec3 d2 = d2x * d2x + d2y * d2y; // d21, d22 and d23, squared\n    p = _czm_permute289(px.z + Pi.y + oi); // p31, p32, p33\n    ox = fract(p*K) - Ko;\n    oy = mod(floor(p*K),7.0)*K - Ko;\n    vec3 d3x = Pf.x - 1.5 + jitter*ox;\n    vec3 d3y = Pf.y - of + jitter*oy;\n    vec3 d3 = d3x * d3x + d3y * d3y; // d31, d32 and d33, squared\n    // Sort out the two smallest distances (F1, F2)\n    // While also swapping dx and dy accordingly\n    vec3 comp3 = step(d2, d1);\n    vec3 d1a = mix(d1, d2, comp3);\n    vec3 d1xa = mix(d1x, d2x, comp3);\n    vec3 d1ya = mix(d1y, d2y, comp3);\n    d2 = mix(d2, d1, comp3); // Swap to keep candidates for F2\n    d2x = mix(d2x, d1x, comp3);\n    d2y = mix(d2y, d1y, comp3);\n  \n    comp3 = step(d3, d2);\n    d2 = mix(d2, d3, comp3); // neither F1 nor F2 are now in d3\n    d2x = mix(d2x, d3x, comp3);\n    d2y = mix(d2y, d3y, comp3);\n  \n    comp3 = step(d2, d1a);\n    d1 = mix(d1a, d2, comp3); // F1 is now in d1\n    d1x = mix(d1xa, d2x, comp3);\n    d1y = mix(d1ya, d2y, comp3);\n    d2 = mix(d2, d1a, comp3); // Swap to keep candidates for F2\n    d2x = mix(d2x, d1xa, comp3);\n    d2y = mix(d2y, d1ya, comp3);\n  \n    float comp1 = step(d1.y, d1.x);\n    d1.xy = mix(d1.xy, d1.yx, comp1); // Swap if smaller\n    d1x.xy = mix(d1x.xy, d1x.yx, comp1);\n    d1y.xy = mix(d1y.xy, d1y.yx, comp1);\n  \n    comp1 = step(d1.z, d1.x);\n    d1.xz = mix(d1.xz, d1.zx, comp1); // F1 is in d1.x\n    d1x.xz = mix(d1x.xz, d1x.zx, comp1);\n    d1y.xz = mix(d1y.xz, d1y.zx, comp1);\n \n    vec2 comp2 = step(d2.yz, d1.yz);\n    d1.yz = mix(d1.yz, d2.yz, comp2); // F2 is now not in d2.yz\n    d1x.yz = mix(d1x.yz, d2x.yz, comp2);\n    d1y.yz = mix(d1y.yz, d2y.yz, comp2);\n  \n    comp1 = step(d1.z, d1.y);\n    d1.y = mix(d1.y, d1.z, comp1); // nor in  d1.z\n    d1x.y = mix(d1x.y, d1x.z, comp1);\n    d1y.y = mix(d1y.y, d1y.z, comp1);\n \n    comp1 = step(d2.x, d1.y);\n    d1.y = mix(d1.y, d2.x, comp1); // F2 is in d1.y, we\'re done.\n    d1x.y = mix(d1x.y, d2x.x, comp1);\n    d1y.y = mix(d1y.y, d2y.x, comp1);\n    F = sqrt(d1.xy);\n    d1d2 = vec4(d1x.x, d1y.x, d1x.y, d1y.y);\n}\n\n*/\n\n#endif\n'}),c("Shaders/PolygonFS",[],function(){return"uniform float u_erosion;\nuniform float u_morphTime;\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_textureCoordinates;\n\n#ifndef RENDER_FOR_PICK\n\nvoid erode(vec3 str)\n{\n    if (u_erosion != 1.0)\n    {\n        float t = 0.5 + (0.5 * czm_snoise(str / (1.0 / 10.0)));   // Scale [-1, 1] to [0, 1]\n    \n        if (t > u_erosion)\n        {\n            discard;\n        }\n    }\n}\n\n#endif\n\nvoid main()\n{\n    czm_materialInput materialInput;\n    \n    // TODO: Real 1D distance, and better 3D coordinate\n    materialInput.st = v_textureCoordinates;\n    materialInput.str = vec3(v_textureCoordinates, 0.0);\n    materialInput.positionMC = v_positionMC;\n    \n    //Convert tangent space material normal to eye space\n    materialInput.normalEC = mix(czm_normal[0], normalize(czm_normal * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0))), u_morphTime); // +x is up in Columbus view   \n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n    \n    //Convert view vector to world space\n    vec3 positionToEyeEC = -v_positionEC; \n    materialInput.positionToEyeEC = positionToEyeEC;\n\n    erode(materialInput.str);\n    czm_material material = czm_getMaterial(materialInput);\n    \n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n}\n"}),c("Shaders/PolygonFSPick",[],function(){return"uniform vec4 u_pickColor;\n\nvoid main()\n{\n    gl_FragColor = u_pickColor;\n}"}),c("Shaders/PolygonVS",[],function(){return"attribute vec2 position2D;\nattribute vec3 position3D;\nattribute vec2 textureCoordinates;\n\nuniform float u_morphTime;\nuniform float u_height;     // in meters\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    vec4 p = czm_columbusViewMorph(vec3(u_height, position2D), position3D, u_morphTime);\n\n    v_positionMC = position3D;                      // position in model coordinates\n    v_positionEC = (czm_modelView * p).xyz;         // position in eye coordinates\n    v_textureCoordinates = textureCoordinates;\n    gl_Position = czm_modelViewProjection * p;      // position in clip coordinates\n}\n"}),c("Shaders/PolygonVSPick",[],function(){return"attribute vec2 position2D;\nattribute vec3 position3D;\n\nuniform float u_morphTime;\nuniform float u_height;     // in meters\n\nvoid main() \n{\n    vec4 p = czm_columbusViewMorph(vec3(u_height, position2D), position3D, u_morphTime);\n\n    gl_Position = czm_modelViewProjection * p;                      // position in clip coordinates\n}\n"}),c("Shaders/PolylineFS",[],function(){return"varying vec4 v_color;\n\nvoid main()\n{\n    gl_FragColor = v_color; \n}"}),c("Shaders/PolylineVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 position2DHigh;\nattribute vec3 position2DLow;\nattribute vec4 color;\nattribute float show;\n\nvarying vec4 v_color;\n\nuniform float u_morphTime;\n\nvoid main() \n{\n    vec4 p;\n\n    if (u_morphTime == 1.0)\n    {\n        p = vec4(czm_translateRelativeToEye(position3DHigh, position3DLow), 1.0);\n    }\n    else if (u_morphTime == 0.0)\n    {\n        p = vec4(czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy), 1.0);\n    }\n    else\n    {\n        p = czm_columbusViewMorph(\n        	czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),\n            czm_translateRelativeToEye(position3DHigh, position3DLow), \n            u_morphTime);\n    }\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p * show;  // position in clip coordinates\n    v_color = color;\n}\n"}),c("Scene/PolylineCollection",["../Core/DeveloperError","../Core/combine","../Core/destroyObject","../Core/Cartesian3","../Core/Cartesian4","../Core/EncodedCartesian3","../Core/Matrix4","../Core/ComponentDatatype","../Core/IndexDatatype","../Core/PrimitiveType","../Core/Color","../Core/BoundingSphere","../Core/Intersect","../Renderer/BlendingState","../Renderer/BufferUsage","../Renderer/CommandLists","../Renderer/DrawCommand","./SceneMode","./Polyline","../Shaders/PolylineVS","../Shaders/PolylineFS","../Renderer/StencilFunction","../Renderer/StencilOperation"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function I(a,b,c){this.count=a,this.offset=b,this.rsOne=c.rsOne,this.rsTwo=c.rsTwo,this.rsThree=c.rsThree,this.rsPick=c.rsPick}function K(a){return d.dot(d.UNIT_X,a._boundingVolume.center)<0||a._boundingVolume.intersect(e.UNIT_Y)===m.INTERSECTING}var x=s.SHOW_INDEX,y=s.POSITION_INDEX,z=s.COLOR_INDEX,A=s.OUTLINE_COLOR_INDEX,B=s.WIDTH_INDEX,C=s.OUTLINE_WIDTH_INDEX,D=s.POSITION_SIZE_INDEX,E=s.NUMBER_OF_PROPERTIES,F=65536,G={position3DHigh:0,position3DLow:1,position2DHigh:2,position2DLow:3,color:4,pickColor:5,show:6},H=function(){this.morphTime=1,this.modelMatrix=g.IDENTITY.clone(),this._modelMatrix=g.IDENTITY.clone(),this._sp=undefined,this._boundingVolume=undefined,this._boundingVolume2D=undefined,this._commandLists=new p,this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(E),this._polylines=[],this._polylineBuckets={},this._buffersUsage=[{bufferUsage:o.STATIC_DRAW,frameCount:0},{bufferUsage:o.STATIC_DRAW,frameCount:0},{bufferUsage:o.STATIC_DRAW,frameCount:0},{bufferUsage:o.STATIC_DRAW,frameCount:0},{bufferUsage:o.STATIC_DRAW,frameCount:0},{bufferUsage:o.STATIC_DRAW,frameCount:0}],this._mode=undefined;var a=this;this._uniforms={u_morphTime:function(){return a.morphTime}},this._polylinesToUpdate=[],this._colorVertexArrays=[],this._outlineColorVertexArrays=[],this._pickColorVertexArrays=[],this._positionBuffer=undefined,this._outlineColorBuffer=undefined,this._colorBuffer=undefined,this._pickColorBuffer=undefined,this._showBuffer=undefined};H.prototype.add=function(a){var b=new s(a,this);return b._index=this._polylines.length,this._polylines.push(b),this._createVertexArray=!0,b},H.prototype.remove=function(a){return this.contains(a)?(this._polylines[a._index]=null,this._polylinesRemoved=!0,this._createVertexArray=!0,a._destroy(),!0):!1},H.prototype.removeAll=function(){this._destroyPolylines(),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0},H.prototype.contains=function(a){return typeof a!="undefined"&&a._polylineCollection===this},H.prototype.get=function(b){if(typeof b=="undefined")throw new a("index is required.");return this._removePolylines(),this._polylines[b]},H.prototype.getLength=function(){return this._removePolylines(),this._polylines.length},H.prototype.update=function(a,b,c){typeof this._sp=="undefined"&&(this._sp=a.getShaderCache().getShaderProgram(t,u,G)),this._removePolylines(),this._updateMode(b);var d,e,f,h,i,k,l,m=this._propertiesChanged;if(this._createVertexArray||this._computeNewBuffersUsage())this._createVertexArrays(a);else if(this._polylinesUpdated){var n=this._polylinesToUpdate,o=!1;if(this._mode!==r.SCENE3D){var p=n.length;for(var s=0;s<p;++s){e=n[s];var v=e._propertiesChanged;if(v[y]&&K(e)){var w=e._createSegments(this._projection._ellipsoid);if(e._segmentsLengthChanged(w)){o=!0;break}e._setSegments(w)}}}if(m[D]||m[B]||m[C]||o)this._createVertexArrays(a);else{f=n.length,i=this._polylineBuckets;for(var F=0;F<f;++F){e=n[F],m=e._propertiesChanged,d=e._bucket;var H=0;for(var I in i)if(i.hasOwnProperty(I)){if(i[I]===d){m[y]&&d.writePositionsUpdate(H,e,this._positionBuffer),m[z]&&d.writeColorUpdate(H,e,this._colorBuffer),m[A]&&d.writeColorUpdate(H,e,this._outlineColorBuffer),m[x]&&d.writeShowUpdate(H,e,this._showBuffer);break}H+=i[I].lengthOfPositions}e._clean()}}n.length=0,this._polylinesUpdated=!1}for(var J=0;J<E;++J)m[J]=0;var L,M=g.IDENTITY;b.mode===r.SCENE3D?(L=this._boundingVolume,M=this.modelMatrix):b.mode===r.COLUMBUS_VIEW||b.mode===r.SCENE2D?L=this._boundingVolume2D:L=this._boundingVolume&&this._boundingVolume2D&&this._boundingVolume.union(this._boundingVolume2D);var N=b.passes,O,P;i=this._polylineBuckets;var Q=this._sp;this._commandLists.removeAll();if(typeof i!="undefined"){if(N.color){f=this._colorVertexArrays.length,O=this._commandLists.colorList;for(var R=0;R<f;++R){var S=this._colorVertexArrays[R],T=this._outlineColorVertexArrays[R];h=this._colorVertexArrays[R].buckets,k=h.length;var U=O.length;O.length+=k*3;for(var V=0;V<k;++V,U+=3)l=h[V],P=O[U],typeof P=="undefined"&&(P=O[U]=new q),P.boundingVolume=L,P.modelMatrix=M,P.primitiveType=j.LINES,P.count=l.count,P.offset=l.offset,P.shaderProgram=Q,P.uniformMap=this._uniforms,P.vertexArray=T.va,P.renderState=l.rsOne,P=O[U+1],typeof P=="undefined"&&(P=O[U+1]=new q),P.boundingVolume=L,P.modelMatrix=M,P.primitiveType=j.LINES,P.count=l.count,P.offset=l.offset,P.shaderProgram=Q,P.uniformMap=this._uniforms,P.vertexArray=S.va,P.renderState=l.rsTwo,P=O[U+2],typeof P=="undefined"&&(P=O[U+2]=new q),P.boundingVolume=L,P.modelMatrix=M,P.primitiveType=j.LINES,P.count=l.count,P.offset=l.offset,P.shaderProgram=Q,P.uniformMap=this._uniforms,P.vertexArray=T.va,P.renderState=l.rsThree}}if(N.pick){f=this._pickColorVertexArrays.length,O=this._commandLists.pickList;for(var W=0;W<f;++W){var X=this._pickColorVertexArrays[W];h=X.buckets,k=h.length,O.length+=k;for(var Y=0;Y<k;++Y)l=h[Y],P=O[Y],typeof P=="undefined"&&(P=O[Y]=new q),P.boundingVolume=L,P.modelMatrix=M,P.primitiveType=j.LINES,P.count=l.count,P.offset=l.offset,P.shaderProgram=Q,P.uniformMap=this._uniforms,P.vertexArray=X.va,P.renderState=l.rsPick}}}this._commandLists.empty()||c.push(this._commandLists)},H.prototype.isDestroyed=function(){return!1},H.prototype.destroy=function(){return this._sp=this._sp&&this._sp.release(),this._destroyVertexArrays(),this._destroyPolylines(),c(this)},H.prototype._computeNewBuffersUsage=function(){var a=this._buffersUsage,b=!1,c=this._propertiesChanged;for(var d=0;d<E-1;++d){var e=a[d];c[d]?e.bufferUsage!==o.STREAM_DRAW?(b=!0,e.bufferUsage=o.STREAM_DRAW,e.frameCount=100):e.frameCount=100:e.bufferUsage!==o.STATIC_DRAW&&(e.frameCount===0?(b=!0,e.bufferUsage=o.STATIC_DRAW):e.frameCount--)}return b},H.prototype._createVertexArrays=function(a){this._createVertexArray=!1,this._destroyVertexArrays(),this._sortPolylinesIntoBuckets();var b=[],c=[],d=[0];b.push(c);var e=0,f=this.morphTime!==0,g=[[]],j=0,k=this._polylineBuckets,l,m;for(l in k)k.hasOwnProperty(l)&&(m=k[l],m.updateRenderState(a,f),j+=m.lengthOfPositions);if(j>0){var n=new Float32Array(2*j*3),p=new Uint8Array(j*4),q=new Uint8Array(j*4),s=new Uint8Array(j*4),t=new Uint8Array(j),u,v=0,w=0,B=0;for(l in k)if(k.hasOwnProperty(l)){m=k[l],m.write(n,q,p,s,t,v,B,w,a),this._mode===r.MORPHING&&(typeof u=="undefined"&&(u=new Float32Array(2*j*3)),m.writeForMorph(u,v));var C=m.lengthOfPositions;v+=2*C*3,B+=C,w+=C*4,e=m.updateIndices(b,d,g,e)}this._positionBuffer=a.createVertexBuffer(n,this._buffersUsage[y].bufferUsage);var D;typeof u!="undefined"&&(D=a.createVertexBuffer(u,this._buffersUsage[y].bufferUsage)),this._outlineColorBuffer=a.createVertexBuffer(p,this._buffersUsage[A].bufferUsage),this._colorBuffer=a.createVertexBuffer(q,this._buffersUsage[z].bufferUsage),this._pickColorBuffer=a.createVertexBuffer(s,o.STATIC_DRAW),this._showBuffer=a.createVertexBuffer(t,this._buffersUsage[x].bufferUsage);var E=4*Uint8Array.BYTES_PER_ELEMENT,H=3*Float32Array.BYTES_PER_ELEMENT,I=0,J=b.length;for(var K=0;K<J;++K){c=b[K];if(c.length>0){var L=new Uint16Array(c),M=a.createIndexBuffer(L,o.STATIC_DRAW,i.UNSIGNED_SHORT);M.setVertexArrayDestroyable(!1),I+=d[K];var N=2*(K*H*F-I*H),O=H+N,P=K*E*F-I*E,Q=K*F-I,R=[{index:G.position3DHigh,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:N,strideInBytes:2*H},{index:G.position3DLow,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:O,strideInBytes:2*H},{index:G.position2DHigh,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:N,strideInBytes:2*H},{index:G.position2DLow,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:O,strideInBytes:2*H},{index:G.color,componentsPerAttribute:4,normalize:!0,componentDatatype:h.UNSIGNED_BYTE,vertexBuffer:this._colorBuffer,offsetInBytes:P},{index:G.show,componentsPerAttribute:1,componentDatatype:h.UNSIGNED_BYTE,vertexBuffer:this._showBuffer,offsetInBytes:Q}],S=[{index:G.position3DHigh,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:N,strideInBytes:2*H},{index:G.position3DLow,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:O,strideInBytes:2*H},{index:G.position2DHigh,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:N,strideInBytes:2*H},{index:G.position2DLow,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:O,strideInBytes:2*H},{index:G.color,componentsPerAttribute:4,normalize:!0,componentDatatype:h.UNSIGNED_BYTE,vertexBuffer:this._outlineColorBuffer,offsetInBytes:P},{index:G.show,componentsPerAttribute:1,componentDatatype:h.UNSIGNED_BYTE,vertexBuffer:this._showBuffer,offsetInBytes:Q}],T=[{index:G.position3DHigh,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:N,strideInBytes:2*H},{index:G.position3DLow,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:O,strideInBytes:2*H},{index:G.position2DHigh,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:N,strideInBytes:2*H},{index:G.position2DLow,componentsPerAttribute:3,componentDatatype:h.FLOAT,offsetInBytes:O,strideInBytes:2*H},{index:G.color,componentsPerAttribute:4,normalize:!0,componentDatatype:h.UNSIGNED_BYTE,vertexBuffer:this._pickColorBuffer,offsetInBytes:P},{index:G.show,componentsPerAttribute:1,componentDatatype:h.UNSIGNED_BYTE,vertexBuffer:this._showBuffer,offsetInBytes:Q}];this._mode===r.SCENE3D?(R[0].vertexBuffer=this._positionBuffer,R[1].vertexBuffer=this._positionBuffer,R[2].value=[0,0,0],R[3].value=[0,0,0],S[0].vertexBuffer=this._positionBuffer,S[1].vertexBuffer=this._positionBuffer,S[2].value=[0,0,0],S[3].value=[0,0,0],T[0].vertexBuffer=this._positionBuffer,T[1].vertexBuffer=this._positionBuffer,T[2].value=[0,0,0],T[3].value=[0,0,0]):this._mode===r.SCENE2D||this._mode===r.COLUMBUS_VIEW?(R[0].value=[0,0,0],R[1].value=[0,0,0],R[2].vertexBuffer=this._positionBuffer,R[3].vertexBuffer=this._positionBuffer,S[0].value=[0,0,0],S[1].value=[0,0,0],S[2].vertexBuffer=this._positionBuffer,S[3].vertexBuffer=this._positionBuffer,T[0].value=[0,0,0],T[1].value=[0,0,0],T[2].vertexBuffer=this._positionBuffer,T[3].vertexBuffer=this._positionBuffer):(R[0].vertexBuffer=D,R[1].vertexBuffer=D,R[2].vertexBuffer=this._positionBuffer,R[3].vertexBuffer=this._positionBuffer,S[0].vertexBuffer=D,S[1].vertexBuffer=D,S[2].vertexBuffer=this._positionBuffer,S[3].vertexBuffer=this._positionBuffer,T[0].vertexBuffer=D,T[1].vertexBuffer=D,T[2].vertexBuffer=this._positionBuffer,T[3].vertexBuffer=this._positionBuffer);var U=a.createVertexArray(R,M),V=a.createVertexArray(S,M),W=a.createVertexArray(T,M);this._colorVertexArrays.push({va:U,buckets:g[K]}),this._outlineColorVertexArrays.push({va:V,buckets:g[K]}),this._pickColorVertexArrays.push({va:W,buckets:g[K]})}}}},H.prototype._sortPolylinesIntoBuckets=function(){var a=this._polylineBuckets={},b=this._polylines,c=b.length;for(var d=0;d<c;++d){var e=b[d],f=e.getOutlineWidth(),g=e.getWidth(),h="OL"+f+"W"+g,i=a[h];typeof i=="undefined"&&(i=a[h]=new J(f,g,this._mode,this._projection,this._modelMatrix)),i.addPolyline(e)}},H.prototype._updateMode=function(a){var b=a.mode,c=a.scene2D.projection;this._mode!==b&&typeof b.morphTime!="undefined"&&(this.morphTime=b.morphTime);if(this._mode!==b||this._projection!==c||!this._modelMatrix.equals(this.modelMatrix))this._mode=b,this._projection=c,this._modelMatrix=this.modelMatrix.clone(),this._createVertexArray=!0},H.prototype._removePolylines=function(){if(this._polylinesRemoved){this._polylinesRemoved=!1;var a=[],b=this._polylines.length;for(var c=0,d=0;c<b;++c){var e=this._polylines[c];e&&(e._index=d++,a.push(e))}this._polylines=a}},H.prototype._destroyVertexArrays=function(){var a=this._colorVertexArrays.length;for(var b=0;b<a;++b)this._colorVertexArrays[b].va.destroy(),this._pickColorVertexArrays[b].va.destroy(),this._outlineColorVertexArrays[b].va.destroy();this._colorVertexArrays.length=0,this._pickColorVertexArrays.length=0,this._outlineColorVertexArrays.length=0},H.prototype._updatePolyline=function(a,b){this._polylinesUpdated=!0,this._polylinesToUpdate.push(a),++this._propertiesChanged[b]},H.prototype._destroyPolylines=function(){var a=this._polylines,b=a.length;for(var c=0;c<b;++c)a[c]&&a[c]._destroy()};var J=function(a,b,c,d,e){this.width=b,this.outlineWidth=a,this.polylines=[],this.lengthOfPositions=0,this.rsOne=undefined,this.rsTwo=undefined,this.rsThree=undefined,this.rsPick=undefined,this.mode=c,this.projection=d,this.ellipsoid=d.getEllipsoid(),this.modelMatrix=e};J.prototype.addPolyline=function(a){var b=this.polylines;b.push(a),a._actualLength=this.getPolylinePositionsLength(a),this.lengthOfPositions+=a._actualLength,a._bucket=this},J.prototype.updateRenderState=function(a,b){var c=this._clampWidth(a,this.width),d=this._clampWidth(a,this.outlineWidth),e=this.rsOne||a.createRenderState({colorMask:{red:!1,green:!1,blue:!1,alpha:!1},lineWidth:1,blending:n.ALPHA_BLEND,stencilTest:{enabled:!0,frontFunction:v.ALWAYS,backFunction:v.ALWAYS,reference:0,mask:-1,frontOperation:{fail:w.REPLACE,zFail:w.REPLACE,zPass:w.REPLACE},backOperation:{fail:w.REPLACE,zFail:w.REPLACE,zPass:w.REPLACE}}});e.depthMask=!b,e.depthTest.enabled=b,e.lineWidth=d,this.rsOne=e;var f=this.rsTwo||a.createRenderState({lineWidth:1,depthMask:!1,blending:n.ALPHA_BLEND,stencilTest:{enabled:!0,frontFunction:v.ALWAYS,backFunction:v.ALWAYS,reference:1,mask:-1,frontOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.REPLACE},backOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.REPLACE}}});f.depthTest.enabled=b,f.lineWidth=c,this.rsTwo=f;var g=this.rsThree||a.createRenderState({lineWidth:1,depthMask:!1,blending:n.ALPHA_BLEND,stencilTest:{enabled:!0,frontFunction:v.NOT_EQUAL,backFunction:v.NOT_EQUAL,reference:1,mask:-1,frontOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.KEEP},backOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.KEEP}}});g.lineWidth=this.outlineWidth,g.depthTest.enabled=b,this.rsThree=g;var h=this.rsPick||a.createRenderState();h.depthTest.enabled=b,h.lineWidth=d,h.depthMask=!b,this.rsPick=h},J.prototype.getPolylinePositionsLength=function(a){if(this.mode===r.SCENE3D||!K(a))return a.getPositions().length;var b=a._createSegments(this.ellipsoid);return a._setSegments(b)};var L=new d;return J.prototype.write=function(a,b,c,d,e,g,h,i,j){var l=this.polylines,m=l.length;for(var n=0;n<m;++n){var o=l[n],p=o.getColor(),q=o.getShow(),s=o.getOutlineColor(),t=o.getPickId(j).unnormalizedRgb,u=this._getPositions(o),v=u.length;for(var w=0;w<v;++w){var x=u[w];L.x=x.x,L.y=x.y,L.z=this.mode!==r.SCENE2D?x.z:0,f.writeElements(L,a,g),c[i]=k.floatToByte(s.red),c[i+1]=k.floatToByte(s.green),c[i+2]=k.floatToByte(s.blue),c[i+3]=k.floatToByte(s.alpha),b[i]=k.floatToByte(p.red),b[i+1]=k.floatToByte(p.green),b[i+2]=k.floatToByte(p.blue),b[i+3]=k.floatToByte(p.alpha),d[i]=t.red,d[i+1]=t.green,d[i+2]=t.blue,d[i+3]=255,e[h++]=q,g+=6,i+=4}}},J.prototype.writeForMorph=function(a,b){var c=this.modelMatrix,d,e=this.polylines,g=e.length;for(var h=0;h<g;++h){var i=e[h],j=i.getPositions(),k,l;if(K(i)){var m=i._getSegments();k=m.length;for(l=0;l<k;++l){var n=m[l],o=n.length;for(var p=0;p<o;++p)d=j[n[p].index],d=c.multiplyByPoint(d),f.writeElements(d,a,b),b+=6}}else{k=j.length;for(l=0;l<k;++l)d=j[l],d=c.multiplyByPoint(d),f.writeElements(d,a,b),b+=6}}},J.prototype._clampWidth=function(a,b){var c=a.getMinimumAliasedLineWidth(),d=a.getMaximumAliasedLineWidth();return Math.min(Math.max(b,c),d)},J.prototype._updateIndices3D=function(a,b,c,d){var e=c.length-1,f=new I(0,d,this);c[e].push(f);var g=0,h=a[a.length-1],i=0;h.length>0&&(i=h[h.length-1]+1);var j=this.polylines,k=j.length;for(var l=0;l<k;++l){var m=j[l],n=m.getPositions(),o=n.length;if(n.length>0){for(var p=0;p<o;++p)p!==o-1&&(i===F-1&&(b.push(1),h=[],a.push(h),i=0,f.count=g,g=0,d=0,f=new I(0,0,this),c[++e]=[f]),g+=2,d+=2,h.push(i++),h.push(i));i<F-1?i++:(b.push(0),h=[],a.push(h),i=0,f.count=g,d=0,g=0,f=new I(0,0,this),c[++e]=[f])}m._clean()}return f.count=g,d},J.prototype._updateIndices2D=function(a,b,c,d){var e=c.length-1,f=new I(0,d,this);c[e].push(f);var g=0,h=a[a.length-1],i=0;h.length>0&&(i=h[h.length-1]+1);var j=this.polylines,k=j.length;for(var l=0;l<k;++l){var m=j[l];if(K(m)){var n=m._segments,o=n.length;if(o>0){for(var p=0;p<o;++p){var q=n[p],r=q.length;for(var s=0;s<r;++s)s!==r-1&&(i===F-1&&(b.push(1),h=[],a.push(h),i=0,f.count=g,g=0,d=0,f=new I(0,0,this),c[++e]=[f]),g+=2,d+=2,h.push(i++),h.push(i));p!==o-1&&i++}i<F-1?i++:(b.push(0),h=[],a.push(h),i=0,f.count=g,d=0,g=0,f=new I(0,0,this),c[++e]=[f])}}else{var t=m.getPositions(),u=t.length;for(var v=0;v<u;++v)v!==u-1&&(i===F-1&&(b.push(1),h=[],a.push(h),i=0,f.count=g,g=0,d=0,f=new I(0,0,this),c[++e]=[f]),g+=2,d+=2,h.push(i++),h.push(i));i<F-1?i++:(b.push(0),h=[],a.push(h),i=0,f.count=g,d=0,g=0,f=new I(0,0,this),c[++e]=[f])}m._clean()}return f.count=g,d},J.prototype.updateIndices=function(a,b,c,d){return this.mode===r.SCENE3D?this._updateIndices3D(a,b,c,d):this._updateIndices2D(a,b,c,d)},J.prototype._getPolylineStartIndex=function(a){var b=this.polylines,c=0,d=b.length;for(var e=0;e<d;++e){var f=b[e];if(f===a)break;c+=f._actualLength}return c},J.prototype._getPositions=function(a){var b=a.getPositions();b.length>0&&(typeof a._polylineCollection._boundingVolume=="undefined"?a._polylineCollection._boundingVolume=l.clone(a._boundingVolume):a._polylineCollection._boundingVolume=a._polylineCollection._boundingVolume.union(a._boundingVolume,a._polylineCollection._boundingVolume));if(this.mode===r.SCENE3D)return b;K(a)&&(b=a._getPositions2D());var c=this.ellipsoid,e=this.projection,f=[],g=this.modelMatrix,h=b.length,i,j;for(var k=0;k<h;++k)i=b[k],j=g.multiplyByPoint(i),f.push(e.project(c.cartesianToCartographic(d.fromCartesian4(j))));if(f.length>0){a._boundingVolume2D=l.fromPoints(f,a._boundingVolume2D);var m=a._boundingVolume2D.center;a._boundingVolume2D.center=new d(m.z,m.x,m.y),typeof a._polylineCollection._boundingVolume2D=="undefined"?a._polylineCollection._boundingVolume2D=l.clone(a._boundingVolume2D):a._polylineCollection._boundingVolume2D=a._polylineCollection._boundingVolume2D.union(a._boundingVolume2D,a._polylineCollection._boundingVolume2D)}return f},J.prototype.writePositionsUpdate=function(a,b,c){var d=b._actualLength;if(d){a+=this._getPolylineStartIndex(b);var e=new Float32Array(2*d*3),g=0,h=this._getPositions(b);for(var i=0;i<d;++i){var j=h[i];L.x=j.x,L.y=j.y,L.z=this.mode!==r.SCENE2D?j.z:0,f.writeElements(L,e,g),g+=6}c.copyFromArrayView(e,24*a)}},J.prototype.writeColorUpdate=function(a,b,c){var d=b._actualLength;if(d){a+=this._getPolylineStartIndex(b);var e=0,f=b.getColor(),g=k.floatToByte(f.red),h=k.floatToByte(f.green),i=k.floatToByte(f.blue),j=k.floatToByte(f.alpha),l=new Uint8Array(d*4);for(var m=0;m<d;++m)l[e]=g,l[e+1]=h,l[e+2]=i,l[e+3]=j,e+=4;c.copyFromArrayView(l,4*a)}},J.prototype.writeShowUpdate=function(a,b,c){var d=b._actualLength;if(d){a+=this._getPolylineStartIndex(b);var e=b.getShow(),f=new Uint8Array(d);for(var g=0;g<d;++g)f[g]=e;c.copyFromArrayView(f,a)}},H}),c("DynamicScene/DynamicPathVisualizer",["../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Scene/PolylineCollection"],function(a,b,c,d){function e(a,b,c,d,e,f){var g=typeof c!="undefined",h=typeof d!="undefined",i=typeof e!="undefined";if(!g&&(!h||!i))return[];var j,k;return i&&(j=a.addSeconds(-e)),g&&(!i||c.start.greaterThan(j))&&(j=c.start),h&&(k=a.addSeconds(d)),g&&(!h||c.stop.lessThan(k))&&(k=c.stop),b.getValueRangeCartesian(j,k,a,f)}var f=function(b,c){if(typeof b=="undefined")throw new a("scene is required.");this._scene=b,this._unusedIndexes=[],this._primitives=b.getPrimitives();var e=this._polylineCollection=new d;b.getPrimitives().add(e),this._dynamicObjectCollection=undefined,this.setDynamicObjectCollection(c)};return f.prototype.getScene=function(){return this._scene},f.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},f.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(f.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(f.prototype._onObjectsRemoved,this))},f.prototype.update=function(b){if(typeof b=="undefined")throw new a("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(b,c[d])}},f.prototype.removeAllPrimitives=function(){var a;this._polylineCollection.removeAll();if(typeof this._dynamicObjectCollection!="undefined"){var b=this._dynamicObjectCollection.getObjects();for(a=b.length-1;a>-1;a--)b[a]._pathVisualizerIndex=undefined}this._unusedIndexes=[]},f.prototype.isDestroyed=function(){return!1},f.prototype.destroy=function(){return this.removeAllPrimitives(),this._scene.getPrimitives().remove(this._polylineCollection),b(this)},f.prototype._updateObject=function(a,b){var d=b.path;if(typeof d=="undefined")return;var f=b.position;if(typeof f=="undefined")return;var g,h=d.show,i=b._pathVisualizerIndex,j=typeof h=="undefined"||h.getValue(a);if(!j){typeof i!="undefined"&&(g=this._polylineCollection.get(i),g.setShow(!1),b._pathVisualizerIndex=undefined,this._unusedIndexes.push(i));return}if(typeof i=="undefined"){var k=this._unusedIndexes,l=k.length;l>0?(i=k.pop(),g=this._polylineCollection.get(i)):(i=this._polylineCollection.getLength(),g=this._polylineCollection.add()),b._pathVisualizerIndex=i,g.dynamicObject=b,g.setColor(c.WHITE),g.setOutlineColor(c.BLACK),g.setOutlineWidth(1),g.setWidth(1)}else g=this._polylineCollection.get(i);g.setShow(!0);var m=d.leadTime,n;typeof m!="undefined"&&(n=m.getValue(a)),m=d.trailTime;var o;typeof m!="undefined"&&(o=m.getValue(a)),g.setPositions(e(a,f,b.availability,n,o,g.getPositions())),m=d.color,typeof m!="undefined"&&g.setColor(m.getValue(a,g.getColor())),m=d.outlineColor,typeof m!="undefined"&&g.setOutlineColor(m.getValue(a,g.getOutlineColor())),m=d.outlineWidth;if(typeof m!="undefined"){var p=m.getValue(a);typeof p!="undefined"&&g.setOutlineWidth(p)}m=d.width;if(typeof m!="undefined"){var q=m.getValue(a);typeof q!="undefined"&&g.setWidth(q)}},f.prototype._onObjectsRemoved=function(a,b){var c=this._polylineCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._pathVisualizerIndex;if(typeof g!="undefined"){var h=c.get(g);h.setShow(!1),d.push(g),f._pathVisualizerIndex=undefined}}},f}),c("DynamicScene/DynamicPolylineVisualizer",["../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Scene/PolylineCollection"],function(a,b,c,d){var e=function(b,c){if(typeof b=="undefined")throw new a("scene is required.");this._scene=b,this._unusedIndexes=[],this._primitives=b.getPrimitives();var e=this._polylineCollection=new d;b.getPrimitives().add(e),this._dynamicObjectCollection=undefined,this.setDynamicObjectCollection(c)};return e.prototype.getScene=function(){return this._scene},e.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},e.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(e.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(e.prototype._onObjectsRemoved,this))},e.prototype.update=function(b){if(typeof b=="undefined")throw new a("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(b,c[d])}},e.prototype.removeAllPrimitives=function(){var a;this._polylineCollection.removeAll();if(typeof this._dynamicObjectCollection!="undefined"){var b=this._dynamicObjectCollection.getObjects();for(a=b.length-1;a>-1;a--)b[a]._polylineVisualizerIndex=undefined}this._unusedIndexes=[]},e.prototype.isDestroyed=function(){return!1},e.prototype.destroy=function(){return this.removeAllPrimitives(),this._scene.getPrimitives().remove(this._polylineCollection),b(this)},e.prototype._updateObject=function(a,b){var d=b.polyline;if(typeof d=="undefined")return;var e=b.vertexPositions;if(typeof e=="undefined")return;var f,g=d.show,h=b._polylineVisualizerIndex,i=b.isAvailable(a)&&(typeof g=="undefined"||g.getValue(a));if(!i){typeof h!="undefined"&&(f=this._polylineCollection.get(h),f.setShow(!1),b._polylineVisualizerIndex=undefined,this._unusedIndexes.push(h));return}if(typeof h=="undefined"){var j=this._unusedIndexes,k=j.length;k>0?(h=j.pop(),f=this._polylineCollection.get(h)):(h=this._polylineCollection.getLength(),f=this._polylineCollection.add()),b._polylineVisualizerIndex=h,f.dynamicObject=b,f.setColor(c.WHITE),f.setOutlineColor(c.BLACK),f.setOutlineWidth(1),f.setWidth(1)}else f=this._polylineCollection.get(h);f.setShow(!0);var l=e.getValueCartesian(a);typeof l!="undefined"&&f._visualizerPositions!==l&&(f.setPositions(l),f._visualizerPositions=l);var m=d.color;typeof m!="undefined"&&f.setColor(m.getValue(a,f.getColor())),m=d.outlineColor,typeof m!="undefined"&&f.setOutlineColor(m.getValue(a,f.getOutlineColor())),m=d.outlineWidth;if(typeof m!="undefined"){var n=m.getValue(a);typeof n!="undefined"&&f.setOutlineWidth(n)}m=d.width;if(typeof m!="undefined"){var o=m.getValue(a);typeof o!="undefined"&&f.setWidth(o)}},e.prototype._onObjectsRemoved=function(a,b){var c=this._polylineCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._polylineVisualizerIndex;if(typeof g!="undefined"){var h=c.get(g);h.setShow(!1),d.push(g),f._polylineVisualizerIndex=undefined}}},e}),c("Shaders/Ray",[],function(){return"/**\n * DOC_TBA\n *\n * @name czm_raySegmentCollectionCapacity\n * @glslConstant \n *\n * @see czm_raySegmentCollection\n */\nconst int czm_raySegmentCollectionCapacity = 4;\n\n/**\n * DOC_TBA\n *\n * @name czm_raySegmentCollection\n * @glslStruct\n *\n * @see czm_raySegmentCollectionCapacity\n * @see czm_raySegment\n */\nstruct czm_raySegmentCollection\n{\n    czm_raySegment intervals[czm_raySegmentCollectionCapacity];\n    int count;\n};\n\n/**\n * DOC_TBA\n *\n * @name czm_raySegmentCollectionNew\n * @glslFunction\n *\n */\nczm_raySegmentCollection czm_raySegmentCollectionNew()\n{\n    czm_raySegment intervals[czm_raySegmentCollectionCapacity];\n    czm_raySegmentCollection i = czm_raySegmentCollection(intervals, 0);\n    return i;\n}\n\nczm_raySegmentCollection czm_raySegmentCollectionNew(czm_raySegment segment)\n{\n    czm_raySegment intervals[czm_raySegmentCollectionCapacity];\n    intervals[0] = segment;\n    czm_raySegmentCollection i = czm_raySegmentCollection(intervals, 1);\n    return i;\n}\n\nczm_raySegmentCollection czm_raySegmentCollectionNew(czm_raySegment first, czm_raySegment second)\n{\n    czm_raySegment intervals[czm_raySegmentCollectionCapacity];\n    intervals[0] = first;\n    intervals[1] = second;\n    czm_raySegmentCollection i = czm_raySegmentCollection(intervals, 2);\n    return i;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_removeAt\n * @glslFunction\n *\n */\nvoid czm_removeAt(inout czm_raySegmentCollection collection, int index)\n{\n    --collection.count;\n    for (int i = 0; i < czm_raySegmentCollectionCapacity; ++i)\n    {\n        if (i >= index && i < collection.count)\n        {\n            collection.intervals[i] = collection.intervals[i + 1];\n        }\n        else if (i == collection.count)\n        {\n            break;\n        }\n    }\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_insertAt\n * @glslFunction\n *\n */\nvoid czm_insertAt(inout czm_raySegmentCollection collection, czm_raySegment segment, int index)\n{\n    for (int i = czm_raySegmentCollectionCapacity - 1; i >= 0; --i)\n    {\n        if (i <= collection.count && i > index)\n        {\n            collection.intervals[i] = collection.intervals[i - 1];\n        }\n        else if (i == index)\n        {\n            collection.intervals[i] = segment;\n        }\n        else if (i < index)\n        {\n            break;\n        }\n    }\n    ++collection.count;\n}\n\nvoid czm_insertAt(inout czm_raySegmentCollection collection, czm_raySegmentCollection segments, int index)\n{\n    if (segments.count == 1)\n    {\n        czm_insertAt(collection, segments.intervals[0], index);\n    }\n    else\n    {\n        for (int i = czm_raySegmentCollectionCapacity - 1; i >= 0; --i)\n        {\n            if (i < segments.count)\n            {\n                czm_insertAt(collection, segments.intervals[i], index);\n            }\n        }\n    }\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_complement\n * @glslFunction\n *\n */\nvoid czm_complement(czm_raySegment segment, out czm_raySegmentCollection collection)\n{\n    if (czm_isEmpty(segment))\n    {\n        collection = czm_raySegmentCollectionNew(czm_fullRaySegment);\n    }\n    else if (segment.stop == czm_infinity)\n    {\n        if (segment.start == 0.0)\n        {\n	        collection = czm_raySegmentCollectionNew();\n        }\n        else\n        {\n	        collection = czm_raySegmentCollectionNew(czm_raySegment(0.0, segment.start));\n        }\n    }\n    else if (segment.start == 0.0)\n    {\n        collection = czm_raySegmentCollectionNew(czm_raySegment(segment.stop, czm_infinity));\n    }\n    else\n    {\n	    czm_raySegment head = czm_raySegment(0.0, segment.start);\n	    czm_raySegment tail = czm_raySegment(segment.stop, czm_infinity);\n	    collection = czm_raySegmentCollectionNew(head, tail);\n    }        \n}\n\nczm_raySegmentCollection czm_complement(czm_raySegmentCollection collection)\n{\n    if (collection.count == 0)\n    {\n        czm_raySegmentCollection result = czm_raySegmentCollectionNew(czm_fullRaySegment);\n        return result;\n    }\n    else if (collection.count == 1)\n    {\n        czm_raySegmentCollection result;\n        czm_complement(collection.intervals[0], result);\n        return result;\n    }\n\n    czm_raySegmentCollection result = czm_raySegmentCollectionNew();\n\n    for (int i = 0; i < czm_raySegmentCollectionCapacity; ++i)\n    {\n        if (i < collection.count)\n        {\n            float start = collection.intervals[i].stop;\n            if (i < collection.count - 1)\n            {\n                float stop = collection.intervals[i + 1].start;\n                result.intervals[i] = czm_raySegment(start, stop);\n                ++result.count;\n            }\n            else if (start != czm_infinity)\n            {\n                result.intervals[i] = czm_raySegment(start, czm_infinity);\n                ++result.count;\n            }\n        }\n        else\n        {\n            break;\n        }\n    }\n    \n    if (collection.count > 0)\n    {\n        float stop = collection.intervals[0].start;\n        if (stop != 0.0)\n        {\n            // PERFORMANCE TODO: See if the additional loop iteration from the insert can be eliminated.\n            czm_insertAt(result, czm_raySegment(0.0, stop), 0);\n        }\n    }\n    \n    return result;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * DOC_TBA\n *\n * @name czm_union\n */\nczm_raySegmentCollection czm_union(czm_raySegment left, czm_raySegment right)\n{\n    if (czm_isFull(left) || czm_isFull(right))\n    {\n        czm_raySegmentCollection result = czm_raySegmentCollectionNew(czm_fullRaySegment);\n        return result;\n    }\n\n    float stop = min(left.stop, right.stop);\n    float start = max(left.start, right.start);\n    \n    if (stop < start) // No intersection.\n    {\n        czm_raySegmentCollection result = (left.start < right.start) ? czm_raySegmentCollectionNew(left, right) : czm_raySegmentCollectionNew(right, left);\n        return result;\n    }\n\n    czm_raySegmentCollection result = czm_raySegmentCollectionNew(czm_raySegment(min(left.start, right.start), max(left.stop, right.stop)));\n    return result;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Determines the intersection of two time intervals.  If they do not intersect, an\n * empty time interval, <code>czm_emptyRaySegment</code>, is returned.\n *\n * @name czm_intersection\n * @glslFunction \n *\n * @param {czm_raySegment} left One interval.\n * @param {czm_raySegment} right The other interval.\n *\n * @returns {czm_raySegment} The intersection of <code>left</code> and <code>right</code>.\n * \n * @see czm_unionRaySegments\n * @see czm_subtraction  \n * @see czm_isEmpty\n *\n * @example\n * czm_raySegment i0 = czm_intersection(czm_raySegment(1.0, 2.0), czm_raySegment(3.0, 4.0));    // Empty\n * czm_raySegment i1 = czm_intersection(czm_raySegment(1.0, 3.0), czm_raySegment(2.0, 4.0));    // (2.0, 3.0)\n */\nczm_raySegment czm_intersection(czm_raySegment left, czm_raySegment right)\n{\n    float stop = min(left.stop, right.stop);\n    \n    if (stop < 0.0)\n    {\n        return czm_emptyRaySegment;\n    }\n\n    float start = max(left.start, right.start);\n    \n    if (stop < start)\n    {\n        return czm_emptyRaySegment;\n    }\n\n    czm_raySegment s = czm_raySegment(start, stop);\n    return s;\n}\n\nczm_raySegmentCollection czm_intersection(czm_raySegmentCollection left, czm_raySegment right)\n{\n    if (left.count == 1)\n    {\n        czm_raySegment intersection = czm_intersection(left.intervals[0], right);\n        \n        if (czm_isEmpty(intersection))\n        {\n            czm_raySegmentCollection result = czm_raySegmentCollectionNew();\n            \n            return result;\n        }\n        else\n        {\n            czm_raySegmentCollection result = czm_raySegmentCollectionNew(intersection);\n            \n            return result;\n        }\n    }\n\n    czm_raySegmentCollection result = czm_raySegmentCollectionNew();\n    \n    for (int leftIndex = 0; leftIndex < czm_raySegmentCollectionCapacity; ++leftIndex)\n    {\n        if (leftIndex < left.count)\n        {\n            czm_raySegment intersection = czm_intersection(left.intervals[leftIndex], right);\n            if (!czm_isEmpty(intersection))\n            {\n                czm_insertAt(result, intersection, result.count);\n            }\n        }\n        else\n        {\n            break;\n        }\n    }\n\n    return result;\n}\n\nczm_raySegmentCollection czm_intersection(czm_raySegmentCollection left, czm_raySegmentCollection right)\n{\n    if (right.count == 1)\n    {\n        if (left.count == 1)\n        {\n            czm_raySegment intersection = czm_intersection(left.intervals[0], right.intervals[0]);\n            \n	        if (czm_isEmpty(intersection))\n	        {\n	            czm_raySegmentCollection result = czm_raySegmentCollectionNew();\n	            \n	            return result;\n	        }\n	        else\n	        {\n	            czm_raySegmentCollection result = czm_raySegmentCollectionNew(intersection);\n	            \n	            return result;\n	        }\n        }\n        else\n        {\n            czm_raySegmentCollection result = czm_intersection(left, right.intervals[0]);\n            \n            return result;\n        }\n    }\n\n    czm_raySegmentCollection result = czm_raySegmentCollectionNew();\n    \n    if (left.count > 0 && right.count > 0)\n    {\n        for (int leftIndex = 0; leftIndex < czm_raySegmentCollectionCapacity; ++leftIndex)\n        {\n            if (leftIndex < left.count)\n            {\n                for (int rightIndex = 0; rightIndex < czm_raySegmentCollectionCapacity; ++rightIndex)\n                {\n                    // TODO:  Figure out why this isn't \"rightIndex < right.count\".\n                    if (rightIndex <= right.count && left.intervals[leftIndex].stop >= right.intervals[rightIndex].start)\n                    {\n	                    czm_raySegment intersection = czm_intersection(left.intervals[leftIndex], right.intervals[rightIndex]);\n	                    if (!czm_isEmpty(intersection))\n	                    {\n                            czm_insertAt(result, intersection, result.count);\n                        }\n                    }\n                    else\n                    {\n                        break;\n	                }\n                }\n            }\n            else\n            {\n                break;\n            }\n        }\n    }\n\n    return result;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Subtracts one time interval from another, resulting in zero, one, or two non-empty time intervals.\n * \n * @name czm_subtraction\n * @glslFunction\n *\n * @param {czm_raySegment} outer The outer interval.\n * @param {czm_raySegment} inner The inner interval that is subtracted from <code>outer</code>.\n * \n * @returns {czm_raySegmentCollection} The time intervals resulting from <code>outer - inner</code>.\n *\n * @see czm_intersection\n * @see czm_unionRaySegments\n *\n * @example\n * czm_raySegmentCollection i0 = czm_subtraction(\n *   czm_raySegment(1.0, 4.0), czm_raySegment(2.0, 3.0)); \n * // i0 is [(1.0, 2.0), (3.0, 4.0)]\n * \n * czm_raySegmentCollection i1 = czm_subtraction(\n *   czm_raySegment(1.0, 4.0), czm_raySegment(1.0, 2.0));\n * // i1 is [(2.0, 4.0)]\n * \n * czm_raySegmentCollection i2 = czm_subtraction(\n *   czm_raySegment(1.0, 4.0), czm_raySegment(5.0, 6.0));\n * // i2 is []\n */\nczm_raySegmentCollection czm_subtraction(czm_raySegment outer, czm_raySegment inner)\n{\n    // This function has ANGLE workarounds:  http://code.google.com/p/angleproject/issues/detail?id=185\n\n    czm_raySegmentCollection i = czm_raySegmentCollectionNew();\n\n    czm_raySegment intersection = czm_intersection(outer, inner);\n    \n    if (czm_isEmpty(intersection) || (intersection.start == intersection.stop))\n    {\n        // No intersection, or intersection at an end point; subtraction doesn't change outer.\n        i.count = 1;\n        i.intervals[0] = outer;\n    }\n    else\n    {\n        if ((intersection.start == outer.start) && (intersection.stop == outer.stop))\n        {\n            // outer and inner are the same interval; subtracting them yields empty intervals.\n            i.count = 0;\n        }\n        else if (intersection.start == outer.start)\n        {\n            // inner is completely inside outer, and touching the left boundary; subtraction yields one interval\n            i.count = 1;\n            i.intervals[0] = czm_raySegment(inner.stop, outer.stop);\n        }\n        else if (intersection.stop == outer.stop)\n        {\n            // inner is completely inside outer, and touching the right boundary; subtraction yields one interval\n            i.count = 1;\n            i.intervals[0] = czm_raySegment(outer.start, inner.start);\n        }\n        else\n        {\n            // inner is completely inside outer, but not on a boundary; break outer into two intervals\n            i.count = 2;\n            i.intervals[0] = czm_raySegment(outer.start, inner.start);\n            i.intervals[1] = czm_raySegment(inner.stop, outer.stop);\n        }\n    }\n    \n    return i;\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_subtraction\n */\nczm_raySegmentCollection czm_subtraction(czm_raySegmentCollection left, czm_raySegment right)\n{\n    if (left.count == 1)\n    {\n        czm_raySegmentCollection result = czm_subtraction(left.intervals[0], right);\n        \n        return result;\n    }\n\n    czm_raySegmentCollection result = czm_raySegmentCollectionNew();\n    \n    for (int leftIndex = 0; leftIndex < czm_raySegmentCollectionCapacity; ++leftIndex)\n    {\n        if (leftIndex < left.count)\n        {\n            czm_raySegmentCollection segments = czm_subtraction(left.intervals[leftIndex], right);\n            if (segments.count != 0)\n            {\n                czm_insertAt(result, segments, result.count);\n            }\n        }\n        else\n        {\n            break;\n        }\n    }\n\n    return result;\n}\n\n/**\n * DOC_TBA\n *\n * @name czm_subtraction\n */\nczm_raySegmentCollection czm_subtraction(czm_raySegmentCollection left, czm_raySegmentCollection right)\n{\n    if (right.count == 1)\n    {\n        if (left.count == 1)\n        {\n            czm_raySegmentCollection result = czm_subtraction(left.intervals[0], right.intervals[0]);\n            \n            return result;\n        }\n        else\n        {\n	        czm_raySegmentCollection result = czm_subtraction(left, right.intervals[0]);\n	        \n	        return result;\n        }\n    }\n\n    // PERFORMANCE TODO: See if these two calls (with separate loop iterations) can be combined into one loop.\n    czm_raySegmentCollection complement = czm_complement(right);\n\n    czm_raySegmentCollection result = czm_intersection(left, complement);\n    \n    return result;\n}\n"}),c("Shaders/ReprojectWebMercatorFS",[],function(){return"uniform sampler2D u_texture;\n\nuniform float u_northLatitude;\nuniform float u_southLatitude;\nuniform float u_southMercatorYHigh;\nuniform float u_southMercatorYLow;\nuniform float u_oneOverMercatorHeight;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\n    // fragments on the edges of tiles even though the vertex shader is outputting\n    // coordinates strictly in the 0-1 range.\n    vec2 geographicUV = clamp(v_textureCoordinates, 0.0, 1.0);\n    vec2 webMercatorUV = geographicUV;\n    \n    float currentLatitude = mix(u_southLatitude, u_northLatitude, geographicUV.y);\n    float fraction = czm_latitudeToWebMercatorFraction(currentLatitude, u_southMercatorYLow, u_southMercatorYHigh, u_oneOverMercatorHeight);\n    \n    webMercatorUV = vec2(geographicUV.x, fraction);\n    \n    gl_FragColor = texture2D(u_texture, webMercatorUV);\n}\n"}),c("Shaders/ReprojectWebMercatorVS",[],function(){return"attribute vec4 position;\n\nuniform vec2 u_textureDimensions;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    v_textureCoordinates = position.xy;\n    gl_Position = czm_viewportOrthographic * (position * vec4(u_textureDimensions, 1.0, 1.0));\n}\n"}),c("Shaders/SensorVolume",[],function(){return"uniform float u_erosion;\nuniform vec4 u_intersectionColor;\n\nbool inSensorShadow(vec3 coneVertexWC, czm_ellipsoid ellipsoidEC, vec3 pointEC)\n{\n    // Diagonal matrix from the unscaled ellipsoid space to the scaled space.    \n    vec3 D = ellipsoidEC.inverseRadii;\n\n    // Sensor vertex in the scaled ellipsoid space\n    vec3 q = D * coneVertexWC;\n    float qMagnitudeSquared = dot(q, q);\n    float test = qMagnitudeSquared - 1.0;\n    \n    // Fragment in the ellipsoid frame\n    vec3 t = (czm_inverseView * vec4(pointEC, 1.0)).xyz;\n\n    // Sensor vertex to fragment vector in the ellipsoid's scaled space\n    vec3 temp = D * t - q;\n    float d = dot(temp, q);\n    \n    // Behind silhouette plane and inside silhouette cone\n    return (d < -test) && (d / length(temp) < -sqrt(test));\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n#ifndef RENDER_FOR_PICK\n\nvoid sensorErode(float sensorRadius, vec3 pointEC)\n{\n    if (u_erosion != 1.0)\n    {\n        vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\n        pointMC /= sensorRadius;\n        pointMC /= (1.0 / 10.0);\n    \n        float t = 0.5 + (0.5 * czm_snoise(pointMC));   // Scale [-1, 1] to [0, 1]\n    \n        if (t > u_erosion)\n        {\n            discard;\n        }\n    }\n}\n\nvec4 getIntersectionColor(float sensorRadius, vec3 pointEC)\n{\n    sensorErode(sensorRadius, pointEC);\n    return u_intersectionColor;\n}\n\nvec2 sensor2dTextureCoordinates(float sensorRadius, vec3 pointMC)\n{\n    // (s, t) both in the range [0, 1]\n    float t = pointMC.z / sensorRadius;\n    float s = 1.0 + (atan(pointMC.y, pointMC.x) / czm_twoPi);\n    s = s - floor(s);\n    \n    return vec2(s, t);\n}\n\n#endif"}),c("Shaders/SkyAtmosphereFS",[],function(){return'/*!\n * Copyright (c) 2000-2005, Sean O\'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * \n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n \n // Code:  http://sponeil.net/\n // GPU Gems 2 Article:  http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter16.html\n \nuniform float u_morphTime;\n \nconst float g = -0.95;\nconst float g2 = g * g;\n\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nvarying vec3 v_positionEC;\n\nvoid main (void)\n{\n    // TODO: make arbitrary ellipsoid\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\n    \n    vec3 direction = normalize(v_positionEC);\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n    \n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\n    if (!czm_isEmpty(intersection)) {\n        discard;\n    }\n    \n    // Extra normalize added for Android\n    float fCos = dot(czm_sunDirectionWC, normalize(v_toCamera)) / length(v_toCamera);\n    float fRayleighPhase = 0.75 * (1.0 + fCos*fCos);\n    float fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos*fCos) / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\n    \n    const float fExposure = 2.0;\n    \n    vec3 rgb = fRayleighPhase * v_rayleighColor + fMiePhase * v_mieColor;\n    rgb = vec3(1.0) - exp(-fExposure * rgb);\n    float l = czm_luminance(rgb);\n    gl_FragColor = vec4(rgb, min(smoothstep(0.0, 0.1, l), 1.0) * smoothstep(0.0, 1.0, u_morphTime));\n}\n'}),c("Shaders/SkyAtmosphereVS",[],function(){return"/*!\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * \n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n \n // Code:  http://sponeil.net/\n // GPU Gems 2 Article:  http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter16.html\n  \nattribute vec4 position;\n\nuniform float fCameraHeight;\nuniform float fCameraHeight2;\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nconst float Kr = 0.0025;\nconst float fKr4PI = Kr * 4.0 * czm_pi;\nconst float Km = 0.0015;\nconst float fKm4PI = Km * 4.0 * czm_pi;\nconst float ESun = 15.0;\nconst float fKmESun = Km * ESun;\nconst float fKrESun = Kr * ESun;\nconst vec3 v3InvWavelength = vec3(\n    5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n    9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n    19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\nconst float rayleighScaleDepth = 0.25;\n          \nconst int nSamples = 2;\nconst float fSamples = 2.0;\n\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nvarying vec3 v_positionEC;\n\nfloat scale(float fCos)\n{\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void)\n{\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Pos = position.xyz;\n    vec3 v3Ray = v3Pos - czm_viewerPositionWC;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n#ifdef SKY_FROM_SPACE\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(czm_viewerPositionWC, v3Ray);\n    float C = fCameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\n    fFar -= fNear;\n    float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n    float fStartDepth = exp(-1.0 / fScaleDepth);\n    float fStartOffset = fStartDepth*scale(fStartAngle);\n#else // SKY_FROM_ATMOSPHERE\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = czm_viewerPositionWC;\n    float fHeight = length(v3Start);\n    float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n    float fStartAngle = dot(v3Ray, v3Start) / fHeight;\n    float fStartOffset = fDepth*scale(fStartAngle);\n#endif\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        vec3 lightPosition = normalize(czm_viewerPositionWC); // czm_sunDirectionWC\n        float fLightAngle = dot(lightPosition, v3SamplePoint) / fHeight;\n        float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\n        float fScatter = (fStartOffset + fDepth*(scale(fLightAngle) - scale(fCameraAngle)));\n        vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    v_mieColor = v3FrontColor * fKmESun;\n    v_rayleighColor = v3FrontColor * (v3InvWavelength * fKrESun);\n    v_toCamera = czm_viewerPositionWC - v3Pos;\n    v_positionEC = (czm_modelView * position).xyz;\n    gl_Position = czm_modelViewProjection * position;\n}\n"}),c("Scene/SkyAtmosphere",["../Core/defaultValue","../Core/CubeMapEllipsoidTessellator","../Core/destroyObject","../Core/MeshFilters","../Core/PrimitiveType","../Core/Ellipsoid","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/CullFace","../Renderer/BlendingState","../Scene/SceneMode","../Shaders/SkyAtmosphereVS","../Shaders/SkyAtmosphereFS"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=function(b){b=a(b,f.WGS84),this.show=!0,this.morphTime=1,this._ellipsoid=b,this._command=new h,this._spSkyFromSpace=undefined,this._spSkyFromAtmosphere=undefined,this._fCameraHeight=undefined,this._fCameraHeight2=undefined,this._outerRadius=b.getRadii().multiplyByScalar(1.025).getMaximumComponent();var c=b.getMaximumRadius(),d=.25,e=this;this._command.uniformMap={fCameraHeight:function(){return e._fCameraHeight},fCameraHeight2:function(){return e._fCameraHeight2},fOuterRadius:function(){return e._outerRadius},fOuterRadius2:function(){return e._outerRadius*e._outerRadius},fInnerRadius:function(){return c},fScale:function(){return 1/(e._outerRadius-c)},fScaleDepth:function(){return d},fScaleOverScaleDepth:function(){return 1/(e._outerRadius-c)/d},u_morphTime:function(){return e.morphTime}}};return n.prototype.getEllipsoid=function(){return this._ellipsoid},n.prototype.update=function(a,c){if(!this.show)return undefined;if(c.mode!==k.SCENE3D&&c.mode!==k.MORPHING)return undefined;if(!c.passes.color)return undefined;var h=this._command;if(typeof h.vertexArray=="undefined"){var n=b.compute(f.fromCartesian3(this._ellipsoid.getRadii().multiplyByScalar(1.025)),60);h.vertexArray=a.createVertexArrayFromMesh({mesh:n,attributeIndices:d.createAttributeIndices(n),bufferUsage:g.STATIC_DRAW}),h.primitiveType=e.TRIANGLES,h.renderState=a.createRenderState({cull:{enabled:!0,face:i.FRONT},blending:j.ALPHA_BLEND});var o,p,q=a.getShaderCache();o="#define SKY_FROM_SPACE\n#line 0\n"+l,p="#line 0\n"+m,this._spSkyFromSpace=q.getShaderProgram(o,p),o="#define SKY_FROM_ATMOSPHERE\n#line 0\n"+l,this._spSkyFromAtmosphere=q.getShaderProgram(o,p)}var r=c.camera.getPositionWC();return this._fCameraHeight2=r.magnitudeSquared(),this._fCameraHeight=Math.sqrt(this._fCameraHeight2),this._fCameraHeight>this._outerRadius?h.shaderProgram=this._spSkyFromSpace:h.shaderProgram=this._spSkyFromAtmosphere,h},n.prototype.isDestroyed=function(){return!1},n.prototype.destroy=function(){var a=this._command;return a.vertexArray=a.vertexArray&&a.vertexArray.destroy(),this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.release(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.release(),c(this)},n}),c("Shaders/SkyBoxFS",[],function(){return"uniform samplerCube u_cubeMap;\nuniform float u_morphTime;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec3 rgb = textureCube(u_cubeMap, normalize(v_texCoord)).rgb;\n    gl_FragColor = vec4(rgb, u_morphTime);\n}\n"}),c("Shaders/SkyBoxVS",[],function(){return"attribute vec3 position;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec3 p = czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n    gl_Position = czm_projection * vec4(p, 1.0);\n    v_texCoord = position.xyz;\n}\n"}),c("Shaders/ViewportQuadFS",[],function(){return"uniform sampler2D u_texture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 c = texture2D(u_texture, v_textureCoordinates);\n    \n    if (c.a == 0.0)\n    {\n        discard;\n    }\n    \n    gl_FragColor = c;\n}"}),c("Shaders/ViewportQuadVS",[],function(){return"attribute vec4 position;\nattribute vec2 textureCoordinates;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    gl_Position = position;\n    v_textureCoordinates = textureCoordinates;\n}"}),c("Scene/ViewportQuad",["../Core/destroyObject","../Core/defaultValue","../Core/BoundingRectangle","../Core/ComponentDatatype","../Core/PrimitiveType","../Renderer/BufferUsage","../Renderer/BlendEquation","../Renderer/BlendFunction","../Renderer/CommandLists","../Renderer/DrawCommand","../Shaders/ViewportQuadVS","../Shaders/ViewportQuadFS"],function(a,b,c,d,e,f,g,h,i,j,k,l){function p(a){var b=o[a.getId()];if(typeof b!="undefined"&&typeof b.vertexArray!="undefined")return++b.referenceCount,b;var c={attributes:{position:{componentDatatype:d.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]},textureCoordinates:{componentDatatype:d.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]}}},e=a.createVertexArrayFromMesh({mesh:c,attributeIndices:n,bufferUsage:f.STATIC_DRAW}),g={vertexArray:e,referenceCount:1,release:function(){return typeof this.vertexArray!="undefined"&&--this.referenceCount===0&&(this.vertexArray=this.vertexArray.destroy()),undefined}};return o[a.getId()]=g,g}var m=function(a,d,f){this.renderState=undefined,this.enableBlending=!1,this._va=undefined,this._overlayCommand=new j,this._overlayCommand.primitiveType=e.TRIANGLE_FAN,this._commandLists=new i,this._commandLists.overlayList.push(this._overlayCommand),this._vertexShaderSource=b(d,k),this._fragmentShaderSource=b(f,l),this._texture=undefined,this._destroyTexture=!0,this._framebuffer=undefined,this._destroyFramebuffer=!1,this._rectangle=c.clone(a);var g=this;this._overlayCommand.uniformMap=this.uniforms={u_texture:function(){return g._texture}}};m.prototype.getRectangle=function(){return this._rectangle},m.prototype.setRectangle=function(a){c.clone(a,this._rectangle)},m.prototype.getTexture=function(){return this._texture},m.prototype.setTexture=function(a){this._texture!==a&&(this._texture=this._destroyTexture&&this._texture&&this._texture.destroy(),this._texture=a)},m.prototype.getDestroyTexture=function(){return this._destroyTexture},m.prototype.setDestroyTexture=function(a){this._destroyTexture=a},m.prototype.getFramebuffer=function(){return this._framebuffer},m.prototype.setFramebuffer=function(a){this._framebuffer!==a&&(this._framebuffer=this._destroyFramebuffer&&this._framebuffer&&this._framebuffer.destroy(),this._framebuffer=a)},m.prototype.getDestroyFramebuffer=function(){return this._destroyFramebuffer},m.prototype.setDestroyFramebuffer=function(a){this._destroyFramebuffer=a};var n={position:0,textureCoordinates:1},o={};return m.prototype.update=function(a,b,c){if(typeof this._texture=="undefined")return;typeof this._overlayCommand.shaderProgram=="undefined"&&(this._overlayCommand.shaderProgram=a.getShaderCache().getShaderProgram(this._vertexShaderSource,this._fragmentShaderSource,n),this._va=p(a),this._overlayCommand.vertexArray=this._va.vertexArray,this.renderState=a.createRenderState({blending:{enabled:!0,equationRgb:g.ADD,equationAlpha:g.ADD,functionSourceRgb:h.SOURCE_ALPHA,functionSourceAlpha:h.SOURCE_ALPHA,functionDestinationRgb:h.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:h.ONE_MINUS_SOURCE_ALPHA}})),this.renderState.blending.enabled=this.enableBlending,this.renderState.viewport=this._rectangle,this._overlayCommand.renderState=this.renderState,this._overlayCommand.framebuffer=this._framebuffer,b.passes.overlay&&c.push(this._commandLists)},m.prototype.isDestroyed=function(){return!1},m.prototype.destroy=function(){return this._va=this._va&&this._va.release(),this._overlayCommand.shaderProgram=this._overlayCommand.shaderProgram&&this._overlayCommand.shaderProgram.release(),this._texture=this._destroyTexture&&this._texture&&this._texture.destroy(),this._framebuffer=this._destroyFramebuffer&&this._framebuffer&&this._framebuffer.destroy(),a(this)},m}),c("Scene/PerformanceDisplay",["../Core/destroyObject","../Core/BoundingRectangle","../Renderer/PixelFormat","./ViewportQuad"],function(a,b,c,d){var e=function(a){typeof a=="undefined"&&(a={}),this._fpsColor=typeof a.fpsColor!="undefined"?a.fpsColor.toCSSColor():"#e52",this._frameTimeColor=typeof a.frameTimeColor!="undefined"?a.frameTimeColor.toCSSColor():"#de3",this._backgroundColor=typeof a.backgroundColor!="undefined"?a.backgroundColor.toCSSColor():"rgba(0, 0, 30, 0.9)",this._font=typeof a.font!="undefined"?a.font:"bold 10px Helvetica,Arial,sans-serif",this._rectangle=typeof a.rectangle!="undefined"?a.rectangle:new b(0,0,80,40),this._canvas=document.createElement("canvas"),this._canvas.width=this._rectangle.width,this._canvas.height=this._rectangle.height,this._canvasContext=this._canvas.getContext("2d"),this._canvasContext.font=this._font,this._canvasContext.lineWidth=1,this._bufferLength=this._rectangle.width,this._frameTimeSamples=new Array(this._bufferLength),this._fpsSamples=new Array(this._bufferLength);for(var c=0;c<this._bufferLength;c++)this._frameTimeSamples[c]=this._fpsSamples[c]=0;this._frameTimeIndex=0,this._fpsIndex=0,this._lastFpsSampleTime=undefined,this._frameCount=0,this._quad=new d(new b(0,0,0,0)),this._quad.enableBlending=!0,this._time=undefined,this._texture=undefined,this._viewportHeight=0};return e.prototype.update=function(a,d,e){if(typeof this._time=="undefined"){this._lastFpsSampleTime=this._time=Date.now();return}var f=this._time,g=this._time=Date.now(),h=g-f;this._frameTimeSamples[this._frameTimeIndex++]=h,this._frameTimeIndex>=this._bufferLength&&(this._frameTimeIndex=0),this._frameCount++;var i=this._fps,j=g-this._lastFpsSampleTime;j>1e3&&(i=this._fps=this._frameCount*1e3/j|0,this._fpsSamples[this._fpsIndex++]=i,this._fpsIndex>=this._bufferLength&&(this._fpsIndex=0),this._lastFpsSampleTime=g,this._frameCount=0);var k=this._canvasContext,l=this._rectangle.width,m=this._rectangle.height;k.clearRect(0,0,l,m),k.fillStyle=this._backgroundColor,k.fillRect(0,0,l,m),typeof i!="undefined"&&(k.fillStyle=this._fpsColor,k.textAlign="left",k.fillText(i+" FPS",1,10)),k.fillStyle=this._frameTimeColor,k.textAlign="right",k.fillText(h+" MS",l-1,10);for(var n=0;n<this._bufferLength;n++)i=this._fpsSamples[(n+this._fpsIndex)%this._bufferLength],i>0&&this._drawLine(this._fpsColor,n,i/100),h=this._frameTimeSamples[(n+this._frameTimeIndex)%this._bufferLength],h>0&&this._drawLine(this._frameTimeColor,n,h/200);typeof this._texture=="undefined"?(this._texture=a.createTexture2D({source:this._canvas,pixelFormat:c.RGBA}),this._quad.setTexture(this._texture)):this._texture.copyFrom(this._canvas);var o=a.getCanvas().clientHeight;o!==this._viewportHeight&&(this._viewportHeight=o,this._quad.setRectangle(new b(this._rectangle.x,o-m-this._rectangle.y,l,m))),this._quad.update(a,d,e)},e.prototype._drawLine=function(a,b,c){var d=this._canvasContext,e=this._rectangle.height,f=e-10;b=.5+b,d.beginPath(),d.strokeStyle=a,d.moveTo(b,e);var g=c*f;g>f&&(g=f);var h=e-g;d.lineTo(b,h),d.stroke()},e.prototype.destroy=function(){return this._quad=this._quad.destroy(),a(this)},e}),c("ThirdParty/Tween",[],function(){var a=a||function(){var b=null,c=60,d=!1,e=[];return{setFPS:function(a){c=a||60},start:function(a){a&&this.setFPS(a),b===null&&(b=setInterval(this.update,1e3/c))},stop:function(){clearInterval(b),b=null},setAutostart:function(a){d=a,d&&e.length&&this.start()},add:function(a){e.push(a),d&&this.start()},getAll:function(){return e},removeAll:function(){e=[]},remove:function(a){var b=e.indexOf(a);b!==-1&&e.splice(b,1)},update:function(b){var c=0,f=e.length,b=b||Date.now();while(c<f)e[c].update(b)?c++:(e.splice(c,1),f--);f===0&&d&&a.stop()}}}();return a.Tween=function(b){var c=b,d={},e={},f={},g=1e3,h=0,i=null,j=a.Easing.Linear.EaseNone,k=null,l=null,m=null;this.to=function(a,b){b!==null&&(g=b);for(var d in a){if(c[d]===null)continue;f[d]=a[d]}return this},this.start=function(b){a.add(this),i=b?b+h:Date.now()+h;for(var g in f){if(c[g]===null)continue;d[g]=c[g],e[g]=f[g]-c[g]}return this},this.stop=function(){return a.remove(this),this},this.delay=function(a){return h=a,this},this.easing=function(a){return j=a,this},this.chain=function(a){return k=a,this},this.onUpdate=function(a){return l=a,this},this.onComplete=function(a){return m=a,this},this.update=function(a){var b,f,h;if(a<i)return!0;f=(a-i)/g,f=f>1?1:f,h=j(f);for(b in e)c[b]=d[b]+e[b]*h;return l!==null&&l.call(c,h),f==1?(m!==null&&m.call(c),k!==null&&k.start(),!1):!0}},a.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},a.Easing.Linear.EaseNone=function(a){return a},a.Easing.Quadratic.EaseIn=function(a){return a*a},a.Easing.Quadratic.EaseOut=function(a){return a*(2-a)},a.Easing.Quadratic.EaseInOut=function(a){return(a*=2)<1?.5*a*a:-0.5*(--a*(a-2)-1)},a.Easing.Cubic.EaseIn=function(a){return a*a*a},a.Easing.Cubic.EaseOut=function(a){return--a*a*a+1},a.Easing.Cubic.EaseInOut=function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)},a.Easing.Quartic.EaseIn=function(a){return a*a*a*a},a.Easing.Quartic.EaseOut=function(a){return 1- --a*a*a*a},a.Easing.Quartic.EaseInOut=function(a){return(a*=2)<1?.5*a*a*a*a:-0.5*((a-=2)*a*a*a-2)},a.Easing.Quintic.EaseIn=function(a){return a*a*a*a*a},a.Easing.Quintic.EaseOut=function(a){return--a*a*a*a*a+1},a.Easing.Quintic.EaseInOut=function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},a.Easing.Sinusoidal.EaseIn=function(a){return 1-Math.cos(a*Math.PI/2)},a.Easing.Sinusoidal.EaseOut=function(a){return Math.sin(a*Math.PI/2)},a.Easing.Sinusoidal.EaseInOut=function(a){return.5*(1-Math.cos(Math.PI*a))},a.Easing.Exponential.EaseIn=function(a){return a===0?0:Math.pow(1024,a-1)},a.Easing.Exponential.EaseOut=function(a){return a===1?1:1-Math.pow(2,-10*a)},a.Easing.Exponential.EaseInOut=function(a){return a===0?0:a===1?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)},a.Easing.Circular.EaseIn=function(a){return 1-Math.sqrt(1-a*a)},a.Easing.Circular.EaseOut=function(a){return Math.sqrt(1- --a*a)},a.Easing.Circular.EaseInOut=function(a){return(a*=2)<1?-0.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},a.Easing.Elastic.EaseIn=function(a){var b,c=.1,d=.4;return a===0?0:a===1?1:(!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d)))},a.Easing.Elastic.EaseOut=function(a){var b,c=.1,d=.4;return a===0?0:a===1?1:(!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin((a-b)*2*Math.PI/d)+1)},a.Easing.Elastic.EaseInOut=function(a){var b,c=.1,d=.4;return a===0?0:a===1?1:(!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-0.5*c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*2*Math.PI/d)*.5+1)},a.Easing.Back.EaseIn=function(a){var b=1.70158;return a*a*((b+1)*a-b)},a.Easing.Back.EaseOut=function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},a.Easing.Back.EaseInOut=function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)},a.Easing.Bounce.EaseIn=function(b){return 1-a.Easing.Bounce.EaseOut(1-b)},a.Easing.Bounce.EaseOut=function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},a.Easing.Bounce.EaseInOut=function(b){return b<.5?a.Easing.Bounce.EaseIn(b*2)*.5:a.Easing.Bounce.EaseOut(b*2-1)*.5+.5},a}),c("Scene/AnimationCollection",["../Core/DeveloperError","../Core/clone","../ThirdParty/Tween"],function(a,b,c){var d=function(){};return d.prototype.add=function(a){var d=a||{};d.duration=typeof d.duration=="undefined"?3e3:d.duration,d.delayDuration=typeof d.delayDuration=="undefined"?0:d.delayDuration,d.easingFunction=typeof d.easingFunction=="undefined"?c.Easing.Linear.EaseNone:d.easingFunction;var e=b(d.startValue),f=new c.Tween(e);return f.to(d.stopValue,d.duration),f.delay(d.delayDuration),f.easing(d.easingFunction),d.onUpdate&&f.onUpdate(function(){d.onUpdate(e)}),f.onComplete(d.onComplete||null),f.start(),{_tween:f}},d.prototype.addAlpha=function(b,d,e,f){if(typeof b=="undefined")throw new a("material is required.");var g=[];for(var h in b.uniforms)b.uniforms.hasOwnProperty(h)&&typeof b.uniforms[h]!="undefined"&&typeof b.uniforms[h].alpha!="undefined"&&g.push(h);if(g.length===0)throw new a("material has no properties with alpha components.");d=typeof d=="undefined"?0:d,e=typeof e=="undefined"?1:e;var i=f||{};i.duration=typeof i.duration=="undefined"?3e3:i.duration,i.delayDuration=typeof i.delayDuration=="undefined"?0:i.delayDuration,i.easingFunction=typeof i.easingFunction=="undefined"?c.Easing.Linear.EaseNone:i.easingFunction;var j={alpha:d},k=new c.Tween(j);return k.to({alpha:e},i.duration),k.delay(i.delayDuration),k.easing(i.easingFunction),k.onUpdate(function(){var a=g.length;for(var c=0;c<a;++c)b.uniforms[g[c]].alpha=j.alpha}),k.onComplete(i.onComplete||null),k.start(),{_tween:k}},d.prototype.addProperty=function(b,d,e,f,g){if(typeof b=="undefined")throw new a("object is required.");if(typeof d=="undefined")throw new a("property is required.");if(typeof b[d]=="undefined")throw new a("object must have the specified property.");var h=g||{};h.duration=typeof h.duration=="undefined"?3e3:h.duration,h.delayDuration=typeof h.delayDuration=="undefined"?0:h.delayDuration,h.easingFunction=typeof h.easingFunction=="undefined"?c.Easing.Linear.EaseNone:h.easingFunction;var i={value:e},j=new c.Tween(i);return j.to({value:f},h.duration),j.delay(h.delayDuration),j.easing(h.easingFunction),j.onUpdate(function(){b[d]=i.value}),j.onComplete(h.onComplete||null),j.start(),{_tween:j}},d.prototype.addOffsetIncrement=function(b,d){if(typeof b=="undefined")throw new a("material is required.");if(typeof b.uniforms.offset=="undefined")throw new a("material must have an offset property.");var e=d||{};e.duration=typeof e.duration=="undefined"?3e3:e.duration,e.delayDuration=typeof e.delayDuration=="undefined"?0:e.delayDuration,e.easingFunction=typeof e.easingFunction=="undefined"?c.Easing.Linear.EaseNone:e.easingFunction;var f={offset:b.uniforms.offset},g=new c.Tween(f);return g.to({offset:b.uniforms.offset+1},e.duration),g.delay(e.delayDuration),g.easing(e.easingFunction),g.onUpdate(function(){b.uniforms.offset=f.offset}),g.onComplete(function(){g.to({offset:b.uniforms.offset+1},e.duration),g.start()}),g.start(),{_tween:g}},d.prototype.remove=function(a){if(typeof a!="undefined"){var b=c.getAll().length;return c.remove(a._tween),c.getAll().length===b-1}return!1},d.prototype.removeAll=function(){c.removeAll()},d.prototype.contains=function(a){return typeof a!="undefined"?c.getAll().indexOf(a)!==-1:!1},d.prototype.update=function(){c.update()},d}),c("Scene/Camera2DController",["../Core/DeveloperError","../Core/destroyObject","../Core/FAR","../Core/Math","../Core/Quaternion","../Core/Matrix3","../Core/Cartesian2","../Core/Cartographic","./CameraEventHandler","./CameraEventType","./CameraHelpers","./AnimationCollection","../ThirdParty/Tween"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=k.move,o=k.maintainInertia,p=k.handleZoom,q=function(b,e,f){if(typeof b=="undefined")throw new a("canvas is required.");if(typeof e=="undefined")throw new a("camera is required.");if(typeof f=="undefined")throw new a("projection is required.");this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this._canvas=b,this._camera=e,this._projection=f,this._zoomRate=1e5,this._moveRate=1e5,this.inertiaTranslate=.9,this.inertiaZoom=.8,this._zoomFactor=1.5,this._translateFactor=1,this._minimumZoomRate=20,this._maximumZoomRate=c,this._translateHandler=new i(b,j.LEFT_DRAG),this._zoomHandler=new i(b,j.RIGHT_DRAG),this._zoomWheel=new i(b,j.WHEEL),this._twistHandler=new i(b,j.MIDDLE_DRAG),this._lastInertiaZoomMovement=undefined,this._lastInertiaTranslateMovement=undefined,this._lastInertiaWheelZoomMovement=undefined,this._frustum=this._camera.frustum.clone(),this._animationCollection=new l,this._zoomAnimation=undefined,this._translateAnimation=undefined,this._frustum=this._camera.frustum.clone(),this._maxCoord=f.project(new h(Math.PI,d.PI_OVER_TWO,0));var g=2,k=this._frustum.top/this._frustum.right;this._frustum.right=this._maxCoord.x*g,this._frustum.left=-this._frustum.right,this._frustum.top=k*this._frustum.right,this._frustum.bottom=-this._frustum.top,this._maxZoomFactor=2.5,this._maxTranslateFactor=1.5};return q.prototype.getProjection=function(){return this._projection},q.prototype.setProjection=function(b){if(typeof b=="undefined")throw new a("projection is required.");this._projection=b,this._maxCoord=b.project(new h(Math.PI,d.toRadians(85.05112878)))},q.prototype.moveUp=function(a){n(this._camera,this._camera.up,a||this._moveRate)},q.prototype.moveDown=function(a){n(this._camera,this._camera.up,-a||-this._moveRate)},q.prototype.moveRight=function(a){n(this._camera,this._camera.right,a||this._moveRate)},q.prototype.moveLeft=function(a){n(this._camera,this._camera.right,-a||-this._moveRate)},q.prototype.zoomIn=function(b){var c=b||this._zoomRate,d=this._camera.frustum;if(typeof d.left=="undefined"||typeof d.right=="undefined"||typeof d.top=="undefined"||typeof d.bottom=="undefined")throw new a("The camera frustum is expected to be orthographic for 2D camera control.");var e=d.right-c,f=d.left+c,g=this._maxCoord.x*this._maxZoomFactor;e>g&&(e=g,f=-e);if(e>f){var h=d.top/d.right;d.right=e,d.left=f,d.top=d.right*h,d.bottom=-d.top}},q.prototype.setPositionCartographic=function(b){if(typeof b=="undefined")throw new a("cartographic is required.");var c=-b.height*.5,d=-c,e=this._camera.frustum;if(d>c){var f=e.top/e.right;e.right=d,e.left=c,e.top=e.right*f,e.bottom=-e.top}g.clone(this._projection.project(b),this._camera.position)},q.prototype.zoomOut=function(a){this.zoomIn(-a||-this._zoomRate)},q.prototype._addCorrectZoomAnimation=function(){var a=this._camera,b=a.frustum,c=b.top,e=b.bottom,f=b.right,g=b.left,h=this._frustum,i=function(b){a.frustum.top=d.lerp(c,h.top,b.time),a.frustum.bottom=d.lerp(e,h.bottom,b.time),a.frustum.right=d.lerp(f,h.right,b.time),a.frustum.left=d.lerp(g,h.left,b.time)};this._zoomAnimation=this._animationCollection.add({easingFunction:m.Easing.Exponential.EaseOut,startValue:{time:0},stopValue:{time:1},onUpdate:i})},q.prototype._addCorrectTranslateAnimation=function(){var a=this._camera,b=a.position,c=b.clone();c.x>this._maxCoord.x?c.x=this._maxCoord.x:c.x<-this._maxCoord.x&&(c.x=-this._maxCoord.x),c.y>this._maxCoord.y?c.y=this._maxCoord.y:c.y<-this._maxCoord.y&&(c.y=-this._maxCoord.y);var d=function(d){a.position=b.lerp(c,d.time)};this._translateAnimation=this._animationCollection.add({easingFunction:m.Easing.Exponential.EaseOut,startValue:{time:0},stopValue:{time:1},onUpdate:d})},q.prototype.update=function(){var a=this._translateHandler,b=this._zoomHandler,c=this._zoomWheel,d=a.isMoving()&&a.getMovement(),e=b.isMoving(),f=c.isMoving();(a.isButtonDown()||b.isButtonDown()||f)&&this._animationCollection.removeAll(),this.enableTranslate&&(d&&this._translate(a.getMovement()),!d&&this.inertiaTranslate<1&&o(a,this.inertiaTranslate,this._translate,this,"_lastInertiaTranslateMovement")),this.enableZoom&&(e?this._zoom(b.getMovement()):f&&this._zoom(c.getMovement()),!e&&this.inertiaZoom<1&&o(b,this.inertiaZoom,this._zoom,this,"_lastInertiaZoomMovement"),!f&&this.inertiaZoom<1&&o(c,this.inertiaZoom,this._zoom,this,"_lastInertiaWheelZoomMovement")),this.enableRotate&&this._twistHandler.isMoving()&&this._twist(this._twistHandler.getMovement());if(!a.isButtonDown()&&!b.isButtonDown()){this._camera.frustum.right>this._frustum.right&&!this._lastInertiaZoomMovement&&!this._animationCollection.contains(this._zoomAnimation)&&this._addCorrectZoomAnimation();var g=this._camera.position,h=g.x<-this._maxCoord.x||g.x>this._maxCoord.x,i=g.y<-this._maxCoord.y||g.y>this._maxCoord.y;(h||i)&&!this._lastInertiaTranslateMovement&&!this._animationCollection.contains(this._translateAnimation)&&this._addCorrectTranslateAnimation()}return this._animationCollection.update(),!0},q.prototype._translate=function(b){var c=this._camera.frustum;if(c.left===null||c.right===null||c.top===null||c.bottom===null)throw new a("The camera frustum is expected to be orthographic for 2D camera control.");var d=this._canvas.clientWidth,e=this._canvas.clientHeight,f=new g;f.x=b.startPosition.x/d*(c.right-c.left)+c.left,f.y=(e-b.startPosition.y)/e*(c.top-c.bottom)+c.bottom;var h=new g;h.x=b.endPosition.x/d*(c.right-c.left)+c.left,h.y=(e-b.endPosition.y)/e*(c.top-c.bottom)+c.bottom;var i=this._camera,j=i.right,k=i.up,l,m,n=f.subtract(h);if(n.x!==0){l=i.position,m=l.add(j.multiplyByScalar(n.x));var o=this._maxCoord.x*this._maxTranslateFactor;m.x>o&&(m.x=o),m.x<-o&&(m.x=-o),i.position=m}if(n.y!==0){l=i.position,m=l.add(k.multiplyByScalar(n.y));var p=this._maxCoord.y*this._maxTranslateFactor;m.y>p&&(m.y=p),m.y<-p&&(m.y=-p),i.position=m}},q.prototype._zoom=function(a){var b=this._camera,c=Math.max(b.frustum.right-b.frustum.left,b.frustum.top-b.frustum.bottom);p(this,a,c)},q.prototype._twist=function(a){var b=this._canvas.clientWidth,c=this._canvas.clientHeight,h=new g;h.x=2/b*a.startPosition.x-1,h.y=2/c*(c-a.startPosition.y)-1,h=h.normalize();var i=new g;i.x=2/b*a.endPosition.x-1,i.y=2/c*(c-a.endPosition.y)-1,i=i.normalize();var j=Math.acos(h.x);h.y<0&&(j=d.TWO_PI-j);var k=Math.acos(i.x);i.y<0&&(k=d.TWO_PI-k);var l=j-k,m=this._camera,n=f.fromQuaternion(e.fromAxisAngle(m.direction,l));m.up=n.multiplyByVector(m.up),m.right=m.direction.cross(m.up)},q.prototype.isDestroyed=function(){return!1},q.prototype.destroy=function(){return this._translateHandler=this._translateHandler&&this._translateHandler.destroy(),this._zoomHandler=this._zoomHandler&&this._zoomHandler.destroy(),this._zoomWheel=this._zoomWheel&&this._zoomWheel.destroy(),this._twistHandler=this._twistHandler&&this._twistHandler.destroy(),b(this)},q}),c("Scene/CameraColumbusViewController",["../Core/destroyObject","../Core/Ellipsoid","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Math","../Core/Matrix4","./CameraEventHandler","./CameraEventType","./CameraSpindleController","./CameraFreeLookController","./CameraHelpers","./AnimationCollection","../ThirdParty/Tween"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=l.maintainInertia,p=l.handleZoom,q=function(a,c,e){this._canvas=a,this._camera=c,this._ellipsoid=e||b.WGS84,this.inertiaTranslate=.9,this.inertiaZoom=.8,this._translateHandler=new h(a,i.LEFT_DRAG),this._rotateHandler=new h(a,i.MIDDLE_DRAG),this._zoomHandler=new h(a,i.RIGHT_DRAG),this._spindleController=new j(a,c,b.UNIT_SPHERE),this._spindleController.constrainedAxis=d.UNIT_Z,this._freeLookController=new k(a,c),this._freeLookController.horizontalRotationAxis=d.UNIT_Z,this._transform=this._camera.transform.clone(),this._lastInertiaTranslateMovement=undefined,this._animationCollection=new m,this._translateAnimation=undefined,this._mapWidth=this._ellipsoid.getRadii().x*Math.PI,this._mapHeight=this._ellipsoid.getRadii().y*f.PI_OVER_TWO};return q.prototype.update=function(){var a=this._translateHandler,b=a.isMoving()&&a.getMovement(),c=this._rotateHandler,d=c.isMoving()&&c.getMovement(),e=this._zoomHandler,f=e&&e.isMoving();d&&this._rotate(c.getMovement());var g=a.isButtonDown()||c.isButtonDown()||c.isButtonDown()||this._freeLookController._handler.isButtonDown();return g&&this._animationCollection.removeAll(),b&&this._translate(a.getMovement()),!b&&this.inertiaTranslate<1&&o(a,this.inertiaTranslate,this._translate,this,"_lastInertiaTranslateMovement"),f&&this._zoom(e.getMovement()),e&&!f&&this.inertiaZoom<1&&o(e,this.inertiaZoom,this._zoom,this,"_lastInertiaZoomMovement"),this._freeLookController.update(),g||this._correctPosition(),this._animationCollection.update(),!0},q.prototype._addCorrectTranslateAnimation=function(a,b,c,f){var g=a.clone();b.y>c?g.y-=b.y-c:b.y<-c&&(g.y+=-c-b.y),b.z>f?g.z-=b.z-f:b.z<-f&&(g.z+=-f-b.z);var h=this._camera,i=function(b){var c=a.lerp(g,b.time),f=new e(c.x,c.y,c.z,1);h.position=d.fromCartesian4(h.getInverseTransform().multiplyByVector(f))};this._translateAnimation=this._animationCollection.add({easingFunction:n.Easing.Exponential.EaseOut,startValue:{time:0},stopValue:{time:1},onUpdate:i})},q.prototype._translate=function(a){var b=this._camera,c=b.direction.dot(d.UNIT_Z)>=0?1:-1,f=b.getPickRay(a.startPosition),g=b.getPickRay(a.endPosition),h=d.fromCartesian4(b.getInverseTransform().multiplyByVector(e.UNIT_X)),i=new e(f.origin.x,f.origin.y,f.origin.z,1);i=d.fromCartesian4(b.getInverseTransform().multiplyByVector(i));var j=new e(f.direction.x,f.direction.y,f.direction.z,0);j=d.fromCartesian4(b.getInverseTransform().multiplyByVector(j));var k=c*h.dot(i)/h.dot(j),l=i.add(j.multiplyByScalar(k));i=new e(g.origin.x,g.origin.y,g.origin.z,1),i=d.fromCartesian4(b.getInverseTransform().multiplyByVector(i)),j=new e(g.direction.x,g.direction.y,g.direction.z,0),j=d.fromCartesian4(b.getInverseTransform().multiplyByVector(j)),k=c*h.dot(i)/h.dot(j);var m=i.add(j.multiplyByScalar(k)),n=l.subtract(m);b.position=b.position.add(n)},q.prototype._correctPosition=function(){var a=this._camera,b=a.position,c=a.direction,f=d.fromCartesian4(a.getInverseTransform().multiplyByVector(e.UNIT_X)),g=-f.dot(b)/f.dot(c),h=b.add(c.multiplyByScalar(g));h=new e(h.x,h.y,h.z,1);var i=a.transform.multiplyByVector(h);this._transform.setColumn(3,i,this._transform);var j=new e(a.position.x,a.position.y,a.position.z,1),k=a.transform.multiplyByVector(j),l=Math.tan(this._camera.frustum.fovy*.5),m=this._camera.frustum.aspectRatio*l,n=k.subtract(i).magnitude(),o=m*n,p=l*n,q=Math.max(o-this._mapWidth,this._mapWidth),r=Math.max(p-this._mapHeight,this._mapHeight);if(k.x<-q||k.x>q||k.y<-r||k.y>r){if(!this._translateHandler.isButtonDown()){var s=i.y<-q||i.y>q,t=i.z<-r||i.z>r;(s||t)&&!this._lastInertiaTranslateMovement&&!this._animationCollection.contains(this._translateAnimation)&&this._addCorrectTranslateAnimation(d.fromCartesian4(k),d.fromCartesian4(i),q,r)}q+=this._mapWidth*.5,i.y>q?k.y-=i.y-q:i.y<-q&&(k.y+=-q-i.y),r+=this._mapHeight*.5,i.z>r?k.z-=i.z-r:i.z<-r&&(k.z+=-r-i.z)}a.position=d.fromCartesian4(a.getInverseTransform().multiplyByVector(k))},q.prototype._rotate=function(a){var b=this._camera,c=b.getPositionWC(),f=b.getUpWC(),g=b.getRightWC(),h=b.getDirectionWC(),i=b.transform;b.transform=this._transform;var j=b.getInverseTransform();b.position=d.fromCartesian4(j.multiplyByPoint(c)),b.up=d.fromCartesian4(j.multiplyByVector(new e(f.x,f.y,f.z,0))),b.right=d.fromCartesian4(j.multiplyByVector(new e(g.x,g.y,g.z,0))),b.direction=d.fromCartesian4(j.multiplyByVector(new e(h.x,h.y,h.z,0))),this._spindleController._rotate(a),c=b.getPositionWC(),f=b.getUpWC(),g=b.getRightWC(),h=b.getDirectionWC(),b.transform=i;var k=b.getInverseTransform();b.position=d.fromCartesian4(k.multiplyByPoint(c)),b.up=d.fromCartesian4(k.multiplyByVector(new e(f.x,f.y,f.z,0))),b.right=d.fromCartesian4(k.multiplyByVector(new e(g.x,g.y,g.z,0))),b.direction=d.fromCartesian4(k.multiplyByVector(new e(h.x,h.y,h.z,0)))},q.prototype._zoom=function(a){p(this._spindleController,a,this._camera.position.z)},q.prototype.isDestroyed=function(){return!1},q.prototype.destroy=function(){return this._rotateHandler=this._rotateHandler&&this._rotateHandler.destroy(),this._translateHandler=this._translateHandler&&this._translateHandler.destroy(),this._zoomHandler=this._zoomHandle&&this._zoomHandler.destroy(),this._spindleController=this._spindleController&&this._spindleController.destroy(),this._freeLookController=this._freeLookController&&this._freeLookController.destroy(),a(this)},q}),c("Scene/CameraControllerCollection",["../Core/DeveloperError","../Core/destroyObject","../Core/Ellipsoid","../Core/Cartographic","./Camera2DController","./CameraFlightController","./CameraSpindleController","./CameraFreeLookController","./CameraColumbusViewController","./CameraCentralBodyController"],function(a,b,c,d,e,f,g,h,i,j){var k=function(a,b){this._controllers=[],this._canvas=b,this._camera=a};return k.prototype.add2D=function(a){var b=new e(this._canvas,this._camera,a);return this._controllers.push(b),b},k.prototype.addSpindle=function(a){var b=new g(this._canvas,this._camera,a);return this._controllers.push(b),b},k.prototype.addFreeLook=function(a){var b=new h(this._canvas,this._camera);return this._controllers.push(b),b},k.prototype.addColumbusView=function(){var a=new i(this._canvas,this._camera);return this._controllers.push(a),a},k.prototype.addFlight=function(a){var b=a||{},e=b.ellipsoid||c.WGS84,g=b.destination||e.cartographicToCartesian(new d(0,0,0)),h=b.duration||4,i=a.complete,j=new f(this._canvas,this._camera,e,g,h,i);return this._controllers.push(j),j},k.prototype.addCentralBody=function(){var a=new j(this._canvas,this._camera);return this._controllers.push(a),a},k.prototype.remove=function(a){if(a){var b=this._controllers,c=b.indexOf(a);if(c!==-1)return b[c].destroy(),b.splice(c,1),!0}return!1},k.prototype.removeAll=function(){var a=this._controllers,b=a.length;for(var c=0;c<b;++c)a[c].destroy();this._controllers=[]},k.prototype.contains=function(a){return a?this._controllers.indexOf(a)!==-1:!1},k.prototype.get=function(b){if(typeof b=="undefined")throw new a("index is required.");return this._controllers[b]},k.prototype.getLength=function(){return this._controllers.length},k.prototype.update=function(){var a=[],b=this._controllers,c=b.length;for(var d=0;d<c;++d)b[d].update()||a.push(d);for(var e=0;e<a.length;++e){var f=a[e];b[f].destroy(),b.splice(f,1)}},k.prototype.isDestroyed=function(){return!1},k.prototype.destroy=function(){return this.removeAll(),b(this)},k}),c("Scene/Camera",["../Core/DeveloperError","../Core/destroyObject","../Core/Math","../Core/Ellipsoid","../Core/IntersectionTests","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Matrix4","../Core/Ray","./CameraControllerCollection","./PerspectiveFrustum"],function(a,b,c,d,e,f,g,h,i,j,k,l){function n(a){var b=a._right,c=a._up,d=a._direction,e=a._position,f=new i(b.x,b.y,b.z,-b.dot(e),c.x,c.y,c.z,-c.dot(e),-d.x,-d.y,-d.z,d.dot(e),0,0,0,1);a._viewMatrix=f.multiply(a._invTransform),a._invViewMatrix=a._viewMatrix.inverseTransformation()}function o(a){var b=a._position,d=!b.equals(a.position);d&&(b=a._position=a.position.clone());var e=a._direction,h=!e.equals(a.direction);h&&(e=a._direction=a.direction.clone());var i=a._up,j=!i.equals(a.up);j&&(i=a._up=a.up.clone());var k=a._right,l=!k.equals(a.right);l&&(k=a._right=a.right.clone());var m=a._transform,o=!m.equals(a.transform);o&&(m=a._transform=a.transform.clone(),a._invTransform=a._transform.inverseTransformation());if(d||o)a._positionWC=f.fromCartesian4(m.multiplyByPoint(b));if(h||o)a._directionWC=f.fromCartesian4(m.multiplyByVector(new g(e.x,e.y,e.z,0)));if(j||o)a._upWC=f.fromCartesian4(m.multiplyByVector(new g(i.x,i.y,i.z,0)));if(l||o)a._rightWC=f.fromCartesian4(m.multiplyByVector(new g(k.x,k.y,k.z,0)));if(h||j||l){var p=e.dot(i.cross(k));if(Math.abs(1-p)>c.EPSILON2){e=a._direction=e.normalize(),a.direction=e.clone();var q=1/i.magnitudeSquared(),r=i.dot(e)*q,s=e.multiplyByScalar(r);i=a._up=i.subtract(s).normalize(),a.up=i.clone(),k=a._right=e.cross(i),a.right=k.clone()}}(d||h||j||l||o)&&n(a)}function p(a,b){var c=a._canvas.clientWidth,d=a._canvas.clientHeight,e=Math.tan(a.frustum.fovy*.5),f=a.frustum.aspectRatio*e,g=a.frustum.near,h=2/c*b.x-1,i=2/d*(d-b.y)-1,k=a.getPositionWC(),l=k.add(a.getDirectionWC().multiplyByScalar(g)),m=a.getRightWC().multiplyByScalar(h*g*f),n=a.getUpWC().multiplyByScalar(i*g*e),o=l.add(m).add(n).subtract(k).normalize();return new j(k,o)}function q(a,b){var c=a._canvas.clientWidth,d=a._canvas.clientHeight,e=2/c*b.x-1;e*=(a.frustum.right-a.frustum.left)*.5;var f=2/d*(d-b.y)-1;f*=(a.frustum.top-a.frustum.bottom)*.5;var g=a.position.clone();return g.x+=e,g.y+=f,new j(g,a.getDirectionWC())}var m=function(b){if(typeof b=="undefined")throw new a("canvas is required.");this.transform=i.IDENTITY.clone(),this._transform=this.transform.clone(),this._invTransform=i.IDENTITY.clone();var e=d.WGS84.getMaximumRadius(),g=(new f(0,-2,1)).normalize().multiplyByScalar(2*e);this.position=g.clone(),this._position=g,this._positionWC=g;var h=f.ZERO.subtract(g).normalize();this.direction=h.clone(),this._direction=h,this._directionWC=h;var j=h.cross(f.UNIT_Z).normalize();this.right=j.clone(),this._right=j,this._rightWC=j;var m=j.cross(h);this.up=m.clone(),this._up=m,this._upWC=m,this.frustum=new l,this.frustum.fovy=c.toRadians(60),this.frustum.aspectRatio=b.clientWidth/b.clientHeight,this._viewMatrix=undefined,this._invViewMatrix=undefined,n(this),this._canvas=b,this._controllers=new k(this,b)};return m.prototype.getControllers=function(){return this._controllers},m.prototype.update=function(){this._controllers.update()},m.prototype.lookAt=function(b,c,d){if(typeof b=="undefined")throw new a("eye is required");if(typeof c=="undefined")throw new a("target is required");if(typeof d=="undefined")throw new a("up is required");this.position=f.clone(b,this.position),this.direction=f.subtract(c,b,this.direction).normalize(this.direction),this.right=f.cross(this.direction,d,this.right).normalize(this.right),this.up=f.cross(this.right,this.direction,this.up)},m.prototype.viewExtent=function(b,e){if(typeof b=="undefined")throw new a("extent is required.");e=typeof e=="undefined"?d.WGS84:e;var g=b.north,i=b.south,j=b.east,k=b.west;k>j&&(j+=c.TWO_PI);var l=e.cartographicToCartesian(new h(j,g)),m=e.cartographicToCartesian(new h(k,i)),n=l.subtract(m),o=m.add(n.normalize().multiplyByScalar(n.magnitude()*.5)),p=e.cartographicToCartesian(new h(k,g)).subtract(o),q=e.cartographicToCartesian(new h(j,i)).subtract(o);l=l.subtract(o),m=m.subtract(o),this.direction=o.negate().normalize(),this.right=this.direction.cross(f.UNIT_Z).normalize(),this.up=this.right.cross(this.direction);var r=Math.max(Math.abs(this.up.dot(p)),Math.abs(this.up.dot(q)),Math.abs(this.up.dot(l)),Math.abs(this.up.dot(m))),s=Math.max(Math.abs(this.right.dot(p)),Math.abs(this.right.dot(q)),Math.abs(this.right.dot(l)),Math.abs(this.right.dot(m))),t=Math.tan(this.frustum.fovy*.5),u=this.frustum.aspectRatio*t,v=Math.max(s/u,r/t);this.position=o.normalize().multiplyByScalar(o.magnitude()+v)},m.prototype.viewExtentColumbusView=function(b,c){if(typeof b=="undefined")throw new a("extent is required.");if(typeof c=="undefined")throw new a("projection is required.");var d=b.north,e=b.south,i=b.east,j=b.west,k=this.transform.setColumn(3,g.UNIT_W),l=c.project(new h(i,d));l=k.multiplyByPoint(l),l=f.fromCartesian4(this.getInverseTransform().multiplyByVector(l));var m=c.project(new h(j,e));m=k.multiplyByPoint(m),m=f.fromCartesian4(this.getInverseTransform().multiplyByVector(m));var n=Math.tan(this.frustum.fovy*.5),o=this.frustum.aspectRatio*n,p=Math.max((l.x-m.x)/o,(l.y-m.y)/n)*.5,q=c.project(new h(.5*(j+i),.5*(d+e),p));q=k.multiplyByPoint(q),this.position=f.fromCartesian4(this.getInverseTransform().multiplyByVector(q)),this.direction=new f(0,1e-4,-0.999),f.UNIT_X.clone(this.right),this.up=this.right.cross(this.direction)},m.prototype.viewExtent2D=function(b,c){if(typeof b=="undefined")throw new a("extent is required.");if(typeof c=="undefined")throw new a("projection is required.");var d=b.north,e=b.south,g=b.east,i=b.west,j=new h(.5*(i+g),.5*(d+e)),k=c.project(new h(g,d)),l=c.project(new h(i,e)),m=Math.abs(k.x-l.x)*.5,n=Math.abs(k.y-l.y)*.5,o=c.project(j);this.position.x=o.x,this.position.y=o.y;var p,q,r=this.frustum.right/this.frustum.top,s=n*r;m>s?(p=m,q=p/r):(q=n,p=s),this.frustum.right=p,this.frustum.left=-p,this.frustum.top=q,this.frustum.bottom=-q,f.UNIT_X.clone(this.right),this.up=this.right.cross(this.direction)},m.prototype.getInverseTransform=function(){return o(this),this._invTransform},m.prototype.getViewMatrix=function(){return o(this),this._viewMatrix},m.prototype.getInverseViewMatrix=function(){return o(this),this._invViewMatrix},m.prototype.getPositionWC=function(){return o(this),this._positionWC},m.prototype.getDirectionWC=function(){return o(this),this._directionWC},m.prototype.getUpWC=function(){return o(this),this._upWC},m.prototype.getRightWC=function(){return o(this),this._rightWC},m.prototype.getPickRay=function(b){if(typeof b=="undefined")throw new a("windowPosition is required.");var c=this.frustum;return typeof c.aspectRatio!="undefined"&&typeof c.fovy!="undefined"&&typeof c.near!="undefined"?p(this,b):q(this,b)},m.prototype.pickEllipsoid=function(b,c){if(typeof b=="undefined")throw new a("windowPosition is required.");c=c||d.WGS84;var f=p(this,b),g=e.rayEllipsoid(f,c);if(!g)return undefined;var h=f.getPoint(g.start);return h},m.prototype.pickMap2D=function(b,d){if(typeof b=="undefined")throw new a("windowPosition is required.");if(typeof d=="undefined")throw new a("projection is required.");var e=q(this,b),f=e.origin;f.z=0;var g=d.unproject(f);return g.latitude<-c.PI_OVER_TWO||g.latitude>c.PI_OVER_TWO||g.longitude<-Math.PI||g.longitude>Math.PI?undefined:d.getEllipsoid().cartographicToCartesian(g)},m.prototype.pickMapColumbusView=function(b,d){if(typeof b=="undefined")throw new a("windowPosition is required.");if(typeof d=="undefined")throw new a("projection is required.");var e=p(this,b),g=-e.origin.x/e.direction.x,h=e.getPoint(g),i=d.unproject(new f(h.y,h.z,0));return i.latitude<-c.PI_OVER_TWO||i.latitude>c.PI_OVER_TWO||i.longitude<-Math.PI||i.longitude>Math.PI?undefined:(h=d.getEllipsoid().cartographicToCartesian(i),h)},m.prototype.clone=function(){var a=new m(this._canvas);return a.position=this.position.clone(),a.direction=this.direction.clone(),a.up=this.up.clone(),a.right=this.right.clone(),a.transform=this.transform.clone(),a.frustum=this.frustum.clone(),a},m.prototype.isDestroyed=function(){return!1},m.prototype.destroy=function(){return this._controllers.destroy(),b(this)},m}),c("Scene/Scene",["../Core/Math","../Core/Color","../Core/defaultValue","../Core/destroyObject","../Core/GeographicProjection","../Core/Ellipsoid","../Core/DeveloperError","../Core/Occluder","../Core/BoundingRectangle","../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Intersect","../Core/IntersectionTests","../Core/Interval","../Core/Matrix4","../Core/JulianDate","../Renderer/Context","../Renderer/ClearCommand","./Camera","./CompositePrimitive","./CullingVolume","./AnimationCollection","./SceneMode","./FrameState","./OrthographicFrustum","./PerspectiveOffCenterFrustum","./FrustumCommands"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function E(a){a.color=!1,a.pick=!1,a.overlay=!1}function F(a,b,c){var d=a._camera,e=a._frameState;e.mode=a.mode,e.morphTime=a.morphTime,e.scene2D=a.scene2D,e.frameNumber=b,e.time=c,e.camera=d,e.cullingVolume=d.frustum.computeCullingVolume(d.getPositionWC(),d.getDirectionWC(),d.getUpWC()),e.occluder=undefined;var f=a._primitives.getCentralBody();if(a.mode===y.SCENE3D&&typeof f!="undefined"){var g=f.getEllipsoid(),i=new h(new j(l.ZERO,g.getMinimumRadius()),d.getPositionWC());e.occluder=i}E(e.passes)}function G(b,c){var d=b.getUniformState(),e=b._camera;b._shaderFrameCount++===120&&(b._shaderFrameCount=0,b._context.getShaderCache().destroyReleasedShaderPrograms()),b._animations.update(),e.update();var f=a.incrementWrap(d.getFrameNumber(),15e6,1);F(b,f,c),b._frameState.passes.color=!0,b._frameState.passes.overlay=!0,d.update(b._frameState),b._animate&&b._animate(),b._commandList.length=0,b._primitives.update(b._context,b._frameState,b._commandList)}function H(a,b,c,d,e){e.length=d;for(var f=0;f<d;++f){var g=Math.max(a,Math.pow(c,f)*a),h=Math.min(b,c*g);g*=.99;var i=e[f];typeof i=="undefined"?i=e[f]=new C(g,h):(i.near=g,i.far=h)}}function I(a,b,c){var d=a._frustumCommandsList,e=d.length;for(var f=0;f<e;++f){var g=d[f],h=g.near,i=g.far;if(typeof c!="undefined"){if(c.start>i)continue;if(c.stop<h)break}g.commands.push(b)}}function L(a,b){var d=a._commandList,e=a._frameState.cullingVolume,f=a._camera,g=f.getDirectionWC(),h=f.getPositionWC(),i=a._frustumCommandsList,j=i.length;for(var k=0;k<j;++k)i[k].commands.length=0;var l=Number.MAX_VALUE,m=Number.MIN_VALUE,o=!1,p;a._frameState.mode===y.SCENE3D&&(p=a._frameState.occluder);var r=J.planes;for(var s=0;s<5;++s)r[s]=e.planes[s];e=J;var u=d.length;for(var v=0;v<u;++v){var w=d[v][b],x=w.length;for(var z=0;z<x;++z){var A=w[z],B=A.boundingVolume;if(typeof B!="undefined"){var C=c(A.modelMatrix,q.IDENTITY),D=B.transform(C);if(e.getVisibility(D)===n.OUTSIDE||typeof p!="undefined"&&!p.isBoundingSphereVisible(D))continue;K=D.getPlaneDistances(h,g,K),l=Math.min(l,K.start),m=Math.max(m,K.stop),I(a,A,K)}else o=!(A instanceof t),I(a,A)}}o?(l=f.frustum.near,m=f.frustum.far):(l=Math.max(l,f.frustum.near),m=Math.min(m,f.frustum.far));var E=a.farToNearRatio,F=Math.ceil(Math.log(m/l)/Math.log(E));l!==Number.MAX_VALUE&&(F!==j||i.length!==0&&(l<i[0].near||m>i[j-1].far))&&(H(l,m,E,F,i),L(a,b))}function M(a,b){var c=a._camera,d=c.frustum.clone(),e=a._context,f=e.getUniformState(),g=typeof a.skyBox!="undefined"?a.skyBox.update(e,a._frameState):undefined,h=typeof a.skyAtmosphere!="undefined"?a.skyAtmosphere.update(e,a._frameState):undefined;a._clearColorCommand.execute(e,b),d.near=c.frustum.near,d.far=c.frustum.far,f.updateFrustum(d),typeof g!="undefined"&&g.execute(e,b),typeof h!="undefined"&&h.execute(e,b);var i=a._clearDepthStencilCommand,j=a._frustumCommandsList,k=j.length;for(var l=0;l<k;++l){i.execute(e,b);var m=k-l-1,n=j[m];d.near=n.near,d.far=n.far,f.updateFrustum(d);var o=n.commands,p=o.length;for(var q=0;q<p;++q)o[q].execute(e,b)}}function N(a){var b=a._context,c=a._commandList,d=c.length;for(var e=0;e<d;++e){var f=c[e].overlayList,g=f.length;for(var h=0;h<g;++h)f[h].execute(b)}}function P(a,b,c,d){var e=a._canvas,f=a._camera,g=f.frustum,h=e.clientWidth,i=e.clientHeight,j=2/h*b.x-1;j*=(g.right-g.left)*.5;var m=2/i*(i-b.y)-1;m*=(g.top-g.bottom)*.5;var n=f.position;n=new l(n.z,n.x,n.y),n.y+=j,n.z+=m;var o=g.getPixelSize(new k(h,i)),p=O;return p.right=o.x*.5,p.left=-p.right,p.top=o.y*.5,p.bottom=-p.top,p.near=g.near,p.far=g.far,p.computeCullingVolume(n,f.getDirectionWC(),f.getUpWC())}function R(a,b,c,d){var e=a._canvas,f=a._camera,g=f.frustum,h=g.near,i=e.clientWidth,j=e.clientHeight,l=Math.tan(g.fovy*.5),m=g.aspectRatio*l,n=2/i*b.x-1,o=2/j*(j-b.y)-1,p=n*h*m,q=o*h*l,r=g.getPixelSize(new k(i,j)),s=r.x*c*.5,t=r.y*d*.5,u=Q;return u.top=q+t,u.bottom=q-t,u.right=p+s,u.left=p-s,u.near=h,u.far=g.far,u.computeCullingVolume(f.getPositionWC(),f.getDirectionWC(),f.getUpWC())}function S(a,b,c,d){return a.mode===y.SCENE2D?P(a,b,c,d):R(a,b,c,d)}var D=function(a){var c=new s(a);this._frameState=new z,this._canvas=a,this._context=c,this._primitives=new v,this._pickFramebuffer=undefined,this._camera=new u(a),this._animate=undefined,this._animations=new x,this._shaderFrameCount=0,this._commandList=[],this._frustumCommandsList=[],this._clearColorCommand=new t,this._clearColorCommand.clearState=c.createClearState({color:b.BLACK}),this._clearDepthStencilCommand=new t,this._clearDepthStencilCommand.clearState=c.createClearState({depth:1,stencil:0}),this.skyBox=undefined,this.skyAtmosphere=undefined,this.mode=y.SCENE3D,this.scene2D={projection:new e(f.WGS84)},this.morphTime=1,this.farToNearRatio=1e3;var d=this._camera.frustum.near,g=this._camera.frustum.far,h=Math.ceil(Math.log(g/d)/Math.log(this.farToNearRatio));H(d,g,this.farToNearRatio,h,this._frustumCommandsList)};D.prototype.getCanvas=function(){return this._canvas},D.prototype.getContext=function(){return this._context},D.prototype.getPrimitives=function(){return this._primitives},D.prototype.getCamera=function(){return this._camera},D.prototype.getUniformState=function(){return this._context.getUniformState()},D.prototype.getFrameState=function(){return this._frameState},D.prototype.getAnimations=function(){return this._animations},D.prototype.setAnimation=function(a){this._animate=a},D.prototype.getAnimation=function(){return this._animate};var J=new w,K=new p;D.prototype.render=function(a){typeof a=="undefined"&&(a=new r),G(this,a),L(this,"colorList"),M(this),N(this)};var O=new A,Q=new B,T=3,U=3,V=new i(0,0,T,U);return D.prototype.pick=function(a){var b=this._context,c=this._primitives,d=this._frameState;this._pickFramebuffer=this._pickFramebuffer||b.createPickFramebuffer();var e=this._pickFramebuffer.begin();F(this),d.cullingVolume=S(this,a,T,U),d.passes.pick=!0;var f=this._commandList;return f.length=0,c.update(b,d,f),L(this,"pickList"),M(this,e),V.x=a.x-(T-1)*.5,V.y=this._canvas.clientHeight-a.y-(U-1)*.5,this._pickFramebuffer.end(V)},D.prototype.pickEllipsoid=function(a,b){if(typeof a=="undefined")throw new g("windowPosition is required.");b=b||f.WGS84;var c;return this.mode===y.SCENE3D?c=this._camera.pickEllipsoid(a,b):this.mode===y.SCENE2D?c=this._camera.pickMap2D(a,this.scene2D.projection):this.mode===y.COLUMBUS_VIEW&&(c=this._camera.pickMapColumbusView(a,this.scene2D.projection)),c},D.prototype.viewExtent=function(a,b){if(typeof a=="undefined")throw new g("extent is required.");b=b||f.WGS84,this.mode===y.SCENE3D?this._camera.viewExtent(a,b):this.mode===y.SCENE2D?this._camera.viewExtent2D(a,this.scene2D.projection):this.mode===y.COLUMBUS_VIEW&&this._camera.viewExtentColumbusView(a,this.scene2D.projection)},D.prototype.isDestroyed=function(){return!1},D.prototype.destroy=function(){return this._camera=this._camera&&this._camera.destroy(),this._pickFramebuffer=this._pickFramebuffer&&this._pickFramebuffer.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._context=this._context&&this._context.destroy(),d(this)},D}),c("Scene/SceneTransitioner",["../Core/destroyObject","../Core/Math","../Core/EventHandler","../Core/MouseEventType","../Core/Ellipsoid","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Matrix4","../ThirdParty/Tween","./OrthographicFrustum","./PerspectiveFrustum","./SceneMode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function p(a,b){a.morphTime=b;var c=a.getPrimitives();for(var d=0,e=c.getLength();d<e;d++){var f=c.get(d);typeof f.morphTime!="undefined"&&(f.morphTime=b)}var g=c.getCentralBody();g.morphTime=b,typeof a.skyBox!="undefined"&&(a.skyBox.morphTime=b),typeof a.skyAtmosphere!="undefined"&&(a.skyAtmosphere.morphTime=b)}function q(a,b,c,d,e,f){var g={duration:e,easingFunction:k.Easing.Quartic.EaseOut},h=b.getPrimitives(),i=b.getAnimations(),j;for(var l=0,m=h.getLength();l<m;l++){var n=h.get(l);typeof n.morphTime!="undefined"&&(j=i.addProperty(n,"morphTime",c,d,g),a._currentAnimations.push(j))}var o=h.getCentralBody();j=i.addProperty(o,"morphTime",c,d,g),a._currentAnimations.push(j),typeof b.skyBox!="undefined"&&(j=i.addProperty(b.skyBox,"morphTime",c,d,g),a._currentAnimations.push(j)),typeof b.skyAtmosphere!="undefined"&&(j=i.addProperty(b.skyAtmosphere,"morphTime",c,d,g),a._currentAnimations.push(j)),typeof f!="undefined"&&(g.onComplete=function(){f.call(a)}),j=i.addProperty(b,"morphTime",c,d,g),a._currentAnimations.push(j)}function r(a){var b=a._scene,c=b.getCanvas(),d=c.clientHeight/c.clientWidth,e=a._camera2D.frustum;e.top=e.right*d,e.bottom=-e.top,d=1/d,e=a._cameraCV.frustum,e.aspectRatio=d,e=a._camera3D.frustum,e.aspectRatio=d;var f=b.getCamera();switch(b.mode){case n.SCENE3D:f.frustum=a._camera3D.frustum.clone();break;case n.COLUMBUS_VIEW:f.frustum=a._cameraCV.frustum.clone();break;case n.SCENE2D:f.frustum=a._camera2D.frustum.clone()}}var o=function(a,c){this._scene=a,this._ellipsoid=c||e.WGS84;var d=a.getCanvas(),f=this._ellipsoid.getMaximumRadius(),h=new g(0,0,2*f),i=h.negate().normalize(),k=g.UNIT_Y,n=new l;n.right=f*Math.PI,n.left=-n.right,n.top=n.right*(d.clientHeight/d.clientWidth),n.bottom=-n.top;var o=new j(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);this._camera2D={position:h,direction:i,up:k,frustum:n,transform:o},h=(new g(0,-1,1)).normalize().multiplyByScalar(5*f),i=g.ZERO.subtract(h).normalize();var p=i.cross(g.UNIT_Z).normalize();k=p.cross(i),n=new m,n.fovy=b.toRadians(60),n.aspectRatio=d.clientWidth/d.clientHeight,this._cameraCV={position:h,direction:i,up:k,frustum:n,transform:o},h=(new g(0,-2,1)).normalize().multiplyByScalar(2*f),i=g.ZERO.subtract(h).normalize(),p=i.cross(g.UNIT_Z).normalize(),k=p.cross(i),this._camera3D={position:h,direction:i,up:k,frustum:n},this._currentAnimations=[],this._morphHandler=undefined,this._morphCancelled=!1,this.morphDuration2D=3e3,this.morphDuration3D=3e3,this.morphDurationColumbusView=3e3,this.endMorphOnMouseInput=!0};return o.prototype.to2D=function(){var a=this._scene;if(a.mode!==n.SCENE2D){a.mode=n.SCENE2D,p(a,0),this._destroyMorphHandler(),r(this);var b=a.getCamera();b.transform=this._camera2D.transform.clone();var c=b.getControllers();c.removeAll(),c.add2D(a.scene2D.projection),b.position=this._camera2D.position.clone(),b.direction=this._camera2D.direction.clone(),b.up=this._camera2D.up.clone()}},o.prototype.toColumbusView=function(){var a=this._scene,b=a.mode;if(a.mode!==n.COLUMBUS_VIEW){a.mode=n.COLUMBUS_VIEW,p(a,0),this._destroyMorphHandler(),r(this);var c=a.getCamera();c.transform=this._cameraCV.transform.clone();var d=c.getControllers();d.removeAll(),d.addColumbusView();if(b!==n.MORPHING||this._morphCancelled)this._morphCancelled=!1,c.position=this._cameraCV.position.clone(),c.direction=this._cameraCV.direction.clone(),c.up=this._cameraCV.up.clone(),c.right=c.direction.cross(c.up)}},o.prototype.to3D=function(){var a=this._scene,b=a.mode;if(a.mode!==n.SCENE3D){a.mode=n.SCENE3D,p(a,1),this._destroyMorphHandler();var c=a.getCamera(),d=c.getControllers();d.removeAll(),d.addCentralBody(),r(this),c.transform=j.IDENTITY.clone();if(b!==n.MORPHING||this._morphCancelled)this._morphCancelled=!1,c.position=this._camera3D.position.clone(),c.direction=this._camera3D.direction.clone(),c.up=this._camera3D.up.clone()}},o.prototype._createMorphHandler=function(a){var b=this,e=this._scene.getCamera().getControllers();e.removeAll();if(this.endMorphOnMouseInput){this._morphHandler=new c(this._scene.getCanvas());var f=function(){b._morphCancelled=!0,a.call(b)};this._morphHandler.setMouseAction(f,d.LEFT_DOWN),this._morphHandler.setMouseAction(f,d.MIDDLE_DOWN),this._morphHandler.setMouseAction(f,d.RIGHT_DOWN),this._morphHandler.setMouseAction(f,d.WHEEL)}},o.prototype._destroyMorphHandler=function(){var a=this._scene.getAnimations();for(var b=0;b<this._currentAnimations.length;++b)a.remove(this._currentAnimations[b]);this._currentAnimations.length=0,this._morphHandler=this._morphHandler&&this._morphHandler.destroy()},o.prototype._changeCameraTransform=function(a,b){var c=new h(a.position.x,a.position.y,a.position.z,1),d=new h(a.direction.x,a.direction.y,a.direction.z,0),e=new h(a.up.x,a.up.y,a.up.z,0),f=b.inverseTransformation().multiply(a.transform);a.transform=b.clone(),a.position=g.fromCartesian4(f.multiplyByVector(c)),a.direction=g.fromCartesian4(f.multiplyByVector(d)),a.up=g.fromCartesian4(f.multiplyByVector(e)),a.right=a.direction.cross(a.up)},o.prototype._columbusViewMorph=function(a,b,c){return a.lerp(b,c)},o.prototype._scenePerspectiveToOrthographic=function(a,c){var d=this,e=this._scene,f=e.getCamera(),g=f.position,h=f.frustum.fovy,i=b.RADIANS_PER_DEGREE*.5,j=g.magnitude()*Math.tan(h*.5);f.frustum.far=j/Math.tan(i*.5)+1e7;var l=function(a){f.frustum.fovy=b.lerp(h,i,a.time);var c=j/Math.tan(f.frustum.fovy*.5);f.position=f.position.normalize().multiplyByScalar(c)},m=e.getAnimations().add({duration:a,easingFunction:k.Easing.Quartic.EaseOut,startValue:{time:0},stopValue:{time:1},onUpdate:l,onComplete:function(){f.frustum=d._camera2D.frustum.clone(),c.call(d)}});this._currentAnimations.push(m)},o.prototype._sceneCVTo2D=function(a,b){var c=this,d=this._scene,e=d.getCamera(),f=this._ellipsoid.getMaximumRadius();this._changeCameraTransform(e,this._cameraCV.transform);var g=e.position.clone(),h=e.direction.clone(),i=e.up.clone(),j=Math.tan(this._cameraCV.frustum.fovy*.5),l=this._cameraCV.frustum.aspectRatio*j,m=f*Math.PI/l,n=this._camera2D.position.normalize().multiplyByScalar(m),o=c._camera2D.direction.clone(),p=c._camera2D.up.clone(),q=function(a){e.position=c._columbusViewMorph(g,n,a.time),e.direction=c._columbusViewMorph(h,o,a.time),e.up=c._columbusViewMorph(i,p,a.time),e.right=e.direction.cross(e.up)};a*=.5;var r=d.getAnimations().add({duration:a,easingFunction:k.Easing.Quartic.EaseOut,startValue:{time:0},stopValue:{time:1},onUpdate:q,onComplete:function(){c._scenePerspectiveToOrthographic(a,b)}});this._currentAnimations.push(r)},o.prototype._scene3DTo2D=function(a,b){a*=.5;var c=this._ellipsoid.getMaximumRadius(),d=Math.tan(this._camera3D.frustum.fovy*.5),e=this._camera3D.frustum.aspectRatio*d,f=c*Math.PI/e,g={};g.position=this._camera2D.position.normalize().multiplyByScalar(f),g.direction=this._camera2D.direction.clone(),g.up=this._camera2D.up.clone();var h=function(){this._scenePerspectiveToOrthographic(a,b)};this._scene3DToCV(a,g,h)},o.prototype._sceneOrthographicToPerspective=function(a,c){var d=this,e=this._scene,g=e.getCamera(),h=this._ellipsoid.getMaximumRadius(),i=Math.tan(this._cameraCV.frustum.fovy*.5),j=this._cameraCV.frustum.aspectRatio*i,l=h*Math.PI/j,m=this._camera2D.position.normalize().multiplyByScalar(l),n=g.frustum.top,o=g.frustum.bottom,p=g.frustum.right,q=g.frustum.left,r=this._camera2D.frustum,s=this._cameraCV.frustum,t=g.position.clone(),u=function(a){g.position=d._columbusViewMorph(t,m,a.time),g.frustum.top=b.lerp(n,r.top,a.time),g.frustum.bottom=b.lerp(o,r.bottom,a.time),g.frustum.right=b.lerp(p,r.right,a.time),g.frustum.left=b.lerp(q,r.left,a.time)},v=(p-q)/(2*h*Math.PI),w=1;v>w&&(v=0);var x=(w-v)*a;x===0&&f.magnitude(f.subtract(t,m,t))!==0&&(x=a,v=0,w=1);var y=e.getAnimations().add({easingFunction:k.Easing.Quartic.EaseOut,duration:x,startValue:{time:v},stopValue:{time:w},onUpdate:u,onComplete:function(){g.frustum=s.clone(),c.call(d)}});this._currentAnimations.push(y)},o.prototype._scene2DToCV=function(a,b){var c=this,d=this._scene,e=d.getCamera();a*=.5;var f=function(){var f=e.position.clone(),g=e.direction.clone(),h=e.up.clone(),i=c._cameraCV.position.clone(),j=c._cameraCV.direction.clone(),l=c._cameraCV.up.clone(),m=function(a){e.position=c._columbusViewMorph(f,i,a.time),e.direction=c._columbusViewMorph(g,j,a.time),e.up=c._columbusViewMorph(h,l,a.time),e.right=e.direction.cross(e.up)},n=d.getAnimations().add({duration:a,easingFunction:k.Easing.Quartic.EaseOut,startValue:{time:0},stopValue:{time:1},onUpdate:m,onComplete:function(){b.call(c)}});c._currentAnimations.push(n)};this._sceneOrthographicToPerspective(a,f)},o.prototype._scene3DToCV=function(a,b,c){var d=this,e=this._scene,f=e.getCamera();this._changeCameraTransform(f,this._cameraCV.transform);var g=f.position.clone(),h=f.direction.clone(),i=f.up.clone(),j=b.position.clone(),l=b.direction.clone(),m=b.up.clone(),n=function(a){f.position=d._columbusViewMorph(g,j,a.time),f.direction=d._columbusViewMorph(h,l,a.time),f.up=d._columbusViewMorph(i,m,a.time),f.right=f.direction.cross(f.up)},o=e.getAnimations().add({duration:a,easingFunction:k.Easing.Quartic.EaseOut,startValue:{time:0},stopValue:{time:1},onUpdate:n,onComplete:function(){f.position=j,f.direction=l,f.up=m}});this._currentAnimations.push(o),q(this,e,1,0,a,c)},o.prototype._scene2DTo3D=function(a,b){a*=.5;var c=this._scene.getCamera();this._sceneOrthographicToPerspective(a,function(){c.frustum=this._cameraCV.frustum.clone(),c.transform=this._cameraCV.transform.clone(),this._sceneCVTo3D(a,b)})},o.prototype._sceneCVTo3D=function(a,b){var c=this._scene,d=this,e=c.getCamera();this._changeCameraTransform(e,j.IDENTITY);var f=e.position,h=e.direction,l=e.up,m=this._ellipsoid.getMaximumRadius(),n=this._ellipsoid.cartographicToCartesian(new i(0,0,10));n=n.normalize().multiplyByScalar(2*m);var o=g.ZERO.subtract(n).normalize(),p=o.cross(g.UNIT_Z).normalize(),r=p.cross(o),s=function(a){e.position=d._columbusViewMorph(f,n,a.time),e.direction=d._columbusViewMorph(h,o,a.time),e.up=d._columbusViewMorph(l,r,a.time),e.right=e.direction.cross(e.up)},t=c.getAnimations().add({duration:a,easingFunction:k.Easing.Quartic.EaseOut,startValue:{time:0},stopValue:{time:1},onUpdate:s});this._currentAnimations.push(t),q(this,c,0,1,a,b)},o.prototype.morphTo2D=function(){var a=this._scene.mode;if(a===n.SCENE2D||a===n.MORPHING)return;r(this),this._scene.mode=n.MORPHING,this._createMorphHandler(this.to2D),a===n.COLUMBUS_VIEW?this._sceneCVTo2D(this.morphDuration2D,this.to2D):this._scene3DTo2D(this.morphDuration2D,this.to2D)},o.prototype.morphToColumbusView=function(){var a=this._scene.mode;if(a===n.COLUMBUS_VIEW||a===n.MORPHING)return;r(this),this._scene.mode=n.MORPHING,this._createMorphHandler(this.toColumbusView),a===n.SCENE2D?this._scene2DToCV(this.morphDurationColumbusView,this.toColumbusView):this._scene3DToCV(this.morphDurationColumbusView,this._cameraCV,this.toColumbusView)},o.prototype.morphTo3D=function(){var a=this._scene,b=a.mode;if(b===n.SCENE3D||b===n.MORPHING)return;r(this),a.mode=n.MORPHING,this._createMorphHandler(this.to3D),b===n.SCENE2D?this._scene2DTo3D(this.morphDuration3D,this.to3D):this._sceneCVTo3D(this.morphDuration3D,this.to3D)},o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){return this._destroyMorphHandler(),a(this)},o}),c("ThirdParty/Uri",[],function(){function e(b){if(b instanceof e)this.scheme=b.scheme,this.authority=b.authority,this.path=b.path,this.query=b.query,this.fragment=b.fragment;else if(b){var c=a.exec(b);this.scheme=c[1],this.authority=c[2],this.path=c[3],this.query=c[4],this.fragment=c[5]}}function f(a){var b=unescape(a);return c.test(b)?b:a.toUpperCase()}function g(a,b,c,d){return(b||"")+c.toLowerCase()+(d||"")}var a=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$"),b=/%[0-9a-z]{2}/gi,c=/[a-zA-Z0-9\-\._~]/,d=/(.*@)?([^@:]*)(:.*)?/;e.prototype.scheme=null,e.prototype.authority=null,e.prototype.path="",e.prototype.query=null,e.prototype.fragment=null,e.prototype.getScheme=function(){return this.scheme},e.prototype.getAuthority=function(){return this.authority},e.prototype.getPath=function(){return this.path},e.prototype.getQuery=function(){return this.query},e.prototype.getFragment=function(){return this.fragment},e.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},e.prototype.isSameDocumentAs=function(a){return a.scheme===this.scheme&&a.authority===this.authority&&a.path===this.path&&a.query===this.query},e.prototype.equals=function(a){return this.isSameDocumentAs(a)&&a.fragment===this.fragment},e.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(d,g).replace(b,f)),this.path&&(this.path=this.path.replace(b,f)),this.query&&(this.query=this.query.replace(b,f)),this.fragment&&(this.fragment=this.fragment.replace(b,f))},e.prototype.resolve=function(a){var b=new e;return this.scheme?(b.scheme=this.scheme,b.authority=this.authority,b.path=this.path,b.query=this.query):(b.scheme=a.scheme,this.authority?(b.authority=this.authority,b.path=this.path,b.query=this.query):(b.authority=a.authority,this.path===""?(b.path=a.path,b.query=this.query||a.query):(this.path.charAt(0)==="/"?(b.path=this.path,b.removeDotSegments()):(a.authority&&a.path===""?b.path="/"+this.path:b.path=a.path.substring(0,a.path.lastIndexOf("/")+1)+this.path,b.removeDotSegments()),b.query=this.query))),b.fragment=this.fragment,b},e.prototype.removeDotSegments=function(){var a=this.path.split("/"),b=[],c,d=a[0]==="";d&&a.shift(),a[0]===""&&a.shift();while(a.length)c=a.shift(),c===".."?b.pop():c!=="."&&b.push(c);(c==="."||c==="..")&&b.push(""),d&&b.unshift(""),this.path=b.join("/")};var h={};return e.resolve=function(a,b){var c=h[a];typeof c=="undefined"&&(h[a]=new e(a));var d=h[b]||(h[b]=new e(b));return c.resolve(d).toString()},e.prototype.toString=function(){var a="";return this.scheme&&(a+=this.scheme+":"),this.authority&&(a+="//"+this.authority),a+=this.path,this.query&&(a+="?"+this.query),this.fragment&&(a+="#"+this.fragment),a},e}),c("DynamicScene/CzmlImage",["../ThirdParty/Uri"],function(a){var b={unwrapInterval:function(b,c){var d=typeof b.image=="undefined"?b:b.image;if(typeof c!="undefined"){var e=new a(document.location.href);c=new a(c),d=(new a(d)).resolve(c.resolve(e)).toString()}return d},isSampled:function(){return!1},getValue:function(a){return a}};return b}),c("DynamicScene/DynamicBillboard",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlCartesian2","./CzmlCartesian3","./CzmlNumber","./CzmlImage","./CzmlHorizontalOrigin","./CzmlVerticalOrigin","./CzmlColor","./DynamicProperty"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(){this.image=undefined,this.scale=undefined,this.horizontalOrigin=undefined,this.verticalOrigin=undefined,this.color=undefined,this.eyeOffset=undefined,this.pixelOffset=undefined,this.show=undefined};return l.processCzmlPacket=function(b,m,n,o){var p=m.billboard;if(typeof p=="undefined")return!1;var q=!1,r=b.billboard;q=typeof r=="undefined",q&&(b.billboard=r=new l);var s=p.interval;typeof s!="undefined"&&(s=a.fromIso8601(s));if(typeof p.color!="undefined"){var t=r.color;typeof t=="undefined"&&(r.color=t=new k(j),q=!0),t.processCzmlIntervals(p.color,s)}if(typeof p.eyeOffset!="undefined"){var u=r.eyeOffset;typeof u=="undefined"&&(r.eyeOffset=u=new k(e),q=!0),u.processCzmlIntervals(p.eyeOffset,s)}if(typeof p.horizontalOrigin!="undefined"){var v=r.horizontalOrigin;typeof v=="undefined"&&(r.horizontalOrigin=v=new k(h),q=!0),v.processCzmlIntervals(p.horizontalOrigin,s)}if(typeof p.image!="undefined"){var w=r.image;typeof w=="undefined"&&(r.image=w=new k(g),q=!0),w.processCzmlIntervals(p.image,s,o)}if(typeof p.pixelOffset!="undefined"){var x=r.pixelOffset;typeof x=="undefined"&&(r.pixelOffset=x=new k(d),q=!0),x.processCzmlIntervals(p.pixelOffset,s)}if(typeof p.scale!="undefined"){var y=r.scale;typeof y=="undefined"&&(r.scale=y=new k(f),q=!0),y.processCzmlIntervals(p.scale,s)}if(typeof p.show!="undefined"){var z=r.show;typeof z=="undefined"&&(r.show=z=new k(c),q=!0),z.processCzmlIntervals(p.show,s)}if(typeof p.verticalOrigin!="undefined"){var A=r.verticalOrigin;typeof A=="undefined"&&(r.verticalOrigin=A=new k(i),q=!0),A.processCzmlIntervals(p.verticalOrigin,s)}return q},l.mergeProperties=function(a,c){var d=c.billboard;if(typeof d!="undefined"){var e=a.billboard;typeof e=="undefined"&&(a.billboard=e=new l),e.color=b(e.color,d.color),e.eyeOffset=b(e.eyeOffset,d.eyeOffset),e.horizontalOrigin=b(e.horizontalOrigin,d.horizontalOrigin),e.image=b(e.image,d.image),e.pixelOffset=b(e.pixelOffset,d.pixelOffset),e.scale=b(e.scale,d.scale),e.show=b(e.show,d.show),e.verticalOrigin=b(e.verticalOrigin,d.verticalOrigin)}},l.undefineProperties=function(a){a.billboard=undefined},l}),c("ThirdParty/measureText",[],function(){var a=function(a,b){return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)};return function(b,c){var d=b.measureText(c),e=a(b.canvas,"font-family"),f=a(b.canvas,"font-size").replace("px",""),g=!/\S/.test(c);d.fontsize=f;var h=document.createElement("div");h.style.position="absolute",h.style.opacity=0,h.style.font=f+"px "+e,h.innerHTML=c+"<br/>"+c,document.body.appendChild(h),d.leading=1.2*f;var i=a(h,"height");i=i.replace("px",""),i>=f*2&&(d.leading=i/2|0),document.body.removeChild(h);if(!g){var j=document.createElement("canvas"),k=100;j.width=d.width+k,j.height=3*f,j.style.opacity=1,j.style.fontFamily=e,j.style.fontSize=f;var l=j.getContext("2d");l.font=f+"px "+e;var m=j.width,n=j.height,o=n/2;l.fillStyle="white",l.fillRect(-1,-1,m+2,n+2),l.fillStyle="black",l.fillText(c,k/2,o);var p=l.getImageData(0,0,m,n).data,q=0,r=m*4,s=p.length;while(++q<s&&p[q]===255);var t=q/r|0;q=s-1;while(--q>0&&p[q]===255);var u=q/r|0;for(q=0;q<s&&p[q]===255;)q+=r,q>=s&&(q=q-s+4);var v=q%r/4|0,w=1;for(q=s-3;q>=0&&p[q]===255;)q-=r,q<0&&(q=s-3-w++*4);var x=q%r/4+1|0;d.ascent=o-t,d.descent=u-o,d.bounds={minx:v-k/2,maxx:x-k/2,miny:0,maxy:u-t},d.height=1+(u-t)}else d.ascent=0,d.descent=0,d.bounds={minx:0,maxx:d.width,miny:0,maxy:0},d.height=0;return d}}),c("Core/writeTextToCanvas",["./defaultValue","./DeveloperError","./Color","../ThirdParty/measureText"],function(a,b,c,d){var e={},f=function(f,g){if(typeof f=="undefined")throw new b("text is required.");if(f==="")return undefined;g=a(g,e);var h=a(g.font,"10px sans-serif"),i=document.createElement("canvas");i.width=i.height=1,i.style.font=h;var j=i.getContext("2d");j.font=h,j.textBaseline=a(g.textBaseline,"bottom"),i.style.visibility="hidden",document.body.appendChild(i);var k=d(j,f);i.dimensions=k,document.body.removeChild(i),i.style.visibility=undefined;var l=k.height-k.ascent;i.width=k.width,i.height=k.height;var m=i.height-l;j.font=h;var n=a(g.fill,!0);if(n){var o=a(g.fillColor,c.WHITE);j.fillStyle=o.toCSSColor(),j.fillText(f,0,m)}var p=a(g.stroke,!1);if(p){var q=a(g.strokeColor,c.BLACK);j.strokeStyle=q.toCSSColor(),j.strokeText(f,0,m)}return i};return f}),c("Scene/LabelCollection",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian2","../Core/Matrix4","../Core/writeTextToCanvas","../Renderer/BufferUsage","./BillboardCollection","./Label","./LabelStyle","./HorizontalOrigin","./VerticalOrigin"],function(a,b,c,d,e,f,g,h,i,j,k){function l(){this.textureInfo=undefined,this.dimensions=undefined,this.billboard=undefined}function m(a,b,c){this.labelCollection=a,this.index=b,this.dimensions=c,this.referenceCount=1,++a._textureCount}function o(a,b,c,d,f,g){return n.font=b,n.fillColor=c,n.strokeColor=d,g===k.BOTTOM?n.textBaseline="bottom":g===k.TOP?n.textBaseline="top":n.textBaseline="middle",n.fill=f===i.FILL||f===i.FILL_AND_OUTLINE,n.stroke=f===i.OUTLINE||f===i.FILL_AND_OUTLINE,e(a,n)}function p(a,b){typeof b.textureInfo!="undefined"&&b.textureInfo.releaseReference(),b.textureInfo=undefined,b.dimensions=undefined;var c=b.billboard;typeof c!="undefined"&&(c.setShow(!1),c.setImageIndex(-1),a._spareBillboards.push(c),b.billboard=undefined)}function q(a,b){var c=b._text,d=c.length,e=b._glyphs,f=e.length,g,h,i;if(d<f)for(h=d;h<f;++h)p(a,e[h]);e.length=d;var k=a._glyphTextureCache,n=a._textureAtlas;for(i=0;i<d;++i){var q=c.charAt(i),r=b._font,s=b._fillColor,t=b._outlineColor,u=b._style,v=b._verticalOrigin,w=JSON.stringify([q,r,s.toString(),t.toString(),u.toString(),v.toString()]),x=k[w];if(typeof x=="undefined"){var y=o(q,r,s,t,u,v),z=-1;y.width>0&&y.height>0&&(z=n.addImage(y)),x=new m(a,z,y.dimensions),k[w]=x}else x.addReference();g=e[i],typeof g!="undefined"?x.index===-1?p(a,g):typeof g.textureInfo!="undefined"&&(g.textureInfo.releaseReference(),g.textureInfo=undefined):(g=new l,e[i]=g),g.textureInfo=x,g.dimensions=x.dimensions;if(x.index!==-1){var A=g.billboard;typeof A=="undefined"&&(a._spareBillboards.length>0?g.billboard=A=a._spareBillboards.pop():g.billboard=A=a._billboardCollection.add(),A.setShow(b._show),A.setPosition(b._position),A.setEyeOffset(b._eyeOffset),A.setHorizontalOrigin(j.LEFT),A.setVerticalOrigin(b._verticalOrigin),A.setScale(b._scale),A._pickIdThis=b),g.billboard.setImageIndex(x.index)}}b._repositionAllGlyphs=!0}function s(a){var b=a._glyphs,c,d,e=0,f=0,g=0,h=b.length;for(g=0;g<h;++g)c=b[g],d=c.dimensions,e+=d.width,f=Math.max(f,d.height);var i=a._scale,l=a._horizontalOrigin,m=0;l===j.CENTER?m-=e/2*i:l===j.RIGHT&&(m-=e*i);var n=a._pixelOffset;r.x=n.x+m,r.y=0;var o=a._verticalOrigin;for(g=0;g<h;++g)c=b[g],d=c.dimensions,o===k.BOTTOM||d.height===f?r.y=n.y-d.descent*i:o===k.TOP?r.y=n.y-(f-d.height)*i-d.descent*i:o===k.CENTER&&(r.y=n.y-(f-d.height)/2*i-d.descent*i),typeof c.billboard!="undefined"&&c.billboard.setPixelOffset(r),r.x+=d.width*i}function t(a,c){var d=c._glyphs;for(var e=0,f=d.length;e<f;++e)p(a,d[e]);b(c)}m.prototype.addReference=function(){this.referenceCount===0&&--this.labelCollection._unusedTextureCount,++this.referenceCount},m.prototype.releaseReference=function(){--this.referenceCount,this.referenceCount===0&&++this.labelCollection._unusedTextureCount};var n={},r=new c,u=function(){this._textureAtlas=undefined,this._billboardCollection=new g,this._billboardCollection.setDestroyTextureAtlas(!1),this._spareBillboards=[],this._glyphTextureCache={},this._textureCount=0,this._unusedTextureCount=0,this._labels=[],this._labelsToUpdate=[],this._frameCount=0,this._totalGlyphCount=0,this.modelMatrix=d.IDENTITY.clone(),this.clampToPixel=!0,this.morphTime=1};return u.prototype.add=function(a){var b=new h(a,this,this._labels.length);return this._labels.push(b),this._labelsToUpdate.push(b),b},u.prototype.remove=function(a){return typeof a=="undefined"?!1:a._labelCollection===this?(this._labels.splice(a._index,1),t(this,a),!0):!1},u.prototype.removeAll=function(){var a=this._labels;for(var b=0,c=a.length;b<c;++b)t(this,a[b]);a.length=0},u.prototype.contains=function(a){return typeof a!="undefined"&&a._labelCollection===this},u.prototype.get=function(b){if(typeof b=="undefined")throw new a("index is required.");return this._labels[b]},u.prototype.getLength=function(){return this._labels.length},u.prototype.update=function(a,b,c){var d=this._billboardCollection;d.modelMatrix=this.modelMatrix,d.morphTime=this.morphTime,d.clampToPixel=this.clampToPixel;var e=!1;if(++this._frameCount%100===0){this._frameCount=0,this._unusedTextureCount>.25*this._textureCount&&(this._textureAtlas=this._textureAtlas.destroy(),this._glyphTextureCache={},this._textureCount=0,this._unusedTextureCount=0,e=!0,this._labelsToUpdate=this._labels.slice(0));while(this._spareBillboards.length>this._totalGlyphCount*.1)d.remove(this._spareBillboards.pop())}typeof this._textureAtlas=="undefined"&&(this._textureAtlas=a.createTextureAtlas(),d.setTextureAtlas(this._textureAtlas));var f=this._labelsToUpdate;for(var g=0,h=f.length;g<h;++g){var i=f[g];if(i.isDestroyed())continue;var j=i._glyphs.length;if(e||i._rebindAllGlyphs)q(this,i),i._rebindAllGlyphs=!1;i._repositionAllGlyphs&&(s(i),i._repositionAllGlyphs=!1);var k=i._glyphs.length-j;this._totalGlyphCount+=k}f.length=0,this._billboardCollection.update(a,b,c)},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){return this.removeAll(),this._billboardCollection.destroy(),b(this)},u}),c("DynamicScene/DynamicLabelVisualizer",["../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Cartesian2","../Core/Cartesian3","../Scene/LabelCollection","../Scene/LabelStyle","../Scene/HorizontalOrigin","../Scene/VerticalOrigin"],function(a,b,c,d,e,f,g,h,i){var j=function(b,c){if(typeof b=="undefined")throw new a("scene is required.");this._scene=b,this._unusedIndexes=[],this._dynamicObjectCollection=undefined;var d=this._labelCollection=new f;b.getPrimitives().add(d),this.setDynamicObjectCollection(c)};j.prototype.getScene=function(){return this._scene},j.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},j.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(j.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(j.prototype._onObjectsRemoved,this))},j.prototype.update=function(b){if(typeof b=="undefined")throw new a("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(b,c[d])}},j.prototype.removeAllPrimitives=function(){this._unusedIndexes=[],this._labelCollection.removeAll();if(typeof this._dynamicObjectCollection!="undefined"){var a=this._dynamicObjectCollection.getObjects();for(var b=a.length-1;b>-1;b--)a[b]._labelVisualizerIndex=undefined}},j.prototype.isDestroyed=function(){return!1},j.prototype.destroy=function(){return this.removeAllPrimitives(),this._scene.getPrimitives().remove(this._labelCollection),b(this)};var k,l,m,n,o;return j.prototype._updateObject=function(a,b){var f=b.label;if(typeof f=="undefined")return;var j=f.text;if(typeof j=="undefined")return;var p=b.position;if(typeof p=="undefined")return;var q,r=f.show,s=b._labelVisualizerIndex,t=b.isAvailable(a)&&(typeof r=="undefined"||r.getValue(a));if(!t){typeof s!="undefined"&&(q=this._labelCollection.get(s),q.setShow(!1),this._unusedIndexes.push(s),b._labelVisualizerIndex=undefined);return}if(typeof s=="undefined"){var u=this._unusedIndexes,v=u.length;v>0?(s=u.pop(),q=this._labelCollection.get(s)):(s=this._labelCollection.getLength(),q=this._labelCollection.add()),b._labelVisualizerIndex=s,q.dynamicObject=b,q.setText(""),q.setScale(1),q.setFont("30px sans-serif"),q.setFillColor(c.WHITE),q.setOutlineColor(c.BLACK),q.setStyle(g.FILL),q.setPixelOffset(d.ZERO),q.setEyeOffset(e.ZERO),q.setHorizontalOrigin(h.CENTER),q.setVerticalOrigin(i.CENTER)}else q=this._labelCollection.get(s);q.setShow(t);var w=j.getValue(a);typeof w!="undefined"&&q.setText(w),k=p.getValueCartesian(a,k),typeof k!="undefined"&&q.setPosition(k);var x=f.scale;if(typeof x!="undefined"){var y=x.getValue(a);typeof y!="undefined"&&q.setScale(y)}x=f.font;if(typeof x!="undefined"){var z=x.getValue(a);typeof z!="undefined"&&q.setFont(z)}x=f.fillColor,typeof x!="undefined"&&(l=x.getValue(a,l),typeof l!="undefined"&&q.setFillColor(l)),x=f.outlineColor,typeof x!="undefined"&&(m=x.getValue(a,m),typeof m!="undefined"&&q.setOutlineColor(m)),x=f.style;if(typeof x!="undefined"){var A=x.getValue(a);typeof A!="undefined"&&q.setStyle(A)}x=f.pixelOffset,typeof x!="undefined"&&(o=x.getValue(a,o),typeof o!="undefined"&&q.setPixelOffset(o)),x=f.eyeOffset,typeof x!="undefined"&&(n=x.getValue(a,n),typeof n!="undefined"&&q.setEyeOffset(n)),x=f.horizontalOrigin;if(typeof x!="undefined"){var B=x.getValue(a);typeof B!="undefined"&&q.setHorizontalOrigin(B)}x=f.verticalOrigin;if(typeof x!="undefined"){var C=x.getValue(a);typeof C!="undefined"&&q.setVerticalOrigin(C)}},j.prototype._onObjectsRemoved=function(a,b){var c=this._labelCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._labelVisualizerIndex;if(typeof g!="undefined"){var h=c.get(g);h.setShow(!1),d.push(g),f._labelVisualizerIndex=undefined}}},j}),function(a,b){a("ThirdParty/when",["module"],function(a){function h(a,b,c,d){return i(a).then(b,c,d)}function i(a){var b,c;return a instanceof k?b=a:(a!=null&&typeof a.valueOf=="function"&&(a=a.valueOf()),o(a)?(c=n(),a.then(c.resolve,c.reject,c.progress),b=c.promise):b=l(a)),b}function j(a){return h(a,function(a){return m(a)})}function k(){}function l(a){var c=new k;return c.then=function(b){try{return i(b?b(a):a)}catch(c){return m(c)}},b(c)}function m(a){var c=new k;return c.then=function(b,c){try{return c?i(c(a)):m(a)}catch(d){return m(d)}},b(c)}function n(){var a,c,d,e,f,h,j,l;return e=[],f=[],a={},d={},c=new k,c.then=a.then=function(b,c,d){return h(b,c,d)},a.promise=b(c),d.resolve=a.resolve=function(b){return l(b)},d.reject=a.reject=function(b){return l(m(b))},d.progress=a.progress=function(b){j(b)},a.resolver=b(d),h=function(a,b,c){var d=n();return e.push(function(c){c.then(a,b).then(d.resolve,d.reject,d.progress)}),c&&f.push(c),d.promise},j=function(a){var b,c=0;while(b=f[c++])b(a)},l=function(a){var b,c=0;a=i(a),h=a.then,l=i,j=w;while(b=e[c++])b(a);return f=e=g,a},a}function o(a){return a&&typeof a.then=="function"}function p(a,b,c,d,e){return v(2,arguments),h(a,function(a){var f,g,i,j,k,l,m,o;m=a.length>>>0,f=Math.max(0,Math.min(b,m)),g=[],i=n();if(!f)i.resolve(g);else{k=i.reject,l=i.progress,j=function(a){g.push(a),--f||(j=w,i.resolve(g))};for(o=0;o<m;++o)o in a&&h(a[o],j,k,l)}return i.then(c,d,e)})}function q(a,b,c,d){return v(1,arguments),s(a,x).then(b,c,d)}function r(a,b,c,d){function e(a){return b?b(a[0]):a[0]}return p(a,1,e,c,d)}function s(a,b){return h(a,function(a){var c,d,e,f,g,i,j;e=d=a.length>>>0,c=[],j=n();if(!e)j.resolve(c);else{g=j.reject,f=function(d,f){h(d,b).then(function(a){c[f]=a,--e||j.resolve(c)},g)};for(i=0;i<d;i++)i in a?f(a[i],i):--e}return j.promise})}function t(a,b){var e=d.call(arguments,1);return h(a,function(a){var d;return d=a.length,e[0]=function(a,c,e){return h(a,function(a){return h(c,function(c){return b(a,c,e,d)})})},c.apply(a,e)})}function u(a,b,c){var d=arguments.length>2;return h(a,function(a){return b.resolve(d?c:a)},b.reject,b.progress)}function v(a,b){var c,d=b.length;while(d>a){c=b[--d];if(c!=null&&typeof c!="function")throw new Error("arg "+d+" must be a function")}}function w(){}function x(a){return a}var b,c,d,e,f,g;return b=b&&Object.freeze||x,h.defer=n,h.resolve=i,h.reject=j,h.all=q,h.some=p,h.any=r,h.map=s,h.reduce=t,h.chain=u,h.isPromise=o,k.prototype=b({always:function(a,b){return this.then(a,a,b)},otherwise:function(a){return this.then(g,a)}}),d=[].slice,c=[].reduce||function(a){var b,c,d,e,f;f=0,b=Object(this),e=b.length>>>0,c=arguments;if(c.length<=1)for(;;){if(f in b){d=b[f++];break}if(++f>=e)throw new TypeError}else d=c[1];for(;f<e;++f)f in b&&(d=a(d,b[f],f,b));return d},h})}(typeof c=="function"&&c.amd?c:function(a,b){typeof exports=="object"?module.exports=b():this.when=b()},this),c("Core/TaskProcessor",["require","./defaultValue","./DeveloperError","../ThirdParty/when"],function(a,b,c,d){function e(a,b){--a._activeTasks;var c=b.data,d=c.id,e=c.result,f=a._deferreds,g=f[d];g.resolve(e),delete f[d]}function i(){if(typeof h=="undefined")if(typeof CESIUM_BASE_URL!="undefined")h=CESIUM_BASE_URL+"/"+g;else if(typeof a.toUrl!="undefined")h=a.toUrl("../Workers/"+g);else{var b=document.getElementsByTagName("script");for(var d=0,e=b.length;d<e;++d){var i=b[d].getAttribute("src"),j=f.exec(i);if(j!==null){h=j[1]+g;break}}if(typeof h=="undefined")throw new c("Unable to determine Cesium base URL automatically, try defining a global variable called CESIUM_BASE_URL.")}return h}function j(c){var d=new Worker(i());d.postMessage=b(d.webkitPostMessage,d.postMessage);var f={loaderConfig:{},workerModule:"Workers/"+c._workerName};typeof a.toUrl!="undefined"?f.loaderConfig.baseUrl="..":f.loaderConfig.paths={Workers:"."},d.postMessage(f),d.onmessage=function(a){e(c,a)},c._worker=d}var f=/(.*\/?)Cesium\w*\.js(?:\W|$)/i,g="cesiumWorkerBootstrapper.js",h,k=function(a,c){this._workerName=a,this._maximumActiveTasks=b(c,5),this._activeTasks=0,this._deferreds={},this._nextID=0};return k.prototype.scheduleTask=function(a,b){typeof this._worker=="undefined"&&j(this);if(this._activeTasks>=this._maximumActiveTasks)return undefined;++this._activeTasks;var c=this._nextID++,e=d.defer();return this._deferreds[c]=e,this._worker.postMessage({id:c,parameters:a},b),e.promise},k}),c("Core/jsonp",["./defaultValue","./DeveloperError","../ThirdParty/when"],function(a,b,c){function d(a,b,c){a.push(encodeURIComponent(b)+"="+encodeURIComponent(c))}var e=function(f,g){if(typeof f=="undefined")throw new b("url is required.");g=a(g,{});var h=c.defer(),i;do i="jsonp"+Math.random().toString().substring(2,8);while(typeof window[i]!="undefined");window[i]=function(a){h.resolve(a);try{delete window[i]}catch(b){window[i]=undefined}};var j=a(g.callbackParameterName,"callback"),k=[];d(k,j,i);var l=a(g.parameters,{});for(var m in l)l.hasOwnProperty(m)&&d(k,m,l[m]);k.length>0&&(f.indexOf("?")===-1?f+="?":f+="&",f+=k.join("&"));var n=g.proxy;return typeof n!="undefined"&&(f=n.getURL(f)),e.loadAndExecuteScript(f,i,h),h.promise};return e.loadAndExecuteScript=function(a,b,c){var d=document.createElement("script");d.async=!0,d.src=a;var e=document.getElementsByTagName("head")[0];d.onload=function(){d.onload=undefined,e.removeChild(d)},d.onerror=function(a){c.reject(a)},e.appendChild(d)},e.defaultLoadAndExecuteScript=e.loadAndExecuteScript,e}),c("Core/loadArrayBuffer",["./DeveloperError","../ThirdParty/when"],function(a,b){var c=function(c,d){if(typeof c=="undefined")throw new a("url is required.");return b(c,function(a){var c=new XMLHttpRequest;c.open("GET",a,!0);if(typeof d!="undefined")for(var e in d)d.hasOwnProperty(e)&&c.setRequestHeader(e,d[e]);c.responseType="arraybuffer";var f=b.defer();return c.onload=function(a){f.resolve(c.response)},c.onerror=function(a){f.reject(a)},c.send(),f.promise})};return c}),c("Core/loadImage",["./defaultValue","./DeveloperError","../ThirdParty/when"],function(a,b,c){var d=/^data:/,e=function(f,g){if(typeof f=="undefined")throw new b("url is required.");return g=a(g,!0),c(f,function(a){d.test(a)&&(g=!1);var b=c.defer();return e.createImage(a,g,b),b.promise})};return e.createImage=function(a,b,c){var d=new Image;d.onload=function(a){c.resolve(d)},d.onerror=function(a){c.reject(a)},b&&(d.crossOrigin=""),d.src=a},e.defaultCreateImage=e.createImage,e}),c("Renderer/TextureAtlasBuilder",["../Core/Event","../Core/DeveloperError","../Core/loadImage"],function(a,b,c){function d(){this.imageLoaded=new a,this.index=-1,this.loaded=!1}var e=function(a){if(typeof a=="undefined")throw new b("textureAtlas is required.");this.textureAtlas=a,this._idHash={}};return e.prototype.addTextureFromUrl=function(a,d){if(typeof a=="undefined")throw new b("url is required.");if(typeof d=="undefined")throw new b("textureAvailableCallback is required.");this.addTextureFromFunction(a,function(a,b){c(a).then(b)},d)},e.prototype.addTextureFromFunction=function(a,c,e){if(typeof a=="undefined")throw new b("id is required.");if(typeof c=="undefined")throw new b("getImageCallback is required.");if(typeof e=="undefined")throw new b("textureAvailableCallback is required.");var f=this._idHash[a];if(typeof f!="undefined"){f.loaded?e(f.index):f.imageLoaded.addEventListener(e);return}this._idHash[a]=f=new d,f.imageLoaded.addEventListener(e);var g=this;c(a,function(b){if(!g.textureAtlas.isDestroyed()){var c=f.index=g.textureAtlas.addImage(b);f.loaded=!0,f.imageLoaded.raiseEvent(c,a),f.imageLoaded=undefined}})},e}),c("DynamicScene/DynamicBillboardVisualizer",["../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Cartesian2","../Core/Cartesian3","../Scene/BillboardCollection","../Scene/HorizontalOrigin","../Scene/VerticalOrigin","../Renderer/TextureAtlasBuilder"],function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return function(d){var e=a._billboardVisualizerIndex;if(typeof e!="undefined"){var f=b.get(e);f._visualizerUrl===c&&(f._visualizerTextureAvailable=!0,f.setImageIndex(d))}}}var k=function(b,c){if(typeof b=="undefined")throw new a("scene is required.");this._scene=b,this._unusedIndexes=[],this._dynamicObjectCollection=undefined;var d=this._billboardCollection=new f,e=this._textureAtlas=b.getContext().createTextureAtlas();this._textureAtlasBuilder=new i(e),d.setTextureAtlas(e),b.getPrimitives().add(d),this.setDynamicObjectCollection(c)};k.prototype.getScene=function(){return this._scene},k.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},k.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(k.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(k.prototype._onObjectsRemoved,this))},k.prototype.update=function(b){if(typeof b=="undefined")throw new a("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(b,c[d])}},k.prototype.removeAllPrimitives=function(){if(typeof this._dynamicObjectCollection!="undefined"){this._unusedIndexes=[],this._billboardCollection.removeAll();var a=this._dynamicObjectCollection.getObjects();for(var b=a.length-1;b>-1;b--)a[b]._billboardVisualizerIndex=undefined}},k.prototype.isDestroyed=function(){return!1},k.prototype.destroy=function(){return this.removeAllPrimitives(),this._scene.getPrimitives().remove(this._billboardCollection),b(this)};var l,m,n,o;return k.prototype._updateObject=function(a,b){var f=b.billboard;if(typeof f=="undefined")return;var i=b.position;if(typeof i=="undefined")return;var k=f.image;if(typeof k=="undefined")return;var p,q=f.show,r=b._billboardVisualizerIndex,s=b.isAvailable(a)&&(typeof q=="undefined"||q.getValue(a));if(!s){typeof r!="undefined"&&(p=this._billboardCollection.get(r),p.setShow(!1),p.setImageIndex(-1),p._visualizerUrl=undefined,p._visualizerTextureAvailable=!1,b._billboardVisualizerIndex=undefined,this._unusedIndexes.push(r));return}if(typeof r=="undefined"){var t=this._unusedIndexes,u=t.length;u>0?(r=t.pop(),p=this._billboardCollection.get(r)):(r=this._billboardCollection.getLength(),p=this._billboardCollection.add()),b._billboardVisualizerIndex=r,p.dynamicObject=b,p._visualizerUrl=undefined,p._visualizerTextureAvailable=!1,p.setColor(c.WHITE),p.setEyeOffset(e.ZERO),p.setPixelOffset(d.ZERO),p.setScale(1),p.setHorizontalOrigin(g.CENTER),p.setVerticalOrigin(h.CENTER)}else p=this._billboardCollection.get(r);var v=k.getValue(a);v!==p._visualizerUrl&&(p._visualizerUrl=v,p._visualizerTextureAvailable=!1,this._textureAtlasBuilder.addTextureFromUrl(v,j(b,this._billboardCollection,v))),p.setShow(p._visualizerTextureAvailable);if(!p._visualizerTextureAvailable)return;l=i.getValueCartesian(a,l),typeof l!="undefined"&&p.setPosition(l);var w=f.color;typeof w!="undefined"&&(m=w.getValue(a,m),typeof m!="undefined"&&p.setColor(m)),w=f.eyeOffset,typeof w!="undefined"&&(n=w.getValue(a,n),typeof n!="undefined"&&p.setEyeOffset(n)),w=f.pixelOffset,typeof w!="undefined"&&(o=w.getValue(a,o),typeof o!="undefined"&&p.setPixelOffset(o)),w=f.scale;if(typeof w!="undefined"){var x=w.getValue(a);typeof x!="undefined"&&p.setScale(x)}w=f.horizontalOrigin;if(typeof w!="undefined"){var y=w.getValue(a);typeof y!="undefined"&&p.setHorizontalOrigin(y)}w=f.verticalOrigin;if(typeof w!="undefined"){var z=w.getValue(a);typeof z!="undefined"&&p.setVerticalOrigin(z)}},k.prototype._onObjectsRemoved=function(a,b){var c=this._billboardCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._billboardVisualizerIndex;if(typeof g!="undefined"){var h=c.get(g);h.setShow(!1),h.setImageIndex(-1),h._visualizerUrl=undefined,h._visualizerTextureAvailable=!1,f._billboardVisualizerIndex=undefined,d.push(g)}}},k}),c("DynamicScene/DynamicPointVisualizer",["../Core/Event","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Scene/BillboardCollection","../Renderer/TextureAtlasBuilder"],function(a,b,c,d,e,f){var g=function(a,c){if(typeof a=="undefined")throw new b("scene is required.");this._scene=a,this._unusedIndexes=[],this._dynamicObjectCollection=undefined;var d=this._billboardCollection=new e,g=this._textureAtlas=a.getContext().createTextureAtlas();this._textureAtlasBuilder=new f(g),d.setTextureAtlas(g),a.getPrimitives().add(d),this.setDynamicObjectCollection(c)};g.prototype.getScene=function(){return this._scene},g.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},g.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(g.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(g.prototype._onObjectsRemoved,this))},g.prototype.update=function(a){if(typeof a=="undefined")throw new b("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(a,c[d])}},g.prototype.removeAllPrimitives=function(){this._unusedIndexes=[],this._billboardCollection.removeAll();if(typeof this._dynamicObjectCollection!="undefined"){var a=this._dynamicObjectCollection.getObjects();for(var b=a.length-1;b>-1;b--)a[b]._pointVisualizerIndex=undefined}},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return this.removeAllPrimitives(),this._scene.getPrimitives().remove(this._billboardCollection),c(this)};var h,i,j;return g.prototype._updateObject=function(a,b){var c=b.point;if(typeof c=="undefined")return;var e=b.position;if(typeof e=="undefined")return;var f,g=c.show,k=b._pointVisualizerIndex,l=b.isAvailable(a)&&(typeof g=="undefined"||g.getValue(a));if(!l){typeof k!="undefined"&&(f=this._billboardCollection.get(k),f.setShow(!1),f.setImageIndex(-1),b._pointVisualizerIndex=undefined,this._unusedIndexes.push(k));return}var m=!1;if(typeof k=="undefined"){var n=this._unusedIndexes,o=n.length;o>0?(k=n.pop(),f=this._billboardCollection.get(k)):(k=this._billboardCollection.getLength(),f=this._billboardCollection.add()),b._pointVisualizerIndex=k,f.dynamicObject=b,f._visualizerColor=d.WHITE.clone(f._visualizerColor),f._visualizerOutlineColor=d.BLACK.clone(f._visualizerOutlineColor),f._visualizerOutlineWidth=2,f._visualizerPixelSize=3,m=!0}else f=this._billboardCollection.get(k);f.setShow(!0),i=e.getValueCartesian(a,i),typeof i!="undefined"&&f.setPosition(i);var p=c.color;typeof p!="undefined"&&(h=p.getValue(a,h),f._visualizerColor!==h&&(f._visualizerColor=h,m=!0)),p=c.outlineColor,typeof p!="undefined"&&(j=p.getValue(a,j),f._visualizerOutlineColor!==j&&(f._visualizerOutlineColor=j,m=!0)),p=c.outlineWidth;if(typeof p!="undefined"){var q=p.getValue(a);f._visualizerOutlineWidth!==q&&(f._visualizerOutlineWidth=q,m=!0)}p=c.pixelSize;if(typeof p!="undefined"){var r=p.getValue(a);f._visualizerPixelSize!==r&&(f._visualizerPixelSize=r,m=!0)}if(m){var s=typeof f._visualizerColor!="undefined"?f._visualizerColor.toCSSColor():"#FFFFFF",t=typeof f._visualizerOutlineColor!="undefined"?f._visualizerOutlineColor.toCSSColor():"#000000",u=typeof f._visualizerPixelSize!="undefined"?f._visualizerPixelSize:3,v=typeof f._visualizerOutlineWidth!="undefined"?f._visualizerOutlineWidth:2,w=JSON.stringify([s,u,t,v]);this._textureAtlasBuilder.addTextureFromFunction(w,function(a,b){var c=document.createElement("canvas"),d=u+2*v;c.height=c.width=d;var e=c.getContext("2d");e.clearRect(0,0,d,d),v!==0&&(e.beginPath(),e.arc(d/2,d/2,d/2,0,2*Math.PI,!0),e.closePath(),e.fillStyle=t,e.fill()),e.beginPath(),e.arc(d/2,d/2,u/2,0,2*Math.PI,!0),e.closePath(),e.fillStyle=s,e.fill(),b(c)},function(a){f.setImageIndex(a)})}},g.prototype._onObjectsRemoved=function(a,b){var c=this._billboardCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._pointVisualizerIndex;if(typeof g!="undefined"){var h=c.get(g);h.setShow(!1),h.setImageIndex(-1),f._pointVisualizerIndex=undefined,d.push(g)}}},g}),c("Core/loadText",["./DeveloperError","../ThirdParty/when"],function(a,b){var c=function(c,d){if(typeof c=="undefined")throw new a("url is required.");return b(c,function(a){var c=new XMLHttpRequest;c.open("GET",a,!0);if(typeof d!="undefined")for(var e in d)d.hasOwnProperty(e)&&c.setRequestHeader(e,d[e]);var f=b.defer();return c.onload=function(a){f.resolve(c.response)},c.onerror=function(a){f.reject(a)},c.send(),f.promise})};return c}),c("Core/loadJson",["./defaultValue","./loadText","./DeveloperError"],function(a,b,c){var d=function(e,f){if(typeof e=="undefined")throw new c("url is required.");return f=a(f,{}),f.Accept="application/json",b(e,f).then(function(a){return JSON.parse(a)})};return d}),c("Core/throttleRequestByServer",["./defaultValue","../ThirdParty/when"],function(a,b){function f(a){return typeof e=="undefined"&&(e=document.createElement("a")),e.href=a,e.hostname+"%"+e.port}function g(e,g){var h=f(e),i=a(d[h],0);return i>c?undefined:(d[h]=i+1,b(g(e),function(a){return d[h]--,a},function(a){return d[h]--,b.reject(a)}))}var c=6,d={},e;return g}),c("Scene/ImageryProvider",["../Core/loadImage","../Core/DeveloperError","../Core/throttleRequestByServer"],function(a,b,c){var d=function(){throw new b("This type should not be instantiated directly.")};return d.prototype.isReady=function(){throw new b("This type should not be instantiated directly.")},d.prototype.getExtent=function(){throw new b("This type should not be instantiated directly.")},d.prototype.getTileWidth=function(){throw new b("This type should not be instantiated directly.")},d.prototype.getTileHeight=function(){throw new b("This type should not be instantiated directly.")},d.prototype.getMaximumLevel=function(){throw new b("This type should not be instantiated directly.")},d.prototype.getTilingScheme=function(){throw new b("This type should not be instantiated directly.")},d.prototype.getTileDiscardPolicy=function(){throw new b("This type should not be instantiated directly.")},d.prototype.getErrorEvent=function(){throw new b("This type should not be instantiated directly.")},d.prototype.getLogo=function(){throw new b("This type should not be instantiated directly.")},d.prototype.requestImage=function(a,c,d,e,f){throw new b("This type should not be instantiated directly.")},d.loadImage=function(b){return c(b,a)},d}),c("Scene/OpenStreetMapImageryProvider",["../Core/defaultValue","../Core/DeveloperError","../Core/Event","../Core/writeTextToCanvas","./ImageryProvider","./WebMercatorTilingScheme"],function(a,b,c,d,e,f){function i(a,b,c,d){var e=a._url+d+"/"+b+"/"+c+"."+a._fileExtension,f=a._proxy;return typeof f!="undefined"&&(e=f.getURL(e)),e}var g=/\/$/,h=function(e){e=a(e,{});var h=a(e.url,"http://tile.openstreetmap.org/");g.test(h)||(h+="/"),this._url=h,this._fileExtension=a(e.fileExtension,"png"),this._proxy=e.proxy,this._tileDiscardPolicy=e.tileDiscardPolicy,this._tilingScheme=new f,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=a(e.maximumLevel,18),this._extent=a(e.extent,this._tilingScheme.getExtent()),this._errorEvent=new c,this._ready=!0;var i=a(e.credit,"MapQuest, Open Street Map and contributors, CC-BY-SA");this._logo=d(i,{font:"12px sans-serif"})};return h.prototype.getUrl=function(){return this._url},h.prototype.getTileWidth=function(){if(!this._ready)throw new b("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},h.prototype.getTileHeight=function(){if(!this._ready)throw new b("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},h.prototype.getMaximumLevel=function(){if(!this._ready)throw new b("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},h.prototype.getTilingScheme=function(){if(!this._ready)throw new b("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},h.prototype.getExtent=function(){if(!this._ready)throw new b("getExtent must not be called before the imagery provider is ready.");return this._extent},h.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new b("getTileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy},h.prototype.getErrorEvent=function(){return this._errorEvent},h.prototype.isReady=function(){return this._ready},h.prototype.requestImage=function(a,c,d){if(!this._ready)throw new b("requestImage must not be called before the imagery provider is ready.");var f=i(this,a,c,d);return e.loadImage(f)},h.prototype.getLogo=function(){if(!this._ready)throw new b("getLogo must not be called before the imagery provider is ready.");return this._logo},h}),c("Scene/TileMapServiceImageryProvider",["../Core/defaultValue","../Core/DeveloperError","../Core/Event","../Core/writeTextToCanvas","../Core/Extent","./ImageryProvider","./WebMercatorTilingScheme"],function(a,b,c,d,e,f,g){function j(a,b,c,d){var e=a._url+d+"/"+b+"/"+(Math.pow(2,d)-c-1)+"."+a._fileExtension,f=a._proxy;return typeof f!="undefined"&&(e=f.getURL(e)),e}var h=/\/$/,i=function(f){f=a(f,{});if(typeof f.url=="undefined")throw new b("description.url is required.");var i=f.url;h.test(i)||(i+="/"),this._url=i,this._fileExtension=a(f.fileExtension,"png"),this._proxy=f.proxy,this._tileDiscardPolicy=f.tileDiscardPolicy,this._tilingScheme=new g,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=a(f.maximumLevel,18),this._extent=a(f.extent,this._tilingScheme.getExtent()),this._errorEvent=new c,this._ready=!0;var j=a(f.credit,"AGI");this._logo=d(j,{font:"12px sans-serif"})};return i.prototype.getUrl=function(){return this._url},i.prototype.getTileWidth=function(){if(!this._ready)throw new b("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},i.prototype.getTileHeight=function(){if(!this._ready)throw new b("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},i.prototype.getMaximumLevel=function(){if(!this._ready)throw new b("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},i.prototype.getTilingScheme=function(){if(!this._ready)throw new b("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},i.prototype.getExtent=function(){if(!this._ready)throw new b("getExtent must not be called before the imagery provider is ready.");return this._extent},i.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new b("getTileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy},i.prototype.getErrorEvent=function(){return this._errorEvent},i.prototype.isReady=function(){return this._ready},i.prototype.requestImage=function(a,c,d){if(!this._ready)throw new b("requestImage must not be called before the imagery provider is ready.");var e=j(this,a,c,d);return f.loadImage(e)},i.prototype.getLogo=function(){return this._logo},i}),c("Scene/WebMapServiceImageryProvider",["../Core/clone","../Core/defaultValue","../Core/freezeObject","../Core/writeTextToCanvas","../Core/DeveloperError","../Core/Event","../Core/Extent","./ImageryProvider","./WebMercatorTilingScheme","./GeographicTilingScheme"],function(a,b,c,d,e,f,g,h,i,j){function l(a,b,c,d){var e=a._url,f=e.indexOf("?");f>=0&&f<e.length-1?e[e.length-1]!=="&"&&(e+="&"):f<0&&(e+="?");var g=a._parameters;for(var h in g)g.hasOwnProperty(h)&&(e+=h+"="+g[h]+"&");typeof g.layers=="undefined"&&(e+="layers="+a._layers+"&"),typeof g.srs=="undefined"&&(e+="srs=EPSG:4326&");if(typeof g.bbox=="undefined"){var i=a._tilingScheme.tileXYToNativeExtent(b,c,d),j=i.west+","+i.south+","+i.east+","+i.north;e+="bbox="+j+"&"}typeof g.width=="undefined"&&(e+="width=256&"),typeof g.height=="undefined"&&(e+="height=256&");var k=a._proxy;return typeof k!="undefined"&&(e=k.getURL(e)),e}var k=function m(c){c=b(c,{});if(typeof c.url=="undefined")throw new e("description.url is required.");if(typeof c.layers=="undefined")throw new e("description.layers is required.");this._url=c.url,this._tileDiscardPolicy=c.tileDiscardPolicy,this._proxy=c.proxy,this._layers=c.layers;var h=a(m.DefaultParameters);if(typeof c.parameters!="undefined")for(var i in c.parameters)if(c.parameters.hasOwnProperty(i)){var k=i.toLowerCase();h[k]=c.parameters[i]}this._parameters=h,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=c.maximumLevel;var l=b(c.extent,g.MAX_VALUE);this._tilingScheme=new j({extent:l}),typeof c.credit!="undefined"&&(this._logo=d(c.credit,{font:"12px sans-serif"})),this._errorEvent=new f,this._ready=!0};return k.prototype.getUrl=function(){return this._url},k.prototype.getLayers=function(){return this._layers},k.prototype.getTileWidth=function(){if(!this._ready)throw new e("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},k.prototype.getTileHeight=function(){if(!this._ready)throw new e("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},k.prototype.getMaximumLevel=function(){if(!this._ready)throw new e("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},k.prototype.getTilingScheme=function(){if(!this._ready)throw new e("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},k.prototype.getExtent=function(){if(!this._ready)throw new e("getExtent must not be called before the imagery provider is ready.");return this._tilingScheme.getExtent()},k.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new e("getTileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy},k.prototype.getErrorEvent=function(){return this._errorEvent},k.prototype.isReady=function(){return this._ready},k.prototype.requestImage=function(a,b,c){if(!this._ready)throw new e("requestImage must not be called before the imagery provider is ready.");var d=l(this,a,b,c);return h.loadImage(d)},k.prototype.getLogo=function(){if(!this._ready)throw new e("getLogo must not be called before the imagery provider is ready.");return this._logo},k.DefaultParameters=c({service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"}),k}),c("Scene/ImageryProviderError",["../Core/defaultValue","../Core/loadImage","../Core/DeveloperError","../Core/throttleRequestByServer"],function(a,b,c,d){var e=function(c,d,e,f,g,h){this.imageryProvider=c,this.message=d,this.x=e,this.y=f,this.level=g,this.timesRetried=a(h,0),this.retry=!1};return e.handleError=function(a,b,c,d,f,g,h,i){var j=a;return typeof a=="undefined"?j=new e(b,d,f,g,h,0):(j.imageryProvider=b,j.message=d,j.x=f,j.y=g,j.level=h,j.retry=!1,++j.timesRetried),c.getNumberOfListeners()>0?c.raiseEvent(j):(console.log('An error occurred in "'+b.constructor.name+'":'),console.log(d)),j.retry&&typeof i!="undefined"&&i(),j},e.handleSuccess=function(a){typeof a!="undefined"&&(a.timesRetried=-1)},e}),c("Renderer/loadCubeMap",["../Core/defaultValue","../Core/DeveloperError","../Core/loadImage","../ThirdParty/when"],function(a,b,c,d){var e=function(a,e,f){function h(b){if(typeof g=="undefined")g=a.createCubeMap({width:b.width,height:b.height});else if(g.getWidth()!==b.width||g.getHeight()!==b.height)g.destroy(),i.reject("Cube map faces do not have the same dimensions.");return g}function k(){++j===6&&i.resolve(g)}function l(a){g=g&&g.destroy(),i.reject(a)}if(typeof a=="undefined")throw new b("context is required.");if(typeof e=="undefined"||typeof e.positiveX=="undefined"||typeof e.negativeX=="undefined"||typeof e.positiveY=="undefined"||typeof e.negativeY=="undefined"||typeof e.positiveZ=="undefined"||typeof e.negativeZ=="undefined")throw new b("urls is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");var g,i=d.defer(),j=0;return c(e.positiveX,f).then(function(a){h(a).getPositiveX().copyFrom(a),k()},l),c(e.negativeX,f).then(function(a){h(a).getNegativeX().copyFrom(a),k()},l),c(e.positiveY,f).then(function(a){h(a).getPositiveY().copyFrom(a),k()},l),c(e.negativeY,f).then(function(a){h(a).getNegativeY().copyFrom(a),k()},l),c(e.positiveZ,f).then(function(a){h(a).getPositiveZ().copyFrom(a),k()},l),c(e.negativeZ,f).then(function(a){h(a).getNegativeZ().copyFrom(a),k()},l),i.promise};return e}),c("Scene/SkyBox",["../Core/BoxTessellator","../Core/Cartesian3","../Core/destroyObject","../Core/DeveloperError","../Core/Matrix4","../Core/MeshFilters","../Core/PrimitiveType","../Renderer/loadCubeMap","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/BlendingState","../Scene/SceneMode","../Shaders/SkyBoxVS","../Shaders/SkyBoxFS"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=function(a){if(typeof a=="undefined"||typeof a.positiveX=="undefined"||typeof a.negativeX=="undefined"||typeof a.positiveY=="undefined"||typeof a.negativeY=="undefined"||typeof a.positiveZ=="undefined"||typeof a.negativeZ=="undefined")throw new d("sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof a.positiveX!=typeof a.negativeX||typeof a.positiveX!=typeof a.positiveY||typeof a.positiveX!=typeof a.negativeY||typeof a.positiveX!=typeof a.positiveZ||typeof a.positiveX!=typeof a.negativeZ)throw new d("sources properties must all be the same type.");this._command=new j,this._cubeMap=undefined,this._sources=a,this.show=!0,this.morphTime=1};return o.prototype.getSources=function(){return this._sources},o.prototype.update=function(c,d){if(!this.show)return undefined;if(d.mode!==l.SCENE3D&&d.mode!==l.MORPHING)return undefined;if(!d.passes.color)return undefined;var j=this._command;if(typeof j.vertexArray=="undefined"){var o=this._sources,p=this;typeof o.positiveX=="string"?h(c,this._sources).then(function(a){p._cubeMap=a}):this._cubeMap=c.createCubeMap({source:o}),j.uniformMap={u_cubeMap:function(){return p._cubeMap},u_morphTime:function(){return p.morphTime}};var q=a.compute({dimensions:new b(2,2,2)}),r=f.createAttributeIndices(q);j.primitiveType=g.TRIANGLES,j.modelMatrix=e.IDENTITY.clone(),j.vertexArray=c.createVertexArrayFromMesh({mesh:q,attributeIndices:r,bufferUsage:i.STATIC_DRAW}),j.shaderProgram=c.getShaderCache().getShaderProgram(m,n,r),j.renderState=c.createRenderState({blending:k.ALPHA_BLEND})}return typeof this._cubeMap=="undefined"?undefined:j},o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){var a=this._command;return a.vertexArray=a.vertexArray&&a.vertexArray.destroy(),a.shaderProgram=a.shaderProgram&&a.shaderProgram.release(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),c(this)},o}),c("Scene/DiscardMissingTileImagePolicy",["../Core/defaultValue","../Core/loadImage","../Core/getImagePixels","../Core/DeveloperError","../ThirdParty/when"],function(a,b,c,d,e){var f=function(f){function h(a){var b=c(a);if(f.disableCheckIfAllPixelsAreTransparent){var d=!0,e=a.width,h=f.pixelsToCheck;for(var i=0,j=h.length;d&&i<j;++i){var k=h[i],l=k.x*4+k.y*e,m=b[l+3];m>0&&(d=!1)}d&&(b=undefined)}g._missingImagePixels=b,g._isReady=!0}function i(){g._missingImagePixels=undefined,g._isReady=!0}f=a(f,{});if(typeof f.missingImageUrl=="undefined")throw new d("description.missingImageUrl is required.");if(typeof f.pixelsToCheck=="undefined")throw new d("description.pixelsToCheck is required.");this._pixelsToCheck=f.pixelsToCheck,this._missingImagePixels=undefined,this._isReady=!1;var g=this;e(b(f.missingImageUrl),h,i)};return f.prototype.isReady=function(){return this._isReady},f.prototype.shouldDiscardImage=function(a){if(!this._isReady)throw new d("shouldDiscardImage must not be called before the discard policy is ready.");var b=this._pixelsToCheck,e=this._missingImagePixels;if(typeof e=="undefined")return!1;var f=c(a),g=a.width;for(var h=0,i=b.length;h<i;++h){var j=b[h],k=j.x*4+j.y*g;for(var l=0;l<4;++l){var m=k+l;if(f[m]!==e[m])return!1}}return!0},f}),c("Scene/ArcGisMapServerImageryProvider",["../Core/defaultValue","../Core/jsonp","../Core/writeTextToCanvas","../Core/Cartesian2","../Core/DeveloperError","../Core/Event","../Core/RuntimeError","./DiscardMissingTileImagePolicy","./GeographicTilingScheme","./ImageryProvider","./ImageryProviderError","./WebMercatorTilingScheme","../ThirdParty/when"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function o(a,b,c,d){var e;if(a._useTiles)e=a._url+"/tile/"+d+"/"+c+"/"+b;else{var f=a._tilingScheme.tileXYToNativeExtent(b,c,d),g=f.west+"%2C"+f.south+"%2C"+f.east+"%2C"+f.north;e=a._url+"/export?",e+="bbox="+g,e+="&bboxSR=4326&size=256%2C256&imageSR=4326&format=png&transparent=true&f=image"}var h=a._proxy;return typeof h!="undefined"&&(e=h.getURL(e)),e}var n=function(j){function q(a){var b=a.tileInfo;if(!n._useTiles||typeof b=="undefined")n._tileWidth=256,n._tileHeight=256,n._tilingScheme=new i,n._useTiles=!1;else{n._tileWidth=b.rows,n._tileHeight=b.cols;if(b.spatialReference.wkid===102100)n._tilingScheme=new l;else{if(a.tileInfo.spatialReference.wkid!==4326){var e="Tile spatial reference WKID "+a.tileInfo.spatialReference.wkid+" is not supported.";p=k.handleError(p,n,n._errorEvent,e,undefined,undefined,undefined,s);return}n._tilingScheme=new i}n._maximumLevel=a.tileInfo.lods.length-1,typeof n._tileDiscardPolicy=="undefined"&&(n._tileDiscardPolicy=new h({missingImageUrl:o(n,0,0,n._maximumLevel),pixelsToCheck:[new d(0,0),new d(200,20),new d(20,200),new d(80,110),new d(160,130)],disableCheckIfAllPixelsAreTransparent:!0})),n._useTiles=!0}typeof a.copyrightText!="undefined"&&a.copyrightText.length>0&&(n._logo=c(a.copyrightText,{font:"12px sans-serif"})),n._ready=!0,k.handleSuccess(p)}function r(a){var b="An error occurred while accessing "+n._url+".";p=k.handleError(p,n,n._errorEvent,b,undefined,undefined,undefined,s)}function s(){var a=b(n._url,{parameters:{f:"json"},proxy:n._proxy});m(a,q,r)}j=a(j,{});if(typeof j.url=="undefined")throw new e("description.url is required.");this._url=j.url,this._tileDiscardPolicy=j.tileDiscardPolicy,this._proxy=j.proxy,this._tileWidth=undefined,this._tileHeight=undefined,this._maximumLevel=undefined,this._tilingScheme=undefined,this._logo=undefined,this._useTiles=a(j.usePreCachedTilesIfAvailable,!0),this._errorEvent=new f,this._ready=!1;var n=this,p;s()};return n.prototype.isUsingPrecachedTiles=function(){return this._useTiles},n.prototype.getUrl=function(){return this._url},n.prototype.getTileWidth=function(){if(!this._ready)throw new e("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},n.prototype.getTileHeight=function(){if(!this._ready)throw new e("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},n.prototype.getMaximumLevel=function(){if(!this._ready)throw new e("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},n.prototype.getTilingScheme=function(){if(!this._ready)throw new e("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},n.prototype.getExtent=function(){if(!this._ready)throw new e("getExtent must not be called before the imagery provider is ready.");return this._tilingScheme.getExtent()},n.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new e("getTileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy},n.prototype.getErrorEvent=function(){return this._errorEvent},n.prototype.isReady=function(){return this._ready},n.prototype.requestImage=function(a,b,c){if(!this._ready)throw new e("requestImage must not be called before the imagery provider is ready.");var d=o(this,a,b,c);return j.loadImage(d)},n.prototype.getLogo=function(){if(!this._ready)throw new e("getLogo must not be called before the imagery provider is ready.");return this._logo},n}),c("Scene/BingMapsImageryProvider",["../Core/defaultValue","../Core/jsonp","../Core/Cartesian2","../Core/DeveloperError","../Core/Event","./BingMapsStyle","./DiscardMissingTileImagePolicy","./ImageryProvider","./ImageryProviderError","./WebMercatorTilingScheme","../ThirdParty/when"],function(a,b,c,d,e,f,g,h,i,j,k){function m(a,b,c,d){var e=a._imageUrlTemplate,f=l.tileXYToQuadKey(b,c,d);e=e.replace("{quadkey}",f);var g=a._imageUrlSubdomains,h=(b+c+d)%g.length;e=e.replace("{subdomain}",g[h]);var i=a._proxy;return typeof i!="undefined"&&(e=i.getURL(e)),e}var l=function(l){function q(a){var b=a.resourceSets[0].resources[0];o._tileWidth=b.imageWidth,o._tileHeight=b.imageHeight,o._maximumLevel=b.zoomMax-1,o._imageUrlSubdomains=b.imageUrlSubdomains,o._imageUrlTemplate=b.imageUrl.replace("{culture}",""),typeof o._tileDiscardPolicy=="undefined"&&(o._tileDiscardPolicy=new g({missingImageUrl:m(o,0,0,o._maximumLevel),pixelsToCheck:[new c(0,0),new c(120,140),new c(130,160),new c(200,50),new c(200,200)],disableCheckIfAllPixelsAreTransparent:!0})),o._ready=!0,i.handleSuccess(p)}function r(a){var b="An error occurred while accessing "+n+".";p=i.handleError(p,o,o._errorEvent,b,undefined,undefined,undefined,s)}function s(){var a=b(n,{callbackParameterName:"jsonp",proxy:o._proxy});k(a,q,r)}l=a(l,{});if(typeof l.server=="undefined")throw new d("description.server is required.");this._server=l.server,this._key=a(l.key,"AquXz3981-1ND5jGs8qQn7R7YUP8qkWi77yZSVM7o3nIvzb-Mg0W2Ta57xuUyywX"),this._mapStyle=a(l.mapStyle,f.AERIAL),this._tileDiscardPolicy=l.tileDiscardPolicy,this._proxy=l.proxy,this.defaultGamma=1;if(this._mapStyle===f.AERIAL||this._mapStyle===f.AERIAL_WITH_LABELS)this.defaultGamma=1.3;this._tilingScheme=new j({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2}),this._tileWidth=undefined,this._tileHeight=undefined,this._maximumLevel=undefined,this._imageUrlTemplate=undefined,this._imageUrlSubdomains=undefined,this._errorEvent=new e,this._ready=!1;var n="http://"+this._server+"/REST/v1/Imagery/Metadata/"+this._mapStyle.imagerySetName+"?key="+this._key,o=this,p;s()};return l.prototype.getServer=function(){return this._server},l.prototype.getKey=function(){return this._key},l.prototype.getMapStyle=function(){return this._mapStyle},l.prototype.getTileWidth=function(){if(!this._ready)throw new d("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},l.prototype.getTileHeight=function(){if(!this._ready)throw new d("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},l.prototype.getMaximumLevel=function(){if(!this._ready)throw new d("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},l.prototype.getTilingScheme=function(){if(!this._ready)throw new d("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},l.prototype.getExtent=function(){if(!this._ready)throw new d("getExtent must not be called before the imagery provider is ready.");return this._tilingScheme.getExtent()},l.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new d("getTileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy},l.prototype.getErrorEvent=function(){return this._errorEvent},l.prototype.isReady=function(){return this._ready},l.prototype.requestImage=function(a,b,c){if(!this._ready)throw new d("requestImage must not be called before the imagery provider is ready.");var e=m(this,a,b,c);return h.loadImage(e)},l.prototype.getLogo=function(){if(!this._ready)throw new d("getLogo must not be called before the imagery provider is ready.");if(typeof l._logo=="undefined"){var a=new Image;a.loaded=!1,a.onload=function(){l._logo.loaded=!0},a.src=l._logoData,l._logo=a}var b=l._logo;return b&&b.loaded?b:undefined},l._logo=undefined,l._logoLoaded=!1,l._logoData="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF0AAAAdCAYAAADIKWCvAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAABBZSURBVHja1FoJdFTVGZ6ZzJZlskMgsrcEoqAQrBhBliKBiBDAgFUL5RQkgIDaKCoqGEBAFkGSgEYrCKgoYtWICLIZBBEOFkX0YEKoDSQo2SczmX36fS/3xscUBAKxp/ecl5eZd99/7/3+/37/cker0Wi0moami4qKCvJ6vVqj0RjEL4KCgvwul8vLe3l5uRdf+cXV2CZPnqwJbHl5eZSpjY2NDcL7Oj2a3+9XxtFqtX632+3FV76qqirK9Ak5fs3/oGGu11Qe1nnJPlpx6cLDw4mNPiQkxARggggSLi8AcuOzG8rwqIC/pFwoUA9lEWyj2Ww28X8+8Hg8EOV1QawTz9xq4C/VrkQxQvHN0fzXAnRauB7AGiIiIsJCQ0PDAFIIPusAjKO+vt5WU1Njs1qtDpvN5v4VgORoioXjboAcc3BwsAWKDA8LCwuFTK3D4aiHrBorBeJ/nU7nUilTeyULlkq4CMDaS6xbGofuUiBxp2P3+7Ecf3FxsXq3+5sCurQ+WroZ4FhGpI1Mur1vvyGYltZaa/156dLF7wDscxhUoR3SDYBsXBCU4gdwftIGJwfL9TudziD00ZtMpuCYmJjY8SmdUgYl1N3H/ierwg4/t+nHPEzOh34eXARcg8VrSW3cYT6fT6seA318Kvk+SXMqalCDGHQhOZynAEX5zLXwOebeCDrH4Fr4v8FgUPrxM+T5eIcRemBQPmDlA/i+pm4Vgq7FAJyoEXdLn9v6pg4dOngCH1ZX19SsXLn8MwzoxoI5OTeA9NJipQB89omJeXH3RUZGerkYNDPkhfXvGX/jA4mfL9D765XFJcRoulnTUirmr69Zh/5OLhSL8IvF6zAOwdCpx4AcjuEDYB6A6qHiAZpXKEDBy2KxBHEdMCCK0As5FKOMC4PSYIp+QZuKAZFG0bRgVfbhQ2UN7AdZjSDxO/QlL7oxVzd2qFso2t9k0LlINAJv9njcRtVW0eFZFC4bJmbARN0EGBcthO9xEfyDf31eLNhJ7heWacD35vjIoNaBg7o9XgPHQp9gAgXZ3ML410DuV/wJ72IX+gQQ0he48MjFBgV4OZYA0IDvjbBsI+4mvEPK1EnQOVeuVewCOncDqNQEZbA/n9F/2bGr6+h3VIATXBqaC3fg7eCO83Xq1IlU0yTg9WJCnAwtg8DrfyFQRV4wJhaHxUTDmrSwbJ2YiFSMH5NUQLDb7XW1tbV15GkuDhM0rt1WeKzOcfPKkTc5h7H/8Z9Cvl35XlEBFmfAQsIgz4/FG8n5bADDjIuAy22vKBTi3fQvGMNah4Y+9QDcRZ6FsvQY04h5QkyYBWIskGumIiX1kGsBqg9yaCF6KMr88COZw264PrGb0Iv/ZHHxwdlPPv7qoUOHsiXdQHarwsLCtR07dhzaq1evUfjswfserE17NfSiyBccGET6UrstbKew4cNH3DBq9OjU1q1axUdGRoQHCqmrs9kBdtWJEyeOZmU9uw7bHr63xsGtDpCCvNFJnvdLg3aUlZbWdu9+YyuH40U9xgphpAQ6CoHFRi5YsCijffu2v4+Ojm6BYMeolk9rr6ioqjx16tR3mzZtevfgwQNFGKOSSqBPYHQEgwiHnJhHH52V3qtX0gD6kkA5DofTda68vMLpcDrbtLkuPvB5YWHREe6YpKSkBwoKCp4aMGDAc9u2bZvSoUOHVKLBXSMM9KoiI73ao0sno+JS/VtvbZofHR1lCQC5HkCQ1zQwUBppCK/4+NbXJSdvH1yw7/PdT81+YmNlZWU9I6H0u9NHJCZ26cr+lVVV1ry8l/bh+1iAZH755Vce6t79hh6CVxtBxhh1Uj6fxcW1iMXV7+abk/oWFRWfyM5elbdnz+4f6BdgGKGPPPLonaNGpd2rNopAOQS5bZvrWl8MjBUrln0MC3Zx82JH/Iw7Zcfl5+cvSklJGQPQvcLR0qleE9D/q1ksYcFqKzly5KvD72x++71vvv66hE5FOCLj+PETBtwx+I67YDyK9aQMHjQ0MfH9m+4ZO2YOF+5Xh2/4wFCSBP7O5nfnqUEoOX2mbNfOXfnr16/bS/4W4ZoxNXVYj3vvu/fPlE8FdO2akPj8888vzMzMXHD48KHTU6ZO6z9u3H0TpOJoFPsPfLHv+cUL3wA49cKAgqdOm56WOnRIKhTQuK4jR/75bfGpUyfhpRwwkiqAbsOcbQMHDlxCeklOTn6YQM+dO/cgeR2WztTFR1prKugEQ09LgRDs7Oj28+cvfDA9fVS6utPp06Vl999/79zq6uoyTKoaW9pOXuN2w2KM4M8wyIjNzJx1z8iRw0fKxZeUnCmbMGH8wuzs3BnXX981QbH0yiprevrds5ctWz4xKalnD2mRa9et3/BK3ks7QNc/Q75Vgk6HxyiI8tPSRiXPmDk9wxLWYAxU0qSJf13ywQcfLKEe+R0Iv37WY7OeO3Bg/3HIqpSgQ3nB4PoorDFu87tbFsa1bBEjx54586GsgoLPjsHPnMbY5RjbjnG9MoIh+HQs+I6Ri4evlZaW+i6Us1x2nC77U3hgh59+Plcxdmz6M+fOnSthvI4J0bs7pNfGO0xk7Viga8GCrLf5HZQ2mve2ba9rnTF12h2BtAUlGTt37txFfj745eGDq3Ozd8LSSrGoSsi3cmFCPsMaDG1zvPXWG/sTEhLapaePVuS3bhUXN2lSxiAJOFv2qpy8vXv3FCL3qgSAVcDKLuSYIZvRjiHr2axVq1fnZAml6tLSRvYBVR2ilTMe4Dt03gwdIZu0qyiHpQsCLQBvsqXr1IBfCPQPP8j/EBljJRwlF1FNS8cEajGpGt7xuRYOrRqgwLdVVSxfvmQrt7d8P6lnz56BuSHjaDV1lZWVnYWMGsqHZXInUXYNxqgGCByzis8IZHb2i582WgwAg5zz/M2OHZ+cgCwH3qMjd9L3MLrizuFnfO88duzrsyLWVlqbtm3aITojXyulCVInI1vMk1SihKkA340QkRZ+wRrUFXO6zChxIUXTnrdl3nxzw2EsuB4AKBN3NjSX2FrM+FgQ08sYGs/cJSUl/05M7KpYcjS85Vm08zStCjkFx1GWA2PUQw4VVg8lS1AArIVxI+N+ZR7qd9u1axuv/pySMrTLhg2vVwBgM/qbmE0KYzJBSSb6kzvvvCtRvTvKSs+eJI+jP52oG8r14LqYNV91YU4nrZzZGBdktdZWqDsMHjwkgXQgkg2m9ibwK4tYRoR7TCyMMjFRshuTydAKoaV832az2y6rQqZVlO3morFrZBGMFyuSHkYUzAoZQajf++77738gj8vP4PzJAwYOTEC6Hot5RoHHoxGaxkRERMQijIzD3KKnTMmYqA4QsrLmbCB/cVcwEQuwZH/ApbkmoDOtFlZsf+3vr+7iRGSH8ePH3wNjjcLEI5FQ8GI5Mhygh2OCESwd4ArH4qCDyGg402EIuy2/8PWXhy89VcXwvSqKO2+R8nsqRoCidlwehLWbyblKxAUnu+KFFc/k5q75G+Lrjrg6tG/fviOuTstfWJmxdevHK+T8+M6GjRs3IECoRj5BSvKw7PxrBa1r0fSCY5nK0zMz2Svfv//Ap4MGDVQyyDZt4luvWfPywzNmPLgCCY+B3EsFMXqhgwQIBlYS0WInT56Syuil0Qn/dK5izeqcHTk5q7v8quZ1SqHJJ6w9cLGyoOaTV8Bm98JQCuDoy6dNnfoAAWXY2qdPcp9du3b1qa6uqWW3wKSOUdSWLe/9Izc3ey+ozEYeF/WdZq/rE3Q/BvUilKLDIZeWP/307NXBwSvCb7vt1tsVZ5jUo8dHH23N2bNn7yc5Oavy2Y90JONocGTP4SOGp4HGu0rBVVXV1jlz57xAC9IEOGgoLIBaFMCVYlOgJasrgKQXPPcGPsOc7Rs3rD/wUf6HRzIypvXr379fSgvkUkzYLpRBs4WHW0LbtWsXH9TQdDLCCoy0ms3SiYOnodVjYdWMvzMzH1n4+BOzxw3o3+8uTpwWNHr0yDEjRtx1t8zyZBytTja4ZQuLTv6A+HlRRUWFjY5Lq9UEgu49P/PVuyCHTsyroheNurSL3cSdRWt0BERCbkY5rNGzGLV06eKSl17KfZ++hzmEKOixiGaGf7px4qSJ4xijM/IZMmTwHUing6dPn7YI1GJiSRp37dVUEC/b0oW1eFjQohfHAgiM59m5z6yBA9qcmfnYGHU9I9B6Amsj+/fvKwRN1jEsY2JTW2M9g23OzFOLHVDBwhjutaJ660eEV8pKpgjTAi3dz/hYJGMMAatramqrpUXa7Ha+a8X3dSyKQbYGY1eyeikiJRbyGAQEr1v3WvnWrfnH33578zzSJp/37v2H5D59b+/86Y7tZ0ExDAR08KnNaunawGM7AM8JMjoJxmKDydes3PH0h4cSDLvG/2VCHzjNKK1G69+9e/fho0e/KmNZVFYB0eyMK0WtPBh9w3lAwrMD+AzWpVnt4skSlWtn7I9Wjjifcb9ThIuNloZAhKgbMbewli1bxsBpx0A5oQDZR2qBr7G7GqIB7gaWmLljqCifTOAAfigunmDFDRkytNvq1blZUv6BL74smDY14ynszB9FvsHd5G2KtV9JRip7+gAYC/Us6JByXOLIrhZgl7N8SjpZvGhhMbcna9T0+FwwLRGLpiU6leIEKISgQ56NoMLyzKzbs5bNgQCUErEAPNaxmcg4eBaL6MgnKsYyctEiOeNpDUuq9XSYAIWOz4guPKwwsTQMhZg4H44N4OqZHPkaGg8naPFOzIF+y33s2DdKciRjdeQSsSwnywOO34rT1cD7haV5eUqCuxJKMkrhVmW8ztMWeczla6gA0cEpFMBLfJagBeF9ngjZ1YvicZg8oBDveHkqJc5LA5sPFuqFopysibDwRLDFcWDIcwsXTxTJkKaosLDw9dfXHmDxCruOPsotDkXMrKFjh5lT7xx2XnJ05kxpMRO7i/mU5gQ9MFTzAnxanUecO9KCdeQ8eQYpowrubIJM7gVNBGZybtCD8o66Do3/Gw99eTEDxOVXW7k8JKG1y/SbZ5SsofPwg6VngKi/tXfvsRERlsiGZOePSPfdKzZvfucg5s+SglOciYaw4NW7d3LXmTNmZKjPAubNm7sWu6PW03DW52tuS9dewXPtr7xzzZKJi8XJ6jNT6grg87QpLA5t0KDBt8ye/eSLoaEhodKxFxWdPJGfn//h9u2fHBflgW7Dhw8f0bnz7xJkFZRJYE5O7pKNG9dvA22dYc2HVUmVT2kWTtdeQwVpLiexUIPXlEREvK8F9RkY7oHLI3G17D9gYM/pD06f1aFDu06XIweUUrps2bLFe/fuOQra+glUxGKbDbTkbKoTbQ7QmzzINd2aAnT+toYRDaMsUAcjrCgoosUtvXt3uWfsn+7u2LHj9SaT0cgTI0EjdU6ny3X27Nl/7dy1c9t7W94l/TB8rQS11LCkS/8FJ+25mjrLbwL6hX5W19xN/mxP/kiK1USEtiHgeQuPB3lAzViXzl8cciu/LGMkg6iFoW0dwGbtnGesdvgXhwBcFtr8zWmE/5egq4GnxQNERlT8iYjy8wv5cw6Gp+L3OhpR4vXJErQ4mXLhXZf4DY36533NCvp/BBgAjIr8TQiNmVwAAAAASUVORK5CYII=",l.tileXYToQuadKey=function(a,b,c){++c;var d="";for(var e=c;e>0;--e){var f="0".charCodeAt(0),g=1<<e-1;(a&g)!==0&&f++,(b&g)!==0&&(f+=2),d+=String.fromCharCode(f)}return d},l.quadKeyToTileXY=function(a){var b={x:0,y:0,level:a.length};for(var c=b.level;c>0;--c){var d=1<<c-1,e=a[b.level-c];e==="1"?b.x|=d:e==="2"?b.y|=d:e==="3"&&(b.x|=d,b.y|=d)}return--b.level,b},l}),c("Scene/EllipsoidTerrainProvider",["../Core/defaultValue","../Core/DeveloperError","../Core/Math","../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/Ellipsoid","../Core/ExtentTessellator","../Core/Occluder","../Core/PlaneTessellator","../Core/TaskProcessor","./TerrainProvider","./TileState","./GeographicTilingScheme","../ThirdParty/when"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(b){b=a(b,{}),this.tilingScheme=a(b.tilingScheme,new o({ellipsoid:a(b.ellipsoid,h.WGS84)})),this.levelZeroMaximumGeometricError=m.getEstimatedLevelZeroGeometricErrorForAHeightmap(this.tilingScheme.getEllipsoid(),64,this.tilingScheme.getNumberOfXTilesAtLevel(0)),this.ready=!0}q.prototype.getLevelMaximumGeometricError=m.prototype.getLevelMaximumGeometricError,q.prototype.requestTileGeometry=function(a){a.state=n.RECEIVED};var r=new l("createVerticesFromExtent");q.prototype.transformGeometry=function(a,b){var c=this.tilingScheme,d=c.getEllipsoid(),e=b.extent;b.center=d.cartographicToCartesian(e.getCenter());var f=16,g=16,h=r.scheduleTask({extent:e,surfaceHeight:0,width:f,height:g,relativeToCenter:b.center,radiiSquared:d.getRadiiSquared()});if(typeof h=="undefined"){b.state=n.RECEIVED;return}p(h,function(a){b.transientData={vertices:a,indices:m.getRegularGridIndices(f,g)},b.state=n.TRANSFORMED},function(a){console.error("failed to transform geometry: "+a),b.state=n.FAILED})};var s=new f;return q.prototype.createResources=function(a,b){var c=b.transientData;b.transientData=undefined,m.createTileEllipsoidGeometryFromBuffers(a,b,c),b.maxHeight=0,b.boundingSphere3D=d.fromVertices(c.vertices,b.center,5);var e=this.tilingScheme.getEllipsoid(),g=b.extent;b.southwestCornerCartesian=e.cartographicToCartesian(g.getSouthwest()),b.southeastCornerCartesian=e.cartographicToCartesian(g.getSoutheast()),b.northeastCornerCartesian=e.cartographicToCartesian(g.getNortheast()),b.northwestCornerCartesian=e.cartographicToCartesian(g.getNorthwest()),b.westNormal=f.UNIT_Z.cross(b.southwestCornerCartesian.negate(s),s).normalize(),b.eastNormal=b.northeastCornerCartesian.negate(s).cross(f.UNIT_Z,s).normalize(),b.southNormal=e.geodeticSurfaceNormal(b.southeastCornerCartesian).cross(b.southwestCornerCartesian.subtract(b.southeastCornerCartesian,s)).normalize(),b.northNormal=e.geodeticSurfaceNormal(b.northwestCornerCartesian).cross(b.northeastCornerCartesian.subtract(b.northwestCornerCartesian,s)).normalize();var h=j.computeOccludeePointFromExtent(b.extent,e);typeof h!="undefined"&&f.multiplyComponents(h,e.getOneOverRadii(),h),b.occludeePointInScaledSpace=h,b.state=n.READY},q}),c("Scene/ImageryLayer",["../Core/defaultValue","../Core/destroyObject","../Core/BoundingRectangle","../Core/ComponentDatatype","../Core/Cartesian2","../Core/Cartesian4","../Core/Color","../Core/DeveloperError","../Core/Event","../Core/Extent","../Core/Math","../Core/PrimitiveType","../Renderer/BufferUsage","../Renderer/MipmapHint","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","./GeographicTilingScheme","./Imagery","./ImageryProviderError","./ImageryState","./TileImagery","./TexturePool","../ThirdParty/when","../Shaders/ReprojectWebMercatorFS","../Shaders/ReprojectWebMercatorVS"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){function B(a,b,c){return JSON.stringify([a,b,c])}function E(b,e,f,h){if(typeof b._fbReproject=="undefined"){b._fbReproject=e.createFramebuffer(),b._fbReproject.destroyAttachments=!1;var i={attributes:{position:{componentDatatype:d.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]}}},j={position:0};b._vaReproject=e.createVertexArrayFromMesh({mesh:i,attributeIndices:j,bufferUsage:m.STATIC_DRAW}),b._spReproject=e.getShaderCache().getShaderProgram(z,y,j),b._rsColor=e.createRenderState()}var k=e.getMaximumTextureFilterAnisotropy();f.setSampler({wrapS:q.CLAMP,wrapT:q.CLAMP,minificationFilter:p.LINEAR,magnificationFilter:o.LINEAR,maximumAnisotropy:Math.min(k,a(b._maximumAnisotropy,k))});var r=f.getWidth(),s=f.getHeight();C.textureDimensions.x=r,C.textureDimensions.y=s,C.texture=f,C.northLatitude=h.north,C.southLatitude=h.south;var t=Math.sin(h.south),u=.5*Math.log((1+t)/(1-t));D[0]=u,C.southMercatorYHigh=D[0],C.southMercatorYLow=u-D[0],t=Math.sin(h.north);var v=.5*Math.log((1+t)/(1-t));C.oneOverMercatorHeight=1/(v-u);var w=b._texturePool.createTexture2D(e,{width:r,height:s,pixelFormat:f.getPixelFormat(),pixelDatatype:f.getPixelDatatype(),preMultiplyAlpha:f.getPreMultiplyAlpha()});w.generateMipmap(n.NICEST),b._fbReproject.setColorTexture(w),e.clear(e.createClearState({framebuffer:b._fbReproject,color:new g(0,0,0,0)}));var x=b._rsColor,A=x.viewport;return typeof A=="undefined"&&(A=new c,x.viewport=A),A.width=r,A.height=s,e.draw({framebuffer:b._fbReproject,shaderProgram:b._spReproject,renderState:x,primitiveType:l.TRIANGLE_FAN,vertexArray:b._vaReproject,uniformMap:C}),w}function F(a,b,c){var d=a._imageryProvider,e=d.getTilingScheme(),f=e.getEllipsoid(),g=Math.cos(c),h=e.getExtent(),i=f.getMaximumRadius()*(h.east-h.west)*g/(d.getTileWidth()*e.getNumberOfXTilesAtLevel(0)),j=i/b,k=Math.log(j)/Math.log(2),l=Math.round(k);return l|0}var A=function(c,d){this._imageryProvider=c,d=a(d,{}),this.alpha=a(d.alpha,a(c.defaultAlpha,1)),this.brightness=a(d.brightness,a(c.defaultBrightness,1)),this.contrast=a(d.contrast,a(c.defaultContrast,1)),this.gamma=a(d.gamma,a(c.defaultGamma,1)),this.show=a(d.show,!0),this._extent=a(d.extent,j.MAX_VALUE),this._maximumAnisotropy=d.maximumAnisotropy,this._imageryCache={},this._texturePool=new w,this._spReproject=undefined,this._vaReproject=undefined,this._fbReproject=undefined,this._skeletonPlaceholder=new v(s.createPlaceholder(this)),this._show=!1,this._layerIndex=-1,this._isBaseLayer=!1,this._requestImageError=undefined};A.prototype.getImageryProvider=function(){return this._imageryProvider},A.prototype.getExtent=function(){return this._extent},A.prototype.isBaseLayer=function(){return this._isBaseLayer},A.prototype.isDestroyed=function(){return!1},A.prototype.destroy=function(){return this._texturePool=this._texturePool&&this._texturePool.destroy(),b(this)},A.prototype._createTileImagerySkeletons=function(a,b,c){var d=this._imageryProvider;typeof c=="undefined"&&(c=a.imagery.length);if(!d.isReady())return this._skeletonPlaceholder.imagery.addReference(),a.imagery.splice(c,0,this._skeletonPlaceholder),!0;var e=a.extent.intersectWith(d.getExtent());e=e.intersectWith(this._extent);if(e.east<=e.west||e.north<=e.south)return!1;var g=0;e.south>0?g=e.south:e.north<0&&(g=e.north);var h=1,i=h*b.getLevelMaximumGeometricError(a.level),j=F(this,i,g);j=Math.max(0,j);var k=d.getMaximumLevel();j>k&&(j=k);var l=d.getTilingScheme(),m=l.positionToTileXY(e.getNorthwest(),j),n=l.positionToTileXY(e.getSoutheast(),j),o=(a.extent.north-a.extent.south)/512,p=(a.extent.east-a.extent.west)/512,q=l.tileXYToExtent(m.x,m.y,j);Math.abs(q.south-e.north)<p&&++m.y,Math.abs(q.east-e.west)<o&&++m.x;var r=l.tileXYToExtent(n.x,n.y,j);Math.abs(r.north-e.south)<p&&--n.y,Math.abs(r.west-e.east)<o&&--n.x;var s=l.getNumberOfXTilesAtLevel(j),t=l.getNumberOfYTilesAtLevel(j),u=a.extent,w=l.tileXYToExtent(m.x,m.y,j),x,y=0,z=1,A;!this.isBaseLayer()&&m.x===0&&(y=Math.min(1,(w.west-u.west)/(u.east-u.west))),!this.isBaseLayer()&&m.y===0&&(z=Math.max(0,(w.north-u.south)/(u.north-u.south)));var B=z;for(var C=m.x;C<=n.x;C++){x=y,w=l.tileXYToExtent(C,m.y,j),y=Math.min(1,(w.east-u.west)/(u.east-u.west)),C===n.x&&(this.isBaseLayer()||C<s-1)&&(y=1),z=B;for(var D=m.y;D<=n.y;D++){A=z,w=l.tileXYToExtent(C,D,j),z=Math.max(0,(w.south-u.south)/(u.north-u.south)),D===n.y&&(this.isBaseLayer()||D<t-1)&&(z=0);var E=new f(x,z,y,A),G=this.getImageryFromCache(C,D,j,w);a.imagery.splice(c,0,new v(G,E)),++c}}return!0},A.prototype._calculateTextureTranslationAndScale=function(a,b){var c=b.imagery.extent,d=a.extent,e=d.east-d.west,g=d.north-d.south,h=e/(c.east-c.west),i=g/(c.north-c.south);return new f(h*(d.west-c.west)/e,i*(d.south-c.south)/g,h,i)},A.prototype._requestImagery=function(a){function d(b){if(typeof b=="undefined")return e();a.image=b,a.state=u.RECEIVED,t.handleSuccess(c._requestImageError)}function e(d){a.state=u.FAILED;var e="Failed to obtain image tile X: "+a.x+" Y: "+a.y+" Level: "+a.level+".";c._requestImageError=t.handleError(c._requestImageError,b,b.getErrorEvent(),e,a.x,a.y,a.level,f)}function f(){a.state=u.TRANSITIONING;var c=b.requestImage(a.x,a.y,a.level);if(typeof c=="undefined"){a.state=u.UNLOADED;return}x(c,d,e)}var b=this._imageryProvider,c=this;f()},A.prototype._createTexture=function(a,b){var c=this._imageryProvider;if(typeof c.getTileDiscardPolicy!="undefined"){var d=c.getTileDiscardPolicy();if(typeof d!="undefined"){if(!d.isReady()){b.state=u.RECEIVED;return}if(d.shouldDiscardImage(b.image)){b.state=u.INVALID;return}}}var e=this._texturePool.createTexture2D(a,{source:b.image});b.texture=e,b.image=undefined,b.state=u.TEXTURE_LOADED},A.prototype._reprojectTexture=function(b,c){var d=c.texture,e=c.extent;if(!(this._imageryProvider.getTilingScheme()instanceof r)&&(e.east-e.west)/d.getWidth()>1e-5){var f=E(this,b,d,c.extent);d.destroy(),c.texture=d=f}var g=b.getMaximumTextureFilterAnisotropy();k.isPowerOfTwo(d.getWidth())&&k.isPowerOfTwo(d.getHeight())?(d.generateMipmap(n.NICEST),d.setSampler({wrapS:q.CLAMP,wrapT:q.CLAMP,minificationFilter:p.LINEAR_MIPMAP_LINEAR,magnificationFilter:o.LINEAR,maximumAnisotropy:Math.min(g,a(this._maximumAnisotropy,g))})):d.setSampler({wrapS:q.CLAMP,wrapT:q.CLAMP,minificationFilter:p.LINEAR,magnificationFilter:o.LINEAR}),c.state=u.READY},A.prototype.getImageryFromCache=function(a,b,c,d){var e=B(a,b,c),f=this._imageryCache[e];return typeof f=="undefined"&&(f=new s(this,a,b,c,d),this._imageryCache[e]=f),f.addReference(),f},A.prototype.removeImageryFromCache=function(a){var b=B(a.x,a.y,a.level);delete this._imageryCache[b]};var C={u_textureDimensions:function(){return this.textureDimensions},u_texture:function(){return this.texture},u_northLatitude:function(){return this.northLatitude},u_southLatitude:function(){return this.southLatitude},u_southMercatorYLow:function(){return this.southMercatorYLow},u_southMercatorYHigh:function(){return this.southMercatorYHigh},u_oneOverMercatorHeight:function(){return this.oneOverMercatorHeight},textureDimensions:new e(0,0),texture:undefined,northLatitude:0,southLatitude:0,southMercatorYHigh:0,southMercatorYLow:0,oneOverMercatorHeight:0},D=typeof Float32Array=="undefined"?undefined:new Float32Array(1);return A}),c("Scene/ImageryLayerCollection",["../Core/DeveloperError","../Core/defaultValue","../Core/destroyObject","../Core/Event","../Core/Math","./ImageryLayer"],function(a,b,c,d,e,f){function h(b,c){if(typeof c=="undefined")throw new a("layer is required.");var d=b.indexOf(c);if(d===-1)throw new a("layer is not in this collection.");return d}function i(a,b,c){var d=a._layers;b=e.clamp(b,0,d.length-1),c=e.clamp(c,0,d.length-1);if(b===c)return;var f=d[b];d[b]=d[c],d[c]=f,a._update(),a.layerMoved.raiseEvent(f,c,b)}var g=function(){this._layers=[],this.layerAdded=new d,this.layerRemoved=new d,this.layerMoved=new d,this.layerShownOrHidden=new d};return g.prototype.add=function(b,c){if(typeof b=="undefined")throw new a("layer is required.");if(typeof c=="undefined")c=this._layers.length,this._layers.push(b);else{if(c<0)throw new a("index must be greater than or equal to zero.");if(c>this._layers.length)throw new a("index must be less than or equal to the number of layers.");this._layers.splice(c,0,b)}this._update(),this.layerAdded.raiseEvent(b,c)},g.prototype.addImageryProvider=function(b,c){if(typeof b=="undefined")throw new a("imageryProvider is required.");var d=new f(b);return this.add(d,c),d},g.prototype.remove=function(a,c){c=b(c,!0);var d=this._layers.indexOf(a);return d!==-1?(this._layers.splice(d,1),this._update(),this.layerRemoved.raiseEvent(a,d),c&&a.destroy(),!0):!1},g.prototype.removeAll=function(a){a=b(a,!0);var c=this._layers;for(var d=0,e=c.length;d<e;d++){var f=c[d];this.layerRemoved.raiseEvent(f,d),a&&f.destroy()}this._layers=[]},g.prototype.contains=function(a){return this.indexOf(a)!==-1},g.prototype.indexOf=function(a){return this._layers.indexOf(a)},g.prototype.get=function(b){if(typeof b=="undefined")throw new a("index is required.","index");return this._layers[b]},g.prototype.getLength=function(){return this._layers.length},g.prototype.raise=function(a){var b=h(this._layers,a);i(this,b,b+1)},g.prototype.lower=function(a){var b=h(this._layers,a);i(this,b,b-1)},g.prototype.raiseToTop=function(a){var b=h(this._layers,a);this._layers.splice(b,1),this._layers.push(a),this._update(),this.layerMoved.raiseEvent(a,this._layers.length-1,b)},g.prototype.lowerToBottom=function(a){var b=h(this._layers,a);this._layers.splice(b,1),this._layers.splice(0,0,a),this._update(),this.layerMoved.raiseEvent(a,0,b)},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return this.removeAll(!0),c(this)},g.prototype._update=function(){var a=!0,b=this._layers,c,d;for(var e=0,f=b.length;e<f;++e)d=b[e],d._layerIndex=e,d.show?(d._isBaseLayer=a,a=!1):d._isBaseLayer=!1,d.show!==d._show&&(d._show=d.show,typeof c=="undefined"&&(c=[]),c.push(d));if(typeof c!="undefined")for(e=0,f=c.length;e<f;++e)d=c[e],this.layerShownOrHidden.raiseEvent(d,d._layerIndex,d.show)},g}),c("Scene/CentralBody",["../Core/combine","../Core/defaultValue","../Core/destroyObject","../Core/BoundingRectangle","../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/ComponentDatatype","../Core/CubeMapEllipsoidTessellator","../Core/Ellipsoid","../Core/Extent","../Core/GeographicProjection","../Core/Intersect","../Core/Math","../Core/Matrix4","../Core/MeshFilters","../Core/Occluder","../Core/PrimitiveType","../Core/Transforms","../Renderer/BufferUsage","../Renderer/ClearCommand","../Renderer/CommandLists","../Renderer/CullFace","../Renderer/DepthFunction","../Renderer/DrawCommand","../Renderer/PixelFormat","../Renderer/BlendingState","./CentralBodySurface","./CentralBodySurfaceShaderSet","./EllipsoidTerrainProvider","./ImageryLayerCollection","./SceneMode","./ViewportQuad","../Shaders/CentralBodyFS","../Shaders/CentralBodyFSDepth","../Shaders/CentralBodyFSPole","../Shaders/CentralBodyVS","../Shaders/CentralBodyVSDepth","../Shaders/CentralBodyVSPole"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O){function U(a,b,c,e){T.logos=a._logos,T.logoIndex=0,T.rebuildLogo=!1,T.totalLogoWidth=0,T.totalLogoHeight=0,V(T,a._surface._terrainProvider);var f=a._imageryLayerCollection;for(var g=0,h=f.getLength();g<h;++g){var i=f.get(g);i.show&&V(T,i.getImageryProvider())}T.logos.length!==T.logoIndex&&(T.rebuildLogo=!0,T.logos.length=T.logoIndex);if(T.rebuildLogo){var j=T.totalLogoWidth,k=T.totalLogoHeight,l=new d(a.logoOffset.x,a.logoOffset.y,j,k);typeof a._logoQuad=="undefined"?(a._logoQuad=new I(l),a._logoQuad.enableBlending=!0):a._logoQuad.setRectangle(l);var m=a._logoQuad.getTexture();if(typeof m=="undefined"||m.getWidth()!==j||m.getHeight()!==k)j===0||k===0?typeof m!="undefined"&&(a._logoQuad.destroy(),a._logoQuad=undefined):(m=b.createTexture2D({width:j,height:k}),a._logoQuad.setTexture(m));var n=0;for(g=0,h=T.logos.length;g<h;g++){var o=T.logos[g];typeof o!="undefined"&&(m.copyFrom(o,0,n),n+=o.height+2)}}typeof a._logoQuad!="undefined"&&a._logoQuad.update(b,c,e)}function V(a,b){if(typeof b.isReady=="function"&&!b.isReady())return;var c;typeof b.getLogo=="function"?c=b.getLogo():c=undefined,a.logos[a.logoIndex]!==c&&(a.rebuildLogo=!0,a.logos[a.logoIndex]=c),a.logoIndex++,typeof c!="undefined"&&(a.totalLogoWidth=Math.max(a.totalLogoWidth,c.width),a.totalLogoHeight+=c.height+2)}var P=function(a){a=b(a,l.WGS84);var c=new F({ellipsoid:a}),d=new G;this._ellipsoid=a,this._imageryLayerCollection=d,this._surface=new D({terrainProvider:c,imageryLayerCollection:d}),this._occluder=new s(new e(g.ZERO,a.getMinimumRadius()),g.ZERO),this._surfaceShaderSet=new E(Q),this._rsColor=undefined,this._rsColorWithoutDepthTest=undefined,this._clearDepthCommand=new w,this._depthCommand=new A,this._depthCommand.primitiveType=t.TRIANGLES,this._depthCommand.boundingVolume=new e(g.ZERO,a.getMaximumRadius()),this._northPoleCommand=new A,this._northPoleCommand.primitiveType=t.TRIANGLE_FAN,this._southPoleCommand=new A,this._southPoleCommand.primitiveType=t.TRIANGLE_FAN,this._drawNorthPole=!1,this._drawSouthPole=!1,this._commandLists=new x,this.northPoleColor=new g(2/255,6/255,18/255),this.southPoleColor=new g(1,1,1),this.logoOffset=f.ZERO,this._logoOffset=this.logoOffset,this._logos=[],this._logoQuad=undefined,this.show=!0,this.morphTime=1,this._mode=H.SCENE3D,this._projection=undefined;var h=this;this._drawUniforms={u_mode:function(){return h._mode},u_morphTime:function(){return h.morphTime}}},Q={position3D:0,textureCoordinates:1};P.prototype.getEllipsoid=function(){return this._ellipsoid},P.prototype.getImageryLayers=function(){return this._imageryLayerCollection},P.prototype._computeDepthQuad=function(a){var b=this._ellipsoid.getRadii(),c=a.camera.getPositionWC(),d=this._ellipsoid.getOneOverRadii().multiplyComponents(c),e=d.magnitude(),f=d.normalize(),h=g.UNIT_Z.cross(d).normalize(),i=f.cross(h).normalize(),j=Math.sqrt(d.magnitudeSquared()-1),k=f.multiplyByScalar(1/e),l=j/e,m=h.multiplyByScalar(l),n=i.multiplyByScalar(l),o=b.multiplyComponents(k.add(n).subtract(m)),p=b.multiplyComponents(k.add(n).add(m)),q=b.multiplyComponents(k.subtract(n).subtract(m)),r=b.multiplyComponents(k.subtract(n).add(m));return[o.x,o.y,o.z,q.x,q.y,q.z,p.x,p.y,p.z,r.x,r.y,r.z]},P.prototype._computePoleQuad=function(a,b,c,e,f){var h=this._ellipsoid.cartographicToCartesian(new i(0,c)),j=this._ellipsoid.cartographicToCartesian(new i(Math.PI,c)),k=h.subtract(j).magnitude()*.5,l=this._ellipsoid.cartographicToCartesian(new i(0,b)),m,n=a.camera.direction;1-g.UNIT_Z.negate().dot(n)<p.EPSILON6?m=g.UNIT_X:m=n.cross(g.UNIT_Z).normalize();var o=l.add(m.multiplyByScalar(k)),q=l.add(g.UNIT_Z.cross(m).normalize().multiplyByScalar(k));u.pointToWindowCoordinates(e,f,l,l),u.pointToWindowCoordinates(e,f,o,o),u.pointToWindowCoordinates(e,f,q,q);var r=Math.floor(Math.max(q.subtract(l).magnitude(),o.subtract(l).magnitude())),s=r;return new d(Math.floor(l.x)-r,Math.floor(l.y)-s,r*2,s*2)};var R=new d,S=new q;P.prototype._fillPoles=function(b,c){var d=this._surface._terrainProvider;if(c.mode!==H.SCENE3D)return;if(!d.ready)return;var f=d.tilingScheme.getExtent(),g=b.getUniformState().getViewProjection(),h=R;h.width=b.getCanvas().clientWidth,h.height=b.getCanvas().clientHeight;var i=q.computeViewportTransformation(h,0,1,S),k=.05,l,n,r,t,u,w,x,y,z,A=this._occluder;f.north<p.PI_OVER_TWO&&(l=new m(-Math.PI,f.north,Math.PI,p.PI_OVER_TWO),n=e.fromExtent3D(l,this._ellipsoid),r=c.cullingVolume.getVisibility(n)===o.OUTSIDE,t=s.computeOccludeePointFromExtent(l,this._ellipsoid),u=t&&!A.isPointVisible(t,0)||!A.isBoundingSphereVisible(n),this._drawNorthPole=!r&&!u,this._drawNorthPole&&(y=this._computePoleQuad(c,l.north,l.south-k,g,i),z=[y.x,y.y,y.x+y.width,y.y,y.x+y.width,y.y+y.height,y.x,y.y+y.height],typeof this._northPoleCommand.vertexArray=="undefined"?(this._northPoleCommand.boundingVolume=e.fromExtent3D(l,this._ellipsoid),x={attributes:{position:{componentDatatype:j.FLOAT,componentsPerAttribute:2,values:z}}},this._northPoleCommand.vertexArray=b.createVertexArrayFromMesh({mesh:x,attributeIndices:{position:0},bufferUsage:v.STREAM_DRAW})):(w=j.FLOAT,this._northPoleCommand.vertexArray.getAttribute(0).vertexBuffer.copyFromArrayView(w.toTypedArray(z))))),f.south>-p.PI_OVER_TWO&&(l=new m(-Math.PI,-p.PI_OVER_TWO,Math.PI,f.south),n=e.fromExtent3D(l,this._ellipsoid),r=c.cullingVolume.getVisibility(n)===o.OUTSIDE,t=s.computeOccludeePointFromExtent(l,this._ellipsoid),u=t&&!A.isPointVisible(t)||!A.isBoundingSphereVisible(n),this._drawSouthPole=!r&&!u,this._drawSouthPole&&(y=this._computePoleQuad(c,l.south,l.north+k,g,i),z=[y.x,y.y,y.x+y.width,y.y,y.x+y.width,y.y+y.height,y.x,y.y+y.height],typeof this._southPoleCommand.vertexArray=="undefined"?(this._southPoleCommand.boundingVolume=e.fromExtent3D(l,this._ellipsoid),x={attributes:{position:{componentDatatype:j.FLOAT,componentsPerAttribute:2,values:z}}},this._southPoleCommand.vertexArray=b.createVertexArrayFromMesh({mesh:x,attributeIndices:{position:0},bufferUsage:v.STREAM_DRAW})):(w=j.FLOAT,this._southPoleCommand.vertexArray.getAttribute(0).vertexBuffer.copyFromArrayView(w.toTypedArray(z)))));var B=0,C=this._imageryLayerCollection.getLength()>0?this._imageryLayerCollection.get(0):undefined;typeof C!="undefined"&&typeof C.getImageryProvider()!="undefined"&&typeof C.getImageryProvider().getPoleIntensity!="undefined"&&(B=C.getImageryProvider().getPoleIntensity());var D={u_dayIntensity:function(){return B}},E=this;if(typeof this._northPoleCommand.uniformMap=="undefined"){var F=a([D,{u_color:function(){return E.northPoleColor}}],!1,!1);this._northPoleCommand.uniformMap=a([F,this._drawUniforms],!1,!1)}if(typeof this._southPoleCommand.uniformMap=="undefined"){var G=a([D,{u_color:function(){return E.southPoleColor}}],!1,!1);this._southPoleCommand.uniformMap=a([G,this._drawUniforms],!1,!1)}},P.prototype.update=function(a,b,c){if(!this.show)return;var d=a.getCanvas().clientWidth,e=a.getCanvas().clientHeight;if(d===0||e===0)return;var f=b.mode,g=b.scene2D.projection,h=!1;if(this._mode!==f||typeof this._rsColor=="undefined")h=!0,f===H.SCENE3D?(this._rsColor=a.createRenderState({cull:{enabled:!0},depthTest:{enabled:!0}}),this._rsColorWithoutDepthTest=a.createRenderState({cull:{enabled:!0}}),this._depthCommand.renderState=a.createRenderState({cull:{enabled:!0},depthTest:{enabled:!0,func:z.ALWAYS},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this._clearDepthCommand.clearState=a.createClearState({depth:1,stencil:0})):(this._rsColor=a.createRenderState(),this._rsColorWithoutDepthTest=a.createRenderState(),this._depthCommand.renderState=a.createRenderState());var i=f===H.SCENE3D||f===H.MORPHING;this._rsColor.cull.enabled=i,this._rsColorWithoutDepthTest.cull.enabled=i,this._depthCommand.renderState.cull.enabled=i,this._northPoleCommand.renderState=this._rsColorWithoutDepthTest,this._southPoleCommand.renderState=this._rsColorWithoutDepthTest;var k=this._computeDepthQuad(b);if(!this._depthCommand.vertexArray){var l={attributes:{position:{componentDatatype:j.FLOAT,componentsPerAttribute:3,values:k}},indexLists:[{primitiveType:t.TRIANGLES,values:[0,1,2,2,1,3]}]};this._depthCommand.vertexArray=a.createVertexArrayFromMesh({mesh:l,attributeIndices:{position:0},bufferUsage:v.DYNAMIC_DRAW})}else{var m=j.FLOAT;this._depthCommand.vertexArray.getAttribute(0).vertexBuffer.copyFromArrayView(m.toTypedArray(k))}var o=a.getShaderCache();this._depthCommand.shaderProgram||(this._depthCommand.shaderProgram=o.getShaderProgram(N,"#line 0\n"+K,{position:0}));var p=this._projection!==g;if(typeof this._surfaceShaderSet=="undefined"||typeof this._northPoleCommand.shaderProgram=="undefined"||typeof this._southPoleCommand.shaderProgram=="undefined"||h||p){var q="vec4 getPosition(vec3 position3DWC) { return getPosition3DMode(position3DWC); }",r="vec4 getPosition(vec3 position3DWC) { return getPosition2DMode(position3DWC); }",s="vec4 getPosition(vec3 position3DWC) { return getPositionColumbusViewMode(position3DWC); }",u="vec4 getPosition(vec3 position3DWC) { return getPositionMorphingMode(position3DWC); }",w;switch(f){case H.SCENE3D:w=q;break;case H.SCENE2D:w=r;break;case H.COLUMBUS_VIEW:w=s;break;case H.MORPHING:w=u}var x="float get2DYPositionFraction() { return get2DGeographicYPositionFraction(); }",y="float get2DYPositionFraction() { return get2DMercatorYPositionFraction(); }",A;g instanceof n?A=x:A=y,this._surfaceShaderSet.baseVertexShaderString=M+"\n"+w+"\n"+A,this._surfaceShaderSet.baseFragmentShaderString=J,this._surfaceShaderSet.invalidateShaders();var B=this._northPoleCommand.shaderProgram&&this._northPoleCommand.shaderProgram.release();B=o.getShaderProgram(O,L,Q),this._northPoleCommand.shaderProgram=B,this._southPoleCommand.shaderProgram=B}var C=b.camera.getPositionWC();this._occluder.setCameraPosition(C),this._fillPoles(a,b),this._mode=f,this._projection=g;var D=b.passes,E=this._commandLists;E.removeAll();if(D.color){var F=E.colorList;f===H.SCENE3D&&(this._drawNorthPole&&F.push(this._northPoleCommand),this._drawSouthPole&&F.push(this._southPoleCommand)),this._surface.update(a,b,F,this._drawUniforms,this._surfaceShaderSet,this._rsColor,this._mode,this._projection),U(this,a,b,c),f===H.SCENE3D&&(F.push(this._clearDepthCommand),F.push(this._depthCommand))}D.pick&&E.pickList.push(this._depthCommand),E.empty()||c.push(E)},P.prototype.isDestroyed=function(){return!1},P.prototype.destroy=function(){return this._northPoleCommand.vertexArray=this._northPoleCommand.vertexArray&&this._northPoleCommand.vertexArray.destroy(),this._southPoleCommand.vertexArray=this._southPoleCommand.vertexArray&&this._southPoleCommand.vertexArray.destroy(),this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._northPoleCommand.shaderProgram=this._northPoleCommand.shaderProgram&&this._northPoleCommand.shaderProgram.release(),this._southPoleCommand.shaderProgram=this._northPoleCommand.shaderProgram,this._depthCommand.shaderProgram=this._depthCommand.shaderProgram&&this._depthCommand.shaderProgram.release(),this._depthCommand.vertexArray=this._depthCommand.vertexArray&&this._depthCommand.vertexArray.destroy(),this._surface=this._surface&&this._surface.destroy(),c(this)};var T={logos:undefined,logoIndex:0,rebuildLogo:!1,totalLogoWidth:0,totalLogoHeight:0};return P}),c("Scene/Material",["../ThirdParty/when","../Core/loadImage","../Core/DeveloperError","../Core/createGuid","../Core/clone","../Core/Color","../Core/combine","../Core/defaultValue","../Core/destroyObject","../Core/Matrix2","../Core/Matrix3","../Core/Matrix4","../Renderer/Texture","../Renderer/CubeMap","../Shaders/Materials/AsphaltMaterial","../Shaders/Materials/BlobMaterial","../Shaders/Materials/BrickMaterial","../Shaders/Materials/BumpMapMaterial","../Shaders/Materials/CementMaterial","../Shaders/Materials/CheckerboardMaterial","../Shaders/Materials/DotMaterial","../Shaders/Materials/FacetMaterial","../Shaders/Materials/FresnelMaterial","../Shaders/Materials/GrassMaterial","../Shaders/Materials/NormalMapMaterial","../Shaders/Materials/ReflectionMaterial","../Shaders/Materials/RefractionMaterial","../Shaders/Materials/StripeMaterial","../Shaders/Materials/TieDyeMaterial","../Shaders/Materials/Water","../Shaders/Materials/WoodMaterial"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){function G(a,b,c){a=h(a,{}),c._context=a.context,c._strict=h(a.strict,!1),c._template=h(a.fabric,{}),c._template.uniforms=h(c._template.uniforms,{}),c._template.materials=h(c._template.materials,{}),c.type=typeof c._template.type!="undefined"?c._template.type:d(),c.shaderSource="",c.materials={},c.uniforms={},c._uniforms={};var f=F._materialCache.getMaterial(c.type);if(typeof f!="undefined"){var i=e(f);c._template=g([c._template,i])}return M(c),typeof f=="undefined"&&F._materialCache.addMaterial(c.type,c._template),N(c),b=O(c,b),b=T(c,b),b}function H(a,b,c,d){if(typeof a!="undefined")for(var e in a)if(a.hasOwnProperty(e)){var f=b.indexOf(e)!==-1;(d&&!f||!d&&f)&&c(e,b)}}function I(a,b){var d="fabric: property name '"+a+"' is not valid. It should be ";for(var e=0;e<b.length;e++){var f="'"+b[e]+"'";d+=e===b.length-1?"or "+f+".":f+", "}throw new c(d)}function J(a,b){var d="fabric: uniforms and materials cannot share the same property '"+a+"'";throw new c(d)}function M(a){var b=a._template,d=b.uniforms,e=b.materials,f=b.components;if(typeof f!="undefined"&&typeof b.source!="undefined")throw new c("fabric: cannot have source and components in the same template.");H(b,K,I,!0),H(f,L,I,!0);var g=[];for(var h in e)e.hasOwnProperty(h)&&g.push(h);H(d,g,J,!1)}function N(a){var b=a._template.components,c=a._template.source;if(typeof c!="undefined")a.shaderSource+=c+"\n";else{a.shaderSource+="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n",a.shaderSource+="czm_material material = czm_getDefaultMaterial(materialInput);\n";if(typeof b!="undefined")for(var d in b)b.hasOwnProperty(d)&&(a.shaderSource+="material."+d+" = "+b[d]+";\n");a.shaderSource+="return material;\n}\n"}}function O(a,b){var c=a._template.uniforms;for(var d in c)c.hasOwnProperty(d)&&(b=P(a,d,b));return b}function P(a,b,d){var e=a._strict,f=a._template.uniforms,g=f[b],h=S(g);if(typeof h=="undefined")throw new c("fabric: uniform '"+b+"' has invalid type.");if(h==="channels"){if(U(a,b,g,!1)===0&&e)throw new c("strict: shader source does not use channels '"+b+"'.")}else{if(h.indexOf("sampler")!==-1&&typeof a._context=="undefined")throw new c("image: context is not defined");if(h==="sampler2D"){var i=b+"Dimensions";V(a,i)>0&&(f[i]={type:"ivec3",x:1,y:1},P(a,i))}var j="uniform "+h+" "+b+";\n";a.shaderSource.indexOf(j)===-1&&(a.shaderSource=j+a.shaderSource);var k=b+"_"+d++;if(U(a,b,k)===1&&e)throw new c("strict: shader source does not use uniform '"+b+"'.");a.uniforms[b]=g,a._uniforms[k]=R(a,b,h)}return d}function R(a,b,d){return function(){var e=a.uniforms,f=e[b],g=S(f);if(d==="sampler2D"&&(g===d||f instanceof m)){g===d&&(f=F._textureCache.registerTexture2DToMaterial(a,b,f));var h=b+"Dimensions";if(e.hasOwnProperty(h)){var i=e[h];i.x=f._width,i.y=f._height}}else if(d==="samplerCube"&&(g===d||f instanceof n))g===d&&(f=F._textureCache.registerCubeMapToMaterial(a,b,f));else if(d.indexOf("mat")!==-1&&(g===d||f instanceof Q[d]))g===d&&(f=Q[d].fromColumnMajorArray(f));else if(typeof g=="undefined"||d!==g)throw new c("fabric: uniform '"+b+"' has invalid value.");return e[b]=f,e[b]}}function S(a){var b=a.type;if(typeof b=="undefined"){var c=typeof a;if(c==="number")b="float";else if(c==="boolean")b="bool";else if(c==="string")/^([rgba]){1,4}$/i.test(a)?b="channels":a===F.DefaultCubeMapId?b="samplerCube":b="sampler2D";else if(c==="object")if(Array.isArray(a)){if(a.length===4||a.length===9||a.length===16)b="mat"+Math.sqrt(a.length)}else{var d=0;for(var e in a)a.hasOwnProperty(e)&&(d+=1);d>=2&&d<=4?b="vec"+d:d===6&&(b="samplerCube")}}return b}function T(a,b){var d=a._context,e=a._strict,f=a._template.materials;for(var h in f)if(f.hasOwnProperty(h)){var i={};b=G({context:d,strict:e,fabric:f[h]},b,i),a._uniforms=g([a._uniforms,i._uniforms]),a.materials[h]=i;var j="czm_getMaterial",k=j+"_"+b++;U(i,j,k),a.shaderSource=i.shaderSource+a.shaderSource;var l=k+"(materialInput)";if(U(a,h,l)===0&&e)throw new c("strict: shader source does not use material '"+h+"'.")}return b}function U(a,b,c,d){d=h(d,!0);var e=0,f="a-zA-Z0-9_",g="(["+f+"])?",i="(["+f+(d?".":"")+"])?",j=new RegExp(i+b+g,"g");return a.shaderSource=a.shaderSource.replace(j,function(a,b,d){return b||d?a:(e+=1,c)}),e}function V(a,b,c){return U(a,b,b,c)}var F=function(a){this.type=undefined,this.shaderSource=undefined,this.materials=undefined,this.uniforms=undefined,this._uniforms=undefined,this._context=undefined,this._strict=undefined,this._template=undefined,G(a,0,this),Object.defineProperty(this,"type",{value:this.type,writable:!1})};F.fromType=function(a,b){if(typeof F._materialCache.getMaterial(b)=="undefined")throw new c("material with type '"+b+"' does not exist.");return new F({context:a,fabric:{type:b}})},F.prototype.isDestroyed=function(){return!1},F.prototype.destroy=function(){var a=this.materials,b=this.uniforms;for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];(d instanceof m||d instanceof n)&&F._textureCache.releaseTexture(this,d)}for(var e in a)a.hasOwnProperty(e)&&e.destroy();return i(this)};var K=["type","materials","uniforms","components","source"],L=["diffuse","specular","shininess","normal","emission","alpha"],Q={mat2:j,mat3:k,mat4:l};return F._textureCache={_pathsToMaterials:{},_pathsToTextures:{},_updateMaterialsOnLoad:function(a,b){this._pathsToTextures[b]=a;var c=this._pathsToMaterials[b];for(var d=0;d<c.length;d++){var e=c[d],f=e.material,g=e.property;this.releaseTexture(f,f.uniforms[g]),f.uniforms[g]=a}},releaseTexture:function(a,b){var c=this._pathsToTextures;for(var d in c)if(c[d]===b){var e=this._pathsToMaterials[d];for(var f=0;f<e.length;f++)if(e[f].material===a){e.splice(f,1);var g=e.length;g===0&&(b.destroy(),delete c.path,delete e.path)}}},registerCubeMapToMaterial:function(c,d,e){var f=this,g;if(e===F.DefaultCubeMapId)g=c._context.getDefaultCubeMap();else{var i=e.positiveX+e.negativeX+e.positiveY+e.negativeY+e.positiveZ+e.negativeZ;this._pathsToMaterials[i]=h(this._pathsToMaterials[i],[]),this._pathsToMaterials[i].push({material:c,property:d}),g=this._pathsToTextures[i];if(typeof g=="undefined"){var j=c.uniforms[d],k=j instanceof n;g=k?j:c._context.getDefaultCubeMap(),this._pathsToMaterials[i].length===1&&a.all([b(e.positiveX),b(e.negativeX),b(e.positiveY),b(e.negativeY),b(e.positiveZ),b(e.negativeZ)]).then(function(a){g=c._context.createCubeMap({source:{positiveX:a[0],negativeX:a[1],positiveY:a[2],negativeY:a[3],positiveZ:a[4],negativeZ:a[5]}}),f._updateMaterialsOnLoad(g,i)})}}return g},registerTexture2DToMaterial:function(c,d,e){var f=this,g;if(e===F.DefaultImageId)g=c._context.getDefaultTexture();else{var i=e;this._pathsToMaterials[i]=h(this._pathsToMaterials[i],[]),this._pathsToMaterials[i].push({material:c,property:d}),g=this._pathsToTextures[i];if(typeof g=="undefined"){var j=c.uniforms[d],k=j instanceof m;g=k?j:c._context.getDefaultTexture(),this._pathsToMaterials[i].length===1&&a(b(i),function(a){g=c._context.createTexture2D({source:a}),f._updateMaterialsOnLoad(g,i)})}}return g}},F._materialCache={_materials:{},addMaterial:function(a,b){this._materials[a]=b},getMaterial:function(a){return this._materials[a]}},F.DefaultImageId="czm_defaultImage",F.DefaultCubeMapId="czm_defaultCubeMap",F.ColorType="Color",F._materialCache.addMaterial(F.ColorType,{type:F.ColorType,uniforms:{color:new f(1,0,0,.5)},components:{diffuse:"color.rgb",alpha:"color.a"}}),F.ImageType="Image",F._materialCache.addMaterial(F.ImageType,{type:F.ImageType,uniforms:{image:F.DefaultImageId,repeat:{x:1,y:1}},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).rgb",alpha:"texture2D(image, fract(repeat * materialInput.st)).a"}}),F.DiffuseMapType="DiffuseMap",F._materialCache.addMaterial(F.DiffuseMapType,{type:F.DiffuseMapType,uniforms:{image:F.DefaultImageId,channels:"rgb",repeat:{x:1,y:1}},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).channels"}}),F.AlphaMapType="AlphaMap",F._materialCache.addMaterial(F.AlphaMapType,{type:F.AlphaMapType,uniforms:{image:F.DefaultImageId,channel:"a",repeat:{x:1,y:1}},components:{alpha:"texture2D(image, fract(repeat * materialInput.st)).channel"}}),F.SpecularMapType="SpecularMap",F._materialCache.addMaterial(F.SpecularMapType,{type:F.SpecularMapType,uniforms:{image:F.DefaultImageId,channel:"r",repeat:{x:1,y:1}},components:{specular:"texture2D(image, fract(repeat * materialInput.st)).channel"}}),F.EmissionMapType="EmissionMap",F._materialCache.addMaterial(F.EmissionMapType,{type:F.EmissionMapType,uniforms:{image:F.DefaultImageId,channels:"rgb",repeat:{x:1,y:1}},components:{emission:"texture2D(image, fract(repeat * materialInput.st)).channels"}}),F.BumpMapType="BumpMap",F._materialCache.addMaterial(F.BumpMapType,{type:F.BumpMapType,uniforms:{image:F.DefaultImageId,channel:"r",strength:.8,repeat:{x:1,y:1}},source:r}),F.NormalMapType="NormalMap",F._materialCache.addMaterial(F.NormalMapType,{type:F.NormalMapType,uniforms:{image:F.DefaultImageId,channels:"rgb",strength:.8,repeat:{x:1,y:1}},source:y}),F.ReflectionType="Reflection",F._materialCache.addMaterial(F.ReflectionType,{type:F.ReflectionType,uniforms:{cubeMap:F.DefaultCubeMapId,channels:"rgb"},source:z}),F.RefractionType="Refraction",F._materialCache.addMaterial(F.RefractionType,{type:F.RefractionType,uniforms:{cubeMap:F.DefaultCubeMapId,channels:"rgb",indexOfRefractionRatio:.9},source:A}),F.FresnelType="Fresnel",F._materialCache.addMaterial(F.FresnelType,{type:F.FresnelType,materials:{reflection:{type:F.ReflectionType},refraction:{type:F.RefractionType}},source:w}),F.BrickType="Brick",F._materialCache.addMaterial(F.BrickType,{type:F.BrickType,uniforms:{brickColor:{red:.6,green:.3,blue:.1,alpha:1},mortarColor:{red:.8,green:.8,blue:.7,alpha:1},brickSize:{x:.3,y:.15},brickPct:{x:.9,y:.85},brickRoughness:.2,mortarRoughness:.1},source:q}),F.WoodType="Wood",F._materialCache.addMaterial(F.WoodType,{type:F.WoodType,uniforms:{lightWoodColor:{red:.6,green:.3,blue:.1,alpha:1},darkWoodColor:{red:.4,green:.2,blue:.07,alpha:1},ringFrequency:3,noiseScale:{x:.7,y:.5},grainFrequency:27},source:E}),F.AsphaltType="Asphalt",F._materialCache.addMaterial(F.AsphaltType,{type:F.AsphaltType,uniforms:{asphaltColor:{red:.15,green:.15,blue:.15,alpha:1},bumpSize:.02,roughness:.2},source:o}),F.CementType="Cement",F._materialCache.addMaterial(F.CementType,{type:F.CementType,uniforms:{cementColor:{red:.95,green:.95,blue:.85,alpha:1},grainScale:.01,roughness:.3},source:s}),F.GrassType="Grass",F._materialCache.addMaterial(F.GrassType,{type:F.GrassType,uniforms:{grassColor:{red:.25,green:.4,blue:.1,alpha:1},dirtColor:{red:.1,green:.1,blue:.1,alpha:1},patchiness:1.5},source:x}),F.StripeType="Stripe",F._materialCache.addMaterial(F.StripeType,{type:F.StripeType,uniforms:{horizontal:!0,lightColor:{red:1,green:1,blue:1,alpha:.5},darkColor:{red:0,green:0,blue:1,alpha:.5},offset:0,repeat:5},source:B}),F.CheckerboardType="Checkerboard",F._materialCache.addMaterial(F.CheckerboardType,{type:F.CheckerboardType,uniforms:{lightColor:{red:1,green:1,blue:1,alpha:.5},darkColor:{red:0,green:0,blue:0,alpha:.5},repeat:{x:5,y:5}},source:t}),F.DotType="Dot",F._materialCache.addMaterial(F.DotType,{type:F.DotType,uniforms:{lightColor:{red:1,green:1,blue:0,alpha:.75},darkColor:{red:0,green:1,blue:1,alpha:.75},repeat:{x:5,y:5}},source:u}),F.TyeDyeType="TieDye",F._materialCache.addMaterial(F.TyeDyeType,{type:F.TyeDyeType,uniforms:{lightColor:{red:1,green:1,blue:0,alpha:.75},darkColor:{red:1,green:0,blue:0,alpha:.75},frequency:5},source:C}),F.FacetType="Facet",F._materialCache.addMaterial(F.FacetType,{type:F.FacetType,uniforms:{lightColor:{red:.25,green:.25,blue:.25,alpha:.75},darkColor:{red:.75,green:.75,blue:.75,alpha:.75},frequency:10},source:v}),F.BlobType="Blob",F._materialCache.addMaterial(F.BlobType,{type:F.BlobType,uniforms:{lightColor:{red:1,green:1,blue:1,alpha:.5},darkColor:{red:0,green:0,blue:1,alpha:.5},frequency:10},source:p}),F.WaterType="Water",F._materialCache.addMaterial(F.WaterType,{type:F.WaterType,uniforms:{baseWaterColor:{red:.2,green:.3,blue:.6,alpha:1},blendColor:{red:0,green:1,blue:.699,alpha:1},specularMap:F.DefaultImageId,normalMap:F.DefaultImageId,frequency:10,animationSpeed:.01,amplitude:1,specularIntensity:.5,fadeFactor:1},source:D}),F}),c("DynamicScene/DynamicColorMaterial",["./DynamicProperty","./CzmlColor","../Scene/Material"],function(a,b,c){var d=function(){this.color=undefined};return d.isMaterial=function(a){return typeof a!="undefined"&&typeof a.solidColor!="undefined"},d.prototype.processCzmlIntervals=function(c){var d=c.solidColor;if(typeof d!="undefined"&&typeof d.color!="undefined"){var e=this.color;typeof e=="undefined"&&(this.color=e=new a(b)),e.processCzmlIntervals(d.color)}},d.prototype.getValue=function(a,b,d){if(typeof d=="undefined"||d.type!==c.ColorType)d=c.fromType(b,c.ColorType);return d.uniforms.color=this.color.getValue(a,d.uniforms.color),d},d}),c("DynamicScene/DynamicImageMaterial",["./DynamicProperty","./CzmlImage","./CzmlNumber","../Scene/Material"],function(a,b,c,d){var e=function(){this.image=undefined,this.verticalRepeat=undefined,this.horizontalRepeat=undefined};return e.isMaterial=function(a){return typeof a.image!="undefined"},e.prototype.processCzmlIntervals=function(d,e){var f=d.image;if(typeof f=="undefined")return;if(typeof f.image!="undefined"){var g=this.image;typeof g=="undefined"&&(this.image=g=new a(b)),g.processCzmlIntervals(f.image,undefined,e)}if(typeof f.verticalRepeat!="undefined"){var h=this.verticalRepeat;typeof h=="undefined"&&(this.verticalRepeat=h=new a(c)),h.processCzmlIntervals(f.verticalRepeat)}if(typeof f.horizontalRepeat!="undefined"){var i=this.horizontalRepeat;typeof i=="undefined"&&(this.horizontalRepeat=i=new a(c)),i.processCzmlIntervals(f.horizontalRepeat)}},e.prototype.getValue=function(a,b,c){if(typeof c=="undefined"||c.type!==d.ImageType)c=d.fromType(b,d.ImageType);var e,f=this.verticalRepeat;typeof f!="undefined"&&(e=f.getValue(a),typeof e!="undefined"&&(c.uniforms.repeat.x=e));var g;f=this.horizontalRepeat,typeof f!="undefined"&&(g=f.getValue(a),typeof g!="undefined"&&(c.uniforms.repeat.y=g)),f=this.image;if(typeof f!="undefined"){var h=this.image.getValue(a);typeof h!="undefined"&&c.currentUrl!==h&&(c.currentUrl=h,c.uniforms.image=h)}return c},e}),c("DynamicScene/DynamicMaterialProperty",["../Core/JulianDate","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/Iso8601","./DynamicColorMaterial","./DynamicImageMaterial"],function(a,b,c,d,e,f){var g=[e,f],h=function(){this._intervals=new c};return h.prototype.processCzmlIntervals=function(a,b,c){if(Array.isArray(a))for(var d=0,e=a.length;d<e;d++)this._addCzmlInterval(a[d],b,c);else this._addCzmlInterval(a,b,c)},h.prototype.getValue=function(a,b,c){var d=this._intervals.findIntervalContainingDate(a),e=typeof d!="undefined"?d.data:undefined;return typeof e!="undefined"?e.getValue(a,b,c):c},h.prototype._addCzmlInterval=function(a,c,e){var f=a.interval;typeof f=="undefined"?f=d.MAXIMUM_INTERVAL.clone():f=b.fromIso8601(f),typeof c!="undefined"&&(f=f.intersect(c));var h=this._intervals,i=h.findInterval(f.start,f.stop),j=!1,k;typeof i!="undefined"?(k=i.data,j=k.isMaterial(a)):(i=f,h.addInterval(i));if(j===!1)for(var l=0,m=g.length;l<m;l++){var n=g[l];j=n.isMaterial(a);if(j){i.data=k=new n;break}}j&&k.processCzmlIntervals(a,e)},h}),c("DynamicScene/DynamicCone",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty","./DynamicMaterialProperty"],function(a,b,c,d,e,f,g){var h=function(){this.minimumClockAngle=undefined,this.maximumClockAngle=undefined,this.innerHalfAngle=undefined,this.outerHalfAngle=undefined,this.capMaterial=undefined,this.innerMaterial=undefined,this.outerMaterial=undefined,this.silhouetteMaterial=undefined,this.intersectionColor=undefined,this.showIntersection=undefined,this.radius=undefined,this.show=undefined};return h.processCzmlPacket=function(b,i){var j=i.cone;if(typeof j=="undefined")return!1;var k=!1,l=b.cone;k=typeof l=="undefined",k&&(b.cone=l=new h);var m=j.interval;typeof m!="undefined"&&(m=a.fromIso8601(m));if(typeof j.show!="undefined"){var n=l.show;typeof n=="undefined"&&(l.show=n=new f(c),k=!0),n.processCzmlIntervals(j.show,m)}if(typeof j.innerHalfAngle!="undefined"){var o=l.innerHalfAngle;typeof o=="undefined"&&(l.innerHalfAngle=o=new f(d),k=!0),o.processCzmlIntervals(j.innerHalfAngle,m)}if(typeof j.outerHalfAngle!="undefined"){var p=l.outerHalfAngle;typeof p=="undefined"&&(l.outerHalfAngle=p=new f(d),k=!0),p.processCzmlIntervals(j.outerHalfAngle,m)}if(typeof j.minimumClockAngle!="undefined"){var q=l.minimumClockAngle;typeof q=="undefined"&&(l.minimumClockAngle=q=new f(d),k=!0),q.processCzmlIntervals(j.minimumClockAngle,m)}if(typeof j.maximumClockAngle!="undefined"){var r=l.maximumClockAngle;typeof r=="undefined"&&(l.maximumClockAngle=r=new f(d),k=!0),r.processCzmlIntervals(j.maximumClockAngle,m)}if(typeof j.radius!="undefined"){var s=l.radius;typeof s=="undefined"&&(l.radius=s=new f(d),k=!0),s.processCzmlIntervals(j.radius,m)}if(typeof j.showIntersection!="undefined"){var t=l.showIntersection;typeof t=="undefined"&&(l.showIntersection=t=new f(c),k=!0),t.processCzmlIntervals(j.showIntersection,m)}if(typeof j.intersectionColor!="undefined"){var u=l.intersectionColor;typeof u=="undefined"&&(l.intersectionColor=u=new f(e),k=!0),u.processCzmlIntervals(j.intersectionColor,m)}if(typeof j.capMaterial!="undefined"){var v=l.capMaterial;typeof v=="undefined"&&(l.capMaterial=v=new g,k=!0),v.processCzmlIntervals(j.capMaterial,m)}if(typeof j.innerMaterial!="undefined"){var w=l.innerMaterial;typeof w=="undefined"&&(l.innerMaterial=w=new g,k=!0),w.processCzmlIntervals(j.innerMaterial,m)}if(typeof j.outerMaterial!="undefined"){var x=l.outerMaterial;typeof x=="undefined"&&(l.outerMaterial=x=new g,k=!0),x.processCzmlIntervals(j.outerMaterial,m)}if(typeof j.silhouetteMaterial!="undefined"){var y=l.silhouetteMaterial;typeof y=="undefined"&&(l.silhouetteMaterial=y=new g,k=!0),y.processCzmlIntervals(j.silhouetteMaterial,m)}return k},h.mergeProperties=function(a,c){var d=c.cone;if(typeof d!="undefined"){var e=a.cone;typeof e=="undefined"&&(a.cone=e=new h),e.show=b(e.show,d.show),e.innerHalfAngle=b(e.innerHalfAngle,d.innerHalfAngle),e.outerHalfAngle=b(e.outerHalfAngle,d.outerHalfAngle),e.minimumClockAngle=b(e.minimumClockAngle,d.minimumClockAngle),e.maximumClockAngle=b(e.maximumClockAngle,d.maximumClockAngle),e.radius=b(e.radius,d.radius),e.showIntersection=b(e.showIntersection,d.showIntersection),e.intersectionColor=b(e.intersectionColor,d.intersectionColor),e.capMaterial=b(e.capMaterial,d.capMaterial),e.innerMaterial=b(e.innerMaterial,d.innerMaterial),e.outerMaterial=b(e.outerMaterial,d.outerMaterial),e.silhouetteMaterial=b(e.silhouetteMaterial,d.silhouetteMaterial)}},h.undefineProperties=function(a){a.cone=undefined},h}),c("DynamicScene/DynamicEllipsoid",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlCartesian3","./CzmlColor","./DynamicProperty","./DynamicMaterialProperty"],function(a,b,c,d,e,f,g){var h=function(){this.show=undefined,this.radii=undefined,this.material=undefined};return h.processCzmlPacket=function(b,e,i){var j=e.ellipsoid;if(typeof j=="undefined")return!1;var k=!1,l=b.ellipsoid;k=typeof l=="undefined",k&&(b.ellipsoid=l=new h);var m=j.interval;typeof m!="undefined"&&(m=a.fromIso8601(m));if(typeof j.show!="undefined"){var n=l.show;typeof n=="undefined"&&(l.show=n=new f(c),k=!0),n.processCzmlIntervals(j.show,m)}if(typeof j.radii!="undefined"){var o=l.radii;typeof o=="undefined"&&(l.radii=o=new f(d),k=!0),o.processCzmlIntervals(j.radii,m)}if(typeof j.material!="undefined"){var p=l.material;typeof p=="undefined"&&(l.material=p=new g,k=!0),p.processCzmlIntervals(j.material,m)}return k},h.mergeProperties=function(a,c){var d=c.ellipsoid;if(typeof d!="undefined"){var e=a.ellipsoid;typeof e=="undefined"&&(a.ellipsoid=e=new h),e.show=b(e.show,d.show),e.radii=b(e.radii,d.radii),e.material=b(e.material,d.material)}},h.undefineProperties=function(a){a.ellipsoid=undefined},h}),c("DynamicScene/DynamicPolygon",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./DynamicProperty","./DynamicMaterialProperty"],function(a,b,c,d,e){var f=function(){this.show=undefined,this.material=undefined};return f.processCzmlPacket=function(b,g,h,i){var j=g.polygon;if(typeof j=="undefined")return!1;var k=!1,l=b.polygon;k=typeof l=="undefined",k&&(b.polygon=l=new f);var m=j.interval;typeof m!="undefined"&&(m=a.fromIso8601(m));if(typeof j.show!="undefined"){var n=l.show;typeof n=="undefined"&&(l.show=n=new d(c),k=!0),n.processCzmlIntervals(j.show,m)}if(typeof j.material!="undefined"){var o=l.material;typeof o=="undefined"&&(l.material=o=new e,k=!0),o.processCzmlIntervals(j.material,m,i)}return k},f.mergeProperties=function(a,c){var d=c.polygon;if(typeof d!="undefined"){var e=a.polygon;typeof e=="undefined"&&(a.polygon=e=new f),e.show=b(e.show,d.show),e.material=b(e.material,d.material)}},f.undefineProperties=function(a){a.polygon=undefined},f}),c("DynamicScene/DynamicPyramid",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty","./DynamicDirectionsProperty","./DynamicMaterialProperty"],function(a,b,c,d,e,f,g,h){var i=function(){this.show=undefined,this.directions=undefined,this.radius=undefined,this.showIntersection=undefined,this.intersectionColor=undefined,this.material=undefined};return i.processCzmlPacket=function(b,j,k){var l=j.pyramid;if(typeof l=="undefined")return!1;var m=!1,n=b.pyramid;m=typeof n=="undefined",m&&(b.pyramid=n=new i);var o=l.interval;typeof o!="undefined"&&(o=a.fromIso8601(o));if(typeof l.show!="undefined"){var p=n.show;typeof p=="undefined"&&(n.show=p=new f(c),m=!0),p.processCzmlIntervals(l.show,o)}if(typeof l.radius!="undefined"){var q=n.radius;typeof q=="undefined"&&(n.radius=q=new f(d),m=!0),q.processCzmlIntervals(l.radius,o)}if(typeof l.showIntersection!="undefined"){var r=n.showIntersection;typeof r=="undefined"&&(n.showIntersection=r=new f(c),m=!0),r.processCzmlIntervals(l.showIntersection,o)}if(typeof l.intersectionColor!="undefined"){var s=n.intersectionColor;typeof s=="undefined"&&(n.intersectionColor=s=new f(e),m=!0),s.processCzmlIntervals(l.intersectionColor,o)}if(typeof l.material!="undefined"){var t=n.material;typeof t=="undefined"&&(n.material=t=new h,m=!0),t.processCzmlIntervals(l.material,o)}if(typeof l.directions!="undefined"){var u=n.directions;typeof u=="undefined"&&(n.directions=u=new g,m=!0),u.processCzmlIntervals(l.directions,o)}return m},i.mergeProperties=function(a,c){var d=c.pyramid;if(typeof d!="undefined"){var e=a.pyramid;typeof e=="undefined"&&(a.pyramid=e=new i),e.show=b(e.show,d.show),e.directions=b(e.directions,d.directions),e.radius=b(e.radius,d.radius),e.showIntersection=b(e.showIntersection,d.showIntersection),e.intersectionColor=b(e.intersectionColor,d.intersectionColor),e.material=b(e.material,d.material)}},i.undefineProperties=function(a){a.pyramid=undefined},i}),c("Scene/ComplexConicSensorVolume",["../Core/DeveloperError","../Core/Color","../Core/combine","../Core/destroyObject","../Core/FAR","../Core/Math","../Core/Cartesian3","../Core/Matrix4","../Core/ComponentDatatype","../Core/PrimitiveType","../Core/BoxTessellator","../Core/BoundingSphere","../Renderer/BufferUsage","../Renderer/CommandLists","../Renderer/CullFace","../Renderer/DrawCommand","../Renderer/BlendingState","./Material","../Shaders/Noise","../Shaders/Ray","../Shaders/ConstructiveSolidGeometry","../Shaders/SensorVolume","../Shaders/ComplexConicSensorVolumeVS","../Shaders/ComplexConicSensorVolumeFS","./SceneMode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z={position:0},A=function(a){var c=a||{};this._pickId=undefined,this._colorCommand=new p,this._pickCommand=new p,this._commandLists=new n,this._colorCommand.primitiveType=this._pickCommand.primitiveType=j.TRIANGLES,this._colorCommand.boundingVolume=this._pickCommand.boundingVolume=new l,this.show=typeof c.show=="undefined"?!0:c.show,this.showIntersection=typeof c.showIntersection=="undefined"?!0:c.showIntersection,this.modelMatrix=c.modelMatrix||h.IDENTITY.clone(),this.innerHalfAngle=typeof c.innerHalfAngle=="undefined"?f.PI_OVER_TWO:c.innerHalfAngle,this.outerHalfAngle=typeof c.outerHalfAngle=="undefined"?f.PI_OVER_TWO:c.outerHalfAngle,this._outerHalfAngle=undefined,this.maximumClockAngle=typeof c.maximumClockAngle=="undefined"?Math.PI:c.maximumClockAngle,this._maximumClockAngle=undefined,this.minimumClockAngle=typeof c.minimumClockAngle=="undefined"?-Math.PI:c.minimumClockAngle,this._minimumClockAnglee=undefined,this.radius=typeof c.radius=="undefined"?Number.POSITIVE_INFINITY:c.radius,this._radius=undefined,this.outerMaterial=typeof c.outerMaterial!="undefined"?c.outerMaterial:r.fromType(undefined,r.ColorType),this._outerMaterial=undefined,this.innerMaterial=typeof c.innerMaterial!="undefined"?c.innerMaterial:r.fromType(undefined,r.ColorType),this._innerMaterial=undefined,this.capMaterial=typeof c.capMaterial!="undefined"?c.capMaterial:r.fromType(undefined,r.ColorType),this._capMaterial=undefined,this.silhouetteMaterial=typeof c.silhouetteMaterial!="undefined"?c.silhouetteMaterial:r.fromType(undefined,r.ColorType),this._silhouetteMaterial=undefined,this.intersectionColor=typeof c.intersectionColor!="undefined"?b.clone(c.intersectionColor):b.clone(b.WHITE),this.erosion=typeof c.erosion=="undefined"?1:c.erosion;var d=this;this._uniforms={u_sensorRadius:function(){return isFinite(d.radius)?d.radius:e},u_outerHalfAngle:function(){return d.outerHalfAngle},u_innerHalfAngle:function(){return d.innerHalfAngle},u_maximumClockAngle:function(){return d.maximumClockAngle},u_minimumClockAngle:function(){return d.minimumClockAngle},u_showIntersection:function(){return d.showIntersection},u_intersectionColor:function(){return d.intersectionColor},u_erosion:function(){return d.erosion}},this._mode=y.SCENE3D};return A.prototype._getBoundingVolume=function(){var a=isFinite(this.radius)?this.radius:e,b,c,d;if(this.outerHalfAngle<=f.toRadians(45)){var h=Math.tan(this.outerHalfAngle)*a,m=[g.ZERO,new g(h,-h,a),new g(h,h,a),new g(-h,h,a),new g(-h,-h,a)],n=[];for(var o=0;o<m.length;++o)n.push(m[o].x,m[o].y,m[o].z);b={attributes:{position:{componentDatatype:i.FLOAT,componentsPerAttribute:3,values:n}},indexLists:[{primitiveType:j.TRIANGLES,values:[0,1,4,0,4,3,0,3,2,0,2,1,1,2,3,1,3,4]}]},l.fromPoints(m,this._colorCommand.boundingVolume)}else this.outerHalfAngle<=f.toRadians(90)?(c=new g(-a,-a,0),d=new g(a,a,a),b=k.compute({minimumCorner:c,maximumCorner:d}),l.fromPoints([c,d],this._colorCommand.boundingVolume)):(c=new g(-a,-a,-a),d=new g(a,a,a),b=k.compute({minimumCorner:c,maximumCorner:d}),l.fromPoints([c,d],this._colorCommand.boundingVolume));return b},A.prototype._combineMaterials=function(){var a={czm_getOuterMaterial:this.outerMaterial,czm_getInnerMaterial:this.innerMaterial,czm_getCapMaterial:this.capMaterial,czm_getSilhouetteMaterial:this.silhouetteMaterial},b={},c="";for(var d in a)if(a.hasOwnProperty(d)){var e=a[d],f=e.shaderSource.replace(/czm_getMaterial/g,d),g=e._uniforms;for(var h in g)if(g.hasOwnProperty(h)){var i=1,j=h;while(b.hasOwnProperty(j))j=h+i,i+=1;f=f.replace(new RegExp(h,"g"),j),b[j]=g[h]}c+=f}return{_uniforms:b,shaderSource:c}},A.prototype.update=function(b,d,e){this._mode=d.mode;if(!this.show||this._mode!==y.SCENE3D)return;if(this.innerHalfAngle>this.outerHalfAngle)throw new a("this.innerHalfAngle cannot be greater than this.outerHalfAngle.");if(this.radius<0)throw new a("this.radius must be greater than or equal to zero.");if(typeof this.outerMaterial=="undefined")throw new a("this.outerMaterial must be defined.");if(typeof this.innerMaterial=="undefined")throw new a("this.innerMaterial must be defined.");if(typeof this.capMaterial=="undefined")throw new a("this.capMaterial must be defined.");if(typeof this.silhouetteMaterial=="undefined")throw new a("this.silhouetteMaterial must be defined.");if(this._outerHalfAngle!==this.outerHalfAngle||this._radius!==this.radius)this._outerHalfAngle=this.outerHalfAngle,this._radius=this.radius,this._colorCommand.vertexArray=this._pickCommand.vertexArray=b.createVertexArrayFromMesh({mesh:this._getBoundingVolume(),attributeIndices:z,bufferUsage:m.STATIC_DRAW});typeof this._colorCommand.renderState=="undefined"&&(this._colorCommand.renderState=this._pickCommand.renderState=b.createRenderState({cull:{enabled:!0,face:o.FRONT},blending:q.ALPHA_BLEND}));var f=d.passes;this._colorCommand.modelMatrix=this._colorCommand.modelMatrix=this.modelMatrix,this._commandLists.removeAll();if(f.color){var g=this._outerMaterial!==this.outerMaterial,h=this._innerMaterial!==this.innerMaterial,i=this._capMaterial!==this.capMaterial,j=this._silhouetteMaterial!==this.silhouetteMaterial,k=g||h||i||j;if(k){this._outerMaterial=this.outerMaterial,this._innerMaterial=this.innerMaterial,this._capMaterial=this.capMaterial,this._silhouetteMaterial=this.silhouetteMaterial;var l=this._combineMaterials();this._colorCommand.uniformMap=c([this._uniforms,l._uniforms],!1,!1);var n="#line 0\n"+s+"#line 0\n"+t+"#line 0\n"+u+"#line 0\n"+v+"#line 0\n"+l.shaderSource+"#line 0\n"+x;this._colorCommand.shaderProgram=this._colorCommand.shaderProgram&&this._colorCommand.shaderProgram.release(),this._colorCommand.shaderProgram=b.getShaderCache().getShaderProgram(w,n,z)}this._commandLists.colorList.push(this._colorCommand)}if(f.pick){if(typeof this._pickId=="undefined"){var p="#define RENDER_FOR_PICK 1\n#line 0\n"+t+"#line 0\n"+u+"#line 0\n"+v+"#line 0\n"+x;this._pickCommand.shaderProgram=b.getShaderCache().getShaderProgram(w,p,z),this._pickId=b.createPickId(this);var r=this;this._pickCommand.uniformMap=c([this._uniforms,{u_pickColor:function(){return r._pickId.normalizedRgba}}],!1,!1)}this._commandLists.pickList.push(this._pickCommand)}this._commandLists.empty()||e.push(this._commandLists)},A.prototype.isDestroyed=function(){return!1},A.prototype.destroy=function(){return this._colorCommand.vertexArray=this._colorCommand.vertexArray&&this._colorCommand.vertexArray.destroy(),this._colorCommand.shaderProgram=this._colorCommand.shaderProgram&&this._colorCommand.shaderProgram.release(),this._pickCommand.shaderProgram=this._pickCommand.shaderProgram&&this._pickCommand.shaderProgram.release(),this._pickId=this._pickId&&this._pickId.destroy(),d(this)},A}),c("DynamicScene/DynamicConeVisualizer",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Scene/ComplexConicSensorVolume","../Scene/Material"],function(a,b,c,d,e,f,g,h,i){var j=new f,k=function(a,c){if(typeof a=="undefined")throw new b("scene is required.");this._scene=a,this._unusedIndexes=[],this._primitives=a.getPrimitives(),this._coneCollection=[],this._dynamicObjectCollection=undefined,this.setDynamicObjectCollection(c)};k.prototype.getScene=function(){return this._scene},k.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},k.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(k.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(k.prototype._onObjectsRemoved,this))},k.prototype.update=function(a){if(typeof a=="undefined")throw new b("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(a,c[d])}},k.prototype.removeAllPrimitives=function(){var a,b;for(a=0,b=this._coneCollection.length;a<b;a++)this._primitives.remove(this._coneCollection[a]);if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(a=c.length-1;a>-1;a--)c[a]._coneVisualizerIndex=undefined}this._unusedIndexes=[],this._coneCollection=[]},k.prototype.isDestroyed=function(){return!1},k.prototype.destroy=function(){return this.removeAllPrimitives(),c(this)};var l,m,n;return k.prototype._updateObject=function(b,c){var k=this._scene.getContext(),o=c.cone;if(typeof o=="undefined")return;var p=c.position;if(typeof p=="undefined")return;var q=c.orientation;if(typeof q=="undefined")return;var r,s=o.show,t=c._coneVisualizerIndex,u=c.isAvailable(b)&&(typeof s=="undefined"||s.getValue(b));if(!u){typeof t!="undefined"&&(r=this._coneCollection[t],r.show=!1,c._coneVisualizerIndex=undefined,this._unusedIndexes.push(t));return}if(typeof t=="undefined"){var v=this._unusedIndexes,w=v.length;w>0?(t=v.pop(),r=this._coneCollection[t]):(t=this._coneCollection.length,r=new h,this._coneCollection.push(r),this._primitives.add(r)),c._coneVisualizerIndex=t,r.dynamicObject=c,r.capMaterial=i.fromType(k,i.ColorType),r.innerHalfAngle=0,r.outerHalfAngle=Math.PI,r.innerMaterial=i.fromType(k,i.ColorType),r.intersectionColor=d.YELLOW,r.maximumClockAngle=e.TWO_PI,r.minimumClockAngle=0,r.outerMaterial=i.fromType(k,i.ColorType),r.radius=Number.POSITIVE_INFINITY,r.showIntersection=!0,r.silhouetteMaterial=i.fromType(k,i.ColorType)}else r=this._coneCollection[t];r.show=!0;var x=o.minimumClockAngle;if(typeof x!="undefined"){var y=x.getValue(b);typeof y!="undefined"&&(r.minimumClockAngle=y)}x=o.maximumClockAngle;if(typeof x!="undefined"){var z=x.getValue(b);typeof z!="undefined"?r.maximumClockAngle=z:r.maximumClockAngle=e.TWO_PI}x=o.innerHalfAngle;if(typeof x!="undefined"){var A=x.getValue(b);typeof A!="undefined"&&(r.innerHalfAngle=A)}x=o.outerHalfAngle;if(typeof x!="undefined"){var B=x.getValue(b);typeof B!="undefined"?r.outerHalfAngle=B:r.outerHalfAngle=Math.PI}x=o.radius;if(typeof x!="undefined"){var C=x.getValue(b);typeof C!="undefined"&&(r.radius=C)}l=a(p.getValueCartesian(b,l),r._visualizerPosition),m=a(q.getValue(b,m),r._visualizerOrientation),typeof l!="undefined"&&typeof m!="undefined"&&(!l.equals(r._visualizerPosition)||!m.equals(r._visualizerOrientation))&&(g.fromRotationTranslation(f.fromQuaternion(m,j),l,r.modelMatrix),l.clone(r._visualizerPosition),m.clone(r._visualizerOrientation));var D=o.capMaterial;typeof D!="undefined"&&(r.capMaterial=D.getValue(b,k,r.capMaterial)),D=o.innerMaterial,typeof D!="undefined"&&(r.innerMaterial=D.getValue(b,k,r.innerMaterial)),D=o.outerMaterial,typeof D!="undefined"&&(r.outerMaterial=D.getValue(b,k,r.outerMaterial)),D=o.silhouetteMaterial,typeof D!="undefined"&&(r.silhouetteMaterial=D.getValue(b,k,r.silhouetteMaterial)),x=o.intersectionColor,typeof x!="undefined"&&(n=x.getValue(b,n),typeof n!="undefined"&&(r.intersectionColor=n))},k.prototype._onObjectsRemoved=function(a,b){var c=this._coneCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._coneVisualizerIndex;if(typeof g!="undefined"){var h=c[g];h.show=!1,d.push(g),f._coneVisualizerIndex=undefined}}},k}),c("Scene/CustomSensorVolume",["../Core/DeveloperError","../Core/Color","../Core/combine","../Core/destroyObject","../Core/FAR","../Core/Math","../Core/Cartesian3","../Core/Matrix4","../Core/ComponentDatatype","../Core/PrimitiveType","../Core/BoundingSphere","../Renderer/BufferUsage","../Renderer/BlendingState","../Renderer/CommandLists","../Renderer/DrawCommand","./Material","../Shaders/Noise","../Shaders/SensorVolume","../Shaders/CustomSensorVolumeVS","../Shaders/CustomSensorVolumeFS","./SceneMode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v={position:0,normal:1},w=function(a){var c=a||{};this._pickId=undefined,this._pickIdThis=c._pickIdThis||this,this._colorCommand=new o,this._pickCommand=new o,this._commandLists=new n,this._colorCommand.primitiveType=this._pickCommand.primitiveType=j.TRIANGLES,this._colorCommand.boundingVolume=this._pickCommand.boundingVolume=new k,this.show=typeof c.show=="undefined"?!0:c.show,this.showIntersection=typeof c.showIntersection=="undefined"?!0:c.showIntersection,this.showThroughEllipsoid=typeof c.showThroughEllipsoid=="undefined"?!1:c.showThroughEllipsoid,this.modelMatrix=c.modelMatrix||h.IDENTITY.clone(),this.bufferUsage=c.bufferUsage||l.STATIC_DRAW,this._bufferUsage=c.bufferUsage||l.STATIC_DRAW,this.radius=typeof c.radius=="undefined"?Number.POSITIVE_INFINITY:c.radius,this._directions=undefined,this._directionsDirty=!1,this.setDirections(c.directions),this.material=typeof c.material!="undefined"?c.material:p.fromType(undefined,p.ColorType),this._material=undefined,this.intersectionColor=typeof c.intersectionColor!="undefined"?b.clone(c.intersectionColor):b.clone(b.WHITE),this.erosion=typeof c.erosion=="undefined"?1:c.erosion;var d=this;this._uniforms={u_showThroughEllipsoid:function(){return d.showThroughEllipsoid},u_showIntersection:function(){return d.showIntersection},u_sensorRadius:function(){return isFinite(d.radius)?d.radius:e},u_intersectionColor:function(){return d.intersectionColor},u_erosion:function(){return d.erosion}},this._mode=u.SCENE3D};return w.prototype.setDirections=function(a){this._directions=a,this._directionsDirty=!0},w.prototype.getDirections=function(){return this._directions},w.prototype._computePositions=function(){var a=this._directions,b=a.length,c=new Float32Array(3*b),d=isFinite(this.radius)?this.radius:e,f=[g.ZERO];for(var h=b-2,i=b-1,j=0;j<b;h=i++,i=j++){var l=g.fromSpherical(a[h]),m=g.fromSpherical(a[i]),n=g.fromSpherical(a[j]),o=Math.max(g.angleBetween(l,m),g.angleBetween(m,n)),p=d/Math.cos(o*.5),q=m.multiplyByScalar(p);c[i*3+0]=q.x,c[i*3+1]=q.y,c[i*3+2]=q.z,f.push(q)}return k.fromPoints(f,this._colorCommand.boundingVolume),c},w.prototype._createVertexArray=function(a){var b=this._computePositions(),c=this._directions.length,d=new Float32Array(18*c),e=0;for(var f=c-1,h=0;h<c;f=h++){var j=new g(b[f*3+0],b[f*3+1],b[f*3+2]),k=new g(b[h*3+0],b[h*3+1],b[h*3+2]),l=k.cross(j).normalize();d[e++]=0,d[e++]=0,d[e++]=0,d[e++]=l.x,d[e++]=l.y,d[e++]=l.z,d[e++]=k.x,d[e++]=k.y,d[e++]=k.z,d[e++]=l.x,d[e++]=l.y,d[e++]=l.z,d[e++]=j.x,d[e++]=j.y,d[e++]=j.z,d[e++]=l.x,d[e++]=l.y,d[e++]=l.z}var m=a.createVertexBuffer(new Float32Array(d),this.bufferUsage),n=6*Float32Array.BYTES_PER_ELEMENT,o=[{index:v.position,vertexBuffer:m,componentsPerAttribute:3,componentDatatype:i.FLOAT,offsetInBytes:0,strideInBytes:n},{index:v.normal,vertexBuffer:m,componentsPerAttribute:3,componentDatatype:i.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:n}];return a.createVertexArray(o)},w.prototype.update=function(b,d,e){this._mode=d.mode;if(!this.show||this._mode!==u.SCENE3D)return;if(this.radius<0)throw new a("this.radius must be greater than or equal to zero.");if(typeof this.material=="undefined")throw new a("this.material must be defined.");typeof this._colorCommand.renderState=="undefined"&&(this._colorCommand.renderState=this._pickCommand.renderState=b.createRenderState({depthTest:{enabled:!0},depthMask:!1,blending:m.ALPHA_BLEND})),this._colorCommand.renderState.depthTest.enabled=!this.showThroughEllipsoid;if(this._directionsDirty||this._bufferUsage!==this.bufferUsage){this._directionsDirty=!1,this._bufferUsage=this.bufferUsage,this._va=this._va&&this._va.destroy();var f=this._directions;f&&f.length>=3&&(this._colorCommand.vertexArray=this._pickCommand.vertexArray=this._createVertexArray(b))}if(typeof this._colorCommand.vertexArray=="undefined")return;var g=d.passes;this._colorCommand.modelMatrix=this._pickCommand.modelMatrix=this.modelMatrix,this._commandLists.removeAll();if(g.color){var h=typeof this._material=="undefined"||this._material!==this.material;if(h){this._material=this.material;var i="#line 0\n"+q+"#line 0\n"+r+"#line 0\n"+this._material.shaderSource+"#line 0\n"+t;this._colorCommand.shaderProgram=this._colorCommand.shaderProgram&&this._colorCommand.shaderProgram.release(),this._colorCommand.shaderProgram=b.getShaderCache().getShaderProgram(s,i,v),this._colorCommand.uniformMap=c([this._uniforms,this._material._uniforms],!1,!1)}this._commandLists.colorList.push(this._colorCommand)}if(g.pick){if(typeof this._pickId=="undefined"){var j="#define RENDER_FOR_PICK 1\n#line 0\n"+r+"#line 0\n"+t;this._pickCommand.shaderProgram=b.getShaderCache().getShaderProgram(s,j,v),this._pickId=b.createPickId(this._pickIdThis);var k=this;this._pickCommand.uniformMap=c([this._uniforms,{u_pickColor:function(){return k._pickId.normalizedRgba}}],!1,!1)}this._commandLists.pickList.push(this._pickCommand)}this._commandLists.empty()||e.push(this._commandLists)},w.prototype.isDestroyed=function(){return!1},w.prototype.destroy=function(){return this._colorCommand.vertexArray=this._colorCommand.vertexArray&&this._colorCommand.vertexArray.destroy(),this._colorCommand.shaderProgram=this._colorCommand.shaderProgram&&this._colorCommand.shaderProgram.release(),this._pickCommand.shaderProgram=this._pickCommand.shaderProgram&&this._pickCommand.shaderProgram.release(),this._pickId=this._pickId&&this._pickId.destroy(),d(this)},w}),c("DynamicScene/DynamicConeVisualizerUsingCustomSensor",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/Spherical","../Scene/CustomSensorVolume","../Scene/Material"],function(a,b,c,d,e,f,g,h,i,j){function l(a,b,c,d){var e=b[a];typeof e=="undefined"&&(b[a]=e=new h),e.clock=c,e.cone=d,e.magnitude=1}function m(a,b,c,d,f){var g,h=0,i=e.toRadians(2);if(a===0&&b===e.TWO_PI)for(g=0;g<e.TWO_PI;g+=i)l(h++,f,g,d);else{for(g=a;g<b;g+=i)l(h++,f,g,d);l(h++,f,b,d);if(c){for(g=b;g>a;g-=i)l(h++,f,g,c);l(h++,f,a,c)}else l(h++,f,b,0)}return f.length=h,f}var k=new f,n=function(a,c){if(typeof a=="undefined")throw new b("scene is required.");this._scene=a,this._unusedIndexes=[],this._primitives=a.getPrimitives(),this._coneCollection=[],this._dynamicObjectCollection=undefined,this._directionsScratch=[],this.setDynamicObjectCollection(c)};n.prototype.getScene=function(){return this._scene},n.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},n.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(n.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(n.prototype._onObjectsRemoved,this))},n.prototype.update=function(a){if(typeof a=="undefined")throw new b("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(a,c[d])}},n.prototype.removeAllPrimitives=function(){var a,b;for(a=0,b=this._coneCollection.length;a<b;a++)this._primitives.remove(this._coneCollection[a]);if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(a=c.length-1;a>-1;a--)c[a]._coneVisualizerIndex=undefined}this._unusedIndexes=[],this._coneCollection=[]},n.prototype.isDestroyed=function(){return!1},n.prototype.destroy=function(){return this.removeAllPrimitives(),c(this)};var o,p,q;return n.prototype._updateObject=function(b,c){var h=this._scene.getContext(),l=c.cone;if(typeof l=="undefined")return;var n=c.position;if(typeof n=="undefined")return;var r=c.orientation;if(typeof r=="undefined")return;var s,t=l.show,u=c._coneVisualizerIndex,v=c.isAvailable(b)&&(typeof t=="undefined"||t.getValue(b));if(!v){typeof u!="undefined"&&(s=this._coneCollection[u],s.show=!1,c._coneVisualizerIndex=undefined,this._unusedIndexes.push(u));return}if(typeof u=="undefined"){var w=this._unusedIndexes,x=w.length;x>0?(u=w.pop(),s=this._coneCollection[u]):(u=this._coneCollection.length,s=new i,this._coneCollection.push(s),this._primitives.add(s)),c._coneVisualizerIndex=u,s.dynamicObject=c,s.material=j.fromType(h,j.ColorType),s.intersectionColor=d.YELLOW,s.radius=Number.POSITIVE_INFINITY,s.showIntersection=!0}else s=this._coneCollection[u];s.show=!0;var y,z=l.minimumClockAngle;typeof z!="undefined"&&(y=z.getValue(b)),typeof y=="undefined"&&(y=0);var A;z=l.maximumClockAngle,typeof z!="undefined"&&(A=z.getValue(b)),typeof A=="undefined"&&(A=e.TWO_PI);var B;z=l.innerHalfAngle,typeof z!="undefined"&&(B=z.getValue(b)),typeof B=="undefined"&&(B=0);var C;z=l.outerHalfAngle,typeof z!="undefined"&&(C=z.getValue(b)),typeof C=="undefined"&&(C=Math.PI);if(y!==s.minimumClockAngle||A!==s.maximumClockAngle||B!==s.innerHalfAngle||C!==s.outerHalfAngle)s.setDirections(m(y,A,B,C,this._directionsScratch)),s.innerHalfAngle=B,s.maximumClockAngle=A,s.outerHalfAngle=C,s.minimumClockAngle=y;z=l.radius;if(typeof z!="undefined"){var D=z.getValue(b);typeof D!="undefined"&&(s.radius=D)}o=a(n.getValueCartesian(b,o),s._visualizerPosition),p=a(r.getValue(b,p),s._visualizerOrientation),typeof o!="undefined"&&typeof p!="undefined"&&(!o.equals(s._visualizerPosition)||!p.equals(s._visualizerOrientation))&&(g.fromRotationTranslation(f.fromQuaternion(p,k),o,s.modelMatrix),o.clone(s._visualizerPosition),p.clone(s._visualizerOrientation));var E=l.outerMaterial;typeof E!="undefined"&&(s.material=E.getValue(b,h,s.material)),z=l.intersectionColor,typeof z!="undefined"&&(q=z.getValue(b,q),typeof q!="undefined"&&(s.intersectionColor=q))},n.prototype._onObjectsRemoved=function(a,b){var c=this._coneCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._coneVisualizerIndex;if(typeof g!="undefined"){var h=c[g];h.show=!1,d.push(g),f._coneVisualizerIndex=undefined}}},n}),c("DynamicScene/DynamicPyramidVisualizer",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Matrix3","../Core/Matrix4","../Scene/CustomSensorVolume","../Scene/Material"],function(a,b,c,d,e,f,g,h){var i=new e,j=function(a,c){if(typeof a=="undefined")throw new b("scene is required.");this._scene=a,this._unusedIndexes=[],this._primitives=a.getPrimitives(),this._pyramidCollection=[],this._dynamicObjectCollection=undefined,this.setDynamicObjectCollection(c)};j.prototype.getScene=function(){return this._scene},j.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},j.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(j.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(j.prototype._onObjectsRemoved,this))},j.prototype.update=function(a){if(typeof a=="undefined")throw new b("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(a,c[d])}},j.prototype.removeAllPrimitives=function(){var a,b;for(a=0,b=this._pyramidCollection.length;a<b;a++)this._primitives.remove(this._pyramidCollection[a]);if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(a=c.length-1;a>-1;a--)c[a]._pyramidVisualizerIndex=undefined}this._unusedIndexes=[],this._pyramidCollection=[]},j.prototype.isDestroyed=function(){return!1},j.prototype.destroy=function(){return this.removeAllPrimitives(),c(this)};var k,l;return j.prototype._updateObject=function(b,c){var j=this._scene.getContext(),m=c.pyramid;if(typeof m=="undefined")return;var n=m.directions;if(typeof n=="undefined")return;var o=c.position;if(typeof o=="undefined")return;var p=c.orientation;if(typeof p=="undefined")return;var q,r=m.show,s=c._pyramidVisualizerIndex,t=c.isAvailable(b)&&(typeof r=="undefined"||r.getValue(b));if(!t){typeof s!="undefined"&&(q=this._pyramidCollection[s],q.show=!1,c._pyramidVisualizerIndex=undefined,this._unusedIndexes.push(s));return}if(typeof s=="undefined"){var u=this._unusedIndexes,v=u.length;v>0?(s=u.pop(),q=this._pyramidCollection[s]):(s=this._pyramidCollection.length,q=new g,this._pyramidCollection.push(q),this._primitives.add(q)),c._pyramidVisualizerIndex=s,q.dynamicObject=c,q.radius=Number.POSITIVE_INFINITY,q.showIntersection=!0,q.intersectionColor=d.YELLOW,q.material=h.fromType(j,h.ColorType)}else q=this._pyramidCollection[s];q.show=!0;var w=n.getValueSpherical(b);typeof w!="undefined"&&q._visualizerDirections!==w&&(q.setDirections(w),q._visualizerDirections=w),k=a(o.getValueCartesian(b,k),q._visualizerPosition),l=a(p.getValue(b,l),q._visualizerOrientation),typeof k!="undefined"&&typeof l!="undefined"&&(!k.equals(q._visualizerPosition)||!l.equals(q._visualizerOrientation))&&(f.fromRotationTranslation(e.fromQuaternion(l,i),k,q.modelMatrix),k.clone(q._visualizerPosition),l.clone(q._visualizerOrientation));var x=m.material;typeof x!="undefined"&&(q.material=x.getValue(b,j,q.material));var y=m.intersectionColor;if(typeof y!="undefined"){var z=y.getValue(b,z);typeof z!="undefined"&&(q.intersectionColor=z)}y=m.radius;if(typeof y!="undefined"){var A=y.getValue(b,A);typeof A!="undefined"&&(q.radius=A)}},j.prototype._onObjectsRemoved=function(a,b){var c=this._pyramidCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._pyramidVisualizerIndex;if(typeof g!="undefined"){var h=c[g];h.show=!1,d.push(g),f._pyramidVisualizerIndex=undefined}}},j}),c("Scene/EllipsoidPrimitive",["../Core/BoxTessellator","../Core/Cartesian3","../Core/Cartesian4","../Core/Color","../Core/combine","../Core/ComponentDatatype","../Core/DeveloperError","../Core/destroyObject","../Core/Ellipsoid","../Core/Matrix4","../Core/MeshFilters","../Core/BoundingSphere","../Core/PrimitiveType","../Renderer/CullFace","../Renderer/BlendingState","../Renderer/BufferUsage","../Renderer/CommandLists","../Renderer/DrawCommand","./Material","./SceneMode","../Shaders/Noise","../Shaders/EllipsoidVS","../Shaders/EllipsoidFS"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function A(c){var d=z[c.getId()];if(typeof d!="undefined"&&typeof d.vertexArray!="undefined")return++d.referenceCount,d;var e=a.compute({dimensions:new b(2,2,2)}),f=c.createVertexArrayFromMesh({mesh:e,attributeIndices:x,bufferUsage:p.STATIC_DRAW}),g={vertexArray:f,referenceCount:1,release:function(){return typeof this.vertexArray!="undefined"&&--this.referenceCount===0&&(this.vertexArray=this.vertexArray.destroy()),undefined}};return z[c.getId()]=g,g}var x={position:0},y=function(){this.center=b.ZERO.clone(),this.radii=undefined,this._radii=new b,this._oneOverEllipsoidRadiiSquared=new b,this._boundingSphere=new l,this.modelMatrix=j.IDENTITY.clone(),this._computedModelMatrix=j.IDENTITY.clone(),this.show=!0,this.material=s.fromType(undefined,s.ColorType),this._material=undefined,this._sp=undefined,this._rs=undefined,this._va=undefined,this._pickSP=undefined,this._pickMaterial=undefined,this._pickId=undefined,this._colorCommand=new r,this._pickCommand=new r,this._commandLists=new q;var a=this;this._uniforms={u_radii:function(){return a.radii},u_oneOverEllipsoidRadiiSquared:function(){return a._oneOverEllipsoidRadiiSquared}}},z={};return y.prototype.update=function(a,c,d){if(!this.show||c.mode!==t.SCENE3D||typeof this.center=="undefined"||typeof this.radii=="undefined")return;if(typeof this.material=="undefined")throw new g("this.material must be defined.");typeof this._rs=="undefined"&&(this._rs=a.createRenderState({cull:{enabled:!0,face:n.FRONT},depthTest:{enabled:!0},depthMask:!1,blending:o.ALPHA_BLEND})),typeof this._va=="undefined"&&(this._va=A(a));var f=this.radii;if(!b.equals(this._radii,f)){b.clone(f,this._radii);var h=this._oneOverEllipsoidRadiiSquared;h.x=1/(f.x*f.x),h.y=1/(f.y*f.y),h.z=1/(f.z*f.z),this._boundingSphere.radius=b.getMaximumComponent(f)}j.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix);var i=this._commandLists;i.removeAll();if(c.passes.color){var k=this._colorCommand;if(typeof this._material=="undefined"||this._material!==this.material){this._material=this.material;var l="#line 0\n"+u+"#line 0\n"+this.material.shaderSource+"#line 0\n"+w;this._sp=this._sp&&this._sp.release(),this._sp=a.getShaderCache().getShaderProgram(v,l,x),k.primitiveType=m.TRIANGLES,k.vertexArray=this._va.vertexArray,k.renderState=this._rs,k.shaderProgram=this._sp,k.uniformMap=e([this._uniforms,this._material._uniforms],!1,!1)}k.boundingVolume=this._boundingSphere,k.modelMatrix=this._computedModelMatrix,i.colorList.push(k)}if(c.passes.pick){var p=this._pickCommand;if(typeof this._pickId=="undefined"){var q=a.createPickId(this),r=s.fromType(a,s.ColorType);r.uniforms.color=q.normalizedRgba;var y="#line 0\n"+u+"#line 0\n"+r.shaderSource+"#line 0\n"+w;this._pickId=q,this._pickMaterial=r,this._pickSP=a.getShaderCache().getShaderProgram(v,y,x),p.primitiveType=m.TRIANGLES,p.vertexArray=this._va.vertexArray,p.renderState=this._rs,p.shaderProgram=this._pickSP,p.uniformMap=e([this._uniforms,r._uniforms],!1,!1)}p.boundingVolume=this._boundingSphere,p.modelMatrix=this._computedModelMatrix,i.pickList.push(p)}d.push(this._commandLists)},y.prototype.isDestroyed=function(){return!1},y.prototype.destroy=function(){return this._sp=this._sp&&this._sp.release(),this._va=this._va&&this._va.release(),this._pickSP=this._pickSP&&this._pickSP.release(),this._pickId=this._pickId&&this._pickId.destroy(),h(this)},y}),c("DynamicScene/DynamicEllipsoidVisualizer",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Matrix3","../Core/Matrix4","../Scene/EllipsoidPrimitive","../Scene/Material"],function(a,b,c,d,e,f,g,h){var i=new e,j=function(a,c){if(typeof a=="undefined")throw new b("scene is required.");this._scene=a,this._unusedIndexes=[],this._primitives=a.getPrimitives(),this._ellipsoidCollection=[],this._dynamicObjectCollection=undefined,this.setDynamicObjectCollection(c)};j.prototype.getScene=function(){return this._scene},j.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},j.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(j.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(j.prototype._onObjectsRemoved,this))},j.prototype.update=function(a){if(typeof a=="undefined")throw new b("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(a,c[d])}},j.prototype.removeAllPrimitives=function(){var a,b;for(a=0,b=this._ellipsoidCollection.length;a<b;a++)this._primitives.remove(this._ellipsoidCollection[a]);if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(a=c.length-1;a>-1;a--)c[a]._ellipsoidVisualizerIndex=undefined}this._unusedIndexes=[],this._ellipsoidCollection=[]},j.prototype.isDestroyed=function(){return!1},j.prototype.destroy=function(){return this.removeAllPrimitives(),c(this)};var k,l;return j.prototype._updateObject=function(b,c){var d=this._scene.getContext(),j=c.ellipsoid;if(typeof j=="undefined")return;var m=j.radii;if(typeof m=="undefined")return;var n=c.position;if(typeof n=="undefined")return;var o=c.orientation;if(typeof o=="undefined")return;var p,q=j.show,r=c._ellipsoidVisualizerIndex,s=c.isAvailable(b)&&(typeof q=="undefined"||q.getValue(b));if(!s){typeof r!="undefined"&&(p=this._ellipsoidCollection[r],p.show=!1,c._ellipsoidVisualizerIndex=undefined,this._unusedIndexes.push(r));return}if(typeof r=="undefined"){var t=this._unusedIndexes,u=t.length;u>0?(r=t.pop(),p=this._ellipsoidCollection[r]):(r=this._ellipsoidCollection.length,p=new g,this._ellipsoidCollection.push(p),this._primitives.add(p)),c._ellipsoidVisualizerIndex=r,p.dynamicObject=c,p.material=h.fromType(d,h.ColorType)}else p=this._ellipsoidCollection[r];p.show=!0,p.radii=m.getValue(b,p.radii),k=a(n.getValueCartesian(b,k),p._visualizerPosition),l=a(o.getValue(b,l),p._visualizerOrientation),typeof k!="undefined"&&typeof l!="undefined"&&(!k.equals(p._visualizerPosition)||!l.equals(p._visualizerOrientation))&&(f.fromRotationTranslation(e.fromQuaternion(l,i),k,p.modelMatrix),k.clone(p._visualizerPosition),l.clone(p._visualizerOrientation));var v=j.material;typeof v!="undefined"&&(p.material=v.getValue(b,d,p.material))},j.prototype._onObjectsRemoved=function(a,b){var c=this._ellipsoidCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._ellipsoidVisualizerIndex;if(typeof g!="undefined"){var h=c[g];h.show=!1,d.push(g),f._ellipsoidVisualizerIndex=undefined}}},j}),c("Scene/Polygon",["../Core/DeveloperError","../Core/defaultValue","../Core/Color","../Core/combine","../Core/destroyObject","../Core/Cartesian2","../Core/Math","../Core/Ellipsoid","../Core/BoundingRectangle","../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartographic","../Core/ComponentDatatype","../Core/MeshFilters","../Core/PrimitiveType","../Core/EllipsoidTangentPlane","../Core/PolygonPipeline","../Core/WindingOrder","../Core/ExtentTessellator","../Core/Queue","../Renderer/BlendingState","../Renderer/BufferUsage","../Renderer/CommandLists","../Renderer/CullFace","../Renderer/DrawCommand","../Renderer/VertexLayout","./Material","./SceneMode","../Shaders/Noise","../Shaders/PolygonVS","../Shaders/PolygonFS","../Shaders/PolygonVSPick","../Shaders/PolygonFSPick"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G){function I(){this._va=undefined}function M(a,b,c){var d=new i.fromPoints(b),e=new f(d.x,d.y),g=c.attributes.position.values,h=g.length,j=new Float32Array(2*(h/3)),k=0;for(var l=0;l<h;l+=3){var n=L;n.x=g[l],n.y=g[l+1],n.z=g[l+2];var o=a.projectPointOntoPlane(n,K);o.subtract(e,o),j[k++]=o.x/d.width,j[k++]=o.y/d.height}return c.attributes.textureCoordinates={componentDatatype:m.FLOAT,componentsPerAttribute:2,values:j},c}function O(a,b,c){var d=q.cleanUp(b);if(d.length<3)return undefined;var e=p.fromPoints(d,a.ellipsoid),f=e.projectPointsOntoPlane(d,N),g=q.computeWindingOrder2D(f);g===r.CLOCKWISE&&(f.reverse(),d.reverse());var h=q.earClip2D(f),i=q.computeSubdivision(d,h,a._granularity),j=c||f;return i=M(e,j,i),i}function Q(a){var b,c=[],d;if(typeof a._extent!="undefined"&&!a._extent.isEmpty()){c.push(s.compute({extent:a._extent,generateTextureCoordinates:!0})),a._boundingVolume=j.fromExtent3D(a._extent,a._ellipsoid,a._boundingVolume);if(a._mode!==B.SCENE3D){a._boundingVolume2D=j.fromExtent2D(a._extent,a._projection,a._boundingVolume2D);var e=a._boundingVolume2D.center;a._boundingVolume2D.center=new k(0,e.x,e.y)}}else if(typeof a._positions!="undefined")d=O(a,a._positions),typeof d!="undefined"&&(c.push(d),a._boundingVolume=j.fromPoints(a._positions,a._boundingVolume));else if(typeof a._polygonHierarchy!="undefined"){var f=a._polygonHierarchy[0],g=p.fromPoints(f,a.ellipsoid),h=g.projectPointsOntoPlane(f,P);for(b=0;b<a._polygonHierarchy.length;b++)d=O(a,a._polygonHierarchy[b],h),typeof d!="undefined"&&c.push(d);c.length>0&&(a._boundingVolume=j.fromPoints(f,a._boundingVolume))}if(c.length===0)return undefined;var i=[];for(b=0;b<c.length;b++)d=c[b],d=q.scaleToGeodeticHeight(d,a.height,a.ellipsoid),d=n.reorderForPostVertexCache(d),d=n.reorderForPreVertexCache(d),a._mode===B.SCENE3D?(d.attributes.position2D={value:[0,0]},d.attributes.position3D=d.attributes.position,delete d.attributes.position):d=n.projectTo2D(d,a._projection),i=i.concat(n.fitToUnsignedShortIndices(d));if(a._mode!==B.SCENE3D){d=c[0];var l=d.attributes.position2D.values,m=[];for(b=0;b<l.length;b+=2)m.push(new k(l[b],l[b+1],0));a._boundingVolume2D=j.fromPoints(m,a._boundingVolume2D);var o=a._boundingVolume2D.center;a._boundingVolume2D.center=new k(0,o.x,o.y)}return i}function R(a,b){return b===B.SCENE3D?a.scene3D.granularity||a.granularity:a.scene2D.granularity||a.granularity}var H={position2D:0,position3D:1,textureCoordinates:2};I.prototype.getVertexArrays=function(){return this._va},I.prototype.update=function(a,b,c){if(typeof b!="undefined"){this._destroyVA();var d=[],e=b.length;for(var f=0;f<e;++f)d.push(a.createVertexArrayFromMesh({mesh:b[f],attributeIndices:H,bufferUsage:c,vertexLayout:z.INTERLEAVED}));this._va=d}else this._destroyVA()},I.prototype._destroyVA=function(){var a=this._va;if(typeof a!="undefined"){this._va=undefined;var b=a.length;for(var c=0;c<b;++c)a[c].destroy()}},I.prototype.isDestroyed=function(){return!1},I.prototype.destroy=function(){return this._destroyVA(),e(this)};var J=function(){this._sp=undefined,this._rs=undefined,this._spPick=undefined,this._rsPick=undefined,this._vertices=new I,this._pickId=undefined,this._boundingVolume=new j,this._boundingVolume2D=new j,this._commandLists=new w,this.ellipsoid=h.WGS84,this._ellipsoid=undefined,this.height=0,this._height=undefined,this.granularity=g.toRadians(1),this._granularity=undefined,this.scene2D={granularity:g.toRadians(30)},this.scene3D={},this._positions=undefined,this._extent=undefined,this._polygonHierarchy=undefined,this._createVertexArray=!1,this.show=!0,this.bufferUsage=v.STATIC_DRAW,this._bufferUsage=v.STATIC_DRAW,this.material=A.fromType(undefined,A.ColorType),this.material.uniforms.color=new c(1,1,0,.5),this._material=undefined,this.erosion=1,this._mode=B.SCENE3D,this._projection=undefined,this.morphTime=this._mode.morphTime;var a=this;this._uniforms={u_erosion:function(){return a.erosion},u_morphTime:function(){return a.morphTime},u_height:function(){return a._mode!==B.SCENE2D?a.height:0}},this._pickUniforms=undefined,this._drawUniforms=undefined};J.prototype.getPositions=function(){return this._positions},J.prototype.setPositions=function(c,d){if(typeof c!="undefined"&&c.length<3)throw new a("At least three positions are required.");this.height=b(d,0),this._extent=undefined,this._polygonHierarchy=undefined,this._positions=c,this._createVertexArray=!0},J.prototype.configureFromPolygonHierarchy=function(c,d){var e=[],f=new t;f.enqueue(c);while(f.length!==0){var g=f.dequeue(),h=g.positions;if(h.length<3)throw new a("At least three positions are required.");var i=g.holes?g.holes.length:0;if(i===0)e.push(g.positions);else{var j=[];for(var k=0;k<i;k++){var l=g.holes[k];j.push(l.positions);var m=0;l.holes&&(m=l.holes.length);for(var n=0;n<m;n++)f.enqueue(l.holes[n])}var o=q.eliminateHoles(h,j);e.push(o)}}this.height=b(d,0),this._positions=undefined,this._extent=undefined,this._polygonHierarchy=e,this._createVertexArray=!0},J.prototype.configureExtent=function(a,c){this._extent=a,this.height=b(c,0),this._positions=undefined,this._polygonHierarchy=undefined,this._createVertexArray=!0};var K=new f,L=new k,N=[],P=[];return J.prototype.update=function(b,c,e){if(typeof this.ellipsoid=="undefined")throw new a("this.ellipsoid must be defined.");if(typeof this.material=="undefined")throw new a("this.material must be defined.");var f=c.mode,g=R(this,f);if(g<0)throw new a("this.granularity and scene2D/scene3D overrides must be greater than zero.");if(!this.show)return;this._ellipsoid!==this.ellipsoid&&(this._createVertexArray=!0,this._ellipsoid=this.ellipsoid),this._height!==this.height&&(this._createVertexArray=!0,this._height=this.height),this._granularity!==g&&(this._createVertexArray=!0,this._granularity=g),this._bufferUsage!==this.bufferUsage&&(this._createVertexArray=!0,this._bufferUsage=this.bufferUsage);var h=c.scene2D.projection;this._projection!==h&&(this._createVertexArray=!0,this._projection=h),this._mode!==f&&(this._createVertexArray=this._mode===B.SCENE3D||f===B.SCENE3D,this._mode=f,typeof f.morphTime!="undefined"&&(this.morphTime=f.morphTime)),this._createVertexArray&&(this._createVertexArray=!1,this._vertices.update(b,Q(this),this.bufferUsage));if(typeof this._vertices.getVertexArrays()=="undefined")return;var i;f===B.SCENE3D?i=this._boundingVolume:f===B.COLUMBUS_VIEW||f===B.SCENE2D?i=this._boundingVolume2D:i=this._boundingVolume.union(this._boundingVolume2D);var j=c.passes,k=this._vertices.getVertexArrays(),l=k.length,m,n;this._commandLists.removeAll();if(j.color){typeof this._rs=="undefined"&&(this._rs=b.createRenderState({cull:{enabled:!0,face:x.BACK},blending:u.ALPHA_BLEND}));var p=typeof this._material=="undefined"||this._material!==this.material;if(p){this._material=this.material;var q="#line 0\n"+C+"#line 0\n"+this._material.shaderSource+"#line 0\n"+E;this._sp=this._sp&&this._sp.release(),this._sp=b.getShaderCache().getShaderProgram(D,q,H),this._drawUniforms=d([this._uniforms,this._material._uniforms],!1,!1)}m=this._commandLists.colorList,m.length=l;for(var r=0;r<l;++r)n=m[r],typeof n=="undefined"&&(n=m[r]=new y),n.boundingVolume=i,n.primitiveType=o.TRIANGLES,n.shaderProgram=this._sp,n.uniformMap=this._drawUniforms,n.vertexArray=k[r],n.renderState=this._rs}if(j.pick){if(typeof this._pickId=="undefined"){this._spPick=b.getShaderCache().getShaderProgram(F,G,H),this._rsPick=b.createRenderState({cull:{enabled:!0,face:x.BACK}}),this._pickId=b.createPickId(this);var s=this;this._pickUniforms={u_pickColor:function(){return s._pickId.normalizedRgba},u_morphTime:function(){return s.morphTime},u_height:function(){return s.height}}}m=this._commandLists.pickList,m.length=l;for(var t=0;t<l;++t)n=m[t],typeof n=="undefined"&&(n=m[t]=new y),n.boundingVolume=i,n.primitiveType=o.TRIANGLES,n.shaderProgram=this._spPick,n.uniformMap=this._pickUniforms,n.vertexArray=k[t],n.renderState=this._rsPick}this._commandLists.empty()||e.push(this._commandLists)},J.prototype.isDestroyed=function(){return!1},J.prototype.destroy=function(){return this._sp=this._sp&&this._sp.release(),this._spPick=this._spPick&&this._spPick.release(),this._vertices=this._vertices.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),e(this)},J}),c("DynamicScene/DynamicPolygonVisualizer",["../Core/DeveloperError","../Core/destroyObject","../Scene/Polygon","../Scene/Material"],function(a,b,c,d){var e=function(b,c){if(typeof b=="undefined")throw new a("scene is required.");this._scene=b,this._unusedIndexes=[],this._primitives=b.getPrimitives(),this._polygonCollection=[],this._dynamicObjectCollection=undefined,this.setDynamicObjectCollection(c)};return e.prototype.getScene=function(){return this._scene},e.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},e.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;b!==a&&(typeof b!="undefined"&&(b.objectsRemoved.removeEventListener(e.prototype._onObjectsRemoved),this.removeAllPrimitives()),this._dynamicObjectCollection=a,typeof a!="undefined"&&a.objectsRemoved.addEventListener(e.prototype._onObjectsRemoved,this))},e.prototype.update=function(b){if(typeof b=="undefined")throw new a("time is requied.");if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(var d=0,e=c.length;d<e;d++)this._updateObject(b,c[d])}},e.prototype.removeAllPrimitives=function(){var a,b;for(a=0,b=this._polygonCollection.length;a<b;a++)this._primitives.remove(this._polygonCollection[a]);if(typeof this._dynamicObjectCollection!="undefined"){var c=this._dynamicObjectCollection.getObjects();for(a=c.length-1;a>-1;a--)c[a]._polygonVisualizerIndex=undefined}this._unusedIndexes=[],this._polygonCollection=[]},e.prototype.isDestroyed=function(){return!1},e.prototype.destroy=function(){return this.removeAllPrimitives(),b(this)},e.prototype._updateObject=function(a,b){var e=this._scene.getContext(),f=b.polygon;if(typeof f=="undefined")return;var g=b.vertexPositions;if(typeof g=="undefined")return;var h=g.getValueCartesian(a),i,j=f.show,k=b._polygonVisualizerIndex,l=b.isAvailable(a)&&(typeof j=="undefined"||j.getValue(a));if(!l||typeof h=="undefined"||h.length<3){typeof k!="undefined"&&(i=this._polygonCollection[k],i.show=!1,b._polygonVisualizerIndex=undefined,this._unusedIndexes.push(k));return}if(typeof k=="undefined"){var m=this._unusedIndexes,n=m.length;n>0?(k=m.pop(),i=this._polygonCollection[k]):(k=this._polygonCollection.length,i=new c,this._polygonCollection.push(i),this._primitives.add(i)),b._polygonVisualizerIndex=k,i.dynamicObject=b,i.material=d.fromType(e,d.ColorType)}else i=this._polygonCollection[k];i.show=!0,i._visualizerPositions!==h&&(i.setPositions(h),i._visualizerPositions=h);var o=f.material;typeof o!="undefined"&&(i.material=o.getValue(a,e,i.material))},e.prototype._onObjectsRemoved=function(a,b){var c=this._polygonCollection,d=this._unusedIndexes;for(var e=b.length-1;e>-1;e--){var f=b[e],g=f._polygonVisualizerIndex;if(typeof g!="undefined"){var h=c[g];h.show=!1,d.push(g),f._polygonVisualizerIndex=undefined}}},e}),c("DynamicScene/CzmlDefaults",["./DynamicObject","./DynamicBillboard","./DynamicEllipsoid","./DynamicCone","./DynamicLabel","./DynamicPath","./DynamicPoint","./DynamicPolygon","./DynamicPolyline","./DynamicPyramid","./DynamicBillboardVisualizer","./DynamicEllipsoidVisualizer","./DynamicConeVisualizerUsingCustomSensor","./DynamicLabelVisualizer","./DynamicPathVisualizer","./DynamicPointVisualizer","./DynamicPolygonVisualizer","./DynamicPolylineVisualizer","./DynamicPyramidVisualizer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t={updaters:[b.processCzmlPacket,c.processCzmlPacket,d.processCzmlPacket,e.processCzmlPacket,f.processCzmlPacket,g.processCzmlPacket,h.processCzmlPacket,i.processCzmlPacket,j.processCzmlPacket,a.processCzmlPacketPosition,a.processCzmlPacketViewFrom,a.processCzmlPacketOrientation,a.processCzmlPacketVertexPositions,a.processCzmlPacketAvailability],mergers:[b.mergeProperties,c.mergeProperties,d.mergeProperties,e.mergeProperties,f.mergeProperties,g.mergeProperties,h.mergeProperties,i.mergeProperties,j.mergeProperties,a.mergeProperties],cleaners:[b.undefineProperties,c.undefineProperties,d.undefineProperties,e.undefineProperties,f.undefineProperties,g.undefineProperties,h.undefineProperties,i.undefineProperties,j.undefineProperties,a.undefineProperties],createVisualizers:function(a){return[new k(a),new l(a),new m(a),new n(a),new p(a),new q(a),new r(a),new s(a),new o(a)]}};return t}),c("DynamicScene/CompositeDynamicObjectCollection",["../Core/Event","../Core/Iso8601","../Core/TimeInterval","../Core/DeveloperError","./DynamicObject","./DynamicObjectCollection","./CzmlDefaults"],function(a,b,c,d,e,f,g){var h=function(b,c,d){this._hash={},this._array=[],this._collections=[],this.mergeFunctions=typeof c=="undefined"?g.mergers:c,this.cleanFunctions=typeof d=="undefined"?g.cleaners:d,this.objectPropertiesChanged=new a,this.objectsRemoved=new a,this.setCollections(b)};return h.prototype.computeAvailability=function(){var a=b.MAXIMUM_VALUE,d=b.MINIMUM_VALUE,e,f,g,h=this._collections;for(e=0,f=h.length;e<f;e++){g=h[e];var i=g.computeAvailability(),j=i.start,k=i.stop;j.lessThan(a)&&!j.equals(b.MINIMUM_VALUE)&&(a=i.start),k.greaterThan(d)&&!k.equals(b.MAXIMUM_VALUE)&&(d=i.stop)}return a===b.MAXIMUM_VALUE&&(a=b.MINIMUM_VALUE),d===b.MINIMUM_VALUE&&(d=b.MAXIMUM_VALUE),new c(a,d,!0,!0)},h.prototype.getCollections=function(){return this._collections.slice(0)},h.prototype.setCollections=function(a){a=typeof a!="undefined"?a:[];var b=this._collections;if(a!==b){var c,d;for(d=b.length-1;d>-1;d--)c=b[d],c.compositeCollection=undefined,c.objectPropertiesChanged.removeEventListener(h.prototype._onObjectPropertiesChanged);b=this._collections=a,this._clearObjects();var e=this.mergeFunctions;for(d=b.length-1;d>-1;d--){c=b[d],c.compositeCollection=this,c.objectPropertiesChanged.addEventListener(h.prototype._onObjectPropertiesChanged,this);var f=c.getObjects();for(var g=f.length-1;g>-1;g--){var i=f[g],j=this._getOrCreateObject(i.id);for(var k=e.length-1;k>-1;k--){var l=e[k];l(j,i)}}}}},h.prototype.getObject=function(a){if(typeof a=="undefined")throw new d("id is required.");return this._hash[a]},h.prototype.getObjects=function(){return this._array},h.prototype.clear=function(){this.setCollections([])},h.prototype._getOrCreateObject=function(a){var b=this._hash[a];return b||(b=new e(a),this._hash[a]=b,this._array.push(b)),b},h.prototype._clearObjects=function(){var a=this._array;this._hash={},this._array=[],a.length>0&&this.objectsRemoved.raiseEvent(this,a)},h.prototype._onObjectPropertiesChanged=function(a,b){var c=this.mergeFunctions,d=this.cleanFunctions,e=this._collections,f,g,h=[];for(var i=b.length-1;i>-1;i--){f=b[i],g=this.getObject(f.id);if(typeof g!="undefined")for(var j=d.length-1;j>-1;j--){var k=d[j];k(g)}else g=this._getOrCreateObject(f.id);h.push(g);for(var l=e.length-1;l>-1;l--){var m=e[l],n=m.getObject(f.id);if(typeof n!="undefined")for(var o=c.length-1;o>-1;o--){var p=c[o];p(g,n)}}}h.length>0&&this.objectPropertiesChanged.raiseEvent(this,h)},h}),c("DynamicScene/VisualizerCollection",["../Core/DeveloperError","../Core/destroyObject","./CzmlDefaults"],function(a,b,c){var d=function(a,b){typeof a=="undefined"&&(a=[]),this._visualizers=a,this._dynamicObjectCollection=undefined,this.setDynamicObjectCollection(b)};return d.createCzmlStandardCollection=function(b,e){if(typeof b=="undefined")throw new a("scene is required.");return new d(c.createVisualizers(b),e)},d.prototype.getVisualizers=function(){return this._visualizers.slice(0)},d.prototype.setVisualizers=function(a,b){b=typeof b!="undefined"?b:!0;var c,d=this._visualizers;if(b)for(c=d.length-1;c>-1;c--){var e=d[c];a.indexOf(e)===-1&&e.destroy()}typeof a=="undefined"&&(a=[]),this._visualizers=a;var f=this._dynamicObjectCollection;for(c=a.length-1;c>-1;c--)a[c].setDynamicObjectCollection(f)},d.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},d.prototype.setDynamicObjectCollection=function(a){var b=this._dynamicObjectCollection;if(b!==a){this._dynamicObjectCollection=a;var c=this._visualizers;for(var d=c.length-1;d>-1;d--)c[d].setDynamicObjectCollection(a)}},d.prototype.update=function(a){var b=this._visualizers;for(var c=b.length-1;c>-1;c--)b[c].update(a)},d.prototype.removeAllPrimitives=function(){var a=this._visualizers;for(var b=a.length-1;b>-1;b--)a[b].removeAllPrimitives()},d.prototype.isDestroyed=function(){return!1},d.prototype.destroy=function(a){a=typeof a!="undefined"?a:!0,this.removeAllPrimitives();if(a){var c=this._visualizers;for(var d=c.length-1;d>-1;d--)c[d].destroy()}return b(this)},d}),c("DynamicScene/processCzml",["../Core/createGuid","../Core/DeveloperError","./CzmlDefaults"],function(a,b,c){function d(b,c,d,e,f,g){var h=b.id;typeof h=="undefined"&&(h=a());var i=c.getOrCreateObject(h);for(var j=f.length-1;j>-1;j--)f[j](i,b,c,g)&&typeof e[h]=="undefined"&&(e[h]=!0,d.push(i))}var e=function(a,e,f,g){if(typeof a=="undefined")throw new b("czml is required.");if(typeof e=="undefined")throw new b("dynamicObjectCollection is required.");var h=[],i={};g=typeof g!="undefined"?g:c.updaters;if(Array.isArray(a))for(var j=0,k=a.length;j<k;j++)d(a[j],e,h,i,g,f);else d(a,e,h,i,g,f);return h.length>0&&e.objectPropertiesChanged.raiseEvent(e,h),h};return e}),c("Scene/RectangularPyramidSensorVolume",["../Core/DeveloperError","../Core/Color","../Core/destroyObject","../Core/Math","../Core/Matrix4","../Renderer/BufferUsage","./Material","./CustomSensorVolume"],function(a,b,c,d,e,f,g,h){var i=function(a){var c=a||{};this.show=typeof c.show=="undefined"?!0:c.show,this.showIntersection=typeof c.showIntersection=="undefined"?!0:c.showIntersection,this.showThroughEllipsoid=typeof c.showThroughEllipsoid=="undefined"?!1:c.showThroughEllipsoid,this.modelMatrix=c.modelMatrix||e.IDENTITY.clone(),this.bufferUsage=c.bufferUsage||f.STATIC_DRAW,this.radius=typeof c.radius=="undefined"?Number.POSITIVE_INFINITY:c.radius,this.xHalfAngle=typeof c.xHalfAngle=="undefined"?d.PI_OVER_TWO:c.xHalfAngle,this._xHalfAngle=undefined,this.yHalfAngle=typeof c.yHalfAngle=="undefined"?d.PI_OVER_TWO:c.yHalfAngle,this._yHalfAngle=undefined,this.material=typeof c.material!="undefined"?c.material:g.fromType(undefined,g.ColorType),this.intersectionColor=typeof c.intersectionColor!="undefined"?b.clone(c.intersectionColor):b.clone(b.WHITE),this.erosion=typeof c.erosion=="undefined"?1:c.erosion,c._pickIdThis=c._pickIdThis||this,this._customSensor=new h(c)};return i.prototype.update=function(b,c,e){if(this.xHalfAngle>d.PI_OVER_TWO||this.yHalfAngle>d.PI_OVER_TWO)throw new a("this.xHalfAngle and this.yHalfAngle must each be less than or equal to 90 degrees.");var f=this._customSensor;f.show=this.show,f.showIntersection=this.showIntersection,f.showThroughEllipsoid=this.showThroughEllipsoid,f.modelMatrix=this.modelMatrix,f.bufferUsage=this.bufferUsage,f.radius=this.radius,f.material=this.material,f.intersectionColor=this.intersectionColor,f.erosion=this.erosion;if(this._xHalfAngle!==this.xHalfAngle||this._yHalfAngle!==this.yHalfAngle){this._xHalfAngle=this.xHalfAngle,this._yHalfAngle=this.yHalfAngle;var g=Math.tan(Math.min(this.xHalfAngle,d.toRadians(89))),h=Math.tan(Math.min(this.yHalfAngle,d.toRadians(89))),i=Math.atan(g/h),j=Math.atan(Math.sqrt(g*g+h*h));f.setDirections([{clock:i,cone:j},{clock:d.toRadians(180)-i,cone:j},{clock:d.toRadians(180)+i,cone:j},{clock:-i,cone:j}])}f.update(b,c,e)},i.prototype.isDestroyed=function(){return!1},i.prototype.destroy=function(){return this._customSensor=this._customSensor&&this._customSensor.destroy(),c(this)},i}),c("Scene/SensorVolumeCollection",["../Core/defaultValue","../Core/destroyObject","../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartesian4","../Core/DeveloperError","../Core/Intersect","../Core/Matrix4","./ComplexConicSensorVolume","./CustomSensorVolume","./RectangularPyramidSensorVolume","./SceneMode"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=function(){this._sensors=[]};return m.prototype.addRectangularPyramid=function(a){var b=new k(a);return this._sensors.push(b),b},m.prototype.addComplexConic=function(a){var b=new i(a);return this._sensors.push(b),b},m.prototype.addCustom=function(a){var b=new j(a);return this._sensors.push(b),b},m.prototype.remove=function(a){if(a){var b=this._sensors,c=b.indexOf(a);if(c!==-1)return b[c].destroy(),b.splice(c,1),!0}return!1},m.prototype.removeAll=function(){var a=this._sensors,b=a.length;for(var c=0;c<b;++c)a[c].destroy();this._sensors=[]},m.prototype.contains=function(a){return a?this._sensors.indexOf(a)!==-1:!1},m.prototype.get=function(a){if(typeof a=="undefined")throw new f("index is required.");return this._sensors[a]},m.prototype.getLength=function(){return this._sensors.length},m.prototype.update=function(a,b,c){var d=b.mode;if(d!==l.SCENE3D)return;var e=this._sensors,f=e.length;for(var g=0;g<f;++g)e[g].update(a,b,c)},m.prototype.isDestroyed=function(){return!1},m.prototype.destroy=function(){return this.removeAll(),b(this)},m}),c("Scene/SingleTileImageryProvider",["../Core/defaultValue","../Core/loadImage","../Core/writeTextToCanvas","../Core/DeveloperError","../Core/Event","../Core/Extent","./GeographicTilingScheme","./ImageryProviderError","../ThirdParty/when"],function(a,b,c,d,e,f,g,h,i){var j=function(j){function r(a){p._image=a,p._tileWidth=a.width,p._tileHeight=a.height,p._ready=!0,h.handleSuccess(p._errorEvent)}function s(a){var b="Failed to load image "+o+".";q=h.handleError(q,p,p._errorEvent,b,0,0,0,t)}function t(){i(b(o),r,s)}j=a(j,{});var k=j.url;if(typeof k=="undefined")throw new d("url is required.");this._url=k;var l=j.proxy;this._proxy=l;var m=a(j.extent,f.MAX_VALUE),n=new g({extent:m,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1});this._tilingScheme=n,this._image=undefined,this._texture=undefined,this._tileWidth=0,this._tileHeight=0,this._errorEvent=new e,this._ready=!1;var o=k;typeof l!="undefined"&&(o=l.getURL(o)),typeof j.credit!="undefined"&&(this._logo=c(j.credit,{font:"12px sans-serif"}));var p=this,q;t()};return j.prototype.getUrl=function(){return this._url},j.prototype.getTileWidth=function(){if(!this._ready)throw new d("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},j.prototype.getTileHeight=function(){if(!this._ready)throw new d("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},j.prototype.getMaximumLevel=function(){if(!this._ready)throw new d("getMaximumLevel must not be called before the imagery provider is ready.");return 0},j.prototype.getTilingScheme=function(){if(!this._ready)throw new d("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},j.prototype.getExtent=function(){return this._tilingScheme.getExtent()},j.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new d("getTileDiscardPolicy must not be called before the imagery provider is ready.");return undefined},j.prototype.getErrorEvent=function(){return this._errorEvent},j.prototype.isReady=function(){return this._ready},j.prototype.requestImage=function(a,b,c){if(!this._ready)throw new d("requestImage must not be called before the imagery provider is ready.");return this._image},j.prototype.getLogo=function(){if(!this._ready)throw new d("getLogo must not be called before the imagery provider is ready.");return this._logo},j}),c("Cesium",["Core/AnimationController","Core/AxisAlignedBoundingBox","Core/BoundingRectangle","Core/BoundingSphere","Core/BoxTessellator","Core/Cartesian2","Core/Cartesian3","Core/Cartesian4","Core/Cartographic","Core/CatmullRomSpline","Core/Clock","Core/ClockRange","Core/ClockStep","Core/Color","Core/ComponentDatatype","Core/CubeMapEllipsoidTessellator","Core/CubicRealPolynomial","Core/DefaultProxy","Core/DeveloperError","Core/Ellipsoid","Core/EllipsoidTangentPlane","Core/EllipsoidalOccluder","Core/EncodedCartesian3","Core/Enumeration","Core/Event","Core/EventHandler","Core/EventModifier","Core/Extent","Core/ExtentTessellator","Core/FAR","Core/FeatureDetection","Core/Fullscreen","Core/GeographicProjection","Core/HermitePolynomialApproximation","Core/HermiteSpline","Core/IndexDatatype","Core/Intersect","Core/IntersectionTests","Core/Interval","Core/Iso8601","Core/JulianDate","Core/LagrangePolynomialApproximation","Core/LeapSecond","Core/LinearApproximation","Core/Math","Core/Matrix2","Core/Matrix3","Core/Matrix4","Core/MeshFilters","Core/MouseEventType","Core/Occluder","Core/OrientationInterpolator","Core/PlaneTessellator","Core/PolygonPipeline","Core/PolylinePipeline","Core/PrimitiveType","Core/QuadraticRealPolynomial","Core/QuarticRealPolynomial","Core/Quaternion","Core/Queue","Core/Ray","Core/RuntimeError","Core/Shapes","Core/Spherical","Core/TaskProcessor","Core/TimeConstants","Core/TimeInterval","Core/TimeIntervalCollection","Core/TimeStandard","Core/Tipsify","Core/Transforms","Core/TridiagonalSystemSolver","Core/Visibility","Core/WebMercatorProjection","Core/WindingOrder","Core/binarySearch","Core/clone","Core/combine","Core/computeSunPosition","Core/createGuid","Core/defaultValue","Core/destroyObject","Core/freezeObject","Core/getImagePixels","Core/isLeapYear","Core/jsonp","Core/loadArrayBuffer","Core/loadImage","Core/loadJson","Core/loadText","Core/pointInsideTriangle2D","Core/requestAnimationFrame","Core/throttleRequestByServer","Core/writeTextToCanvas","DynamicScene/CompositeDynamicObjectCollection","DynamicScene/CzmlBoolean","DynamicScene/CzmlCartesian2","DynamicScene/CzmlCartesian3","DynamicScene/CzmlCartographic","DynamicScene/CzmlColor","DynamicScene/CzmlDefaults","DynamicScene/CzmlHorizontalOrigin","DynamicScene/CzmlImage","DynamicScene/CzmlLabelStyle","DynamicScene/CzmlNumber","DynamicScene/CzmlString","DynamicScene/CzmlUnitCartesian3","DynamicScene/CzmlUnitQuaternion","DynamicScene/CzmlUnitSpherical","DynamicScene/CzmlVerticalOrigin","DynamicScene/DynamicBillboard","DynamicScene/DynamicBillboardVisualizer","DynamicScene/DynamicColorMaterial","DynamicScene/DynamicCone","DynamicScene/DynamicConeVisualizer","DynamicScene/DynamicConeVisualizerUsingCustomSensor","DynamicScene/DynamicDirectionsProperty","DynamicScene/DynamicEllipsoid","DynamicScene/DynamicEllipsoidVisualizer","DynamicScene/DynamicImageMaterial","DynamicScene/DynamicLabel","DynamicScene/DynamicLabelVisualizer","DynamicScene/DynamicMaterialProperty","DynamicScene/DynamicObject","DynamicScene/DynamicObjectCollection","DynamicScene/DynamicObjectView","DynamicScene/DynamicPath","DynamicScene/DynamicPathVisualizer","DynamicScene/DynamicPoint","DynamicScene/DynamicPointVisualizer","DynamicScene/DynamicPolygon","DynamicScene/DynamicPolygonVisualizer","DynamicScene/DynamicPolyline","DynamicScene/DynamicPolylineVisualizer","DynamicScene/DynamicPositionProperty","DynamicScene/DynamicProperty","DynamicScene/DynamicPyramid","DynamicScene/DynamicPyramidVisualizer","DynamicScene/DynamicVertexPositionsProperty","DynamicScene/ReferenceProperty","DynamicScene/VisualizerCollection","DynamicScene/processCzml","Renderer/BlendEquation","Renderer/BlendFunction","Renderer/BlendingState","Renderer/Buffer","Renderer/BufferUsage","Renderer/ClearCommand","Renderer/CommandLists","Renderer/Context","Renderer/CubeMap","Renderer/CubeMapFace","Renderer/CullFace","Renderer/DepthFunction","Renderer/DrawCommand","Renderer/Framebuffer","Renderer/MipmapHint","Renderer/PickFramebuffer","Renderer/PixelDatatype","Renderer/PixelFormat","Renderer/Renderbuffer","Renderer/RenderbufferFormat","Renderer/ShaderCache","Renderer/ShaderProgram","Renderer/StencilFunction","Renderer/StencilOperation","Renderer/Texture","Renderer/TextureAtlas","Renderer/TextureAtlasBuilder","Renderer/TextureMagnificationFilter","Renderer/TextureMinificationFilter","Renderer/TextureWrap","Renderer/UniformDatatype","Renderer/UniformState","Renderer/VertexArray","Renderer/VertexArrayFacade","Renderer/VertexLayout","Renderer/loadCubeMap","Scene/AnimationCollection","Scene/ArcGisMapServerImageryProvider","Scene/Billboard","Scene/BillboardCollection","Scene/BingMapsImageryProvider","Scene/BingMapsStyle","Scene/Camera","Scene/Camera2DController","Scene/CameraCentralBodyController","Scene/CameraColumbusViewController","Scene/CameraControllerCollection","Scene/CameraEventHandler","Scene/CameraEventType","Scene/CameraFlightController","Scene/CameraFreeLookController","Scene/CameraHelpers","Scene/CameraSpindleController","Scene/CameraSpindleControllerMode","Scene/CentralBody","Scene/CentralBodySurface","Scene/CentralBodySurfaceShaderSet","Scene/ComplexConicSensorVolume","Scene/CompositePrimitive","Scene/CullingVolume","Scene/CustomSensorVolume","Scene/DiscardMissingTileImagePolicy","Scene/EllipsoidPrimitive","Scene/EllipsoidTerrainProvider","Scene/FrameState","Scene/FrustumCommands","Scene/GeographicTilingScheme","Scene/HorizontalOrigin","Scene/Imagery","Scene/ImageryLayer","Scene/ImageryLayerCollection","Scene/ImageryProvider","Scene/ImageryProviderError","Scene/ImageryState","Scene/Label","Scene/LabelCollection","Scene/LabelStyle","Scene/Material","Scene/NeverTileDiscardPolicy","Scene/OpenStreetMapImageryProvider","Scene/OrthographicFrustum","Scene/PerformanceDisplay","Scene/PerspectiveFrustum","Scene/PerspectiveOffCenterFrustum","Scene/Polygon","Scene/Polyline","Scene/PolylineCollection","Scene/Projections","Scene/RectangularPyramidSensorVolume","Scene/Scene","Scene/SceneMode","Scene/SceneTransitioner","Scene/SensorVolumeCollection","Scene/SingleTileImageryProvider","Scene/SkyAtmosphere","Scene/SkyBox","Scene/TerrainProvider","Scene/TexturePool","Scene/Tile","Scene/TileDiscardPolicy","Scene/TileImagery","Scene/TileLoadQueue","Scene/TileMapServiceImageryProvider","Scene/TileReplacementQueue","Scene/TileState","Scene/TilingScheme","Scene/VerticalOrigin","Scene/ViewportQuad","Scene/WebMapServiceImageryProvider","Scene/WebMercatorTilingScheme","Shaders/BillboardCollectionFS","Shaders/BillboardCollectionVS","Shaders/BuiltinFunctions","Shaders/CentralBodyFS","Shaders/CentralBodyFSDepth","Shaders/CentralBodyFSPole","Shaders/CentralBodyVS","Shaders/CentralBodyVSDepth","Shaders/CentralBodyVSPole","Shaders/ComplexConicSensorVolumeFS","Shaders/ComplexConicSensorVolumeVS","Shaders/ConstructiveSolidGeometry","Shaders/CustomSensorVolumeFS","Shaders/CustomSensorVolumeVS","Shaders/EllipsoidFS","Shaders/EllipsoidVS","Shaders/Materials/AsphaltMaterial","Shaders/Materials/BlobMaterial","Shaders/Materials/BrickMaterial","Shaders/Materials/BumpMapMaterial","Shaders/Materials/CementMaterial","Shaders/Materials/CheckerboardMaterial","Shaders/Materials/DotMaterial","Shaders/Materials/FacetMaterial","Shaders/Materials/FresnelMaterial","Shaders/Materials/GrassMaterial","Shaders/Materials/NormalMapMaterial","Shaders/Materials/ReflectionMaterial","Shaders/Materials/RefractionMaterial","Shaders/Materials/StripeMaterial","Shaders/Materials/TieDyeMaterial","Shaders/Materials/Water","Shaders/Materials/WoodMaterial","Shaders/Noise","Shaders/PolygonFS","Shaders/PolygonFSPick","Shaders/PolygonVS","Shaders/PolygonVSPick","Shaders/PolylineFS","Shaders/PolylineVS","Shaders/Ray","Shaders/ReprojectWebMercatorFS","Shaders/ReprojectWebMercatorVS","Shaders/SensorVolume","Shaders/SkyAtmosphereFS","Shaders/SkyAtmosphereVS","Shaders/SkyBoxFS","Shaders/SkyBoxVS","Shaders/ViewportQuadFS","Shaders/ViewportQuadVS","ThirdParty/Tween","ThirdParty/Uri","ThirdParty/measureText","ThirdParty/when"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,sd,td,ud,vd,wd,xd,yd,zd,Ad,Bd,Cd,Dd,Ed,Fd,Gd,Hd,Id,Jd,Kd,Ld,Md,Nd,Od,Pd,Qd,Rd,Sd,Td,Ud,Vd,Wd,Xd,Yd,Zd,$d,_d,ae,be,ce,de,ee,fe,ge,he,ie,je,ke,le,me,ne,oe,pe,qe,re,se,te,ue,ve,we,xe,ye,ze,Ae,Be,Ce,De,Ee,Fe,Ge,He,Ie,Je,Ke,Le,Me,Ne,Oe,Pe,Qe,Re,Se,Te,Ue,Ve,We,Xe,Ye,Ze,$e,_e,af,bf,cf,df,ef,ff,gf,hf,jf,kf,lf,mf,nf,of,pf,qf,rf,sf,tf,uf,vf,wf,xf,yf,zf,Af,Bf,Cf,Df,Ef,Ff,Gf,Hf,If,Jf,Kf){var Lf={_shaders:{}};return Lf.AnimationController=a,Lf.AxisAlignedBoundingBox=b,Lf.BoundingRectangle=c,Lf.BoundingSphere=d,Lf.BoxTessellator=e,Lf.Cartesian2=f,Lf.Cartesian3=g,Lf.Cartesian4=h,Lf.Cartographic=i,Lf.CatmullRomSpline=j,Lf.Clock=k,Lf.ClockRange=l,Lf.ClockStep=m,Lf.Color=n,Lf.ComponentDatatype=o,Lf.CubeMapEllipsoidTessellator=p,Lf.CubicRealPolynomial=q,Lf.DefaultProxy=r,Lf.DeveloperError=s,Lf.Ellipsoid=t,Lf.EllipsoidTangentPlane=u,Lf.EllipsoidalOccluder=v,Lf.EncodedCartesian3=w,Lf.Enumeration=x,Lf.Event=y,Lf.EventHandler=z,Lf.EventModifier=A,Lf.Extent=B,Lf.ExtentTessellator=C,Lf.FAR=D,Lf.FeatureDetection=E,Lf.Fullscreen=F,Lf.GeographicProjection=G,Lf.HermitePolynomialApproximation=H,Lf.HermiteSpline=I,Lf.IndexDatatype=J,Lf.Intersect=K,Lf.IntersectionTests=L,Lf.Interval=M,Lf.Iso8601=N,Lf.JulianDate=O,Lf.LagrangePolynomialApproximation=P,Lf.LeapSecond=Q,Lf.LinearApproximation=R,Lf.Math=S,Lf.Matrix2=T,Lf.Matrix3=U,Lf.Matrix4=V,Lf.MeshFilters=W,Lf.MouseEventType=X,Lf.Occluder=Y,Lf.OrientationInterpolator=Z,Lf.PlaneTessellator=$,Lf.PolygonPipeline=_,Lf.PolylinePipeline=ab,Lf.PrimitiveType=bb,Lf.QuadraticRealPolynomial=cb,Lf.QuarticRealPolynomial=db,Lf.Quaternion=eb,Lf.Queue=fb,Lf.Ray=gb,Lf.RuntimeError=hb,Lf.Shapes=ib,Lf.Spherical=jb,Lf.TaskProcessor=kb,Lf.TimeConstants=lb,Lf.TimeInterval=mb,Lf.TimeIntervalCollection=nb,Lf.TimeStandard=ob,Lf.Tipsify=pb,Lf.Transforms=qb,Lf.TridiagonalSystemSolver=rb,Lf.Visibility=sb,Lf.WebMercatorProjection=tb,Lf.WindingOrder=ub,Lf.binarySearch=vb,Lf.clone=wb,Lf.combine=xb,Lf.computeSunPosition=yb,Lf.createGuid=zb,Lf.defaultValue=Ab,Lf.destroyObject=Bb,Lf.freezeObject=Cb,Lf.getImagePixels=Db,Lf.isLeapYear=Eb,Lf.jsonp=Fb,Lf.loadArrayBuffer=Gb,Lf.loadImage=Hb,Lf.loadJson=Ib,Lf.loadText=Jb,Lf.pointInsideTriangle2D=Kb,Lf.requestAnimationFrame=Lb,Lf.throttleRequestByServer=Mb,Lf.writeTextToCanvas=Nb,Lf.CompositeDynamicObjectCollection=Ob,Lf.CzmlBoolean=Pb,Lf.CzmlCartesian2=Qb,Lf.CzmlCartesian3=Rb,Lf.CzmlCartographic=Sb,Lf.CzmlColor=Tb,Lf.CzmlDefaults=Ub,Lf.CzmlHorizontalOrigin=Vb,Lf.CzmlImage=Wb,Lf.CzmlLabelStyle=Xb,Lf.CzmlNumber=Yb,Lf.CzmlString=Zb,Lf.CzmlUnitCartesian3=$b,Lf.CzmlUnitQuaternion=_b,Lf.CzmlUnitSpherical=ac,Lf.CzmlVerticalOrigin=bc,Lf.DynamicBillboard=cc,Lf.DynamicBillboardVisualizer=dc,Lf.DynamicColorMaterial=ec,Lf.DynamicCone=fc,Lf.DynamicConeVisualizer=gc,Lf.DynamicConeVisualizerUsingCustomSensor=hc,Lf.DynamicDirectionsProperty=ic,Lf.DynamicEllipsoid=jc,Lf.DynamicEllipsoidVisualizer=kc,Lf.DynamicImageMaterial=lc,Lf.DynamicLabel=mc,Lf.DynamicLabelVisualizer=nc,Lf.DynamicMaterialProperty=oc,Lf.DynamicObject=pc,Lf.DynamicObjectCollection=qc,Lf.DynamicObjectView=rc,Lf.DynamicPath=sc,Lf.DynamicPathVisualizer=tc,Lf.DynamicPoint=uc,Lf.DynamicPointVisualizer=vc,Lf.DynamicPolygon=wc,Lf.DynamicPolygonVisualizer=xc,Lf.DynamicPolyline=yc,Lf.DynamicPolylineVisualizer=zc,Lf.DynamicPositionProperty=Ac,Lf.DynamicProperty=Bc,Lf.DynamicPyramid=Cc,Lf.DynamicPyramidVisualizer=Dc,Lf.DynamicVertexPositionsProperty=Ec,Lf.ReferenceProperty=Fc,Lf.VisualizerCollection=Gc,Lf.processCzml=Hc,Lf.BlendEquation=Ic,Lf.BlendFunction=Jc,Lf.BlendingState=Kc,Lf.Buffer=Lc,Lf.BufferUsage=Mc,Lf.ClearCommand=Nc,Lf.CommandLists=Oc,Lf.Context=Pc,Lf.CubeMap=Qc,Lf.CubeMapFace=Rc,Lf.CullFace=Sc,Lf.DepthFunction=Tc,Lf.DrawCommand=Uc,Lf.Framebuffer=Vc,Lf.MipmapHint=Wc,Lf.PickFramebuffer=Xc,Lf.PixelDatatype=Yc,Lf.PixelFormat=Zc,Lf.Renderbuffer=$c,Lf.RenderbufferFormat=_c,Lf.ShaderCache=ad,Lf.ShaderProgram=bd,Lf.StencilFunction=cd,Lf.StencilOperation=dd,Lf.Texture=ed,Lf.TextureAtlas=fd,Lf.TextureAtlasBuilder=gd,Lf.TextureMagnificationFilter=hd,Lf.TextureMinificationFilter=id,Lf.TextureWrap=jd,Lf.UniformDatatype=kd,Lf.UniformState=ld,Lf.VertexArray=md,Lf.VertexArrayFacade=nd,Lf.VertexLayout=od,Lf.loadCubeMap=pd,Lf.AnimationCollection=qd,Lf.ArcGisMapServerImageryProvider=rd,Lf.Billboard=sd,Lf.BillboardCollection=td,Lf.BingMapsImageryProvider=ud,Lf.BingMapsStyle=vd,Lf.Camera=wd,Lf.Camera2DController=xd,Lf.CameraCentralBodyController=yd,Lf.CameraColumbusViewController=zd,Lf.CameraControllerCollection=Ad,Lf.CameraEventHandler=Bd,Lf.CameraEventType=Cd,Lf.CameraFlightController=Dd,Lf.CameraFreeLookController=Ed,Lf.CameraHelpers=Fd,Lf.CameraSpindleController=Gd,Lf.CameraSpindleControllerMode=Hd,Lf.CentralBody=Id,Lf.CentralBodySurface=Jd,Lf.CentralBodySurfaceShaderSet=Kd,Lf.ComplexConicSensorVolume=Ld,Lf.CompositePrimitive=Md,Lf.CullingVolume=Nd,Lf.CustomSensorVolume=Od,Lf.DiscardMissingTileImagePolicy=Pd,Lf.EllipsoidPrimitive=Qd,Lf.EllipsoidTerrainProvider=Rd,Lf.FrameState=Sd,Lf.FrustumCommands=Td,Lf.GeographicTilingScheme=Ud,Lf.HorizontalOrigin=Vd,Lf.Imagery=Wd,Lf.ImageryLayer=Xd,Lf.ImageryLayerCollection=Yd,Lf.ImageryProvider=Zd,Lf.ImageryProviderError=$d,Lf.ImageryState=_d,Lf.Label=ae,Lf.LabelCollection=be,Lf.LabelStyle=ce,Lf.Material=de,Lf.NeverTileDiscardPolicy=ee,Lf.OpenStreetMapImageryProvider=fe,Lf.OrthographicFrustum=ge,Lf.PerformanceDisplay=he,Lf.PerspectiveFrustum=ie,Lf.PerspectiveOffCenterFrustum=je,Lf.Polygon=ke,Lf.Polyline=le,Lf.PolylineCollection=me,Lf.Projections=ne,Lf.RectangularPyramidSensorVolume=oe,Lf.Scene=pe,Lf.SceneMode=qe,Lf.SceneTransitioner=re,Lf.SensorVolumeCollection=se,Lf.SingleTileImageryProvider=te,Lf.SkyAtmosphere=ue,Lf.SkyBox=ve,Lf.TerrainProvider=we,Lf.TexturePool=xe,Lf.Tile=ye,Lf.TileDiscardPolicy=ze,Lf.TileImagery=Ae,Lf.TileLoadQueue=Be,Lf.TileMapServiceImageryProvider=Ce,Lf.TileReplacementQueue=De,Lf.TileState=Ee,Lf.TilingScheme=Fe,Lf.VerticalOrigin=Ge,Lf.ViewportQuad=He,Lf.WebMapServiceImageryProvider=Ie,Lf.WebMercatorTilingScheme=Je,Lf._shaders.BillboardCollectionFS=Ke,Lf._shaders.BillboardCollectionVS=Le,Lf._shaders.BuiltinFunctions=Me,Lf._shaders.CentralBodyFS=Ne,Lf._shaders.CentralBodyFSDepth=Oe,Lf._shaders.CentralBodyFSPole=Pe,Lf._shaders.CentralBodyVS=Qe,Lf._shaders.CentralBodyVSDepth=Re,Lf._shaders.CentralBodyVSPole=Se,Lf._shaders.ComplexConicSensorVolumeFS=Te,Lf._shaders.ComplexConicSensorVolumeVS=Ue,Lf._shaders.ConstructiveSolidGeometry=Ve,Lf._shaders.CustomSensorVolumeFS=We,Lf._shaders.CustomSensorVolumeVS=Xe,Lf._shaders.EllipsoidFS=Ye,Lf._shaders.EllipsoidVS=Ze,Lf._shaders.AsphaltMaterial=$e,Lf._shaders.BlobMaterial=_e,Lf._shaders.BrickMaterial=af,Lf._shaders.BumpMapMaterial=bf,Lf._shaders.CementMaterial=cf,Lf._shaders.CheckerboardMaterial=df,Lf._shaders.DotMaterial=ef,Lf._shaders.FacetMaterial=ff,Lf._shaders.FresnelMaterial=gf,Lf._shaders.GrassMaterial=hf,Lf._shaders.NormalMapMaterial=jf,Lf._shaders.ReflectionMaterial=kf,Lf._shaders.RefractionMaterial=lf,Lf._shaders.StripeMaterial=mf,Lf._shaders.TieDyeMaterial=nf,Lf._shaders.Water=of,Lf._shaders.WoodMaterial=pf,Lf._shaders.Noise=qf,Lf._shaders.PolygonFS=rf,Lf._shaders.PolygonFSPick=sf,Lf._shaders.PolygonVS=tf,Lf._shaders.PolygonVSPick=uf,Lf._shaders.PolylineFS=vf,Lf._shaders.PolylineVS=wf,Lf._shaders.Ray=xf,Lf._shaders.ReprojectWebMercatorFS=yf,Lf._shaders.ReprojectWebMercatorVS=zf,Lf._shaders.SensorVolume=Af,Lf._shaders.SkyAtmosphereFS=Bf,Lf._shaders.SkyAtmosphereVS=Cf,Lf._shaders.SkyBoxFS=Df,Lf._shaders.SkyBoxVS=Ef,Lf._shaders.ViewportQuadFS=Ff,Lf._shaders.ViewportQuadVS=Gf,Lf.Tween=Hf,Lf.Uri=If,Lf.measureText=Jf,Lf.when=Kf,Lf}),b(["Cesium"],function(a){var b=typeof window!="undefined"?window:typeof self!="undefined"?self:{};b.Cesium=a},undefined,!0),c("main",function(){})})()